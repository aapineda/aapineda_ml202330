

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>aapineda &#8212; River Flow Forecasting = A Hybrid Approach Integrating Machine Learning and Linear Time Series Models</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Nueva carpeta/notebo';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.jpg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.jpg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Bienvenidos
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Texto.html">River Flow Forecasting: A Hybrid Approach Integrating Machine Learning and ARIMA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebo23.html">Aplicaci√≥n</a></li>

</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FNueva carpeta/notebo.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Nueva carpeta/notebo.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>aapineda</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">aapineda</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#river-flow-forecasting-a-hybrid-approach-integrating-machine-learning-and-linear-time-series-models">River Flow Forecasting: A Hybrid Approach Integrating Machine Learning and Linear Time Series Models</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resumen"><strong>Resumen</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metodologia"><strong>Metodolog√≠a</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#librerias-necesarias">Librerias Necesarias</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset">Dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#relacion-entre-enso-y-caudal">Relacion entre ENSO y Caudal</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#lag-a-los-datos">Lag a los datos</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#auto-correlation-function-acf-and-partial-autocorrelation-funcion-pacf">Auto Correlation function (ACF) and Partial Autocorrelation Funcion(PACF).</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#datos-de-entrenamiento-y-prueba">Datos de Entrenamiento y Prueba</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metricas">Metricas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#arima">ARIMA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#funcion-arima">Funcion ARIMA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-lineales">Modelos lineales</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ar">AR</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arma">ARMA</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ridge">Ridge</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lasso">Lasso</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest">Random Forest</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Metricas</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#k-nn-regresor">k-NN regresor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#svr">SVR</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#redes-neuronales">Redes Neuronales</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-hibrido">Modelo Hibrido</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest-con-modelos-lineales">Random Forest con modelos lineales</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ar-rf">AR-RF</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arma-rf">ARMA-RF</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ar-ann">AR-ANN</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arma-ann">ARMA-ANN</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="aapineda">
<h1>aapineda<a class="headerlink" href="#aapineda" title="Permalink to this heading">#</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="river-flow-forecasting-a-hybrid-approach-integrating-machine-learning-and-linear-time-series-models">
<h1>River Flow Forecasting: A Hybrid Approach Integrating Machine Learning and Linear Time Series Models<a class="headerlink" href="#river-flow-forecasting-a-hybrid-approach-integrating-machine-learning-and-linear-time-series-models" title="Permalink to this heading">#</a></h1>
<p><img alt="Alt text" src="Nueva carpeta/1024px-Rio_Magdalena_Delta_landsat.jpg" /></p>
<section id="resumen">
<h2><strong>Resumen</strong><a class="headerlink" href="#resumen" title="Permalink to this heading">#</a></h2>
<p>La precisa estimaci√≥n del caudal del r√≠o Magdalena en la estaci√≥n de Calamar, Bol√≠var, es esencial para la gesti√≥n de recursos h√≠dricos y la reducci√≥n de riesgos de inundaciones en esta regi√≥n. En este estudio, se emplearon tres enfoques de modelado para estimar el caudal del r√≠o a largo plazo (mensuales).
Los datos necesarios para este an√°lisis fueron recopilados espec√≠ficamente en la estaci√≥n de monitoreo de Calamar, Bol√≠var, a lo largo del r√≠o Magdalena. Se examinaron tres enfoques de modelado: modelos autoregresivos (AR), modelos de promedio m√≥vil (MA) y modelos autoregresivos de promedio m√≥vil (ARMA). Los resultados revelaron que los modelos MA superaron consistentemente en rendimiento a los modelos AR y ARMA.
Adem√°s, para mejorar la precisi√≥n en la estimaci√≥n del caudal del r√≠o Magdalena, se exploraron modelos de aprendizaje autom√°tico. Espec√≠ficamente, se utilizaron Bosques Aleatorios (RF) y Splines de Regresi√≥n Adaptativos Multivariados (MARS) para estimar los valores mensuales de un factor cr√≠tico, el caudal del Rio, bas√°ndose en datos del Caudal del periodo anterior. Los resultados revelaron que RF y MARS produjeron estimaciones comparables, con RF mostrando una ligera ventaja en el rendimiento.
Posteriormente, se implementaron modelos h√≠bridos que combinaron enfoques de series temporales y aprendizaje autom√°tico, como RF-AR, RF-MA, RF-ARMA, MARS-AR, MARS-MA y MARS-ARMA, con el objetivo de mejorar la precisi√≥n en la estimaci√≥n del Caudal. Entre estos modelos h√≠bridos, RF-AR y MARS-AR demostraron consistentemente un rendimiento sobresaliente.
Los resultados de este estudio sugieren que la combinaci√≥n de enfoques h√≠bridos, que integran modelos de series temporales y aprendizaje autom√°tico, ofrece un enfoque prometedor para estimar el Caudal en la estaci√≥n de Calamar, Bol√≠var, a lo largo del r√≠o Magdalena. Estas estimaciones precisas del Caudal tienen aplicaciones significativas en proyectos relacionados con el analisis de Riesgo, planificacion de dragados y Energia hidroelectrica.</p>
<ul class="simple">
<li><p>Palabras clave: R√≠o Magdalena ¬∑ Estimaci√≥n ¬∑ Modelos de Series Temporales ¬∑ Modelos de Aprendizaje Autom√°tico ¬∑ Modelos Independientes y H√≠bridos ¬∑ Caudales.</p></li>
</ul>
</section>
<section id="metodologia">
<h2><strong>Metodolog√≠a</strong><a class="headerlink" href="#metodologia" title="Permalink to this heading">#</a></h2>
<p><strong>Poblaci√≥n y Muestra:</strong></p>
<ul class="simple">
<li><p>Poblaci√≥n: La poblaci√≥n de inter√©s consisti√≥ en todos los datos hist√≥ricos de caudales disponibles para la estaci√≥n de Calamar, Bol√≠var, a lo largo del r√≠o Magdalena. (1984-2020)</p></li>
<li><p>Muestra: La muestra se seleccion√≥ considerando el tiempo y el espacio, incluyendo datos diarios recopilados a lo largo de varios a√±os espec√≠ficos. La muestra se limit√≥ a la estaci√≥n de Calamar, Bol√≠var.</p></li>
</ul>
<p><strong>Variables:</strong>
Se defini√≥ un diccionario de caracter√≠sticas que incluy√≥ las siguientes variables:</p>
<ul class="simple">
<li><p>Caudal del r√≠o Magdalena (variable objetivo).</p></li>
<li><p>Variables meteorol√≥gicas adicionales (si es necesario).</p></li>
<li><p>Fechas y marcas temporales para el an√°lisis de series temporales.</p></li>
</ul>
<p><strong>T√©cnicas:</strong>
Se emplearon diversas t√©cnicas para la estimaci√≥n del caudal del r√≠o Magdalena, que se dividieron en dos categor√≠as principales:</p>
<p><strong>a. Modelos de Series Temporales:</strong></p>
<ul class="simple">
<li><p>Modelos AR (Autoregresivos).</p></li>
<li><p>Modelos MA (Promedio M√≥vil).</p></li>
<li><p>Modelos ARMA (Autoregresivos de Promedio M√≥vil).</p></li>
</ul>
<p><strong>b. Modelos de Aprendizaje Autom√°tico:</strong></p>
<ul class="simple">
<li><p>Bosques Aleatorios (RF).</p></li>
<li><p>Splines de Regresi√≥n Adaptativos Multivariados (MARS).
Adem√°s, se aplicaron modelos h√≠bridos que combinaron enfoques de series temporales y aprendizaje autom√°tico, como RF-AR y MARS-AR.</p></li>
</ul>
<p><strong>Dise√±o General:</strong>
El estudio sigui√≥ un dise√±o de investigaci√≥n observacional retrospectiva. Se recopilaron datos hist√≥ricos de caudales del r√≠o Magdalena en la estaci√≥n de Calamar, Bol√≠var, as√≠ como datos de velocidad del viento y, en su caso, datos meteorol√≥gicos adicionales. Estos datos retrospectivos se analizaron para desarrollar modelos de estimaci√≥n del caudal del r√≠o.</p>
<p><strong>Validez:</strong>
La validez del estudio se abord√≥ de la siguiente manera:</p>
<ul class="simple">
<li><p>Grupos de Datos Coherentes: Se utilizaron datos coherentes y homog√©neos recopilados de manera consistente a lo largo del tiempo.</p></li>
<li><p>Automatizado: La obtenci√≥n de datos se automatiz√≥ mediante la extracci√≥n de datos desde fuentes como archivos CSV y, en su caso, API o consultas SQL.</p></li>
<li><p>T√©cnicas Estad√≠sticas: Se aplicaron pruebas estad√≠sticas como Chi cuadrado, T-Students, Prueba Fisher y an√°lisis de autocorrelaci√≥n para evaluar la validez y la robustez de los modelos propuestos y los resultados del estudio.</p></li>
</ul>
<p>Este enfoque metodol√≥gico riguroso garantiza la calidad y la confiabilidad de los resultados del estudio de estimaci√≥n del caudal del r√≠o Magdalena en la estaci√≥n de Calamar, Bol√≠var, y sienta las bases para la mejora de la gesti√≥n de recursos h√≠dricos en esta regi√≥n.</p>
</section>
<section id="librerias-necesarias">
<h2>Librerias Necesarias<a class="headerlink" href="#librerias-necesarias" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span><span class="n">plot_pacf</span> 
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools.sm_exceptions</span> <span class="kn">import</span> <span class="n">ConvergenceWarning</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">ConvergenceWarning</span><span class="p">)</span>

<span class="c1">## Errores</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="dataset">
<h2>Dataset<a class="headerlink" href="#dataset" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># URL del archivo CSV en GitHub</span>
<span class="c1">#url = &#39;https://raw.githubusercontent.com/aapineda/data/main/Q_Station_25017010.csv&#39;</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/aapineda/data/main/Q_Station_29037020.csv&#39;</span> <span class="c1">##CALMAR</span>
<span class="c1">#url = &#39;https://raw.githubusercontent.com/aapineda/data/main/Q_Station_21237020.csv&#39;</span>
<span class="c1">#url = &#39;https://raw.githubusercontent.com/aapineda/data/main/Q_Station_25027020.csv&#39;</span>



<span class="c1"># Leer el archivo CSV desde la URL</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 13515 entries, 0 to 13514
Data columns (total 3 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   Date    13515 non-null  object 
 1   Flow    13515 non-null  float64
 2   ENSO    13515 non-null  float64
dtypes: float64(2), object(1)
memory usage: 316.9+ KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Flow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Flow</th>
      <th>ENSO</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1-01-1984</td>
      <td>7803.0</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2-01-1984</td>
      <td>7718.0</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3-01-1984</td>
      <td>7634.0</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4-01-1984</td>
      <td>7554.0</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5-01-1984</td>
      <td>7498.0</td>
      <td>-0.6</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Flow</th>
      <th>ENSO</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>13515.000000</td>
      <td>13515.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>7239.553703</td>
      <td>-0.003492</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2708.667922</td>
      <td>0.850624</td>
    </tr>
    <tr>
      <th>min</th>
      <td>2011.900000</td>
      <td>-1.800000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>5177.200000</td>
      <td>-0.600000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>6987.000000</td>
      <td>-0.100000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>9157.050000</td>
      <td>0.500000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>14909.000000</td>
      <td>2.600000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Date    0
Flow    0
ENSO    0
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)))</span><span class="o">*</span><span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Date    0.0
Flow    0.0
ENSO    0.0
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Aseg√∫rate de que la columna &#39;fecha&#39; sea de tipo datetime</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">-%m-%Y&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>


<span class="c1"># Agrupa los datos por mes y calcula el promedio</span>
<span class="n">serie</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="c1">#serie = df</span>

<span class="n">serie</span> <span class="o">=</span> <span class="n">serie</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># La variable promedio_por_mes ahora contiene el promedio de &#39;valor&#39; por mes</span>
<span class="nb">print</span><span class="p">(</span><span class="n">serie</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                   Date          Flow  ENSO
0   1984-01-16 00:00:00   7046.387097  -0.6
1   1984-02-15 00:00:00   5769.344828  -0.4
2   1984-03-16 00:00:00   5016.483871  -0.3
3   1984-04-15 12:00:00   4613.266667  -0.4
4   1984-05-16 00:00:00   6783.838710  -0.5
..                  ...           ...   ...
439 2020-08-16 00:00:00   7277.535484  -0.6
440 2020-09-15 12:00:00   8679.066667  -0.9
441 2020-10-16 00:00:00   9349.567742  -1.2
442 2020-11-15 12:00:00   9804.350000  -1.3
443 2020-12-16 00:00:00  10353.732258  -1.2

[444 rows x 3 columns]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Flow</th>
      <th>ENSO</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1984-01-16 00:00:00</td>
      <td>7046.387097</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1984-02-15 00:00:00</td>
      <td>5769.344828</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1984-03-16 00:00:00</td>
      <td>5016.483871</td>
      <td>-0.3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1984-04-15 12:00:00</td>
      <td>4613.266667</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1984-05-16 00:00:00</td>
      <td>6783.838710</td>
      <td>-0.5</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>439</th>
      <td>2020-08-16 00:00:00</td>
      <td>7277.535484</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>440</th>
      <td>2020-09-15 12:00:00</td>
      <td>8679.066667</td>
      <td>-0.9</td>
    </tr>
    <tr>
      <th>441</th>
      <td>2020-10-16 00:00:00</td>
      <td>9349.567742</td>
      <td>-1.2</td>
    </tr>
    <tr>
      <th>442</th>
      <td>2020-11-15 12:00:00</td>
      <td>9804.350000</td>
      <td>-1.3</td>
    </tr>
    <tr>
      <th>443</th>
      <td>2020-12-16 00:00:00</td>
      <td>10353.732258</td>
      <td>-1.2</td>
    </tr>
  </tbody>
</table>
<p>444 rows √ó 3 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie</span><span class="p">[</span><span class="s1">&#39;Mes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">serie</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">#PREDECIR CON MESES</span>
<span class="c1">#serie = serie.drop(columns=&#39;Date&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Flow</th>
      <th>ENSO</th>
      <th>Mes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1984-01-16 00:00:00</td>
      <td>7046.387097</td>
      <td>-0.6</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1984-02-15 00:00:00</td>
      <td>5769.344828</td>
      <td>-0.4</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1984-03-16 00:00:00</td>
      <td>5016.483871</td>
      <td>-0.3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1984-04-15 12:00:00</td>
      <td>4613.266667</td>
      <td>-0.4</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1984-05-16 00:00:00</td>
      <td>6783.838710</td>
      <td>-0.5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>439</th>
      <td>2020-08-16 00:00:00</td>
      <td>7277.535484</td>
      <td>-0.6</td>
      <td>440</td>
    </tr>
    <tr>
      <th>440</th>
      <td>2020-09-15 12:00:00</td>
      <td>8679.066667</td>
      <td>-0.9</td>
      <td>441</td>
    </tr>
    <tr>
      <th>441</th>
      <td>2020-10-16 00:00:00</td>
      <td>9349.567742</td>
      <td>-1.2</td>
      <td>442</td>
    </tr>
    <tr>
      <th>442</th>
      <td>2020-11-15 12:00:00</td>
      <td>9804.350000</td>
      <td>-1.3</td>
      <td>443</td>
    </tr>
    <tr>
      <th>443</th>
      <td>2020-12-16 00:00:00</td>
      <td>10353.732258</td>
      <td>-1.2</td>
      <td>444</td>
    </tr>
  </tbody>
</table>
<p>444 rows √ó 4 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr</span> <span class="o">=</span> <span class="n">serie</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

<span class="n">f</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">annot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">1.5</span> <span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;.2f&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/15aa06d2500ddfe61c0e90cd5cba7d0a37d0239827c946f2779ba10bf47a397d.png" src="../_images/15aa06d2500ddfe61c0e90cd5cba7d0a37d0239827c946f2779ba10bf47a397d.png" />
</div>
</div>
<section id="relacion-entre-enso-y-caudal">
<h3>Relacion entre ENSO y Caudal<a class="headerlink" href="#relacion-entre-enso-y-caudal" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>  <span class="c1"># Importa StandardScaler desde sklearn.preprocessing si no est√° ya importado</span>

<span class="c1"># Escala las series &#39;Flow&#39; y &#39;ENSO&#39; usando StandardScaler</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">scaled_flow</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">serie</span><span class="p">[[</span><span class="s1">&#39;Flow&#39;</span><span class="p">]])</span>
<span class="n">scaled_enso</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">serie</span><span class="p">[[</span><span class="s1">&#39;ENSO&#39;</span><span class="p">]])</span>

<span class="c1"># Crea una figura y traza las series</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie</span><span class="p">[</span><span class="s1">&#39;Mes&#39;</span><span class="p">],</span> <span class="n">scaled_flow</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Flow&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie</span><span class="p">[</span><span class="s1">&#39;Mes&#39;</span><span class="p">],</span> <span class="n">scaled_enso</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ENSO&#39;</span><span class="p">)</span>  <span class="c1"># Usamos un color diferente (azul) para ENSO</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Tiempo (Mes)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Caudal (escala est√°ndar)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;River Flow and ENSO&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Rotate x-axis labels for readability</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f0bdc2a334c6b76f4f29bdaae9349d1947d0f9374a5d59a6f27fcb1e4718103b.png" src="../_images/f0bdc2a334c6b76f4f29bdaae9349d1947d0f9374a5d59a6f27fcb1e4718103b.png" />
</div>
</div>
<section id="lag-a-los-datos">
<h4>Lag a los datos<a class="headerlink" href="#lag-a-los-datos" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie</span><span class="p">[</span><span class="s1">&#39;Flow_lag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">serie</span><span class="p">[</span><span class="s1">&#39;Flow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">serie</span><span class="p">[</span><span class="s1">&#39;ENSO_lag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">serie</span><span class="p">[</span><span class="s1">&#39;ENSO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Flow</th>
      <th>ENSO</th>
      <th>Mes</th>
      <th>Flow_lag</th>
      <th>ENSO_lag</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1984-01-16 00:00:00</td>
      <td>7046.387097</td>
      <td>-0.6</td>
      <td>1</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1984-02-15 00:00:00</td>
      <td>5769.344828</td>
      <td>-0.4</td>
      <td>2</td>
      <td>7046.387097</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1984-03-16 00:00:00</td>
      <td>5016.483871</td>
      <td>-0.3</td>
      <td>3</td>
      <td>5769.344828</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1984-04-15 12:00:00</td>
      <td>4613.266667</td>
      <td>-0.4</td>
      <td>4</td>
      <td>5016.483871</td>
      <td>-0.3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1984-05-16 00:00:00</td>
      <td>6783.838710</td>
      <td>-0.5</td>
      <td>5</td>
      <td>4613.266667</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>439</th>
      <td>2020-08-16 00:00:00</td>
      <td>7277.535484</td>
      <td>-0.6</td>
      <td>440</td>
      <td>6987.390323</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>440</th>
      <td>2020-09-15 12:00:00</td>
      <td>8679.066667</td>
      <td>-0.9</td>
      <td>441</td>
      <td>7277.535484</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>441</th>
      <td>2020-10-16 00:00:00</td>
      <td>9349.567742</td>
      <td>-1.2</td>
      <td>442</td>
      <td>8679.066667</td>
      <td>-0.9</td>
    </tr>
    <tr>
      <th>442</th>
      <td>2020-11-15 12:00:00</td>
      <td>9804.350000</td>
      <td>-1.3</td>
      <td>443</td>
      <td>9349.567742</td>
      <td>-1.2</td>
    </tr>
    <tr>
      <th>443</th>
      <td>2020-12-16 00:00:00</td>
      <td>10353.732258</td>
      <td>-1.2</td>
      <td>444</td>
      <td>9804.350000</td>
      <td>-1.3</td>
    </tr>
  </tbody>
</table>
<p>444 rows √ó 6 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Flow_lag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">7490.387</span>
<span class="c1">#serie.at[0, &#39;ENSO_lag&#39;] = -0.8</span>
<span class="c1">#serie.at[1, &#39;ENSO_lag&#39;] = -1</span>
<span class="n">serie</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;ENSO_lag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.9</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Flow</th>
      <th>ENSO</th>
      <th>Mes</th>
      <th>Flow_lag</th>
      <th>ENSO_lag</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1984-01-16 00:00:00</td>
      <td>7046.387097</td>
      <td>-0.6</td>
      <td>1</td>
      <td>7490.387000</td>
      <td>-0.9</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1984-02-15 00:00:00</td>
      <td>5769.344828</td>
      <td>-0.4</td>
      <td>2</td>
      <td>7046.387097</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1984-03-16 00:00:00</td>
      <td>5016.483871</td>
      <td>-0.3</td>
      <td>3</td>
      <td>5769.344828</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1984-04-15 12:00:00</td>
      <td>4613.266667</td>
      <td>-0.4</td>
      <td>4</td>
      <td>5016.483871</td>
      <td>-0.3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1984-05-16 00:00:00</td>
      <td>6783.838710</td>
      <td>-0.5</td>
      <td>5</td>
      <td>4613.266667</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>439</th>
      <td>2020-08-16 00:00:00</td>
      <td>7277.535484</td>
      <td>-0.6</td>
      <td>440</td>
      <td>6987.390323</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>440</th>
      <td>2020-09-15 12:00:00</td>
      <td>8679.066667</td>
      <td>-0.9</td>
      <td>441</td>
      <td>7277.535484</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>441</th>
      <td>2020-10-16 00:00:00</td>
      <td>9349.567742</td>
      <td>-1.2</td>
      <td>442</td>
      <td>8679.066667</td>
      <td>-0.9</td>
    </tr>
    <tr>
      <th>442</th>
      <td>2020-11-15 12:00:00</td>
      <td>9804.350000</td>
      <td>-1.3</td>
      <td>443</td>
      <td>9349.567742</td>
      <td>-1.2</td>
    </tr>
    <tr>
      <th>443</th>
      <td>2020-12-16 00:00:00</td>
      <td>10353.732258</td>
      <td>-1.2</td>
      <td>444</td>
      <td>9804.350000</td>
      <td>-1.3</td>
    </tr>
  </tbody>
</table>
<p>444 rows √ó 6 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr</span> <span class="o">=</span> <span class="n">serie</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

<span class="n">f</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">annot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">1.5</span> <span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;.2f&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/0e93d3cae17fe59112e1faca64fa7a3adc5a228a084d76d57baaf5def5e043a6.png" src="../_images/0e93d3cae17fe59112e1faca64fa7a3adc5a228a084d76d57baaf5def5e043a6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie_ARIMA</span><span class="o">=</span> <span class="n">serie</span><span class="p">[[</span><span class="s1">&#39;Flow&#39;</span><span class="p">,</span> <span class="s1">&#39;Mes&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie_ARIMA</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Flow</th>
      <th>Mes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7046.387097</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5769.344828</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5016.483871</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4613.266667</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6783.838710</td>
      <td>5</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>439</th>
      <td>7277.535484</td>
      <td>440</td>
    </tr>
    <tr>
      <th>440</th>
      <td>8679.066667</td>
      <td>441</td>
    </tr>
    <tr>
      <th>441</th>
      <td>9349.567742</td>
      <td>442</td>
    </tr>
    <tr>
      <th>442</th>
      <td>9804.350000</td>
      <td>443</td>
    </tr>
    <tr>
      <th>443</th>
      <td>10353.732258</td>
      <td>444</td>
    </tr>
  </tbody>
</table>
<p>444 rows √ó 2 columns</p>
</div></div></div>
</div>
</section>
</section>
<section id="auto-correlation-function-acf-and-partial-autocorrelation-funcion-pacf">
<h3>Auto Correlation function (ACF) and Partial Autocorrelation Funcion(PACF).<a class="headerlink" href="#auto-correlation-function-acf-and-partial-autocorrelation-funcion-pacf" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_pacf</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">[</span><span class="s1">&#39;Flow&#39;</span><span class="p">])</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">[</span><span class="s1">&#39;Flow&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/5388c0708902c7cd2ae748cc06eabf02d1439d6f05bc3c30eb754a67ad52a61d.png" src="../_images/5388c0708902c7cd2ae748cc06eabf02d1439d6f05bc3c30eb754a67ad52a61d.png" />
<img alt="../_images/9de5ee83a662483b5de86430c541d9a9d0a398d80e303af51c6333712865c954.png" src="../_images/9de5ee83a662483b5de86430c541d9a9d0a398d80e303af51c6333712865c954.png" />
<img alt="../_images/5388c0708902c7cd2ae748cc06eabf02d1439d6f05bc3c30eb754a67ad52a61d.png" src="../_images/5388c0708902c7cd2ae748cc06eabf02d1439d6f05bc3c30eb754a67ad52a61d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Function to know stacionality</span>

<span class="k">def</span> <span class="nf">Prueba_Dickey_Fuller</span><span class="p">(</span><span class="n">series</span> <span class="p">,</span> <span class="n">column_name</span><span class="p">):</span>
    <span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Resultados de la prueba de Dickey-Fuller para columna: </span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">dftest</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">autolag</span><span class="o">=</span><span class="s1">&#39;AIC&#39;</span><span class="p">)</span>
    <span class="n">dfoutput</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dftest</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Test Statistic&#39;</span><span class="p">,</span><span class="s1">&#39;p-value&#39;</span><span class="p">,</span><span class="s1">&#39;No Lags Used&#39;</span><span class="p">,</span><span class="s1">&#39;N√∫mero de observaciones utilizadas&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">dftest</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
       <span class="n">dfoutput</span><span class="p">[</span><span class="s1">&#39;Critical Value (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="k">key</span>] = value
    <span class="nb">print</span> <span class="p">(</span><span class="n">dfoutput</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dftest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.05</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Conclusion:====&gt;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rechazar la hip√≥tesis nula&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los datos son estacionarios (Stationary)&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Conclusion:====&gt;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No se puede rechazar la hip√≥tesis nula&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los datos son no estacionarios (Non Stationary)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Prueba_Dickey_Fuller</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">[</span><span class="s1">&#39;Flow&#39;</span><span class="p">],</span><span class="s2">&quot;Flow&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Resultados de la prueba de Dickey-Fuller para columna: Flow
Test Statistic                         -5.555584
p-value                                 0.000002
No Lags Used                           13.000000
N√∫mero de observaciones utilizadas    430.000000
Critical Value (1%)                    -3.445649
Critical Value (5%)                    -2.868285
Critical Value (10%)                   -2.570363
dtype: float64
Conclusion:====&gt;
Rechazar la hip√≥tesis nula
Los datos son estacionarios (Stationary)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convertir &#39;Flow&#39; y &#39;Mes&#39; en arreglos NumPy y luego aplicar reshape</span>
<span class="sd">&quot;&quot;&quot;target = serie[&#39;Flow&#39;].values.reshape(-1, 1)</span>
<span class="sd">data = serie[&#39;Mes&#39;].values.reshape(-1, 1)&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&quot;target = serie[&#39;Flow&#39;].values.reshape(-1, 1)\ndata = serie[&#39;Mes&#39;].values.reshape(-1, 1)&quot;
</pre></div>
</div>
</div>
</div>
</section>
<section id="datos-de-entrenamiento-y-prueba">
<h3>Datos de Entrenamiento y Prueba<a class="headerlink" href="#datos-de-entrenamiento-y-prueba" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">serie</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_train</span> <span class="o">=</span> <span class="n">serie</span><span class="p">[</span><span class="n">serie</span><span class="o">.</span><span class="n">Mes</span> <span class="o">&lt;=</span> <span class="n">size</span><span class="p">]</span>
<span class="n">data_test</span>  <span class="o">=</span> <span class="n">serie</span><span class="p">[</span><span class="n">serie</span><span class="o">.</span><span class="n">Mes</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#X_train = np.array(data_train.Mes)[:, None] # vector-columna</span>

<span class="c1">#X_train = np.array(data_train[[&#39;Mes&#39;, &#39;ENSO&#39;]])</span>
<span class="c1">#X_train = np.array(data_train[[&#39;Flow_lag&#39;]])</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_train</span><span class="p">[[</span><span class="s1">&#39;Flow_lag&#39;</span><span class="p">,</span> <span class="s1">&#39;ENSO_lag&#39;</span><span class="p">]])</span>

<span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_train</span><span class="o">.</span><span class="n">Flow</span><span class="p">)</span>

<span class="c1">#X_test = np.array(data_test.Mes)[:, None] # vector-columna</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_test</span><span class="p">[[</span><span class="s1">&#39;Flow_lag&#39;</span><span class="p">,</span> <span class="s1">&#39;ENSO_lag&#39;</span><span class="p">]])</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_test</span><span class="o">.</span><span class="n">Flow</span><span class="p">)</span>

<span class="n">X_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">serie</span><span class="p">[[</span><span class="s1">&#39;Flow_lag&#39;</span><span class="p">,</span> <span class="s1">&#39;ENSO_lag&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>89
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="metricas">
<h2>Metricas<a class="headerlink" href="#metricas" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculo de Metricas</span>
<span class="k">def</span> <span class="nf">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred</span><span class="p">):</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMSE: </span><span class="si">{</span><span class="n">rmse</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAE: </span><span class="si">{</span><span class="n">mae</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Calcular el RRMSE directamente</span>
    <span class="n">rrmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RRMSE: </span><span class="si">{</span><span class="n">rrmse</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Calcular R-squared</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R-squared (R^2): </span><span class="si">{</span><span class="n">r2</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Calcular el NSE (coeficiente de eficiencia Nash-Sutcliffe)</span>
    <span class="n">nse</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_test</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NSE (Nash-Sutcliffe Efficiency): </span><span class="si">{</span><span class="n">nse</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="arima">
<h2>ARIMA<a class="headerlink" href="#arima" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>

<span class="c1"># Load dataset</span>

<span class="c1"># Split into train and test sets</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">serie_ARIMA</span><span class="p">[</span><span class="s1">&#39;Flow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">size</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">size</span><span class="p">:]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pmdarima</span> <span class="k">as</span> <span class="nn">pm</span>

<span class="n">model_1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">auto_arima</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">start_p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">start_q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">test</span><span class="o">=</span><span class="s1">&#39;adf&#39;</span><span class="p">,</span>
                      <span class="n">max_p</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">d</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">seasonal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">start_P</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">D</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">trace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">error_action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span>
                      <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">stepwise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">model_1</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Performing stepwise search to minimize aic
 ARIMA(1,0,0)(0,0,0)[0]             : AIC=7865.329, Time=0.03 sec
 ARIMA(0,0,0)(0,0,0)[0]             : AIC=9208.012, Time=0.01 sec
 ARIMA(2,0,0)(0,0,0)[0]             : AIC=7777.791, Time=0.06 sec
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> ARIMA(3,0,0)(0,0,0)[0]             : AIC=7662.598, Time=0.16 sec
 ARIMA(4,0,0)(0,0,0)[0]             : AIC=7641.101, Time=0.17 sec
 ARIMA(5,0,0)(0,0,0)[0]             : AIC=7639.764, Time=0.18 sec
 ARIMA(5,0,0)(0,0,0)[0] intercept   : AIC=7603.639, Time=0.23 sec
 ARIMA(4,0,0)(0,0,0)[0] intercept   : AIC=7601.648, Time=0.18 sec
 ARIMA(3,0,0)(0,0,0)[0] intercept   : AIC=7606.573, Time=0.10 sec

Best model:  ARIMA(4,0,0)(0,0,0)[0] intercept
Total fit time: 1.132 seconds
                               SARIMAX Results                                
==============================================================================
Dep. Variable:                      y   No. Observations:                  444
Model:               SARIMAX(4, 0, 0)   Log Likelihood               -3794.824
Date:                Wed, 04 Oct 2023   AIC                           7601.648
Time:                        00:28:44   BIC                           7626.223
Sample:                             0   HQIC                          7611.340
                                - 444                                         
Covariance Type:                  opg                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
intercept   1414.4895    230.488      6.137      0.000     962.742    1866.237
ar.L1          1.3864      0.050     27.656      0.000       1.288       1.485
ar.L2         -0.8359      0.083    -10.109      0.000      -0.998      -0.674
ar.L3          0.1300      0.085      1.529      0.126      -0.037       0.297
ar.L4          0.1242      0.049      2.547      0.011       0.029       0.220
sigma2      1.555e+06      0.009   1.64e+08      0.000    1.56e+06    1.56e+06
===================================================================================
Ljung-Box (L1) (Q):                   0.00   Jarque-Bera (JB):                 9.27
Prob(Q):                              0.96   Prob(JB):                         0.01
Heteroskedasticity (H):               1.16   Skew:                            -0.35
Prob(H) (two-sided):                  0.36   Kurtosis:                         2.91
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
[2] Covariance matrix is singular or near-singular, with condition number 7.9e+25. Standard errors may be unstable.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">orden_ar</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fit model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">orden_ar</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="c1"># summary of fit model</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
<span class="c1"># line plot of residuals</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">model_fit</span><span class="o">.</span><span class="n">resid</span><span class="p">)</span>
<span class="n">residuals</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># density plot of residuals</span>
<span class="n">residuals</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># summary stats of residuals</span>
<span class="nb">print</span><span class="p">(</span><span class="n">residuals</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                               SARIMAX Results                                
==============================================================================
Dep. Variable:                      y   No. Observations:                  355
Model:                 ARIMA(5, 0, 0)   Log Likelihood               -3036.744
Date:                Wed, 04 Oct 2023   AIC                           6087.488
Time:                        00:28:44   BIC                           6114.593
Sample:                             0   HQIC                          6098.271
                                - 355                                         
Covariance Type:                  opg                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const       7413.0301    367.764     20.157      0.000    6692.227    8133.834
ar.L1          1.4205      0.057     24.728      0.000       1.308       1.533
ar.L2         -0.8886      0.095     -9.400      0.000      -1.074      -0.703
ar.L3          0.1636      0.107      1.530      0.126      -0.046       0.373
ar.L4          0.1146      0.104      1.099      0.272      -0.090       0.319
ar.L5         -0.0103      0.065     -0.158      0.875      -0.138       0.117
sigma2      1.576e+06   1.33e+05     11.854      0.000    1.32e+06    1.84e+06
===================================================================================
Ljung-Box (L1) (Q):                   0.00   Jarque-Bera (JB):                 6.01
Prob(Q):                              0.98   Prob(JB):                         0.05
Heteroskedasticity (H):               1.31   Skew:                            -0.31
Prob(H) (two-sided):                  0.14   Kurtosis:                         2.87
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
</pre></div>
</div>
<img alt="../_images/2d8ae7506498537a8ce62804233f606dfead057de4a804362c7c82ada69568d2.png" src="../_images/2d8ae7506498537a8ce62804233f606dfead057de4a804362c7c82ada69568d2.png" />
<img alt="../_images/207f7fdcc73e057b2f78305cfd79b0ea6f8c133556108255f671fa4e99d81e36.png" src="../_images/207f7fdcc73e057b2f78305cfd79b0ea6f8c133556108255f671fa4e99d81e36.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                 0
count   355.000000
mean     -5.996724
std    1254.328712
min   -3866.216294
25%    -843.690613
50%      66.530667
75%     869.953976
max    3390.829384
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="funcion-arima">
<h2>Funcion ARIMA<a class="headerlink" href="#funcion-arima" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ARIMA_estimador</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">,</span> <span class="n">orden</span><span class="p">):</span>
    <span class="c1"># Split into train and test sets</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">residuales</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">serie_ARIMA</span><span class="p">[</span><span class="s1">&#39;Flow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">size</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">size</span><span class="p">:]</span>

    <span class="n">history</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">train</span><span class="p">]</span>
    
    <span class="c1"># Walk-forward validation</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">orden</span><span class="p">)</span>
        <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">()</span>
        <span class="n">yhat</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yhat</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="c1">#print(&#39;Month=%s, Predicted=%f, Expected=%f&#39; % (serie_ARIMA[&#39;Mes&#39;].iloc[size + t], yhat, obs))</span>

    <span class="n">history</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">train</span><span class="p">]</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">orden</span><span class="p">)</span>
        <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">()</span>
        <span class="n">yhat</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yhat</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="n">residuales</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="o">-</span><span class="n">yhat</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">[</span><span class="s1">&#39;Mes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">size</span><span class="p">:],</span> <span class="n">test</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">[</span><span class="s1">&#39;Mes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">size</span><span class="p">:],</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicted&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Tiempo (Mes)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Caudal (m3/s)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;River Flow Forecast&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


    <span class="c1"># Evaluate forecasts</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test RMSE: </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">rmse</span><span class="p">)</span>

    <span class="c1"># Plot forecasts against actual outcomes</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">[</span><span class="s1">&#39;Mes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">size</span><span class="p">:],</span> <span class="n">residuales</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Residuales&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Tiempo (Mes)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Caudal (m3/s)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Residuales obtenidos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Rotate x-axis labels for readability</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    
    <span class="k">return</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">residuales</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="modelos-lineales">
<h2>Modelos lineales<a class="headerlink" href="#modelos-lineales" title="Permalink to this heading">#</a></h2>
<p>Entre los modelos lineales se encuentran: autoregressive (AR), moving average (MA), and autoregressive moving average (ARMA)</p>
<section id="ar">
<h3>AR<a class="headerlink" href="#ar" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pmdarima</span> <span class="k">as</span> <span class="nn">pm</span>

<span class="n">model_1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">auto_arima</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">start_p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">start_q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">test</span><span class="o">=</span><span class="s1">&#39;adf&#39;</span><span class="p">,</span>
                      <span class="n">max_p</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">d</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">seasonal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">start_P</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">D</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">trace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">error_action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span>
                      <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">stepwise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">model_1</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Performing stepwise search to minimize aic
 ARIMA(1,0,0)(0,0,0)[0]             : AIC=7865.329, Time=0.03 sec
 ARIMA(0,0,0)(0,0,0)[0]             : AIC=9208.012, Time=0.02 sec
 ARIMA(2,0,0)(0,0,0)[0]             : AIC=7777.791, Time=0.07 sec
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> ARIMA(3,0,0)(0,0,0)[0]             : AIC=7662.598, Time=0.13 sec
 ARIMA(4,0,0)(0,0,0)[0]             : AIC=7641.101, Time=0.22 sec
 ARIMA(5,0,0)(0,0,0)[0]             : AIC=7639.764, Time=0.23 sec
 ARIMA(5,0,0)(0,0,0)[0] intercept   : AIC=7603.639, Time=0.22 sec
 ARIMA(4,0,0)(0,0,0)[0] intercept   : AIC=7601.648, Time=0.18 sec
 ARIMA(3,0,0)(0,0,0)[0] intercept   : AIC=7606.573, Time=0.11 sec

Best model:  ARIMA(4,0,0)(0,0,0)[0] intercept
Total fit time: 1.233 seconds
                               SARIMAX Results                                
==============================================================================
Dep. Variable:                      y   No. Observations:                  444
Model:               SARIMAX(4, 0, 0)   Log Likelihood               -3794.824
Date:                Wed, 04 Oct 2023   AIC                           7601.648
Time:                        00:28:46   BIC                           7626.223
Sample:                             0   HQIC                          7611.340
                                - 444                                         
Covariance Type:                  opg                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
intercept   1414.4895    230.488      6.137      0.000     962.742    1866.237
ar.L1          1.3864      0.050     27.656      0.000       1.288       1.485
ar.L2         -0.8359      0.083    -10.109      0.000      -0.998      -0.674
ar.L3          0.1300      0.085      1.529      0.126      -0.037       0.297
ar.L4          0.1242      0.049      2.547      0.011       0.029       0.220
sigma2      1.555e+06      0.009   1.64e+08      0.000    1.56e+06    1.56e+06
===================================================================================
Ljung-Box (L1) (Q):                   0.00   Jarque-Bera (JB):                 9.27
Prob(Q):                              0.96   Prob(JB):                         0.01
Heteroskedasticity (H):               1.16   Skew:                            -0.35
Prob(H) (two-sided):                  0.36   Kurtosis:                         2.91
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
[2] Covariance matrix is singular or near-singular, with condition number 7.9e+25. Standard errors may be unstable.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">orden_ar</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fit model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">orden_ar</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="c1"># summary of fit model</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
<span class="c1"># line plot of residuals</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">model_fit</span><span class="o">.</span><span class="n">resid</span><span class="p">)</span>
<span class="n">residuals</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># density plot of residuals</span>
<span class="n">residuals</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># summary stats of residuals</span>
<span class="nb">print</span><span class="p">(</span><span class="n">residuals</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                               SARIMAX Results                                
==============================================================================
Dep. Variable:                      y   No. Observations:                  355
Model:                 ARIMA(5, 0, 0)   Log Likelihood               -3036.744
Date:                Wed, 04 Oct 2023   AIC                           6087.488
Time:                        00:28:46   BIC                           6114.593
Sample:                             0   HQIC                          6098.271
                                - 355                                         
Covariance Type:                  opg                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const       7413.0301    367.764     20.157      0.000    6692.227    8133.834
ar.L1          1.4205      0.057     24.728      0.000       1.308       1.533
ar.L2         -0.8886      0.095     -9.400      0.000      -1.074      -0.703
ar.L3          0.1636      0.107      1.530      0.126      -0.046       0.373
ar.L4          0.1146      0.104      1.099      0.272      -0.090       0.319
ar.L5         -0.0103      0.065     -0.158      0.875      -0.138       0.117
sigma2      1.576e+06   1.33e+05     11.854      0.000    1.32e+06    1.84e+06
===================================================================================
Ljung-Box (L1) (Q):                   0.00   Jarque-Bera (JB):                 6.01
Prob(Q):                              0.98   Prob(JB):                         0.05
Heteroskedasticity (H):               1.31   Skew:                            -0.31
Prob(H) (two-sided):                  0.14   Kurtosis:                         2.87
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
</pre></div>
</div>
<img alt="../_images/2d8ae7506498537a8ce62804233f606dfead057de4a804362c7c82ada69568d2.png" src="../_images/2d8ae7506498537a8ce62804233f606dfead057de4a804362c7c82ada69568d2.png" />
<img alt="../_images/207f7fdcc73e057b2f78305cfd79b0ea6f8c133556108255f671fa4e99d81e36.png" src="../_images/207f7fdcc73e057b2f78305cfd79b0ea6f8c133556108255f671fa4e99d81e36.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                 0
count   355.000000
mean     -5.996724
std    1254.328712
min   -3866.216294
25%    -843.690613
50%      66.530667
75%     869.953976
max    3390.829384
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">residuales</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">orden_ar</span><span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="n">predictions_AR</span><span class="p">,</span> <span class="n">residuales_AR</span> <span class="o">=</span> <span class="n">ARIMA_estimador</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">,</span> <span class="n">orden_ar</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/fdc6af850712b1693e041892f74723ef15065789e014366281d3092747b6fa06.png" src="../_images/fdc6af850712b1693e041892f74723ef15065789e014366281d3092747b6fa06.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test RMSE: 1216.840
</pre></div>
</div>
<img alt="../_images/3b864a539b17c0fc10a4531aa59f5fd67e0bba19690f0d37aa058286616d6b57.png" src="../_images/3b864a539b17c0fc10a4531aa59f5fd67e0bba19690f0d37aa058286616d6b57.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions_AR</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1216.84
MAE: 968.17
RRMSE: 0.19
R-squared (R^2): 0.70
NSE (Nash-Sutcliffe Efficiency): 0.70
</pre></div>
</div>
</div>
</div>
</section>
<section id="arma">
<h3>ARMA<a class="headerlink" href="#arma" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pmdarima</span> <span class="k">as</span> <span class="nn">pm</span>

<span class="n">model_1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">auto_arima</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">start_p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">start_q</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">test</span><span class="o">=</span><span class="s1">&#39;adf&#39;</span><span class="p">,</span>
                      <span class="n">max_p</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_q</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                      <span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">d</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">seasonal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">start_P</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">D</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">trace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">error_action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span>
                      <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">stepwise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">model_1</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Performing stepwise search to minimize aic
 ARIMA(1,0,1)(0,0,0)[0]             : AIC=7727.800, Time=0.10 sec
 ARIMA(0,0,0)(0,0,0)[0]             : AIC=9208.012, Time=0.01 sec
 ARIMA(1,0,0)(0,0,0)[0]             : AIC=7865.329, Time=0.03 sec
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> ARIMA(0,0,1)(0,0,0)[0]             : AIC=inf, Time=0.13 sec
 ARIMA(2,0,1)(0,0,0)[0]             : AIC=7724.921, Time=0.26 sec
 ARIMA(2,0,0)(0,0,0)[0]             : AIC=7777.791, Time=0.05 sec
 ARIMA(3,0,1)(0,0,0)[0]             : AIC=7640.387, Time=0.40 sec
 ARIMA(3,0,0)(0,0,0)[0]             : AIC=7662.598, Time=0.09 sec
 ARIMA(4,0,1)(0,0,0)[0]             : AIC=7641.410, Time=0.32 sec
 ARIMA(3,0,2)(0,0,0)[0]             : AIC=7605.158, Time=0.76 sec
 ARIMA(2,0,2)(0,0,0)[0]             : AIC=inf, Time=0.88 sec
 ARIMA(4,0,2)(0,0,0)[0]             : AIC=inf, Time=0.86 sec
 ARIMA(3,0,3)(0,0,0)[0]             : AIC=7555.284, Time=0.90 sec
 ARIMA(2,0,3)(0,0,0)[0]             : AIC=inf, Time=0.70 sec
 ARIMA(4,0,3)(0,0,0)[0]             : AIC=7557.907, Time=0.94 sec
 ARIMA(3,0,4)(0,0,0)[0]             : AIC=7560.306, Time=1.10 sec
 ARIMA(2,0,4)(0,0,0)[0]             : AIC=inf, Time=0.84 sec
 ARIMA(4,0,4)(0,0,0)[0]             : AIC=7525.732, Time=1.26 sec
 ARIMA(5,0,4)(0,0,0)[0]             : AIC=7525.104, Time=1.86 sec
 ARIMA(5,0,3)(0,0,0)[0]             : AIC=7620.838, Time=1.06 sec
 ARIMA(5,0,5)(0,0,0)[0]             : AIC=inf, Time=1.79 sec
 ARIMA(4,0,5)(0,0,0)[0]             : AIC=7516.928, Time=1.62 sec
 ARIMA(3,0,5)(0,0,0)[0]             : AIC=7554.974, Time=1.37 sec
 ARIMA(4,0,5)(0,0,0)[0] intercept   : AIC=7476.994, Time=2.05 sec
 ARIMA(3,0,5)(0,0,0)[0] intercept   : AIC=7514.302, Time=1.88 sec
 ARIMA(4,0,4)(0,0,0)[0] intercept   : AIC=7513.373, Time=1.41 sec
 ARIMA(5,0,5)(0,0,0)[0] intercept   : AIC=7490.559, Time=2.00 sec
 ARIMA(3,0,4)(0,0,0)[0] intercept   : AIC=7502.789, Time=1.27 sec
 ARIMA(5,0,4)(0,0,0)[0] intercept   : AIC=7500.611, Time=2.07 sec

Best model:  ARIMA(4,0,5)(0,0,0)[0] intercept
Total fit time: 28.045 seconds
                               SARIMAX Results                                
==============================================================================
Dep. Variable:                      y   No. Observations:                  444
Model:               SARIMAX(4, 0, 5)   Log Likelihood               -3727.497
Date:                Wed, 04 Oct 2023   AIC                           7476.994
Time:                        00:29:49   BIC                           7522.048
Sample:                             0   HQIC                          7494.761
                                - 444                                         
Covariance Type:                  opg                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
intercept   1859.5711    235.166      7.907      0.000    1398.654    2320.488
ar.L1          2.4884      0.075     33.390      0.000       2.342       2.635
ar.L2         -3.2278      0.131    -24.683      0.000      -3.484      -2.972
ar.L3          2.2276      0.131     17.046      0.000       1.971       2.484
ar.L4         -0.7410      0.058    -12.695      0.000      -0.855      -0.627
ma.L1         -1.3509      0.088    -15.429      0.000      -1.522      -1.179
ma.L2          1.2730      0.100     12.746      0.000       1.077       1.469
ma.L3          0.0251      0.126      0.199      0.842      -0.221       0.271
ma.L4         -0.3552      0.086     -4.141      0.000      -0.523      -0.187
ma.L5          0.3409      0.063      5.424      0.000       0.218       0.464
sigma2      1.163e+06      0.064   1.82e+07      0.000    1.16e+06    1.16e+06
===================================================================================
Ljung-Box (L1) (Q):                   2.22   Jarque-Bera (JB):                 1.43
Prob(Q):                              0.14   Prob(JB):                         0.49
Heteroskedasticity (H):               1.38   Skew:                            -0.10
Prob(H) (two-sided):                  0.05   Kurtosis:                         3.19
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
[2] Covariance matrix is singular or near-singular, with condition number 2.02e+23. Standard errors may be unstable.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">orden_arma</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fit model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">orden_arma</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="c1"># summary of fit model</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
<span class="c1"># line plot of residuals</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">model_fit</span><span class="o">.</span><span class="n">resid</span><span class="p">)</span>
<span class="n">residuals</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># density plot of residuals</span>
<span class="n">residuals</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># summary stats of residuals</span>
<span class="nb">print</span><span class="p">(</span><span class="n">residuals</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                               SARIMAX Results                                
==============================================================================
Dep. Variable:                      y   No. Observations:                  355
Model:                 ARIMA(3, 0, 3)   Log Likelihood               -2997.559
Date:                Wed, 04 Oct 2023   AIC                           6011.118
Time:                        00:29:50   BIC                           6042.094
Sample:                             0   HQIC                          6023.441
                                - 355                                         
Covariance Type:                  opg                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const       7413.0298    497.511     14.900      0.000    6437.925    8388.134
ar.L1          1.7600      0.048     36.386      0.000       1.665       1.855
ar.L2         -1.7533      0.050    -34.982      0.000      -1.852      -1.655
ar.L3          0.7638      0.048     15.977      0.000       0.670       0.857
ma.L1         -0.4552      0.061     -7.509      0.000      -0.574      -0.336
ma.L2          0.5166      0.056      9.269      0.000       0.407       0.626
ma.L3          0.4490      0.060      7.452      0.000       0.331       0.567
sigma2      1.406e+06      0.245   5.74e+06      0.000    1.41e+06    1.41e+06
===================================================================================
Ljung-Box (L1) (Q):                   0.11   Jarque-Bera (JB):                 8.79
Prob(Q):                              0.74   Prob(JB):                         0.01
Heteroskedasticity (H):               1.18   Skew:                            -0.33
Prob(H) (two-sided):                  0.37   Kurtosis:                         3.40
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
[2] Covariance matrix is singular or near-singular, with condition number 1.47e+23. Standard errors may be unstable.
</pre></div>
</div>
<img alt="../_images/2a2b26c47905db1a9c0adb730eba10182370216950facee5502b6aca35814ab8.png" src="../_images/2a2b26c47905db1a9c0adb730eba10182370216950facee5502b6aca35814ab8.png" />
<img alt="../_images/b157d174aac34e6b99d43816cf376f03370042b2a446f83433af1430e2a72b55.png" src="../_images/b157d174aac34e6b99d43816cf376f03370042b2a446f83433af1430e2a72b55.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                 0
count   355.000000
mean     -4.070046
std    1119.383301
min   -3600.255485
25%    -732.651711
50%     109.265873
75%     728.571345
max    2922.233298
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie_ARIMA</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Flow</th>
      <th>Mes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7046.387097</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5769.344828</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5016.483871</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4613.266667</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6783.838710</td>
      <td>5</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>439</th>
      <td>7277.535484</td>
      <td>440</td>
    </tr>
    <tr>
      <th>440</th>
      <td>8679.066667</td>
      <td>441</td>
    </tr>
    <tr>
      <th>441</th>
      <td>9349.567742</td>
      <td>442</td>
    </tr>
    <tr>
      <th>442</th>
      <td>9804.350000</td>
      <td>443</td>
    </tr>
    <tr>
      <th>443</th>
      <td>10353.732258</td>
      <td>444</td>
    </tr>
  </tbody>
</table>
<p>444 rows √ó 2 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictions_ARMA</span><span class="p">,</span> <span class="n">residuales_ARMA</span> <span class="o">=</span> <span class="n">ARIMA_estimador</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">,</span> <span class="n">orden_arma</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/bfceb86903a56d8314397a5fe39d20dee92ec6e7b1d50908a9da452b5b1e83b1.png" src="../_images/bfceb86903a56d8314397a5fe39d20dee92ec6e7b1d50908a9da452b5b1e83b1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test RMSE: 1096.834
</pre></div>
</div>
<img alt="../_images/d733e5886b82b25b848fba7b2b05e3293a37943ae0bd8a77b2e9bc954e6042db.png" src="../_images/d733e5886b82b25b848fba7b2b05e3293a37943ae0bd8a77b2e9bc954e6042db.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions_ARMA</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1096.83
MAE: 845.08
RRMSE: 0.17
R-squared (R^2): 0.75
NSE (Nash-Sutcliffe Efficiency): 0.75
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="ridge">
<h2>Ridge<a class="headerlink" href="#ridge" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>


<span class="c1"># Definir el conjunto de hiperpar√°metros para la b√∫squeda en cuadr√≠cula</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ridge__alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span>
<span class="p">}</span>

<span class="c1"># Crear el pipeline con MinMaxScaler y Ridge</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">(),</span> <span class="n">Ridge</span><span class="p">())</span>

<span class="c1"># Realizar la b√∫squeda en cuadr√≠cula</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-13 {color: black;}#sk-container-id-13 pre{padding: 0;}#sk-container-id-13 div.sk-toggleable {background-color: white;}#sk-container-id-13 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-13 label.sk-toggleable__label-arrow:before {content: "‚ñ∏";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-13 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-13 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-13 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-13 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-13 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-13 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "‚ñæ";}#sk-container-id-13 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-13 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-13 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-13 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-13 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-13 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-13 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-13 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-13 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-13 div.sk-item {position: relative;z-index: 1;}#sk-container-id-13 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-13 div.sk-item::before, #sk-container-id-13 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-13 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-13 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-13 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-13 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-13 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-13 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-13 div.sk-label-container {text-align: center;}#sk-container-id-13 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-13 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-13" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#x27;minmaxscaler&#x27;, MinMaxScaler()),
                                       (&#x27;ridge&#x27;, Ridge())]),
             n_jobs=-1, param_grid={&#x27;ridge__alpha&#x27;: [0.1, 1.0, 10.0]},
             scoring=&#x27;r2&#x27;)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-49" type="checkbox" ><label for="sk-estimator-id-49" class="sk-toggleable__label sk-toggleable__label-arrow">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#x27;minmaxscaler&#x27;, MinMaxScaler()),
                                       (&#x27;ridge&#x27;, Ridge())]),
             n_jobs=-1, param_grid={&#x27;ridge__alpha&#x27;: [0.1, 1.0, 10.0]},
             scoring=&#x27;r2&#x27;)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-50" type="checkbox" ><label for="sk-estimator-id-50" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;minmaxscaler&#x27;, MinMaxScaler()), (&#x27;ridge&#x27;, Ridge())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-51" type="checkbox" ><label for="sk-estimator-id-51" class="sk-toggleable__label sk-toggleable__label-arrow">MinMaxScaler</label><div class="sk-toggleable__content"><pre>MinMaxScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-52" type="checkbox" ><label for="sk-estimator-id-52" class="sk-toggleable__label sk-toggleable__label-arrow">Ridge</label><div class="sk-toggleable__content"><pre>Ridge()</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;minmaxscaler&#39;, MinMaxScaler()), (&#39;ridge&#39;, Ridge(alpha=0.1))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>

<span class="c1"># Calculo de Metricas</span>

<span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training-set score: 0.64
Test-set score: 0.59
RMSE: 1423.44
MAE: 1130.75
RRMSE: 0.22
R-squared (R^2): 0.59
NSE (Nash-Sutcliffe Efficiency): 0.59
</pre></div>
</div>
</div>
</div>
</section>
<section id="lasso">
<h2>Lasso<a class="headerlink" href="#lasso" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Lasso</span>


<span class="c1"># Definir el conjunto de hiperpar√°metros para la b√∫squeda en cuadr√≠cula</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;lasso__alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span>
<span class="p">}</span>

<span class="c1"># Crear el pipeline con MinMaxScaler y Lasso</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">(),</span> <span class="n">Lasso</span><span class="p">())</span>

<span class="c1"># Realizar la b√∫squeda en cuadr√≠cula</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-14 {color: black;}#sk-container-id-14 pre{padding: 0;}#sk-container-id-14 div.sk-toggleable {background-color: white;}#sk-container-id-14 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-14 label.sk-toggleable__label-arrow:before {content: "‚ñ∏";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-14 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-14 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-14 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-14 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-14 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-14 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "‚ñæ";}#sk-container-id-14 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-14 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-14 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-14 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-14 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-14 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-14 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-14 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-14 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-14 div.sk-item {position: relative;z-index: 1;}#sk-container-id-14 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-14 div.sk-item::before, #sk-container-id-14 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-14 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-14 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-14 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-14 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-14 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-14 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-14 div.sk-label-container {text-align: center;}#sk-container-id-14 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-14 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-14" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#x27;minmaxscaler&#x27;, MinMaxScaler()),
                                       (&#x27;lasso&#x27;, Lasso())]),
             n_jobs=-1, param_grid={&#x27;lasso__alpha&#x27;: [0.1, 1.0, 10.0]},
             scoring=&#x27;r2&#x27;)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-53" type="checkbox" ><label for="sk-estimator-id-53" class="sk-toggleable__label sk-toggleable__label-arrow">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#x27;minmaxscaler&#x27;, MinMaxScaler()),
                                       (&#x27;lasso&#x27;, Lasso())]),
             n_jobs=-1, param_grid={&#x27;lasso__alpha&#x27;: [0.1, 1.0, 10.0]},
             scoring=&#x27;r2&#x27;)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-54" type="checkbox" ><label for="sk-estimator-id-54" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;minmaxscaler&#x27;, MinMaxScaler()), (&#x27;lasso&#x27;, Lasso())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-55" type="checkbox" ><label for="sk-estimator-id-55" class="sk-toggleable__label sk-toggleable__label-arrow">MinMaxScaler</label><div class="sk-toggleable__content"><pre>MinMaxScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-56" type="checkbox" ><label for="sk-estimator-id-56" class="sk-toggleable__label sk-toggleable__label-arrow">Lasso</label><div class="sk-toggleable__content"><pre>Lasso()</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;minmaxscaler&#39;, MinMaxScaler()), (&#39;lasso&#39;, Lasso(alpha=0.1))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>

<span class="c1"># Calculo de Metricas</span>

<span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training-set score: 0.64
Test-set score: 0.59
RMSE: 1424.01
MAE: 1130.71
RRMSE: 0.22
R-squared (R^2): 0.59
NSE (Nash-Sutcliffe Efficiency): 0.59
</pre></div>
</div>
</div>
</div>
</section>
<section id="random-forest">
<h2>Random Forest<a class="headerlink" href="#random-forest" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">RandomForestRegressor</span><span class="p">())</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;randomforestregressor__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">400</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__max_leaf_nodes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__min_samples_split&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">]}</span>

<span class="n">RF</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">RF</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-15 {color: black;}#sk-container-id-15 pre{padding: 0;}#sk-container-id-15 div.sk-toggleable {background-color: white;}#sk-container-id-15 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-15 label.sk-toggleable__label-arrow:before {content: "‚ñ∏";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-15 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-15 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-15 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-15 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-15 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-15 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "‚ñæ";}#sk-container-id-15 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-15 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-15 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-15 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-15 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-15 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-15 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-15 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-15 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-15 div.sk-item {position: relative;z-index: 1;}#sk-container-id-15 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-15 div.sk-item::before, #sk-container-id-15 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-15 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-15 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-15 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-15 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-15 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-15 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-15 div.sk-label-container {text-align: center;}#sk-container-id-15 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-15 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-15" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                                       (&#x27;randomforestregressor&#x27;,
                                        RandomForestRegressor())]),
             n_jobs=-1,
             param_grid={&#x27;randomforestregressor__max_depth&#x27;: [2, 3, 4],
                         &#x27;randomforestregressor__max_leaf_nodes&#x27;: [2, 4, 6, 8],
                         &#x27;randomforestregressor__min_samples_split&#x27;: [2, 5, 10,
                                                                      15],
                         &#x27;randomforestregressor__n_estimators&#x27;: [400]},
             scoring=&#x27;r2&#x27;)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-57" type="checkbox" ><label for="sk-estimator-id-57" class="sk-toggleable__label sk-toggleable__label-arrow">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                                       (&#x27;randomforestregressor&#x27;,
                                        RandomForestRegressor())]),
             n_jobs=-1,
             param_grid={&#x27;randomforestregressor__max_depth&#x27;: [2, 3, 4],
                         &#x27;randomforestregressor__max_leaf_nodes&#x27;: [2, 4, 6, 8],
                         &#x27;randomforestregressor__min_samples_split&#x27;: [2, 5, 10,
                                                                      15],
                         &#x27;randomforestregressor__n_estimators&#x27;: [400]},
             scoring=&#x27;r2&#x27;)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-58" type="checkbox" ><label for="sk-estimator-id-58" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                (&#x27;randomforestregressor&#x27;, RandomForestRegressor())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-59" type="checkbox" ><label for="sk-estimator-id-59" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-60" type="checkbox" ><label for="sk-estimator-id-60" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestRegressor</label><div class="sk-toggleable__content"><pre>RandomForestRegressor()</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                (&#39;randomforestregressor&#39;,
                 RandomForestRegressor(max_depth=3, max_leaf_nodes=8,
                                       min_samples_split=15,
                                       n_estimators=400))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training-set score: 0.68
Test-set score: 0.53
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_RF_train</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">-</span><span class="n">RF</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">RF</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">res_RF_test</span><span class="o">=</span> <span class="n">y_test</span><span class="o">-</span><span class="n">y_pred</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_tree</span> <span class="o">=</span> <span class="n">RF</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_all</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">data_train</span><span class="o">.</span><span class="n">Mes</span><span class="p">,</span> <span class="n">data_train</span><span class="o">.</span><span class="n">Flow</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Training data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">data_test</span><span class="o">.</span><span class="n">Mes</span><span class="p">,</span> <span class="n">data_test</span><span class="o">.</span><span class="n">Flow</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">serie</span><span class="o">.</span><span class="n">Mes</span><span class="p">,</span> <span class="n">y_tree</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Tree prediction&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f12ac4b4458a9d52fa8cb9f94a8d5f9dc3b77c82c7ccf55c6048f583d6430280.png" src="../_images/f12ac4b4458a9d52fa8cb9f94a8d5f9dc3b77c82c7ccf55c6048f583d6430280.png" />
</div>
</div>
<section id="id1">
<h3>Metricas<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculo de Metricas</span>

<span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1511.46
MAE: 1169.33
RRMSE: 0.23
R-squared (R^2): 0.53
NSE (Nash-Sutcliffe Efficiency): 0.53
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_test</span><span class="o">.</span><span class="n">Mes</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_test</span><span class="o">.</span><span class="n">Mes</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;RF&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">data_test</span><span class="o">.</span><span class="n">Mes</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">data_test</span><span class="o">.</span><span class="n">Mes</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/781d3276b06229a851e50f8fcf6a028fceed42dd5a07e9f197d9daf1caaf0634.png" src="../_images/781d3276b06229a851e50f8fcf6a028fceed42dd5a07e9f197d9daf1caaf0634.png" />
</div>
</div>
</section>
</section>
<section id="k-nn-regresor">
<h2>k-NN regresor<a class="headerlink" href="#k-nn-regresor" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>  
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">neighbors</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_log_error</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">explained_variance_score</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">KNeighborsRegressor</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;kneighborsregressor__n_neighbors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">]}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-16 {color: black;}#sk-container-id-16 pre{padding: 0;}#sk-container-id-16 div.sk-toggleable {background-color: white;}#sk-container-id-16 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-16 label.sk-toggleable__label-arrow:before {content: "‚ñ∏";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-16 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-16 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-16 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-16 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-16 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-16 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "‚ñæ";}#sk-container-id-16 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-16 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-16 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-16 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-16 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-16 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-16 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-16 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-16 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-16 div.sk-item {position: relative;z-index: 1;}#sk-container-id-16 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-16 div.sk-item::before, #sk-container-id-16 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-16 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-16 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-16 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-16 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-16 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-16 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-16 div.sk-label-container {text-align: center;}#sk-container-id-16 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-16 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-16" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                                       (&#x27;kneighborsregressor&#x27;,
                                        KNeighborsRegressor())]),
             param_grid={&#x27;kneighborsregressor__n_neighbors&#x27;: [1, 2, 4, 6, 8, 10,
                                                              15, 20, 30, 40]},
             scoring=&#x27;r2&#x27;)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-61" type="checkbox" ><label for="sk-estimator-id-61" class="sk-toggleable__label sk-toggleable__label-arrow">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                                       (&#x27;kneighborsregressor&#x27;,
                                        KNeighborsRegressor())]),
             param_grid={&#x27;kneighborsregressor__n_neighbors&#x27;: [1, 2, 4, 6, 8, 10,
                                                              15, 20, 30, 40]},
             scoring=&#x27;r2&#x27;)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-62" type="checkbox" ><label for="sk-estimator-id-62" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                (&#x27;kneighborsregressor&#x27;, KNeighborsRegressor())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-63" type="checkbox" ><label for="sk-estimator-id-63" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-64" type="checkbox" ><label for="sk-estimator-id-64" class="sk-toggleable__label sk-toggleable__label-arrow">KNeighborsRegressor</label><div class="sk-toggleable__content"><pre>KNeighborsRegressor()</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                (&#39;kneighborsregressor&#39;, KNeighborsRegressor(n_neighbors=15))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training-set score: 0.66
Test-set score: 0.53
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculo de Metricas</span>

<span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1514.89
MAE: 1174.65
RRMSE: 0.23
R-squared (R^2): 0.53
NSE (Nash-Sutcliffe Efficiency): 0.53
</pre></div>
</div>
</div>
</div>
</section>
<section id="svr">
<h2>SVR<a class="headerlink" href="#svr" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;svr__kernel&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;rbf&#39;</span><span class="p">],</span>
    <span class="s1">&#39;svr__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
    <span class="s1">&#39;svr__epsilon&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">(),</span> <span class="n">SVR</span><span class="p">())</span>

<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-17 {color: black;}#sk-container-id-17 pre{padding: 0;}#sk-container-id-17 div.sk-toggleable {background-color: white;}#sk-container-id-17 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-17 label.sk-toggleable__label-arrow:before {content: "‚ñ∏";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-17 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-17 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-17 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-17 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-17 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-17 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "‚ñæ";}#sk-container-id-17 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-17 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-17 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-17 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-17 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-17 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-17 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-17 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-17 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-17 div.sk-item {position: relative;z-index: 1;}#sk-container-id-17 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-17 div.sk-item::before, #sk-container-id-17 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-17 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-17 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-17 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-17 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-17 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-17 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-17 div.sk-label-container {text-align: center;}#sk-container-id-17 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-17 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-17" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#x27;minmaxscaler&#x27;, MinMaxScaler()),
                                       (&#x27;svr&#x27;, SVR())]),
             n_jobs=-1,
             param_grid={&#x27;svr__C&#x27;: [0.001, 0.01, 0.1, 1, 10, 100],
                         &#x27;svr__epsilon&#x27;: [0.001, 0.01, 0.1, 0.2, 0.5, 1],
                         &#x27;svr__kernel&#x27;: [&#x27;linear&#x27;, &#x27;rbf&#x27;]},
             scoring=&#x27;r2&#x27;)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-65" type="checkbox" ><label for="sk-estimator-id-65" class="sk-toggleable__label sk-toggleable__label-arrow">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#x27;minmaxscaler&#x27;, MinMaxScaler()),
                                       (&#x27;svr&#x27;, SVR())]),
             n_jobs=-1,
             param_grid={&#x27;svr__C&#x27;: [0.001, 0.01, 0.1, 1, 10, 100],
                         &#x27;svr__epsilon&#x27;: [0.001, 0.01, 0.1, 0.2, 0.5, 1],
                         &#x27;svr__kernel&#x27;: [&#x27;linear&#x27;, &#x27;rbf&#x27;]},
             scoring=&#x27;r2&#x27;)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-66" type="checkbox" ><label for="sk-estimator-id-66" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;minmaxscaler&#x27;, MinMaxScaler()), (&#x27;svr&#x27;, SVR())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-67" type="checkbox" ><label for="sk-estimator-id-67" class="sk-toggleable__label sk-toggleable__label-arrow">MinMaxScaler</label><div class="sk-toggleable__content"><pre>MinMaxScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-68" type="checkbox" ><label for="sk-estimator-id-68" class="sk-toggleable__label sk-toggleable__label-arrow">SVR</label><div class="sk-toggleable__content"><pre>SVR()</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;minmaxscaler&#39;, MinMaxScaler()),
                (&#39;svr&#39;, SVR(C=100, epsilon=0.001))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculo de Metricas</span>

<span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1624.98
MAE: 1303.93
RRMSE: 0.25
R-squared (R^2): 0.46
NSE (Nash-Sutcliffe Efficiency): 0.46
</pre></div>
</div>
</div>
</div>
</section>
<section id="redes-neuronales">
<h2>Redes Neuronales<a class="headerlink" href="#redes-neuronales" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">TransformedTargetRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.optimizers</span> <span class="kn">import</span> <span class="n">Adam</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>
<span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">load_model</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define el callback EarlyStopping</span>
<span class="n">early_stopping</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define el modelo de red neuronal</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Compila el modelo</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">)</span>

<span class="n">indice</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.8</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">))</span>

<span class="n">X_trainval</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[:</span><span class="n">indice</span><span class="p">]</span>
<span class="n">y_trainval</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[:</span><span class="n">indice</span><span class="p">]</span>
<span class="n">X_val</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">indice</span><span class="p">:]</span>
<span class="n">y_val</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="n">indice</span><span class="p">:]</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>


<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainval</span><span class="p">,</span> <span class="n">y_trainval</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                        <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">),</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">early_stopping</span><span class="p">])</span>

<span class="c1"># Define el pipeline con transformador de escala y modelo</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
<span class="p">])</span>


<span class="c1"># Eval√∫a el modelo en datos de prueba</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>


<span class="c1"># Grafica los resultados</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos reales&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicciones&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/200
3/3 [==============================] - 1s 113ms/step - loss: 55365320.0000 - val_loss: 71390920.0000
Epoch 2/200
3/3 [==============================] - 0s 29ms/step - loss: 48480508.0000 - val_loss: 62074268.0000
Epoch 3/200
3/3 [==============================] - 0s 32ms/step - loss: 42070444.0000 - val_loss: 53539864.0000
Epoch 4/200
3/3 [==============================] - 0s 24ms/step - loss: 36257648.0000 - val_loss: 44834344.0000
Epoch 5/200
3/3 [==============================] - 0s 25ms/step - loss: 30185006.0000 - val_loss: 35640140.0000
Epoch 6/200
3/3 [==============================] - 0s 28ms/step - loss: 23716000.0000 - val_loss: 26289424.0000
Epoch 7/200
3/3 [==============================] - 0s 27ms/step - loss: 17372626.0000 - val_loss: 17673238.0000
Epoch 8/200
3/3 [==============================] - 0s 30ms/step - loss: 11558709.0000 - val_loss: 10376077.0000
Epoch 9/200
3/3 [==============================] - 0s 29ms/step - loss: 6748636.0000 - val_loss: 5450940.0000
Epoch 10/200
3/3 [==============================] - 0s 37ms/step - loss: 3717610.0000 - val_loss: 3496650.2500
Epoch 11/200
3/3 [==============================] - 0s 27ms/step - loss: 2939852.2500 - val_loss: 4350219.5000
Epoch 12/200
3/3 [==============================] - 0s 26ms/step - loss: 3674101.7500 - val_loss: 5867777.0000
Epoch 13/200
3/3 [==============================] - 0s 23ms/step - loss: 4545388.5000 - val_loss: 6007170.0000
Epoch 14/200
3/3 [==============================] - 0s 21ms/step - loss: 4421989.0000 - val_loss: 4952468.0000
Epoch 15/200
3/3 [==============================] - 0s 26ms/step - loss: 3651133.2500 - val_loss: 3905311.0000
Epoch 16/200
3/3 [==============================] - 0s 33ms/step - loss: 3012840.0000 - val_loss: 3482984.7500
Epoch 17/200
3/3 [==============================] - 0s 26ms/step - loss: 2826552.0000 - val_loss: 3595496.0000
Epoch 18/200
3/3 [==============================] - 0s 24ms/step - loss: 2942494.0000 - val_loss: 3843827.5000
Epoch 19/200
3/3 [==============================] - 0s 24ms/step - loss: 3107556.7500 - val_loss: 3950966.5000
Epoch 20/200
3/3 [==============================] - 0s 26ms/step - loss: 3158478.7500 - val_loss: 3871294.2500
Epoch 21/200
3/3 [==============================] - 0s 28ms/step - loss: 3076518.2500 - val_loss: 3686684.0000
Epoch 22/200
1/3 [=========&gt;....................] - ETA: 0s - loss: 2758878.7500
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3/3 [==============================] - 0s 33ms/step - loss: 2959200.2500 - val_loss: 3522205.7500
Epoch 23/200
3/3 [==============================] - 0s 87ms/step - loss: 2855009.0000 - val_loss: 3473210.7500
Epoch 24/200
3/3 [==============================] - 0s 34ms/step - loss: 2834397.5000 - val_loss: 3494057.0000
Epoch 25/200
3/3 [==============================] - 0s 27ms/step - loss: 2846834.2500 - val_loss: 3516232.0000
Epoch 26/200
3/3 [==============================] - 0s 26ms/step - loss: 2851994.2500 - val_loss: 3509800.0000
Epoch 27/200
3/3 [==============================] - 0s 19ms/step - loss: 2845034.0000 - val_loss: 3492046.7500
Epoch 28/200
3/3 [==============================] - 0s 22ms/step - loss: 2828092.7500 - val_loss: 3475156.0000
Epoch 29/200
3/3 [==============================] - 0s 26ms/step - loss: 2824280.0000 - val_loss: 3479052.2500
Epoch 30/200
3/3 [==============================] - 0s 23ms/step - loss: 2836521.0000 - val_loss: 3494621.7500
Epoch 31/200
3/3 [==============================] - 0s 23ms/step - loss: 2840858.5000 - val_loss: 3490691.5000
Epoch 32/200
3/3 [==============================] - 0s 23ms/step - loss: 2836209.0000 - val_loss: 3480634.2500
Epoch 33/200
3/3 [==============================] - 0s 23ms/step - loss: 2824866.7500 - val_loss: 3473369.7500
3/3 [==============================] - 0s 3ms/step
</pre></div>
</div>
<img alt="../_images/d232bdf07b55d48903127d807f7a1547b0765b023d96ee116dd3f5babed2fd35.png" src="../_images/d232bdf07b55d48903127d807f7a1547b0765b023d96ee116dd3f5babed2fd35.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 6481.912 ],
       [ 5424.327 ],
       [ 7183.716 ],
       [ 7652.7554],
       [ 8319.862 ],
       [ 8195.32  ],
       [ 5651.0693],
       [ 3676.264 ],
       [ 4436.83  ],
       [ 3972.9458],
       [ 6312.454 ],
       [ 6480.289 ],
       [ 4624.7363],
       [ 4091.8555],
       [ 5356.78  ],
       [ 6861.87  ],
       [ 8111.6777],
       [ 8263.042 ],
       [ 4466.788 ],
       [ 3889.4478],
       [ 3313.7085],
       [ 4754.6646],
       [ 4969.0366],
       [ 5755.7065],
       [ 4232.0483],
       [ 4023.351 ],
       [ 4283.904 ],
       [ 4234.335 ],
       [ 5656.559 ],
       [ 4332.8154],
       [ 2621.9465],
       [ 2416.5679],
       [ 2609.9006],
       [ 3284.9888],
       [ 5247.434 ],
       [ 5780.7427],
       [ 5189.1963],
       [ 5312.5073],
       [ 5975.2153],
       [ 7072.793 ],
       [ 8874.276 ],
       [ 9913.    ],
       [ 8469.961 ],
       [ 4950.6846],
       [ 4628.643 ],
       [ 6628.06  ],
       [ 8197.943 ],
       [10163.417 ],
       [10479.275 ],
       [ 8879.311 ],
       [ 8526.602 ],
       [ 8835.049 ],
       [ 8975.308 ],
       [ 9422.628 ],
       [ 8021.958 ],
       [ 4780.6064],
       [ 3803.6292],
       [ 5925.1113],
       [ 7705.307 ],
       [ 9550.084 ],
       [ 8419.176 ],
       [ 6663.619 ],
       [ 6499.5703],
       [ 8341.278 ],
       [ 9888.493 ],
       [ 9277.278 ],
       [ 4199.5156],
       [ 3209.2852],
       [ 3855.4065],
       [ 5695.751 ],
       [ 6755.7075],
       [ 8792.046 ],
       [ 7650.3296],
       [ 5803.686 ],
       [ 5091.7905],
       [ 7287.3364],
       [ 9039.737 ],
       [ 8322.271 ],
       [ 5089.0186],
       [ 3151.7424],
       [ 3223.5728],
       [ 3555.2878],
       [ 4015.9988],
       [ 5470.6855],
       [ 6811.51  ],
       [ 7094.334 ],
       [ 8460.495 ],
       [ 9114.076 ],
       [ 9557.381 ]], dtype=float32)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1543.14
MAE: 1243.48
RRMSE: 0.47
R-squared (R^2): 0.51
NSE (Nash-Sutcliffe Efficiency): -170.36
</pre></div>
</div>
</div>
</div>
</section>
<section id="modelo-hibrido">
<h2>Modelo Hibrido<a class="headerlink" href="#modelo-hibrido" title="Permalink to this heading">#</a></h2>
<section id="random-forest-con-modelos-lineales">
<h3>Random Forest con modelos lineales<a class="headerlink" href="#random-forest-con-modelos-lineales" title="Permalink to this heading">#</a></h3>
<p>Entre los modelos lineales se encuentran: autoregressive (AR), moving average (MA), and autoregressive moving average (ARMA)</p>
<p>Para medir el rendimiento de todos los modelos desarrollados de manera cualitativa, los valores de RRMSE (Error Cuadr√°tico Medio Ra√≠z Relativo) se categorizaron de la siguiente manera:</p>
<ul class="simple">
<li><p>Excelente: 0% &lt; RRMSE &lt; 10%</p></li>
<li><p>Bueno: 10% &lt; RRMSE &lt; 20%</p></li>
<li><p>Regular: 20% &lt; RRMSE &lt; 30%</p></li>
<li><p>Malo: RRMSE &gt; 30%</p></li>
</ul>
</section>
<section id="ar-rf">
<h3>AR-RF<a class="headerlink" href="#ar-rf" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">residuales_test_lag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">residuales_test_extra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">residuales_test_lag</span><span class="p">,</span> <span class="n">X_test</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="c1">#plt.plot(data_test.Mes, y_pred, label=&quot;RF&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Caudal (m3/s)&#39;)
</pre></div>
</div>
<img alt="../_images/ed4007de80de919bab40c506e117348e25fa78347df0e4f2e34ec7b1a7701f6f.png" src="../_images/ed4007de80de919bab40c506e117348e25fa78347df0e4f2e34ec7b1a7701f6f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_order</span> <span class="o">=</span> <span class="n">orden_ar</span>
<span class="n">history</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">train</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">residuals_train</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">resid</span>

<span class="n">residuales_train_lag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#residuales_train_extra = residuales_train_lag</span>
<span class="n">residuales_train_extra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">residuales_train_lag</span><span class="p">,</span> <span class="n">X_train</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 7.49038700e+03, -9.00000000e-01],
       [ 7.04638710e+03, -6.00000000e-01],
       [ 5.76934483e+03, -4.00000000e-01],
       [ 5.01648387e+03, -3.00000000e-01],
       [ 4.61326667e+03, -4.00000000e-01],
       [ 6.78383871e+03, -5.00000000e-01],
       [ 9.16430000e+03, -4.00000000e-01],
       [ 1.04028065e+04, -3.00000000e-01],
       [ 1.04148065e+04, -2.00000000e-01],
       [ 1.01124667e+04, -2.00000000e-01],
       [ 1.12975484e+04, -6.00000000e-01],
       [ 1.27622333e+04, -9.00000000e-01],
       [ 1.25075484e+04, -1.10000000e+00],
       [ 7.95409677e+03, -1.00000000e+00],
       [ 3.91685714e+03, -8.00000000e-01],
       [ 3.00100000e+03, -8.00000000e-01],
       [ 3.97440000e+03, -8.00000000e-01],
       [ 5.52129032e+03, -8.00000000e-01],
       [ 6.20606667e+03, -6.00000000e-01],
       [ 4.73029032e+03, -5.00000000e-01],
       [ 6.05835484e+03, -5.00000000e-01],
       [ 7.84180000e+03, -4.00000000e-01],
       [ 9.08690323e+03, -3.00000000e-01],
       [ 9.90666667e+03, -3.00000000e-01],
       [ 9.75325806e+03, -4.00000000e-01],
       [ 6.52548387e+03, -5.00000000e-01],
       [ 5.09717857e+03, -5.00000000e-01],
       [ 5.66748387e+03, -3.00000000e-01],
       [ 6.55200000e+03, -2.00000000e-01],
       [ 8.34709677e+03, -1.00000000e-01],
       [ 9.22853333e+03,  0.00000000e+00],
       [ 8.71706452e+03,  2.00000000e-01],
       [ 6.20522581e+03,  4.00000000e-01],
       [ 6.18996667e+03,  7.00000000e-01],
       [ 8.39074194e+03,  9.00000000e-01],
       [ 1.06275333e+04,  1.10000000e+00],
       [ 9.59354839e+03,  1.20000000e+00],
       [ 5.07500000e+03,  1.20000000e+00],
       [ 4.22164286e+03,  1.20000000e+00],
       [ 4.11390323e+03,  1.10000000e+00],
       [ 4.45050000e+03,  9.00000000e-01],
       [ 6.14919355e+03,  1.00000000e+00],
       [ 6.98206667e+03,  1.20000000e+00],
       [ 5.94500000e+03,  1.50000000e+00],
       [ 7.56383871e+03,  1.70000000e+00],
       [ 7.65320000e+03,  1.60000000e+00],
       [ 8.92225806e+03,  1.50000000e+00],
       [ 1.10862000e+04,  1.30000000e+00],
       [ 1.11318710e+04,  1.10000000e+00],
       [ 6.51670968e+03,  8.00000000e-01],
       [ 4.39441379e+03,  5.00000000e-01],
       [ 4.15222581e+03,  1.00000000e-01],
       [ 4.69490000e+03, -3.00000000e-01],
       [ 5.72529032e+03, -9.00000000e-01],
       [ 6.41570000e+03, -1.30000000e+00],
       [ 8.63629032e+03, -1.30000000e+00],
       [ 9.66929032e+03, -1.10000000e+00],
       [ 1.15193000e+04, -1.20000000e+00],
       [ 1.28927097e+04, -1.50000000e+00],
       [ 1.31599667e+04, -1.80000000e+00],
       [ 1.35308387e+04, -1.80000000e+00],
       [ 1.15635161e+04, -1.70000000e+00],
       [ 7.22439286e+03, -1.40000000e+00],
       [ 6.12045161e+03, -1.10000000e+00],
       [ 5.86236667e+03, -8.00000000e-01],
       [ 6.46380645e+03, -6.00000000e-01],
       [ 7.54586667e+03, -4.00000000e-01],
       [ 7.21819355e+03, -3.00000000e-01],
       [ 6.88880645e+03, -3.00000000e-01],
       [ 8.29833333e+03, -2.00000000e-01],
       [ 1.05308065e+04, -2.00000000e-01],
       [ 1.20455000e+04, -2.00000000e-01],
       [ 1.07093871e+04, -1.00000000e-01],
       [ 6.67322581e+03,  1.00000000e-01],
       [ 5.05682143e+03,  2.00000000e-01],
       [ 4.68441935e+03,  3.00000000e-01],
       [ 5.27616667e+03,  3.00000000e-01],
       [ 7.40058065e+03,  3.00000000e-01],
       [ 7.70736667e+03,  3.00000000e-01],
       [ 7.09032258e+03,  3.00000000e-01],
       [ 6.33496774e+03,  4.00000000e-01],
       [ 6.60586667e+03,  4.00000000e-01],
       [ 7.99829032e+03,  3.00000000e-01],
       [ 9.89116667e+03,  4.00000000e-01],
       [ 1.01937742e+04,  4.00000000e-01],
       [ 7.04987097e+03,  4.00000000e-01],
       [ 3.69596429e+03,  3.00000000e-01],
       [ 4.15470968e+03,  2.00000000e-01],
       [ 4.84343333e+03,  3.00000000e-01],
       [ 6.41819355e+03,  5.00000000e-01],
       [ 7.13026667e+03,  6.00000000e-01],
       [ 6.73990323e+03,  7.00000000e-01],
       [ 6.34674194e+03,  6.00000000e-01],
       [ 5.39646667e+03,  6.00000000e-01],
       [ 7.76845161e+03,  8.00000000e-01],
       [ 8.24023333e+03,  1.20000000e+00],
       [ 8.43783871e+03,  1.50000000e+00],
       [ 4.55206452e+03,  1.70000000e+00],
       [ 3.06772414e+03,  1.60000000e+00],
       [ 2.88403226e+03,  1.50000000e+00],
       [ 2.84413333e+03,  1.30000000e+00],
       [ 4.61690323e+03,  1.10000000e+00],
       [ 5.50690000e+03,  7.00000000e-01],
       [ 4.89880645e+03,  4.00000000e-01],
       [ 5.71783871e+03,  1.00000000e-01],
       [ 6.07516667e+03, -1.00000000e-01],
       [ 6.90800000e+03, -2.00000000e-01],
       [ 6.91370000e+03, -3.00000000e-01],
       [ 7.09638710e+03, -1.00000000e-01],
       [ 5.11138710e+03,  1.00000000e-01],
       [ 3.85028571e+03,  3.00000000e-01],
       [ 3.58738710e+03,  5.00000000e-01],
       [ 5.26603333e+03,  7.00000000e-01],
       [ 7.41777419e+03,  7.00000000e-01],
       [ 8.56700000e+03,  6.00000000e-01],
       [ 7.77048387e+03,  3.00000000e-01],
       [ 6.27522581e+03,  3.00000000e-01],
       [ 7.23683333e+03,  2.00000000e-01],
       [ 8.26770968e+03,  1.00000000e-01],
       [ 8.98203333e+03,  0.00000000e+00],
       [ 1.00119032e+04,  1.00000000e-01],
       [ 8.04461290e+03,  1.00000000e-01],
       [ 5.15410714e+03,  1.00000000e-01],
       [ 5.14622581e+03,  2.00000000e-01],
       [ 6.45143333e+03,  3.00000000e-01],
       [ 8.07354839e+03,  4.00000000e-01],
       [ 9.08156667e+03,  4.00000000e-01],
       [ 8.37629032e+03,  4.00000000e-01],
       [ 6.86635484e+03,  4.00000000e-01],
       [ 6.57506667e+03,  6.00000000e-01],
       [ 7.92058065e+03,  7.00000000e-01],
       [ 9.54086667e+03,  1.00000000e+00],
       [ 9.94609677e+03,  1.10000000e+00],
       [ 5.24693548e+03,  1.00000000e+00],
       [ 2.53400000e+03,  7.00000000e-01],
       [ 2.62264516e+03,  5.00000000e-01],
       [ 3.68930000e+03,  3.00000000e-01],
       [ 5.82183871e+03,  1.00000000e-01],
       [ 7.23370000e+03,  0.00000000e+00],
       [ 7.74154839e+03, -2.00000000e-01],
       [ 8.85032258e+03, -5.00000000e-01],
       [ 9.49323333e+03, -8.00000000e-01],
       [ 9.16258065e+03, -1.00000000e+00],
       [ 1.05438733e+04, -1.00000000e+00],
       [ 9.34874194e+03, -1.00000000e+00],
       [ 6.82161290e+03, -9.00000000e-01],
       [ 4.98224138e+03, -8.00000000e-01],
       [ 5.88254839e+03, -6.00000000e-01],
       [ 6.62680000e+03, -4.00000000e-01],
       [ 7.20877419e+03, -3.00000000e-01],
       [ 9.22450000e+03, -3.00000000e-01],
       [ 1.10290645e+04, -3.00000000e-01],
       [ 1.11215806e+04, -3.00000000e-01],
       [ 1.02336000e+04, -4.00000000e-01],
       [ 9.89625806e+03, -4.00000000e-01],
       [ 1.05106333e+04, -4.00000000e-01],
       [ 9.40222581e+03, -5.00000000e-01],
       [ 5.69187097e+03, -5.00000000e-01],
       [ 4.93360714e+03, -4.00000000e-01],
       [ 3.68938710e+03, -1.00000000e-01],
       [ 3.70373333e+03,  3.00000000e-01],
       [ 4.58241935e+03,  8.00000000e-01],
       [ 5.43830000e+03,  1.20000000e+00],
       [ 5.06632258e+03,  1.60000000e+00],
       [ 3.72848387e+03,  1.90000000e+00],
       [ 3.66056667e+03,  2.10000000e+00],
       [ 5.03935484e+03,  2.30000000e+00],
       [ 5.66160000e+03,  2.40000000e+00],
       [ 4.81900000e+03,  2.40000000e+00],
       [ 2.62587097e+03,  2.20000000e+00],
       [ 2.74557143e+03,  1.90000000e+00],
       [ 2.53348387e+03,  1.40000000e+00],
       [ 4.12746667e+03,  1.00000000e+00],
       [ 6.51380645e+03,  5.00000000e-01],
       [ 8.00793333e+03, -1.00000000e-01],
       [ 8.63419355e+03, -8.00000000e-01],
       [ 8.30719355e+03, -1.10000000e+00],
       [ 8.48100000e+03, -1.30000000e+00],
       [ 9.30712903e+03, -1.40000000e+00],
       [ 9.98053333e+03, -1.50000000e+00],
       [ 1.10197419e+04, -1.60000000e+00],
       [ 9.84880645e+03, -1.50000000e+00],
       [ 7.31500000e+03, -1.30000000e+00],
       [ 8.07658065e+03, -1.10000000e+00],
       [ 8.43106667e+03, -1.00000000e+00],
       [ 9.33390323e+03, -1.00000000e+00],
       [ 1.03279000e+04, -1.00000000e+00],
       [ 1.09857742e+04, -1.10000000e+00],
       [ 9.73258065e+03, -1.10000000e+00],
       [ 9.59440000e+03, -1.20000000e+00],
       [ 1.14342258e+04, -1.30000000e+00],
       [ 1.33782333e+04, -1.50000000e+00],
       [ 1.30227742e+04, -1.70000000e+00],
       [ 1.08118387e+04, -1.70000000e+00],
       [ 6.09337931e+03, -1.40000000e+00],
       [ 5.97648387e+03, -1.10000000e+00],
       [ 5.62980000e+03, -8.00000000e-01],
       [ 6.92251613e+03, -7.00000000e-01],
       [ 8.97120000e+03, -6.00000000e-01],
       [ 9.57287097e+03, -6.00000000e-01],
       [ 8.56200000e+03, -5.00000000e-01],
       [ 8.57196667e+03, -5.00000000e-01],
       [ 1.02342903e+04, -6.00000000e-01],
       [ 1.05701333e+04, -7.00000000e-01],
       [ 9.16245161e+03, -7.00000000e-01],
       [ 5.23922581e+03, -7.00000000e-01],
       [ 2.96032143e+03, -5.00000000e-01],
       [ 3.28812903e+03, -4.00000000e-01],
       [ 3.76126667e+03, -3.00000000e-01],
       [ 4.55577419e+03, -3.00000000e-01],
       [ 5.87240000e+03, -1.00000000e-01],
       [ 4.88964516e+03, -1.00000000e-01],
       [ 4.29306452e+03, -1.00000000e-01],
       [ 4.58910000e+03, -2.00000000e-01],
       [ 6.22883871e+03, -3.00000000e-01],
       [ 7.73403333e+03, -3.00000000e-01],
       [ 8.53735484e+03, -3.00000000e-01],
       [ 6.71738710e+03, -1.00000000e-01],
       [ 3.32614286e+03,  0.00000000e+00],
       [ 2.89341935e+03,  1.00000000e-01],
       [ 4.51806667e+03,  2.00000000e-01],
       [ 5.95490323e+03,  4.00000000e-01],
       [ 7.58330000e+03,  7.00000000e-01],
       [ 6.75061290e+03,  8.00000000e-01],
       [ 4.44029032e+03,  9.00000000e-01],
       [ 4.58456667e+03,  1.00000000e+00],
       [ 5.09380645e+03,  1.20000000e+00],
       [ 7.59186667e+03,  1.30000000e+00],
       [ 6.22529032e+03,  1.10000000e+00],
       [ 3.52700000e+03,  9.00000000e-01],
       [ 2.51669286e+03,  6.00000000e-01],
       [ 2.68403226e+03,  4.00000000e-01],
       [ 3.81450000e+03,  0.00000000e+00],
       [ 5.95896774e+03, -3.00000000e-01],
       [ 7.15183333e+03, -2.00000000e-01],
       [ 7.71235484e+03,  1.00000000e-01],
       [ 6.91016129e+03,  2.00000000e-01],
       [ 6.13983333e+03,  3.00000000e-01],
       [ 7.89738710e+03,  3.00000000e-01],
       [ 1.00157333e+04,  4.00000000e-01],
       [ 1.11461613e+04,  4.00000000e-01],
       [ 8.35522581e+03,  4.00000000e-01],
       [ 3.72365517e+03,  3.00000000e-01],
       [ 2.91551613e+03,  2.00000000e-01],
       [ 3.60866667e+03,  2.00000000e-01],
       [ 6.01135484e+03,  2.00000000e-01],
       [ 7.55763333e+03,  3.00000000e-01],
       [ 6.19545161e+03,  5.00000000e-01],
       [ 5.94148387e+03,  6.00000000e-01],
       [ 6.27126667e+03,  7.00000000e-01],
       [ 8.04712903e+03,  7.00000000e-01],
       [ 1.01606333e+04,  7.00000000e-01],
       [ 1.11060968e+04,  7.00000000e-01],
       [ 7.07870968e+03,  6.00000000e-01],
       [ 4.56842857e+03,  6.00000000e-01],
       [ 3.83841935e+03,  4.00000000e-01],
       [ 4.44826667e+03,  4.00000000e-01],
       [ 6.62954839e+03,  3.00000000e-01],
       [ 8.43363333e+03,  1.00000000e-01],
       [ 8.27274194e+03, -1.00000000e-01],
       [ 6.66387097e+03, -1.00000000e-01],
       [ 6.31793333e+03, -1.00000000e-01],
       [ 7.51048387e+03, -3.00000000e-01],
       [ 1.00604667e+04, -6.00000000e-01],
       [ 1.26999032e+04, -8.00000000e-01],
       [ 9.20445161e+03, -9.00000000e-01],
       [ 5.53164286e+03, -8.00000000e-01],
       [ 4.32906452e+03, -6.00000000e-01],
       [ 6.29180000e+03, -4.00000000e-01],
       [ 8.75725806e+03, -1.00000000e-01],
       [ 1.10471000e+04,  0.00000000e+00],
       [ 1.01592903e+04,  1.00000000e-01],
       [ 6.98380645e+03,  3.00000000e-01],
       [ 7.05766667e+03,  5.00000000e-01],
       [ 7.21825806e+03,  8.00000000e-01],
       [ 9.11436667e+03,  9.00000000e-01],
       [ 1.05754194e+04,  9.00000000e-01],
       [ 7.90932258e+03,  7.00000000e-01],
       [ 3.75367857e+03,  2.00000000e-01],
       [ 2.91609677e+03, -1.00000000e-01],
       [ 5.65806667e+03, -3.00000000e-01],
       [ 8.44187097e+03, -4.00000000e-01],
       [ 1.12632667e+04, -5.00000000e-01],
       [ 1.10995806e+04, -6.00000000e-01],
       [ 9.30432258e+03, -8.00000000e-01],
       [ 1.04192000e+04, -1.10000000e+00],
       [ 1.04443871e+04, -1.30000000e+00],
       [ 1.31311000e+04, -1.50000000e+00],
       [ 1.25108387e+04, -1.60000000e+00],
       [ 8.93561290e+03, -1.60000000e+00],
       [ 5.44206897e+03, -1.50000000e+00],
       [ 5.42022581e+03, -1.30000000e+00],
       [ 5.67336667e+03, -1.00000000e+00],
       [ 7.71080645e+03, -8.00000000e-01],
       [ 9.97433333e+03, -6.00000000e-01],
       [ 1.15245484e+04, -4.00000000e-01],
       [ 1.19362258e+04, -2.00000000e-01],
       [ 1.21245667e+04, -2.00000000e-01],
       [ 1.20382581e+04, -4.00000000e-01],
       [ 1.33234667e+04, -6.00000000e-01],
       [ 1.44381935e+04, -7.00000000e-01],
       [ 1.02574839e+04, -8.00000000e-01],
       [ 6.77750000e+03, -8.00000000e-01],
       [ 5.64258065e+03, -6.00000000e-01],
       [ 6.94770000e+03, -3.00000000e-01],
       [ 7.84980645e+03,  0.00000000e+00],
       [ 7.78746667e+03,  3.00000000e-01],
       [ 7.40141935e+03,  5.00000000e-01],
       [ 6.03451613e+03,  6.00000000e-01],
       [ 6.08250000e+03,  7.00000000e-01],
       [ 5.28929032e+03,  1.00000000e+00],
       [ 7.12320000e+03,  1.40000000e+00],
       [ 6.16322581e+03,  1.60000000e+00],
       [ 3.44706452e+03,  1.50000000e+00],
       [ 2.57892857e+03,  1.20000000e+00],
       [ 3.22200000e+03,  8.00000000e-01],
       [ 4.54460000e+03,  4.00000000e-01],
       [ 7.18206452e+03, -2.00000000e-01],
       [ 9.27516667e+03, -7.00000000e-01],
       [ 1.09722581e+04, -1.00000000e+00],
       [ 1.27412581e+04, -1.30000000e+00],
       [ 1.28392667e+04, -1.60000000e+00],
       [ 1.36845484e+04, -1.60000000e+00],
       [ 1.37174333e+04, -1.60000000e+00],
       [ 1.39420323e+04, -1.60000000e+00],
       [ 1.14301290e+04, -1.40000000e+00],
       [ 6.72085714e+03, -1.20000000e+00],
       [ 6.59529032e+03, -9.00000000e-01],
       [ 8.27376667e+03, -7.00000000e-01],
       [ 1.19960000e+04, -6.00000000e-01],
       [ 1.28272667e+04, -4.00000000e-01],
       [ 1.12263548e+04, -5.00000000e-01],
       [ 1.01257742e+04, -6.00000000e-01],
       [ 9.12993333e+03, -8.00000000e-01],
       [ 9.56509677e+03, -1.00000000e+00],
       [ 1.14015333e+04, -1.10000000e+00],
       [ 1.33945806e+04, -1.00000000e+00],
       [ 1.13356129e+04, -9.00000000e-01],
       [ 6.96813793e+03, -7.00000000e-01],
       [ 4.54058065e+03, -6.00000000e-01],
       [ 6.58516667e+03, -5.00000000e-01],
       [ 9.66800000e+03, -3.00000000e-01],
       [ 9.00076667e+03,  0.00000000e+00],
       [ 6.41796774e+03,  2.00000000e-01],
       [ 6.19329032e+03,  4.00000000e-01],
       [ 6.50166667e+03,  4.00000000e-01],
       [ 6.41374194e+03,  3.00000000e-01],
       [ 7.85830000e+03,  1.00000000e-01],
       [ 6.85496774e+03, -2.00000000e-01],
       [ 3.66877419e+03, -4.00000000e-01],
       [ 3.20507143e+03, -4.00000000e-01],
       [ 3.79174194e+03, -3.00000000e-01],
       [ 4.22893333e+03, -3.00000000e-01],
       [ 6.25893548e+03, -4.00000000e-01],
       [ 8.22893333e+03, -4.00000000e-01]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">residuales_train_extra</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-2.05548235e+03,  7.49038700e+03, -9.00000000e-01],
       [-3.66642956e+02,  7.04638710e+03, -6.00000000e-01],
       [-1.35158224e+03,  5.76934483e+03, -4.00000000e-01],
       ...,
       [-1.09798020e+03,  4.22893333e+03, -3.00000000e-01],
       [ 1.26295867e+03,  6.25893548e+03, -4.00000000e-01],
       [ 6.62281918e+02,  8.22893333e+03, -4.00000000e-01]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="c1">#plt.plot(data_test.Mes, y_pred, label=&quot;RF&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Caudal (m3/s)&#39;)
</pre></div>
</div>
<img alt="../_images/a79f4d1efdb0b1209d4b14cb944052800158e859cdb24be523b50e4ae77ff23f.png" src="../_images/a79f4d1efdb0b1209d4b14cb944052800158e859cdb24be523b50e4ae77ff23f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">RandomForestRegressor</span><span class="p">())</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;randomforestregressor__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">400</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__max_leaf_nodes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__min_samples_split&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">]}</span>

<span class="n">RF_e</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">RF_e</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">residuales_train_extra</span><span class="p">,</span> <span class="n">residuals_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-18 {color: black;}#sk-container-id-18 pre{padding: 0;}#sk-container-id-18 div.sk-toggleable {background-color: white;}#sk-container-id-18 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-18 label.sk-toggleable__label-arrow:before {content: "‚ñ∏";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-18 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-18 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-18 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-18 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-18 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-18 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "‚ñæ";}#sk-container-id-18 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-18 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-18 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-18 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-18 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-18 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-18 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-18 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-18 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-18 div.sk-item {position: relative;z-index: 1;}#sk-container-id-18 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-18 div.sk-item::before, #sk-container-id-18 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-18 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-18 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-18 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-18 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-18 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-18 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-18 div.sk-label-container {text-align: center;}#sk-container-id-18 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-18 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-18" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                                       (&#x27;randomforestregressor&#x27;,
                                        RandomForestRegressor())]),
             n_jobs=-1,
             param_grid={&#x27;randomforestregressor__max_depth&#x27;: [2, 3, 4],
                         &#x27;randomforestregressor__max_leaf_nodes&#x27;: [2, 4, 6, 8],
                         &#x27;randomforestregressor__min_samples_split&#x27;: [2, 5, 10,
                                                                      15],
                         &#x27;randomforestregressor__n_estimators&#x27;: [400]},
             scoring=&#x27;r2&#x27;)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-69" type="checkbox" ><label for="sk-estimator-id-69" class="sk-toggleable__label sk-toggleable__label-arrow">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                                       (&#x27;randomforestregressor&#x27;,
                                        RandomForestRegressor())]),
             n_jobs=-1,
             param_grid={&#x27;randomforestregressor__max_depth&#x27;: [2, 3, 4],
                         &#x27;randomforestregressor__max_leaf_nodes&#x27;: [2, 4, 6, 8],
                         &#x27;randomforestregressor__min_samples_split&#x27;: [2, 5, 10,
                                                                      15],
                         &#x27;randomforestregressor__n_estimators&#x27;: [400]},
             scoring=&#x27;r2&#x27;)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-70" type="checkbox" ><label for="sk-estimator-id-70" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                (&#x27;randomforestregressor&#x27;, RandomForestRegressor())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-71" type="checkbox" ><label for="sk-estimator-id-71" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-72" type="checkbox" ><label for="sk-estimator-id-72" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestRegressor</label><div class="sk-toggleable__content"><pre>RandomForestRegressor()</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF_e</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                (&#39;randomforestregressor&#39;,
                 RandomForestRegressor(max_depth=4, max_leaf_nodes=8,
                                       min_samples_split=15,
                                       n_estimators=400))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">RF_e</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;plt.figure(figsize=(14,6))</span>
<span class="sd">plt.plot(residuals_train, label=&quot;Training data&quot;)</span>
<span class="sd">#plt.plot(residuales_AR, label=&quot;Test data&quot;)</span>
<span class="sd">plt.plot(y_tree, label=&quot;Tree prediction&quot;)</span>
<span class="sd">plt.legend();</span>

<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;plt.figure(figsize=(14,6))\nplt.plot(residuals_train, label=&quot;Training data&quot;)\n#plt.plot(residuales_AR, label=&quot;Test data&quot;)\nplt.plot(y_tree, label=&quot;Tree prediction&quot;)\nplt.legend();\n\n&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Tree prediction&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ba3757b54893f704ff4d330b94a15ca4a11d07f792dfea86b868790a51f8c43f.png" src="../_images/ba3757b54893f704ff4d330b94a15ca4a11d07f792dfea86b868790a51f8c43f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1152.48
MAE: 894.70
RRMSE: -9.59
R-squared (R^2): 0.09
NSE (Nash-Sutcliffe Efficiency): 0.09
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF_e</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">residuales_train_extra</span><span class="p">,</span> <span class="n">residuals_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF_e</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">,</span> <span class="n">residuales_AR</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training-set score: 0.24
Test-set score: 0.09
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_residual</span> <span class="o">=</span> <span class="n">RF_e</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">)</span>

<span class="n">y_AR_RF</span> <span class="o">=</span> <span class="n">predictions_AR</span> <span class="o">+</span> <span class="n">y_residual</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">y_residual</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 267.5214176    91.51494441   94.21215857   40.35321221  303.52444562
  241.24805751  104.21684953   68.99265601   73.19766058   56.99725645
  -20.69748499   69.26380742   82.37537094  -39.28571869  -22.94293597
  -43.15823824  -85.40581272 -122.50874832   87.17517515 -120.94640765
   22.56363561  -63.00773042   90.75904306 -653.66167928 -117.39658716
 -729.31783902 -585.30737492 -338.97332742 -738.67231666 -168.53662693
 -318.92058235 -636.02238623 -291.5611344   -79.0197143   -38.48592548
   69.66667358   95.77760253  118.50950259  174.03039995  258.53854944
  403.48482518  338.47117361   26.8116129   114.08615966  -60.66224639
  -18.36815412   -8.43444057 -438.27729997 -745.8893021    14.46900994
  346.15471698  304.06934515  341.84778924  445.42405292   38.74840691
  133.78676842   95.77187727  164.45946735  140.29857006  -25.34667382
  -59.481276     14.88154246   14.34429162  -71.55819834 -620.0149907
 -223.9020712    75.26982122 -259.53614096   64.08378018  -28.21588308
  -11.12395464  -63.67793328  -63.96424474   36.68804732    3.55677478
 -115.0562676   -15.9524782   -64.40496228   87.97310739 -132.29633826
  -98.77162148   85.01303181   32.62307802   88.24243973  201.42961942
  259.48125023  209.63867544  632.62257272  695.96259326]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">y_AR_RF</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1152.48
MAE: 894.70
RRMSE: 0.18
R-squared (R^2): 0.73
NSE (Nash-Sutcliffe Efficiency): 0.73
</pre></div>
</div>
</div>
</div>
</section>
<section id="arma-rf">
<h3>ARMA-RF<a class="headerlink" href="#arma-rf" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">residuales_test_lag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">residuales_ARMA</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">residuales_test_extra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">residuales_test_lag</span><span class="p">,</span> <span class="n">X_test</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_ARMA</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="c1">#plt.plot(data_test.Mes, y_pred, label=&quot;RF&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Caudal (m3/s)&#39;)
</pre></div>
</div>
<img alt="../_images/7f29c2248849a37e2cc3bda0c00de8d2bc325b9900266db534c8efc8eb87df83.png" src="../_images/7f29c2248849a37e2cc3bda0c00de8d2bc325b9900266db534c8efc8eb87df83.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_order</span> <span class="o">=</span> <span class="n">orden_arma</span>
<span class="n">history</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">train</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">residuals_train</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">resid</span>

<span class="n">residuales_train_lag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#residuales_train_extra = residuales_train_lag</span>
<span class="n">residuales_train_extra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">residuales_train_lag</span><span class="p">,</span> <span class="n">X_train</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">residuales_train_extra</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-9.80548111e+02,  7.49038700e+03, -9.00000000e-01],
       [-3.66642663e+02,  7.04638710e+03, -6.00000000e-01],
       [-1.33483436e+03,  5.76934483e+03, -4.00000000e-01],
       ...,
       [-1.25714356e+03,  4.22893333e+03, -3.00000000e-01],
       [ 3.17163021e+02,  6.25893548e+03, -4.00000000e-01],
       [ 9.01116947e+02,  8.22893333e+03, -4.00000000e-01]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="c1">#plt.plot(data_test.Mes, y_pred, label=&quot;RF&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Caudal (m3/s)&#39;)
</pre></div>
</div>
<img alt="../_images/0ff136ffb62039a864ebe63277dd1d72e2bda4f74a85b10cf6d238cf04709f14.png" src="../_images/0ff136ffb62039a864ebe63277dd1d72e2bda4f74a85b10cf6d238cf04709f14.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">RandomForestRegressor</span><span class="p">())</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;randomforestregressor__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">400</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__max_leaf_nodes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__min_samples_split&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">]}</span>

<span class="n">RF_e</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">RF_e</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">residuales_train_extra</span><span class="p">,</span> <span class="n">residuals_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-19 {color: black;}#sk-container-id-19 pre{padding: 0;}#sk-container-id-19 div.sk-toggleable {background-color: white;}#sk-container-id-19 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-19 label.sk-toggleable__label-arrow:before {content: "‚ñ∏";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-19 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-19 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-19 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-19 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-19 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-19 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "‚ñæ";}#sk-container-id-19 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-19 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-19 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-19 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-19 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-19 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-19 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-19 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-19 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-19 div.sk-item {position: relative;z-index: 1;}#sk-container-id-19 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-19 div.sk-item::before, #sk-container-id-19 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-19 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-19 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-19 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-19 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-19 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-19 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-19 div.sk-label-container {text-align: center;}#sk-container-id-19 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-19 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-19" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                                       (&#x27;randomforestregressor&#x27;,
                                        RandomForestRegressor())]),
             n_jobs=-1,
             param_grid={&#x27;randomforestregressor__max_depth&#x27;: [2, 3, 4],
                         &#x27;randomforestregressor__max_leaf_nodes&#x27;: [2, 4, 6, 8],
                         &#x27;randomforestregressor__min_samples_split&#x27;: [2, 5, 10,
                                                                      15],
                         &#x27;randomforestregressor__n_estimators&#x27;: [400]},
             scoring=&#x27;r2&#x27;)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-73" type="checkbox" ><label for="sk-estimator-id-73" class="sk-toggleable__label sk-toggleable__label-arrow">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                                       (&#x27;randomforestregressor&#x27;,
                                        RandomForestRegressor())]),
             n_jobs=-1,
             param_grid={&#x27;randomforestregressor__max_depth&#x27;: [2, 3, 4],
                         &#x27;randomforestregressor__max_leaf_nodes&#x27;: [2, 4, 6, 8],
                         &#x27;randomforestregressor__min_samples_split&#x27;: [2, 5, 10,
                                                                      15],
                         &#x27;randomforestregressor__n_estimators&#x27;: [400]},
             scoring=&#x27;r2&#x27;)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-74" type="checkbox" ><label for="sk-estimator-id-74" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;standardscaler&#x27;, StandardScaler()),
                (&#x27;randomforestregressor&#x27;, RandomForestRegressor())])</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-75" type="checkbox" ><label for="sk-estimator-id-75" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-76" type="checkbox" ><label for="sk-estimator-id-76" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestRegressor</label><div class="sk-toggleable__content"><pre>RandomForestRegressor()</pre></div></div></div></div></div></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF_e</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                (&#39;randomforestregressor&#39;,
                 RandomForestRegressor(max_depth=4, max_leaf_nodes=8,
                                       min_samples_split=15,
                                       n_estimators=400))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">RF_e</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;plt.figure(figsize=(14,6))</span>
<span class="sd">plt.plot(residuals_train, label=&quot;Training data&quot;)</span>
<span class="sd">#plt.plot(residuales_AR, label=&quot;Test data&quot;)</span>
<span class="sd">plt.plot(y_tree, label=&quot;Tree prediction&quot;)</span>
<span class="sd">plt.legend();</span>

<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;plt.figure(figsize=(14,6))\nplt.plot(residuals_train, label=&quot;Training data&quot;)\n#plt.plot(residuales_AR, label=&quot;Test data&quot;)\nplt.plot(y_tree, label=&quot;Tree prediction&quot;)\nplt.legend();\n\n&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Tree prediction&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8fe3d8e0c56b42a7c4a10c57ecbbcd28adc9159f33c96333a5b2684815116976.png" src="../_images/8fe3d8e0c56b42a7c4a10c57ecbbcd28adc9159f33c96333a5b2684815116976.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1167.10
MAE: 912.52
RRMSE: -9.71
R-squared (R^2): 0.07
NSE (Nash-Sutcliffe Efficiency): 0.07
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF_e</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">residuales_train_extra</span><span class="p">,</span> <span class="n">residuals_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF_e</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">,</span> <span class="n">residuales_AR</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training-set score: 0.24
Test-set score: 0.07
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_residual</span> <span class="o">=</span> <span class="n">RF_e</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">)</span>

<span class="n">y_ARMA_RF</span> <span class="o">=</span> <span class="n">predictions_ARMA</span> <span class="o">+</span> <span class="n">y_residual</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">y_residual</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 210.36143752   10.57930247  154.60102135   47.99286457  121.26697531
  104.28421674  118.08222028  121.2294001    36.20489273   36.94510681
  -86.43338699   74.57083366   68.22580784   -2.00869272  -47.33149207
   74.76109493   32.26448026  -45.61423064   38.54602733 -191.3647399
   30.41319705   21.75059402   30.23972599 -613.29741545  -89.79455761
 -849.58356609 -169.39005073 -228.37875159 -362.7545254  -236.52242655
 -289.1660467  -269.93963955 -144.1704935    23.89758754   29.29492875
   69.6097213    78.19351136  126.37924533  185.17830894  157.65418072
  352.26368758  325.70556857  111.39304239   94.84075302   15.36299059
   53.90805704   60.64009148  -89.01669751 -442.98097717   50.18140894
  229.22403891  157.73874359  155.37673594  362.7207154   107.14785468
  148.56581317  124.10150667  193.89724412  126.41374359  -13.6077931
  -19.18175852   76.23974069   61.52816393 -183.41443336 -572.63496055
 -334.59622316   19.91306129 -290.833718     24.18301811   36.31308563
   60.86229448  138.60534723   46.0208512    76.09974802   83.5687228
   10.7682193    83.28757289  -22.40729137   58.53431429   38.30683807
   48.18271143   45.5230304    51.48971175   34.81070696  164.53739941
  323.90110617  237.73951855  229.25007429  282.85207658]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">y_ARMA_RF</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1055.67
MAE: 816.14
RRMSE: 0.16
R-squared (R^2): 0.77
NSE (Nash-Sutcliffe Efficiency): 0.77
</pre></div>
</div>
</div>
</div>
</section>
<section id="ar-ann">
<h3>AR-ANN<a class="headerlink" href="#ar-ann" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="c1">#plt.plot(data_test.Mes, y_pred, label=&quot;RF&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Caudal (m3/s)&#39;)
</pre></div>
</div>
<img alt="../_images/ed4007de80de919bab40c506e117348e25fa78347df0e4f2e34ec7b1a7701f6f.png" src="../_images/ed4007de80de919bab40c506e117348e25fa78347df0e4f2e34ec7b1a7701f6f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_order</span> <span class="o">=</span> <span class="n">orden_ar</span>
<span class="n">history</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">train</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">residuals_train</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">resid</span>

<span class="n">residuales_train_lag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#residuales_train_extra = residuales_train_lag</span>
<span class="n">residuales_train_extra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">residuales_train_lag</span><span class="p">,</span> <span class="n">X_train</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">residuales_train_extra</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-9.80548111e+02, -9.00000000e-01],
       [-3.66642663e+02, -6.00000000e-01],
       [-1.33483436e+03, -4.00000000e-01],
       [-5.21687649e+02, -3.00000000e-01],
       [-7.53624232e+02, -4.00000000e-01],
       [ 1.64657851e+03, -5.00000000e-01],
       [ 9.55025065e+02, -4.00000000e-01],
       [ 9.03991066e+02, -3.00000000e-01],
       [ 5.90433468e+02, -2.00000000e-01],
       [ 7.85392954e+02, -2.00000000e-01],
       [ 1.80260521e+03, -6.00000000e-01],
       [ 1.11176890e+03, -9.00000000e-01],
       [-2.51865479e+02, -1.10000000e+00],
       [-3.38922155e+03, -1.00000000e+00],
       [-1.40557043e+03, -8.00000000e-01],
       [-9.93181139e+01, -8.00000000e-01],
       [-1.54814995e+02, -8.00000000e-01],
       [-3.26763652e+02, -8.00000000e-01],
       [-5.61986796e+02, -6.00000000e-01],
       [-1.26823197e+03, -5.00000000e-01],
       [ 2.55294231e+03, -5.00000000e-01],
       [ 1.01052878e+03, -4.00000000e-01],
       [ 3.29249581e+02, -3.00000000e-01],
       [-1.23369108e+02, -3.00000000e-01],
       [-9.58979722e+01, -4.00000000e-01],
       [-2.03699154e+03, -5.00000000e-01],
       [ 6.41949663e+02, -5.00000000e-01],
       [ 3.26196791e+02, -3.00000000e-01],
       [-4.56137548e+02, -2.00000000e-01],
       [ 5.10445599e+02, -1.00000000e-01],
       [ 3.07779220e+02,  0.00000000e+00],
       [ 4.85601410e+02,  2.00000000e-01],
       [-1.19494166e+03,  4.00000000e-01],
       [ 8.88840669e+02,  7.00000000e-01],
       [ 8.02660825e+02,  9.00000000e-01],
       [ 7.10876564e+02,  1.10000000e+00],
       [-1.30801595e+03,  1.20000000e+00],
       [-2.58792114e+03,  1.20000000e+00],
       [ 1.47593913e+03,  1.20000000e+00],
       [-8.93159538e+02,  1.10000000e+00],
       [-9.69802468e+02,  9.00000000e-01],
       [-3.42992679e+01,  1.00000000e+00],
       [-7.13754076e+00,  1.20000000e+00],
       [-2.17812040e+02,  1.50000000e+00],
       [ 2.86482746e+03,  1.70000000e+00],
       [-8.64673883e+02,  1.60000000e+00],
       [ 7.17900732e+02,  1.50000000e+00],
       [ 8.13712045e+02,  1.30000000e+00],
       [ 1.02292455e+02,  1.10000000e+00],
       [-2.84308447e+03,  8.00000000e-01],
       [ 5.73981047e+02,  5.00000000e-01],
       [-6.91631957e+02,  1.00000000e-01],
       [-9.26046155e+02, -3.00000000e-01],
       [-6.36420259e+02, -9.00000000e-01],
       [ 1.92961910e+02, -1.30000000e+00],
       [ 2.92223330e+03, -1.30000000e+00],
       [ 1.15200389e+03, -1.10000000e+00],
       [ 1.97829034e+03, -1.20000000e+00],
       [ 2.74539395e+02, -1.50000000e+00],
       [ 1.73794277e+02, -1.80000000e+00],
       [ 1.52844878e+03, -1.80000000e+00],
       [-2.44662002e+02, -1.70000000e+00],
       [-2.13002125e+03, -1.40000000e+00],
       [ 1.20267511e+02, -1.10000000e+00],
       [-1.51801887e+03, -8.00000000e-01],
       [-1.39971946e+02, -6.00000000e-01],
       [ 7.35248688e+02, -4.00000000e-01],
       [ 1.76468709e+02, -3.00000000e-01],
       [ 5.41055637e+02, -3.00000000e-01],
       [ 1.19048098e+03, -2.00000000e-01],
       [ 9.72454528e+02, -2.00000000e-01],
       [ 6.84326267e+02, -2.00000000e-01],
       [-7.89423258e+02, -1.00000000e-01],
       [-1.94679874e+03,  1.00000000e-01],
       [ 4.03130475e+02,  2.00000000e-01],
       [-8.57035445e+02,  3.00000000e-01],
       [-6.25559829e+02,  3.00000000e-01],
       [ 7.40664775e+02,  3.00000000e-01],
       [-3.03325455e+02,  3.00000000e-01],
       [ 5.30378542e+02,  3.00000000e-01],
       [ 8.08602156e+01,  4.00000000e-01],
       [ 1.98880793e+02,  4.00000000e-01],
       [ 1.73098184e+02,  3.00000000e-01],
       [ 7.96178158e+02,  4.00000000e-01],
       [ 2.45477015e+02,  4.00000000e-01],
       [-1.73577862e+03,  4.00000000e-01],
       [-1.36781060e+03,  3.00000000e-01],
       [ 6.86206771e+02,  2.00000000e-01],
       [-1.27903494e+03,  3.00000000e-01],
       [ 3.31616464e+02,  5.00000000e-01],
       [-4.56988076e+01,  6.00000000e-01],
       [ 4.24667960e+02,  7.00000000e-01],
       [ 4.50403871e+02,  6.00000000e-01],
       [-1.09795159e+03,  6.00000000e-01],
       [ 1.62684740e+03,  8.00000000e-01],
       [-1.41514720e+03,  1.20000000e+00],
       [ 7.41704053e+02,  1.50000000e+00],
       [-3.14783980e+03,  1.70000000e+00],
       [ 6.75192432e+02,  1.60000000e+00],
       [-1.08129399e+03,  1.50000000e+00],
       [-1.45961751e+03,  1.30000000e+00],
       [ 2.14316388e+02,  1.10000000e+00],
       [-2.00473238e+02,  7.00000000e-01],
       [-1.19245894e+02,  4.00000000e-01],
       [ 1.47641081e+03,  1.00000000e-01],
       [-4.83536332e+02, -1.00000000e-01],
       [-1.31039411e+02, -2.00000000e-01],
       [-1.13394966e+03, -3.00000000e-01],
       [ 4.67251748e+02, -1.00000000e-01],
       [-1.37722865e+03,  1.00000000e-01],
       [-4.47216569e+01,  3.00000000e-01],
       [-8.67939695e+02,  5.00000000e-01],
       [ 3.43606636e+02,  7.00000000e-01],
       [ 4.21587620e+02,  7.00000000e-01],
       [ 7.07170401e+02,  6.00000000e-01],
       [-7.54782216e+01,  3.00000000e-01],
       [-3.36016722e+02,  3.00000000e-01],
       [ 1.14031211e+03,  2.00000000e-01],
       [-3.76882573e+02,  1.00000000e-01],
       [ 1.53320289e+01,  0.00000000e+00],
       [ 1.16037844e+03,  1.00000000e-01],
       [-1.15488533e+03,  1.00000000e-01],
       [-1.14394049e+03,  1.00000000e-01],
       [ 3.86231481e+02,  2.00000000e-01],
       [-1.30133199e+02,  3.00000000e-01],
       [ 3.58586121e+02,  4.00000000e-01],
       [ 6.08447545e+02,  4.00000000e-01],
       [ 6.93492101e+01,  4.00000000e-01],
       [-2.64667137e+02,  4.00000000e-01],
       [ 1.09265873e+02,  6.00000000e-01],
       [ 4.43413298e+02,  7.00000000e-01],
       [ 4.47063647e+02,  1.00000000e+00],
       [ 2.43455892e+02,  1.10000000e+00],
       [-3.60025548e+03,  1.00000000e+00],
       [-2.15669642e+02,  7.00000000e-01],
       [-2.83833243e+02,  5.00000000e-01],
       [-5.94468761e+02,  3.00000000e-01],
       [ 2.62778704e+02,  1.00000000e-01],
       [ 3.05137869e+02,  0.00000000e+00],
       [ 9.68404101e+02, -2.00000000e-01],
       [ 1.92516946e+03, -5.00000000e-01],
       [ 5.02542627e+02, -8.00000000e-01],
       [-8.42909364e+02, -1.00000000e+00],
       [ 1.09369553e+03, -1.00000000e+00],
       [-1.38818161e+03, -1.00000000e+00],
       [-6.63471557e+02, -9.00000000e-01],
       [-4.63160866e+02, -8.00000000e-01],
       [ 9.87333508e+02, -6.00000000e-01],
       [-9.16393040e+02, -4.00000000e-01],
       [-3.66520559e+02, -3.00000000e-01],
       [ 1.82473193e+03, -3.00000000e-01],
       [ 2.10154239e+03, -3.00000000e-01],
       [ 8.54961171e+02, -3.00000000e-01],
       [-2.65559569e+02, -4.00000000e-01],
       [-2.46474325e+02, -4.00000000e-01],
       [ 4.81213671e+02, -4.00000000e-01],
       [-7.97322331e+02, -5.00000000e-01],
       [-2.18846833e+03, -5.00000000e-01],
       [ 8.71329608e+02, -4.00000000e-01],
       [-2.01193145e+03, -1.00000000e-01],
       [-5.71779264e+02,  3.00000000e-01],
       [-5.49434996e+02,  8.00000000e-01],
       [ 2.96091881e+02,  1.20000000e+00],
       [-3.25807896e+02,  1.60000000e+00],
       [-9.09363878e+02,  1.90000000e+00],
       [-2.52567957e+02,  2.10000000e+00],
       [ 6.38129684e+01,  2.30000000e+00],
       [-7.71125955e+02,  2.40000000e+00],
       [-1.07785601e+03,  2.40000000e+00],
       [-1.60046394e+03,  2.20000000e+00],
       [ 7.21894002e+02,  1.90000000e+00],
       [-1.43784324e+03,  1.40000000e+00],
       [ 4.66244629e+02,  1.00000000e+00],
       [ 5.23701021e+02,  5.00000000e-01],
       [ 7.86819214e+02, -1.00000000e-01],
       [ 9.85247897e+02, -8.00000000e-01],
       [ 2.81667120e+02, -1.10000000e+00],
       [ 4.46947278e+02, -1.30000000e+00],
       [ 2.65140331e+02, -1.40000000e+00],
       [ 1.86829366e+02, -1.50000000e+00],
       [ 1.34066499e+03, -1.60000000e+00],
       [-4.62284381e+02, -1.50000000e+00],
       [-1.00910670e+03, -1.30000000e+00],
       [ 1.52963591e+03, -1.10000000e+00],
       [-7.56997203e+02, -1.00000000e+00],
       [ 6.85726453e+02, -1.00000000e+00],
       [ 8.28782101e+02, -1.00000000e+00],
       [ 1.39585156e+03, -1.10000000e+00],
       [-4.25485258e+02, -1.10000000e+00],
       [ 8.49999798e+02, -1.20000000e+00],
       [ 1.50017672e+03, -1.30000000e+00],
       [ 1.37576118e+03, -1.50000000e+00],
       [-3.48963388e+01, -1.70000000e+00],
       [-4.86701984e+02, -1.70000000e+00],
       [-2.84305590e+03, -1.40000000e+00],
       [ 1.53361335e+03, -1.10000000e+00],
       [-1.77938579e+03, -8.00000000e-01],
       [ 8.11348149e+02, -7.00000000e-01],
       [ 9.92119964e+02, -6.00000000e-01],
       [ 7.50787454e+02, -6.00000000e-01],
       [-8.07397039e+01, -5.00000000e-01],
       [ 8.63528466e+02, -5.00000000e-01],
       [ 1.24410401e+03, -6.00000000e-01],
       [-4.97394581e+02, -7.00000000e-01],
       [-1.00237839e+03, -7.00000000e-01],
       [-2.62997890e+03, -7.00000000e-01],
       [-4.26844863e+02, -5.00000000e-01],
       [ 1.78583267e+02, -4.00000000e-01],
       [-1.05623173e+03, -3.00000000e-01],
       [-6.43008634e+02, -3.00000000e-01],
       [ 4.08696768e+02, -1.00000000e-01],
       [-1.04002750e+03, -1.00000000e-01],
       [ 4.06383255e+02, -1.00000000e-01],
       [-4.17220048e+01, -2.00000000e-01],
       [ 4.80847515e+02, -3.00000000e-01],
       [-1.05161181e+02, -3.00000000e-01],
       [ 3.62440633e+02, -3.00000000e-01],
       [-1.20370775e+03, -1.00000000e-01],
       [-1.82436733e+03,  0.00000000e+00],
       [ 2.23490352e+02,  1.00000000e-01],
       [ 9.73235223e+00,  2.00000000e-01],
       [-4.57865578e+02,  4.00000000e-01],
       [ 7.98978110e+02,  7.00000000e-01],
       [-7.11679189e+02,  8.00000000e-01],
       [-9.25806632e+02,  9.00000000e-01],
       [ 6.99533732e+02,  1.00000000e+00],
       [-9.31247439e+02,  1.20000000e+00],
       [ 1.20232102e+03,  1.30000000e+00],
       [-2.69419767e+03,  1.10000000e+00],
       [-1.14003058e+03,  9.00000000e-01],
       [ 5.70350242e+01,  6.00000000e-01],
       [-1.93386508e+02,  4.00000000e-01],
       [-4.98073361e+02,  0.00000000e+00],
       [ 1.75131385e+02, -3.00000000e-01],
       [ 2.43263189e+01, -2.00000000e-01],
       [ 1.10230838e+03,  1.00000000e-01],
       [ 3.34874500e+01,  2.00000000e-01],
       [-2.29015743e+02,  3.00000000e-01],
       [ 9.98390034e+02,  3.00000000e-01],
       [ 4.59723540e+02,  4.00000000e-01],
       [ 7.70435460e+02,  4.00000000e-01],
       [-1.76962337e+03,  4.00000000e-01],
       [-2.20002328e+03,  3.00000000e-01],
       [ 3.63269555e+02,  2.00000000e-01],
       [-9.80779692e+02,  2.00000000e-01],
       [ 5.79829872e+02,  2.00000000e-01],
       [-1.61089862e+01,  3.00000000e-01],
       [-8.90485416e+02,  5.00000000e-01],
       [ 1.33814930e+03,  6.00000000e-01],
       [ 2.79191119e+02,  7.00000000e-01],
       [ 8.28991922e+02,  7.00000000e-01],
       [ 3.85992362e+02,  7.00000000e-01],
       [ 4.63300516e+02,  7.00000000e-01],
       [-2.86159178e+03,  6.00000000e-01],
       [ 4.05209629e+02,  6.00000000e-01],
       [-5.20321548e+02,  4.00000000e-01],
       [-5.67148086e+02,  4.00000000e-01],
       [ 1.68371822e+02,  3.00000000e-01],
       [ 5.34811640e+02,  1.00000000e-01],
       [ 3.65311100e+02, -1.00000000e-01],
       [-5.99807436e+01, -1.00000000e-01],
       [ 4.95077043e+02, -1.00000000e-01],
       [ 1.46942797e+02, -3.00000000e-01],
       [ 9.66111971e+02, -6.00000000e-01],
       [ 1.77632458e+03, -8.00000000e-01],
       [-2.70248612e+03, -9.00000000e-01],
       [-3.68215249e+02, -8.00000000e-01],
       [-2.38847484e+02, -6.00000000e-01],
       [ 9.34326900e+02, -4.00000000e-01],
       [ 6.13297913e+01, -1.00000000e-01],
       [ 1.31035764e+03,  0.00000000e+00],
       [-2.91066509e+02,  1.00000000e-01],
       [-7.54533996e+02,  3.00000000e-01],
       [ 1.65810256e+03,  5.00000000e-01],
       [-1.14428844e+03,  8.00000000e-01],
       [ 7.10217073e+02,  9.00000000e-01],
       [ 2.68027717e+02,  9.00000000e-01],
       [-1.66881480e+03,  7.00000000e-01],
       [-1.50449309e+03,  2.00000000e-01],
       [ 4.55181014e+02, -1.00000000e-01],
       [ 1.09806264e+03, -3.00000000e-01],
       [-3.19860183e+01, -4.00000000e-01],
       [ 1.61100699e+03, -5.00000000e-01],
       [ 3.11382062e+02, -6.00000000e-01],
       [ 6.91785998e+02, -8.00000000e-01],
       [ 2.63122199e+03, -1.10000000e+00],
       [-1.05866276e+03, -1.30000000e+00],
       [ 2.05744087e+03, -1.50000000e+00],
       [-1.64484482e+03, -1.60000000e+00],
       [-1.07535183e+03, -1.60000000e+00],
       [-6.43359113e+02, -1.50000000e+00],
       [ 1.25313860e+03, -1.30000000e+00],
       [-1.46551704e+03, -1.00000000e+00],
       [ 3.45300381e+02, -8.00000000e-01],
       [ 8.60796622e+02, -6.00000000e-01],
       [ 2.32592434e+03, -4.00000000e-01],
       [ 2.00934630e+03, -2.00000000e-01],
       [ 1.32987012e+03, -2.00000000e-01],
       [-3.53645079e+02, -4.00000000e-01],
       [ 8.26158325e+02, -6.00000000e-01],
       [ 1.09558561e+03, -7.00000000e-01],
       [-2.45874584e+03, -8.00000000e-01],
       [ 1.05344607e+02, -8.00000000e-01],
       [-2.04124653e+02, -6.00000000e-01],
       [ 3.20304759e+02, -3.00000000e-01],
       [-1.15906200e+03,  0.00000000e+00],
       [-4.59280540e+02,  3.00000000e-01],
       [ 6.96565157e+02,  5.00000000e-01],
       [ 3.95168177e+01,  6.00000000e-01],
       [ 6.53575798e+02,  7.00000000e-01],
       [-2.22583392e+03,  1.00000000e+00],
       [ 7.99426052e+02,  1.40000000e+00],
       [-2.22671542e+03,  1.60000000e+00],
       [-1.07962315e+03,  1.50000000e+00],
       [ 4.75965059e+02,  1.20000000e+00],
       [ 9.18903154e+01,  8.00000000e-01],
       [-6.58306195e+02,  4.00000000e-01],
       [ 6.00579672e+02, -2.00000000e-01],
       [ 1.01260914e+03, -7.00000000e-01],
       [ 2.51402984e+03, -1.00000000e+00],
       [ 2.85694855e+03, -1.30000000e+00],
       [ 4.13872085e+02, -1.60000000e+00],
       [ 9.28847710e+02, -1.60000000e+00],
       [-3.62642166e+02, -1.60000000e+00],
       [ 1.45424651e+03, -1.60000000e+00],
       [-7.77928221e+02, -1.40000000e+00],
       [-2.07247392e+03, -1.20000000e+00],
       [ 1.26263762e+03, -9.00000000e-01],
       [ 1.27653119e+01, -7.00000000e-01],
       [ 2.44699335e+03, -6.00000000e-01],
       [ 2.24039435e+01, -4.00000000e-01],
       [ 4.02760483e+02, -5.00000000e-01],
       [ 1.06704085e+03, -6.00000000e-01],
       [-2.39236678e+02, -8.00000000e-01],
       [ 1.33149817e+02, -1.00000000e+00],
       [ 8.44409230e+02, -1.10000000e+00],
       [ 1.84681134e+03, -1.00000000e+00],
       [-9.10750441e+02, -9.00000000e-01],
       [-1.65503647e+03, -7.00000000e-01],
       [-8.92487181e+02, -6.00000000e-01],
       [ 1.30918368e+03, -5.00000000e-01],
       [ 8.15476217e+02, -3.00000000e-01],
       [-1.54297981e+03,  0.00000000e+00],
       [-9.14789663e+02,  2.00000000e-01],
       [ 1.60766765e+03,  4.00000000e-01],
       [ 1.75056115e+02,  4.00000000e-01],
       [-1.11407321e+03,  3.00000000e-01],
       [ 2.18392830e+02,  1.00000000e-01],
       [-1.80133602e+03, -2.00000000e-01],
       [-1.65068079e+03, -4.00000000e-01],
       [ 1.14447436e+03, -4.00000000e-01],
       [-1.71653346e+02, -3.00000000e-01],
       [-1.25714356e+03, -3.00000000e-01],
       [ 3.17163021e+02, -4.00000000e-01],
       [ 9.01116947e+02, -4.00000000e-01]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Train data&quot;</span><span class="p">)</span>
<span class="c1">#plt.plot(data_test.Mes, y_pred, label=&quot;RF&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Caudal (m3/s)&#39;)
</pre></div>
</div>
<img alt="../_images/f60172ee3f58aedf9be4c9bb4a6e740ef82b0b064d02b2204468f005540c5872.png" src="../_images/f60172ee3f58aedf9be4c9bb4a6e740ef82b0b064d02b2204468f005540c5872.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define el modelo de red neuronal</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">residuales_train_extra</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Compila el modelo</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">)</span>

<span class="c1"># Divide tus datos en entrenamiento y validaci√≥n</span>
<span class="n">indice</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.8</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">))</span>
<span class="n">y_trainval</span> <span class="o">=</span> <span class="n">residuals_train</span><span class="p">[:</span><span class="n">indice</span><span class="p">]</span>
<span class="n">X_trainval</span> <span class="o">=</span> <span class="n">residuales_train_extra</span><span class="p">[:</span><span class="n">indice</span><span class="p">]</span>
<span class="n">y_val</span> <span class="o">=</span> <span class="n">residuals_train</span><span class="p">[</span><span class="n">indice</span><span class="p">:]</span>
<span class="n">X_val</span> <span class="o">=</span> <span class="n">residuales_train_extra</span><span class="p">[</span><span class="n">indice</span><span class="p">:]</span>

<span class="c1"># Escala los datos</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>


<span class="c1"># Define el callback EarlyStopping</span>
<span class="n">early_stopping</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Entrena el modelo con los datos escalados</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainval</span><span class="p">,</span> <span class="n">y_trainval</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
          <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">),</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">early_stopping</span><span class="p">])</span>


<span class="c1"># Eval√∫a el modelo en datos de prueba escalados</span>
<span class="n">y_pred_NN</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">)</span>

<span class="c1"># Grafica los resultados</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos reales&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred_NN</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicciones&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/200
3/3 [==============================] - 1s 117ms/step - loss: 1505662.7500 - val_loss: 2227273.0000
Epoch 2/200
3/3 [==============================] - 0s 30ms/step - loss: 1488982.2500 - val_loss: 2307965.7500
Epoch 3/200
3/3 [==============================] - 0s 38ms/step - loss: 1464973.1250 - val_loss: 2084722.8750
Epoch 4/200
3/3 [==============================] - 0s 31ms/step - loss: 1437758.1250 - val_loss: 2093922.2500
Epoch 5/200
3/3 [==============================] - 0s 35ms/step - loss: 1432928.3750 - val_loss: 2148326.5000
Epoch 6/200
3/3 [==============================] - 0s 35ms/step - loss: 1429706.7500 - val_loss: 2291732.5000
Epoch 7/200
3/3 [==============================] - 0s 34ms/step - loss: 1476653.8750 - val_loss: 2338862.5000
Epoch 8/200
3/3 [==============================] - 0s 33ms/step - loss: 1453555.2500 - val_loss: 2127372.0000
Epoch 9/200
3/3 [==============================] - 0s 39ms/step - loss: 1447192.3750 - val_loss: 2064070.5000
Epoch 10/200
3/3 [==============================] - 0s 45ms/step - loss: 1445363.8750 - val_loss: 2096234.3750
Epoch 11/200
3/3 [==============================] - 0s 39ms/step - loss: 1436593.3750 - val_loss: 2251287.7500
Epoch 12/200
3/3 [==============================] - 0s 36ms/step - loss: 1443268.6250 - val_loss: 2276320.5000
Epoch 13/200
3/3 [==============================] - 0s 34ms/step - loss: 1438450.0000 - val_loss: 2175534.7500
Epoch 14/200
3/3 [==============================] - 0s 35ms/step - loss: 1418621.7500 - val_loss: 2103128.7500
Epoch 15/200
3/3 [==============================] - 0s 38ms/step - loss: 1423577.3750 - val_loss: 2073390.2500
Epoch 16/200
3/3 [==============================] - 0s 26ms/step - loss: 1429839.1250 - val_loss: 2089388.0000
Epoch 17/200
3/3 [==============================] - 0s 30ms/step - loss: 1420279.3750 - val_loss: 2133420.5000
Epoch 18/200
3/3 [==============================] - 0s 32ms/step - loss: 1419029.1250 - val_loss: 2177582.0000
Epoch 19/200
3/3 [==============================] - 0s 43ms/step - loss: 1419770.8750 - val_loss: 2152189.5000
3/3 [==============================] - 0s 3ms/step
</pre></div>
</div>
<img alt="../_images/9bd9abf82679a324caaaea866487ea031d55fc8758750f7a884b16c5006fee40.png" src="../_images/9bd9abf82679a324caaaea866487ea031d55fc8758750f7a884b16c5006fee40.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define el modelo de red neuronal</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">residuales_train_extra</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Compila el modelo</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">)</span>


<span class="c1"># Escala los datos</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>


<span class="c1"># Define el callback EarlyStopping</span>
<span class="n">early_stopping</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Entrena el modelo con los datos escalados</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">residuales_train_extra</span><span class="p">,</span> <span class="n">residuals_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                        <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">early_stopping</span><span class="p">])</span>


<span class="c1"># Eval√∫a el modelo en datos de prueba escalados</span>
<span class="n">y_pred_NN</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">)</span>

<span class="c1"># Grafica los resultados</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos reales&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred_NN</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicciones&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/1000
3/3 [==============================] - 1s 105ms/step - loss: 1437474.8750 - val_loss: 2305028.7500
Epoch 2/1000
3/3 [==============================] - 0s 30ms/step - loss: 1463022.5000 - val_loss: 2039885.1250
Epoch 3/1000
3/3 [==============================] - 0s 24ms/step - loss: 1480362.6250 - val_loss: 2044074.6250
Epoch 4/1000
3/3 [==============================] - 0s 29ms/step - loss: 1453779.1250 - val_loss: 2090796.0000
Epoch 5/1000
3/3 [==============================] - 0s 29ms/step - loss: 1419085.3750 - val_loss: 2225028.2500
Epoch 6/1000
3/3 [==============================] - 0s 32ms/step - loss: 1447172.2500 - val_loss: 2268139.7500
Epoch 7/1000
3/3 [==============================] - 0s 31ms/step - loss: 1437521.6250 - val_loss: 2132133.5000
Epoch 8/1000
3/3 [==============================] - 0s 40ms/step - loss: 1418982.1250 - val_loss: 2074355.6250
Epoch 9/1000
3/3 [==============================] - 0s 32ms/step - loss: 1440689.8750 - val_loss: 2071698.5000
Epoch 10/1000
3/3 [==============================] - 0s 29ms/step - loss: 1420048.8750 - val_loss: 2187216.7500
Epoch 11/1000
3/3 [==============================] - 0s 28ms/step - loss: 1429237.2500 - val_loss: 2200972.5000
Epoch 12/1000
3/3 [==============================] - 0s 26ms/step - loss: 1429774.3750 - val_loss: 2122021.2500
Epoch 13/1000
3/3 [==============================] - 0s 23ms/step - loss: 1417488.0000 - val_loss: 2129961.5000
Epoch 14/1000
3/3 [==============================] - 0s 27ms/step - loss: 1416243.2500 - val_loss: 2156958.5000
Epoch 15/1000
3/3 [==============================] - 0s 27ms/step - loss: 1417274.7500 - val_loss: 2127946.2500
Epoch 16/1000
3/3 [==============================] - 0s 26ms/step - loss: 1413264.7500 - val_loss: 2082853.3750
Epoch 17/1000
3/3 [==============================] - 0s 33ms/step - loss: 1415848.5000 - val_loss: 2071198.2500
Epoch 18/1000
3/3 [==============================] - 0s 29ms/step - loss: 1417822.2500 - val_loss: 2071925.3750
Epoch 19/1000
3/3 [==============================] - 0s 23ms/step - loss: 1416289.6250 - val_loss: 2096836.0000
Epoch 20/1000
3/3 [==============================] - 0s 21ms/step - loss: 1410039.2500 - val_loss: 2153172.7500
Epoch 21/1000
3/3 [==============================] - 0s 20ms/step - loss: 1416917.1250 - val_loss: 2234799.0000
Epoch 22/1000
3/3 [==============================] - 0s 25ms/step - loss: 1448420.5000 - val_loss: 2242081.5000
Epoch 23/1000
3/3 [==============================] - 0s 23ms/step - loss: 1427436.7500 - val_loss: 2059813.0000
Epoch 24/1000
3/3 [==============================] - 0s 31ms/step - loss: 1423159.3750 - val_loss: 2025745.3750
Epoch 25/1000
3/3 [==============================] - 0s 34ms/step - loss: 1454607.1250 - val_loss: 2037068.0000
Epoch 26/1000
3/3 [==============================] - 0s 33ms/step - loss: 1418925.1250 - val_loss: 2175411.5000
Epoch 27/1000
3/3 [==============================] - 0s 32ms/step - loss: 1432779.1250 - val_loss: 2336342.2500
Epoch 28/1000
3/3 [==============================] - 0s 27ms/step - loss: 1455154.0000 - val_loss: 2219295.5000
Epoch 29/1000
3/3 [==============================] - 0s 25ms/step - loss: 1415870.2500 - val_loss: 2070635.0000
Epoch 30/1000
3/3 [==============================] - 0s 24ms/step - loss: 1415052.2500 - val_loss: 2026593.3750
Epoch 31/1000
3/3 [==============================] - 0s 25ms/step - loss: 1425157.1250 - val_loss: 2048098.8750
Epoch 32/1000
3/3 [==============================] - 0s 27ms/step - loss: 1406655.3750 - val_loss: 2126549.0000
Epoch 33/1000
3/3 [==============================] - 0s 30ms/step - loss: 1419574.1250 - val_loss: 2262256.5000
Epoch 34/1000
3/3 [==============================] - 0s 32ms/step - loss: 1429095.3750 - val_loss: 2178388.2500
Epoch 35/1000
3/3 [==============================] - 0s 41ms/step - loss: 1404155.6250 - val_loss: 2067466.3750
Epoch 36/1000
3/3 [==============================] - 0s 33ms/step - loss: 1411229.7500 - val_loss: 2042465.1250
Epoch 37/1000
3/3 [==============================] - 0s 29ms/step - loss: 1420139.1250 - val_loss: 2072931.1250
Epoch 38/1000
3/3 [==============================] - 0s 26ms/step - loss: 1403228.3750 - val_loss: 2153344.2500
Epoch 39/1000
3/3 [==============================] - 0s 26ms/step - loss: 1412868.0000 - val_loss: 2227718.7500
Epoch 40/1000
3/3 [==============================] - 0s 25ms/step - loss: 1418602.5000 - val_loss: 2169831.7500
Epoch 41/1000
3/3 [==============================] - 0s 26ms/step - loss: 1406969.5000 - val_loss: 2080721.3750
Epoch 42/1000
3/3 [==============================] - 0s 33ms/step - loss: 1402347.3750 - val_loss: 2076566.2500
Epoch 43/1000
3/3 [==============================] - 0s 31ms/step - loss: 1402418.5000 - val_loss: 2114604.2500
Epoch 44/1000
3/3 [==============================] - 0s 22ms/step - loss: 1402291.7500 - val_loss: 2085088.5000
Epoch 45/1000
3/3 [==============================] - 0s 25ms/step - loss: 1400965.7500 - val_loss: 2107598.0000
Epoch 46/1000
3/3 [==============================] - 0s 24ms/step - loss: 1402181.0000 - val_loss: 2207285.2500
Epoch 47/1000
3/3 [==============================] - 0s 23ms/step - loss: 1413250.8750 - val_loss: 2189514.2500
Epoch 48/1000
3/3 [==============================] - 0s 20ms/step - loss: 1406200.1250 - val_loss: 2126608.7500
Epoch 49/1000
3/3 [==============================] - 0s 25ms/step - loss: 1400809.6250 - val_loss: 2074233.8750
Epoch 50/1000
3/3 [==============================] - 0s 28ms/step - loss: 1399915.7500 - val_loss: 2048808.1250
Epoch 51/1000
3/3 [==============================] - 0s 26ms/step - loss: 1410813.6250 - val_loss: 2042136.7500
Epoch 52/1000
3/3 [==============================] - 0s 33ms/step - loss: 1401184.6250 - val_loss: 2099243.5000
Epoch 53/1000
3/3 [==============================] - 0s 31ms/step - loss: 1399404.5000 - val_loss: 2217010.0000
Epoch 54/1000
3/3 [==============================] - 0s 27ms/step - loss: 1416852.2500 - val_loss: 2219086.7500
3/3 [==============================] - 0s 3ms/step
</pre></div>
</div>
<img alt="../_images/1060c70bac025123d14f21938ee92d22a73393d2f9f7fe763da543d02d1f0639.png" src="../_images/1060c70bac025123d14f21938ee92d22a73393d2f9f7fe763da543d02d1f0639.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred_NN</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Tree prediction&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/fdff12fb4eeb57daaf9c0b572b7e8c645086d8f68af461a4ce9f681898dd0b84.png" src="../_images/fdff12fb4eeb57daaf9c0b572b7e8c645086d8f68af461a4ce9f681898dd0b84.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">y_pred_NN</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1216.78
MAE: 968.15
RRMSE: -10.13
R-squared (R^2): -0.01
NSE (Nash-Sutcliffe Efficiency): -88.87
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_AR_NN</span> <span class="o">=</span> <span class="n">predictions_AR</span> <span class="o">+</span> <span class="n">y_pred_NN</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">y_residual</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 187.55923613  103.39822764  356.35263815   70.56797972  136.27114048
  119.33447323  119.12742801  113.62009047   98.84615396   49.08717088
  -19.50298123   66.93356542   76.98005152    8.22941368   -3.948112
   57.80783093   29.03923304   -9.56950883   61.67029023 -124.25005846
   39.50519814   28.08133356   32.97679249 -462.59844649 -129.43085711
 -665.23691874 -197.19006264 -186.23387094 -340.52611976 -185.09875623
 -265.73974643 -294.7285865  -185.37177944   16.78094053   16.82745865
   86.16304346  123.65589256  175.64067945  161.24636987  182.28724559
  296.26520312  224.40545985  132.58465007  108.43558177   54.2106994
   63.44301846   78.09579774   -8.92995939 -335.49643782   89.54648965
  198.82079101  179.40444674  199.74785347  264.33869278  136.21149033
  140.77625352  115.15575591  204.27358417  135.07918743  -14.26096215
   13.63165571   78.30953367   62.91683982 -115.9108225  -494.24290731
 -199.07041672   33.20502893 -256.15965865   12.05404252   32.1947274
   49.24309259  145.85045438   69.59142993   72.15153219   76.52133612
   17.72339835   75.72723312    2.49627236   62.69718347   18.48213154
   24.73638149   45.96438063   44.09345476  106.61601513  181.30764322
  257.89697459  228.03611389  282.1739681   261.8390702 ]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">y_AR_NN</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 987.88
MAE: 775.17
RRMSE: 0.15
R-squared (R^2): 0.80
NSE (Nash-Sutcliffe Efficiency): 0.80
</pre></div>
</div>
</div>
</div>
</section>
<section id="arma-ann">
<h3>ARMA-ANN<a class="headerlink" href="#arma-ann" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_ARMA</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="c1">#plt.plot(data_test.Mes, y_pred, label=&quot;RF&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Caudal (m3/s)&#39;)
</pre></div>
</div>
<img alt="../_images/7f29c2248849a37e2cc3bda0c00de8d2bc325b9900266db534c8efc8eb87df83.png" src="../_images/7f29c2248849a37e2cc3bda0c00de8d2bc325b9900266db534c8efc8eb87df83.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_order</span> <span class="o">=</span> <span class="n">orden_arma</span>
<span class="n">history</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">train</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">residuals_train</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">resid</span>

<span class="n">residuales_train_lag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#residuales_train_extra = residuales_train_lag</span>
<span class="n">residuales_train_extra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">residuales_train_lag</span><span class="p">,</span> <span class="n">X_train</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">residuales_train_extra</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-9.80548111e+02, -9.00000000e-01],
       [-3.66642663e+02, -6.00000000e-01],
       [-1.33483436e+03, -4.00000000e-01],
       [-5.21687649e+02, -3.00000000e-01],
       [-7.53624232e+02, -4.00000000e-01],
       [ 1.64657851e+03, -5.00000000e-01],
       [ 9.55025065e+02, -4.00000000e-01],
       [ 9.03991066e+02, -3.00000000e-01],
       [ 5.90433468e+02, -2.00000000e-01],
       [ 7.85392954e+02, -2.00000000e-01],
       [ 1.80260521e+03, -6.00000000e-01],
       [ 1.11176890e+03, -9.00000000e-01],
       [-2.51865479e+02, -1.10000000e+00],
       [-3.38922155e+03, -1.00000000e+00],
       [-1.40557043e+03, -8.00000000e-01],
       [-9.93181139e+01, -8.00000000e-01],
       [-1.54814995e+02, -8.00000000e-01],
       [-3.26763652e+02, -8.00000000e-01],
       [-5.61986796e+02, -6.00000000e-01],
       [-1.26823197e+03, -5.00000000e-01],
       [ 2.55294231e+03, -5.00000000e-01],
       [ 1.01052878e+03, -4.00000000e-01],
       [ 3.29249581e+02, -3.00000000e-01],
       [-1.23369108e+02, -3.00000000e-01],
       [-9.58979722e+01, -4.00000000e-01],
       [-2.03699154e+03, -5.00000000e-01],
       [ 6.41949663e+02, -5.00000000e-01],
       [ 3.26196791e+02, -3.00000000e-01],
       [-4.56137548e+02, -2.00000000e-01],
       [ 5.10445599e+02, -1.00000000e-01],
       [ 3.07779220e+02,  0.00000000e+00],
       [ 4.85601410e+02,  2.00000000e-01],
       [-1.19494166e+03,  4.00000000e-01],
       [ 8.88840669e+02,  7.00000000e-01],
       [ 8.02660825e+02,  9.00000000e-01],
       [ 7.10876564e+02,  1.10000000e+00],
       [-1.30801595e+03,  1.20000000e+00],
       [-2.58792114e+03,  1.20000000e+00],
       [ 1.47593913e+03,  1.20000000e+00],
       [-8.93159538e+02,  1.10000000e+00],
       [-9.69802468e+02,  9.00000000e-01],
       [-3.42992679e+01,  1.00000000e+00],
       [-7.13754076e+00,  1.20000000e+00],
       [-2.17812040e+02,  1.50000000e+00],
       [ 2.86482746e+03,  1.70000000e+00],
       [-8.64673883e+02,  1.60000000e+00],
       [ 7.17900732e+02,  1.50000000e+00],
       [ 8.13712045e+02,  1.30000000e+00],
       [ 1.02292455e+02,  1.10000000e+00],
       [-2.84308447e+03,  8.00000000e-01],
       [ 5.73981047e+02,  5.00000000e-01],
       [-6.91631957e+02,  1.00000000e-01],
       [-9.26046155e+02, -3.00000000e-01],
       [-6.36420259e+02, -9.00000000e-01],
       [ 1.92961910e+02, -1.30000000e+00],
       [ 2.92223330e+03, -1.30000000e+00],
       [ 1.15200389e+03, -1.10000000e+00],
       [ 1.97829034e+03, -1.20000000e+00],
       [ 2.74539395e+02, -1.50000000e+00],
       [ 1.73794277e+02, -1.80000000e+00],
       [ 1.52844878e+03, -1.80000000e+00],
       [-2.44662002e+02, -1.70000000e+00],
       [-2.13002125e+03, -1.40000000e+00],
       [ 1.20267511e+02, -1.10000000e+00],
       [-1.51801887e+03, -8.00000000e-01],
       [-1.39971946e+02, -6.00000000e-01],
       [ 7.35248688e+02, -4.00000000e-01],
       [ 1.76468709e+02, -3.00000000e-01],
       [ 5.41055637e+02, -3.00000000e-01],
       [ 1.19048098e+03, -2.00000000e-01],
       [ 9.72454528e+02, -2.00000000e-01],
       [ 6.84326267e+02, -2.00000000e-01],
       [-7.89423258e+02, -1.00000000e-01],
       [-1.94679874e+03,  1.00000000e-01],
       [ 4.03130475e+02,  2.00000000e-01],
       [-8.57035445e+02,  3.00000000e-01],
       [-6.25559829e+02,  3.00000000e-01],
       [ 7.40664775e+02,  3.00000000e-01],
       [-3.03325455e+02,  3.00000000e-01],
       [ 5.30378542e+02,  3.00000000e-01],
       [ 8.08602156e+01,  4.00000000e-01],
       [ 1.98880793e+02,  4.00000000e-01],
       [ 1.73098184e+02,  3.00000000e-01],
       [ 7.96178158e+02,  4.00000000e-01],
       [ 2.45477015e+02,  4.00000000e-01],
       [-1.73577862e+03,  4.00000000e-01],
       [-1.36781060e+03,  3.00000000e-01],
       [ 6.86206771e+02,  2.00000000e-01],
       [-1.27903494e+03,  3.00000000e-01],
       [ 3.31616464e+02,  5.00000000e-01],
       [-4.56988076e+01,  6.00000000e-01],
       [ 4.24667960e+02,  7.00000000e-01],
       [ 4.50403871e+02,  6.00000000e-01],
       [-1.09795159e+03,  6.00000000e-01],
       [ 1.62684740e+03,  8.00000000e-01],
       [-1.41514720e+03,  1.20000000e+00],
       [ 7.41704053e+02,  1.50000000e+00],
       [-3.14783980e+03,  1.70000000e+00],
       [ 6.75192432e+02,  1.60000000e+00],
       [-1.08129399e+03,  1.50000000e+00],
       [-1.45961751e+03,  1.30000000e+00],
       [ 2.14316388e+02,  1.10000000e+00],
       [-2.00473238e+02,  7.00000000e-01],
       [-1.19245894e+02,  4.00000000e-01],
       [ 1.47641081e+03,  1.00000000e-01],
       [-4.83536332e+02, -1.00000000e-01],
       [-1.31039411e+02, -2.00000000e-01],
       [-1.13394966e+03, -3.00000000e-01],
       [ 4.67251748e+02, -1.00000000e-01],
       [-1.37722865e+03,  1.00000000e-01],
       [-4.47216569e+01,  3.00000000e-01],
       [-8.67939695e+02,  5.00000000e-01],
       [ 3.43606636e+02,  7.00000000e-01],
       [ 4.21587620e+02,  7.00000000e-01],
       [ 7.07170401e+02,  6.00000000e-01],
       [-7.54782216e+01,  3.00000000e-01],
       [-3.36016722e+02,  3.00000000e-01],
       [ 1.14031211e+03,  2.00000000e-01],
       [-3.76882573e+02,  1.00000000e-01],
       [ 1.53320289e+01,  0.00000000e+00],
       [ 1.16037844e+03,  1.00000000e-01],
       [-1.15488533e+03,  1.00000000e-01],
       [-1.14394049e+03,  1.00000000e-01],
       [ 3.86231481e+02,  2.00000000e-01],
       [-1.30133199e+02,  3.00000000e-01],
       [ 3.58586121e+02,  4.00000000e-01],
       [ 6.08447545e+02,  4.00000000e-01],
       [ 6.93492101e+01,  4.00000000e-01],
       [-2.64667137e+02,  4.00000000e-01],
       [ 1.09265873e+02,  6.00000000e-01],
       [ 4.43413298e+02,  7.00000000e-01],
       [ 4.47063647e+02,  1.00000000e+00],
       [ 2.43455892e+02,  1.10000000e+00],
       [-3.60025548e+03,  1.00000000e+00],
       [-2.15669642e+02,  7.00000000e-01],
       [-2.83833243e+02,  5.00000000e-01],
       [-5.94468761e+02,  3.00000000e-01],
       [ 2.62778704e+02,  1.00000000e-01],
       [ 3.05137869e+02,  0.00000000e+00],
       [ 9.68404101e+02, -2.00000000e-01],
       [ 1.92516946e+03, -5.00000000e-01],
       [ 5.02542627e+02, -8.00000000e-01],
       [-8.42909364e+02, -1.00000000e+00],
       [ 1.09369553e+03, -1.00000000e+00],
       [-1.38818161e+03, -1.00000000e+00],
       [-6.63471557e+02, -9.00000000e-01],
       [-4.63160866e+02, -8.00000000e-01],
       [ 9.87333508e+02, -6.00000000e-01],
       [-9.16393040e+02, -4.00000000e-01],
       [-3.66520559e+02, -3.00000000e-01],
       [ 1.82473193e+03, -3.00000000e-01],
       [ 2.10154239e+03, -3.00000000e-01],
       [ 8.54961171e+02, -3.00000000e-01],
       [-2.65559569e+02, -4.00000000e-01],
       [-2.46474325e+02, -4.00000000e-01],
       [ 4.81213671e+02, -4.00000000e-01],
       [-7.97322331e+02, -5.00000000e-01],
       [-2.18846833e+03, -5.00000000e-01],
       [ 8.71329608e+02, -4.00000000e-01],
       [-2.01193145e+03, -1.00000000e-01],
       [-5.71779264e+02,  3.00000000e-01],
       [-5.49434996e+02,  8.00000000e-01],
       [ 2.96091881e+02,  1.20000000e+00],
       [-3.25807896e+02,  1.60000000e+00],
       [-9.09363878e+02,  1.90000000e+00],
       [-2.52567957e+02,  2.10000000e+00],
       [ 6.38129684e+01,  2.30000000e+00],
       [-7.71125955e+02,  2.40000000e+00],
       [-1.07785601e+03,  2.40000000e+00],
       [-1.60046394e+03,  2.20000000e+00],
       [ 7.21894002e+02,  1.90000000e+00],
       [-1.43784324e+03,  1.40000000e+00],
       [ 4.66244629e+02,  1.00000000e+00],
       [ 5.23701021e+02,  5.00000000e-01],
       [ 7.86819214e+02, -1.00000000e-01],
       [ 9.85247897e+02, -8.00000000e-01],
       [ 2.81667120e+02, -1.10000000e+00],
       [ 4.46947278e+02, -1.30000000e+00],
       [ 2.65140331e+02, -1.40000000e+00],
       [ 1.86829366e+02, -1.50000000e+00],
       [ 1.34066499e+03, -1.60000000e+00],
       [-4.62284381e+02, -1.50000000e+00],
       [-1.00910670e+03, -1.30000000e+00],
       [ 1.52963591e+03, -1.10000000e+00],
       [-7.56997203e+02, -1.00000000e+00],
       [ 6.85726453e+02, -1.00000000e+00],
       [ 8.28782101e+02, -1.00000000e+00],
       [ 1.39585156e+03, -1.10000000e+00],
       [-4.25485258e+02, -1.10000000e+00],
       [ 8.49999798e+02, -1.20000000e+00],
       [ 1.50017672e+03, -1.30000000e+00],
       [ 1.37576118e+03, -1.50000000e+00],
       [-3.48963388e+01, -1.70000000e+00],
       [-4.86701984e+02, -1.70000000e+00],
       [-2.84305590e+03, -1.40000000e+00],
       [ 1.53361335e+03, -1.10000000e+00],
       [-1.77938579e+03, -8.00000000e-01],
       [ 8.11348149e+02, -7.00000000e-01],
       [ 9.92119964e+02, -6.00000000e-01],
       [ 7.50787454e+02, -6.00000000e-01],
       [-8.07397039e+01, -5.00000000e-01],
       [ 8.63528466e+02, -5.00000000e-01],
       [ 1.24410401e+03, -6.00000000e-01],
       [-4.97394581e+02, -7.00000000e-01],
       [-1.00237839e+03, -7.00000000e-01],
       [-2.62997890e+03, -7.00000000e-01],
       [-4.26844863e+02, -5.00000000e-01],
       [ 1.78583267e+02, -4.00000000e-01],
       [-1.05623173e+03, -3.00000000e-01],
       [-6.43008634e+02, -3.00000000e-01],
       [ 4.08696768e+02, -1.00000000e-01],
       [-1.04002750e+03, -1.00000000e-01],
       [ 4.06383255e+02, -1.00000000e-01],
       [-4.17220048e+01, -2.00000000e-01],
       [ 4.80847515e+02, -3.00000000e-01],
       [-1.05161181e+02, -3.00000000e-01],
       [ 3.62440633e+02, -3.00000000e-01],
       [-1.20370775e+03, -1.00000000e-01],
       [-1.82436733e+03,  0.00000000e+00],
       [ 2.23490352e+02,  1.00000000e-01],
       [ 9.73235223e+00,  2.00000000e-01],
       [-4.57865578e+02,  4.00000000e-01],
       [ 7.98978110e+02,  7.00000000e-01],
       [-7.11679189e+02,  8.00000000e-01],
       [-9.25806632e+02,  9.00000000e-01],
       [ 6.99533732e+02,  1.00000000e+00],
       [-9.31247439e+02,  1.20000000e+00],
       [ 1.20232102e+03,  1.30000000e+00],
       [-2.69419767e+03,  1.10000000e+00],
       [-1.14003058e+03,  9.00000000e-01],
       [ 5.70350242e+01,  6.00000000e-01],
       [-1.93386508e+02,  4.00000000e-01],
       [-4.98073361e+02,  0.00000000e+00],
       [ 1.75131385e+02, -3.00000000e-01],
       [ 2.43263189e+01, -2.00000000e-01],
       [ 1.10230838e+03,  1.00000000e-01],
       [ 3.34874500e+01,  2.00000000e-01],
       [-2.29015743e+02,  3.00000000e-01],
       [ 9.98390034e+02,  3.00000000e-01],
       [ 4.59723540e+02,  4.00000000e-01],
       [ 7.70435460e+02,  4.00000000e-01],
       [-1.76962337e+03,  4.00000000e-01],
       [-2.20002328e+03,  3.00000000e-01],
       [ 3.63269555e+02,  2.00000000e-01],
       [-9.80779692e+02,  2.00000000e-01],
       [ 5.79829872e+02,  2.00000000e-01],
       [-1.61089862e+01,  3.00000000e-01],
       [-8.90485416e+02,  5.00000000e-01],
       [ 1.33814930e+03,  6.00000000e-01],
       [ 2.79191119e+02,  7.00000000e-01],
       [ 8.28991922e+02,  7.00000000e-01],
       [ 3.85992362e+02,  7.00000000e-01],
       [ 4.63300516e+02,  7.00000000e-01],
       [-2.86159178e+03,  6.00000000e-01],
       [ 4.05209629e+02,  6.00000000e-01],
       [-5.20321548e+02,  4.00000000e-01],
       [-5.67148086e+02,  4.00000000e-01],
       [ 1.68371822e+02,  3.00000000e-01],
       [ 5.34811640e+02,  1.00000000e-01],
       [ 3.65311100e+02, -1.00000000e-01],
       [-5.99807436e+01, -1.00000000e-01],
       [ 4.95077043e+02, -1.00000000e-01],
       [ 1.46942797e+02, -3.00000000e-01],
       [ 9.66111971e+02, -6.00000000e-01],
       [ 1.77632458e+03, -8.00000000e-01],
       [-2.70248612e+03, -9.00000000e-01],
       [-3.68215249e+02, -8.00000000e-01],
       [-2.38847484e+02, -6.00000000e-01],
       [ 9.34326900e+02, -4.00000000e-01],
       [ 6.13297913e+01, -1.00000000e-01],
       [ 1.31035764e+03,  0.00000000e+00],
       [-2.91066509e+02,  1.00000000e-01],
       [-7.54533996e+02,  3.00000000e-01],
       [ 1.65810256e+03,  5.00000000e-01],
       [-1.14428844e+03,  8.00000000e-01],
       [ 7.10217073e+02,  9.00000000e-01],
       [ 2.68027717e+02,  9.00000000e-01],
       [-1.66881480e+03,  7.00000000e-01],
       [-1.50449309e+03,  2.00000000e-01],
       [ 4.55181014e+02, -1.00000000e-01],
       [ 1.09806264e+03, -3.00000000e-01],
       [-3.19860183e+01, -4.00000000e-01],
       [ 1.61100699e+03, -5.00000000e-01],
       [ 3.11382062e+02, -6.00000000e-01],
       [ 6.91785998e+02, -8.00000000e-01],
       [ 2.63122199e+03, -1.10000000e+00],
       [-1.05866276e+03, -1.30000000e+00],
       [ 2.05744087e+03, -1.50000000e+00],
       [-1.64484482e+03, -1.60000000e+00],
       [-1.07535183e+03, -1.60000000e+00],
       [-6.43359113e+02, -1.50000000e+00],
       [ 1.25313860e+03, -1.30000000e+00],
       [-1.46551704e+03, -1.00000000e+00],
       [ 3.45300381e+02, -8.00000000e-01],
       [ 8.60796622e+02, -6.00000000e-01],
       [ 2.32592434e+03, -4.00000000e-01],
       [ 2.00934630e+03, -2.00000000e-01],
       [ 1.32987012e+03, -2.00000000e-01],
       [-3.53645079e+02, -4.00000000e-01],
       [ 8.26158325e+02, -6.00000000e-01],
       [ 1.09558561e+03, -7.00000000e-01],
       [-2.45874584e+03, -8.00000000e-01],
       [ 1.05344607e+02, -8.00000000e-01],
       [-2.04124653e+02, -6.00000000e-01],
       [ 3.20304759e+02, -3.00000000e-01],
       [-1.15906200e+03,  0.00000000e+00],
       [-4.59280540e+02,  3.00000000e-01],
       [ 6.96565157e+02,  5.00000000e-01],
       [ 3.95168177e+01,  6.00000000e-01],
       [ 6.53575798e+02,  7.00000000e-01],
       [-2.22583392e+03,  1.00000000e+00],
       [ 7.99426052e+02,  1.40000000e+00],
       [-2.22671542e+03,  1.60000000e+00],
       [-1.07962315e+03,  1.50000000e+00],
       [ 4.75965059e+02,  1.20000000e+00],
       [ 9.18903154e+01,  8.00000000e-01],
       [-6.58306195e+02,  4.00000000e-01],
       [ 6.00579672e+02, -2.00000000e-01],
       [ 1.01260914e+03, -7.00000000e-01],
       [ 2.51402984e+03, -1.00000000e+00],
       [ 2.85694855e+03, -1.30000000e+00],
       [ 4.13872085e+02, -1.60000000e+00],
       [ 9.28847710e+02, -1.60000000e+00],
       [-3.62642166e+02, -1.60000000e+00],
       [ 1.45424651e+03, -1.60000000e+00],
       [-7.77928221e+02, -1.40000000e+00],
       [-2.07247392e+03, -1.20000000e+00],
       [ 1.26263762e+03, -9.00000000e-01],
       [ 1.27653119e+01, -7.00000000e-01],
       [ 2.44699335e+03, -6.00000000e-01],
       [ 2.24039435e+01, -4.00000000e-01],
       [ 4.02760483e+02, -5.00000000e-01],
       [ 1.06704085e+03, -6.00000000e-01],
       [-2.39236678e+02, -8.00000000e-01],
       [ 1.33149817e+02, -1.00000000e+00],
       [ 8.44409230e+02, -1.10000000e+00],
       [ 1.84681134e+03, -1.00000000e+00],
       [-9.10750441e+02, -9.00000000e-01],
       [-1.65503647e+03, -7.00000000e-01],
       [-8.92487181e+02, -6.00000000e-01],
       [ 1.30918368e+03, -5.00000000e-01],
       [ 8.15476217e+02, -3.00000000e-01],
       [-1.54297981e+03,  0.00000000e+00],
       [-9.14789663e+02,  2.00000000e-01],
       [ 1.60766765e+03,  4.00000000e-01],
       [ 1.75056115e+02,  4.00000000e-01],
       [-1.11407321e+03,  3.00000000e-01],
       [ 2.18392830e+02,  1.00000000e-01],
       [-1.80133602e+03, -2.00000000e-01],
       [-1.65068079e+03, -4.00000000e-01],
       [ 1.14447436e+03, -4.00000000e-01],
       [-1.71653346e+02, -3.00000000e-01],
       [-1.25714356e+03, -3.00000000e-01],
       [ 3.17163021e+02, -4.00000000e-01],
       [ 9.01116947e+02, -4.00000000e-01]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="c1">#plt.plot(data_test.Mes, y_pred, label=&quot;RF&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Caudal (m3/s)&#39;)
</pre></div>
</div>
<img alt="../_images/0ff136ffb62039a864ebe63277dd1d72e2bda4f74a85b10cf6d238cf04709f14.png" src="../_images/0ff136ffb62039a864ebe63277dd1d72e2bda4f74a85b10cf6d238cf04709f14.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">residuales_test_extra</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define el modelo de red neuronal</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Compila el modelo</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">)</span>

<span class="c1"># Divide tus datos en entrenamiento y validaci√≥n</span>
<span class="n">indice</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.8</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">))</span>
<span class="n">y_trainval</span> <span class="o">=</span> <span class="n">residuals_train</span><span class="p">[:</span><span class="n">indice</span><span class="p">]</span>
<span class="n">X_trainval</span> <span class="o">=</span> <span class="n">residuales_train_extra</span><span class="p">[:</span><span class="n">indice</span><span class="p">]</span>
<span class="n">y_val</span> <span class="o">=</span> <span class="n">residuals_train</span><span class="p">[</span><span class="n">indice</span><span class="p">:]</span>
<span class="n">X_val</span> <span class="o">=</span> <span class="n">residuales_train_extra</span><span class="p">[</span><span class="n">indice</span><span class="p">:]</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>

<span class="c1"># Define el callback EarlyStopping</span>
<span class="n">early_stopping</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Entrena el modelo</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainval</span><span class="p">,</span> <span class="n">y_trainval</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
          <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">),</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">early_stopping</span><span class="p">])</span>

<span class="c1"># Define el pipeline con transformador de escala y modelo</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Eval√∫a el modelo en datos de prueba</span>
<span class="n">y_pred_NN</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">)</span>

<span class="c1"># Grafica los resultados</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_ARMA</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos reales&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred_NN</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicciones&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/200
3/3 [==============================] - 2s 112ms/step - loss: 1159803.0000 - val_loss: 1641859.2500
Epoch 2/200
3/3 [==============================] - 0s 30ms/step - loss: 1152422.8750 - val_loss: 1641144.0000
Epoch 3/200
3/3 [==============================] - 0s 26ms/step - loss: 1153122.1250 - val_loss: 1641408.8750
Epoch 4/200
3/3 [==============================] - 0s 26ms/step - loss: 1153669.2500 - val_loss: 1641556.1250
Epoch 5/200
3/3 [==============================] - 0s 27ms/step - loss: 1151493.3750 - val_loss: 1644193.6250
Epoch 6/200
3/3 [==============================] - 0s 32ms/step - loss: 1149726.1250 - val_loss: 1650590.6250
Epoch 7/200
3/3 [==============================] - 0s 33ms/step - loss: 1148545.8750 - val_loss: 1657988.3750
Epoch 8/200
3/3 [==============================] - 0s 31ms/step - loss: 1149448.3750 - val_loss: 1664250.0000
Epoch 9/200
3/3 [==============================] - 0s 27ms/step - loss: 1150590.7500 - val_loss: 1665942.8750
Epoch 10/200
3/3 [==============================] - 0s 22ms/step - loss: 1150762.8750 - val_loss: 1665290.2500
Epoch 11/200
3/3 [==============================] - 0s 27ms/step - loss: 1150810.3750 - val_loss: 1660727.1250
Epoch 12/200
3/3 [==============================] - 0s 23ms/step - loss: 1149604.2500 - val_loss: 1654800.8750
Epoch 13/200
3/3 [==============================] - 0s 25ms/step - loss: 1151044.1250 - val_loss: 1652944.6250
Epoch 14/200
3/3 [==============================] - 0s 26ms/step - loss: 1150876.0000 - val_loss: 1650882.7500
Epoch 15/200
3/3 [==============================] - 0s 27ms/step - loss: 1151506.8750 - val_loss: 1650088.6250
Epoch 16/200
3/3 [==============================] - 0s 27ms/step - loss: 1151520.6250 - val_loss: 1647831.7500
Epoch 17/200
3/3 [==============================] - 0s 29ms/step - loss: 1149727.6250 - val_loss: 1648557.7500
Epoch 18/200
3/3 [==============================] - 0s 25ms/step - loss: 1149309.2500 - val_loss: 1650120.1250
Epoch 19/200
3/3 [==============================] - 0s 24ms/step - loss: 1150357.1250 - val_loss: 1650778.2500
Epoch 20/200
3/3 [==============================] - 0s 28ms/step - loss: 1149936.6250 - val_loss: 1650971.8750
Epoch 21/200
3/3 [==============================] - 0s 29ms/step - loss: 1149957.5000 - val_loss: 1651125.1250
Epoch 22/200
3/3 [==============================] - 0s 29ms/step - loss: 1150579.7500 - val_loss: 1652921.7500
Epoch 23/200
3/3 [==============================] - 0s 27ms/step - loss: 1152374.0000 - val_loss: 1658478.0000
Epoch 24/200
3/3 [==============================] - 0s 21ms/step - loss: 1151313.7500 - val_loss: 1661727.3750
Epoch 25/200
3/3 [==============================] - 0s 23ms/step - loss: 1151703.6250 - val_loss: 1663621.7500
Epoch 26/200
3/3 [==============================] - 0s 23ms/step - loss: 1150895.5000 - val_loss: 1661131.5000
Epoch 27/200
3/3 [==============================] - 0s 25ms/step - loss: 1149673.6250 - val_loss: 1655376.6250
Epoch 28/200
3/3 [==============================] - 0s 26ms/step - loss: 1150121.5000 - val_loss: 1649477.2500
Epoch 29/200
3/3 [==============================] - 0s 24ms/step - loss: 1149543.3750 - val_loss: 1647216.3750
Epoch 30/200
3/3 [==============================] - 0s 28ms/step - loss: 1149734.2500 - val_loss: 1646315.8750
Epoch 31/200
3/3 [==============================] - 0s 28ms/step - loss: 1150057.0000 - val_loss: 1645654.3750
Epoch 32/200
3/3 [==============================] - 0s 21ms/step - loss: 1150138.3750 - val_loss: 1645736.2500
Epoch 33/200
3/3 [==============================] - 0s 24ms/step - loss: 1150014.1250 - val_loss: 1647595.1250
Epoch 34/200
3/3 [==============================] - 0s 21ms/step - loss: 1149021.5000 - val_loss: 1651962.1250
Epoch 35/200
3/3 [==============================] - 0s 29ms/step - loss: 1149037.1250 - val_loss: 1656299.3750
Epoch 36/200
3/3 [==============================] - 0s 24ms/step - loss: 1150304.0000 - val_loss: 1660201.8750
Epoch 37/200
3/3 [==============================] - 0s 24ms/step - loss: 1149667.7500 - val_loss: 1662550.6250
Epoch 38/200
3/3 [==============================] - 0s 21ms/step - loss: 1150786.7500 - val_loss: 1665092.1250
Epoch 39/200
3/3 [==============================] - 0s 23ms/step - loss: 1150639.7500 - val_loss: 1663225.0000
Epoch 40/200
3/3 [==============================] - 0s 22ms/step - loss: 1150282.5000 - val_loss: 1659140.5000
Epoch 41/200
3/3 [==============================] - 0s 25ms/step - loss: 1149659.2500 - val_loss: 1656639.3750
Epoch 42/200
3/3 [==============================] - 0s 28ms/step - loss: 1149362.8750 - val_loss: 1654305.2500
Epoch 43/200
3/3 [==============================] - 0s 27ms/step - loss: 1149454.2500 - val_loss: 1652965.1250
Epoch 44/200
3/3 [==============================] - 0s 23ms/step - loss: 1149334.6250 - val_loss: 1653271.3750
Epoch 45/200
3/3 [==============================] - 0s 21ms/step - loss: 1149707.1250 - val_loss: 1654809.6250
Epoch 46/200
3/3 [==============================] - 0s 21ms/step - loss: 1150122.1250 - val_loss: 1657039.1250
Epoch 47/200
3/3 [==============================] - 0s 22ms/step - loss: 1149808.2500 - val_loss: 1657963.8750
Epoch 48/200
3/3 [==============================] - 0s 20ms/step - loss: 1149572.2500 - val_loss: 1658692.7500
Epoch 49/200
3/3 [==============================] - 0s 24ms/step - loss: 1150149.5000 - val_loss: 1660213.1250
Epoch 50/200
3/3 [==============================] - 0s 23ms/step - loss: 1150060.0000 - val_loss: 1659621.1250
Epoch 51/200
3/3 [==============================] - 0s 24ms/step - loss: 1150180.8750 - val_loss: 1655865.7500
Epoch 52/200
3/3 [==============================] - 0s 32ms/step - loss: 1149408.8750 - val_loss: 1653135.7500
3/3 [==============================] - 0s 3ms/step
</pre></div>
</div>
<img alt="../_images/1811fc6a4995cb15afe1574838bdf6a3d93c80e6636a428d9f6e5542bfbbf646.png" src="../_images/1811fc6a4995cb15afe1574838bdf6a3d93c80e6636a428d9f6e5542bfbbf646.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_ARMA</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred_NN</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Tree prediction&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/73ecccfcf6793d99566722649a26a0bdebe5a58fbf9a18916333b201c2caaa86.png" src="../_images/73ecccfcf6793d99566722649a26a0bdebe5a58fbf9a18916333b201c2caaa86.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">residuales_ARMA</span><span class="p">,</span> <span class="n">y_pred_NN</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1100.97
MAE: 853.70
RRMSE: -10.17
R-squared (R^2): -0.02
NSE (Nash-Sutcliffe Efficiency): -90.36
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_ARMA_NN</span> <span class="o">=</span> <span class="n">predictions_ARMA</span> <span class="o">+</span> <span class="n">y_pred_NN</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">y_residual</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 187.55923613  103.39822764  356.35263815   70.56797972  136.27114048
  119.33447323  119.12742801  113.62009047   98.84615396   49.08717088
  -19.50298123   66.93356542   76.98005152    8.22941368   -3.948112
   57.80783093   29.03923304   -9.56950883   61.67029023 -124.25005846
   39.50519814   28.08133356   32.97679249 -462.59844649 -129.43085711
 -665.23691874 -197.19006264 -186.23387094 -340.52611976 -185.09875623
 -265.73974643 -294.7285865  -185.37177944   16.78094053   16.82745865
   86.16304346  123.65589256  175.64067945  161.24636987  182.28724559
  296.26520312  224.40545985  132.58465007  108.43558177   54.2106994
   63.44301846   78.09579774   -8.92995939 -335.49643782   89.54648965
  198.82079101  179.40444674  199.74785347  264.33869278  136.21149033
  140.77625352  115.15575591  204.27358417  135.07918743  -14.26096215
   13.63165571   78.30953367   62.91683982 -115.9108225  -494.24290731
 -199.07041672   33.20502893 -256.15965865   12.05404252   32.1947274
   49.24309259  145.85045438   69.59142993   72.15153219   76.52133612
   17.72339835   75.72723312    2.49627236   62.69718347   18.48213154
   24.73638149   45.96438063   44.09345476  106.61601513  181.30764322
  257.89697459  228.03611389  282.1739681   261.8390702 ]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">y_ARMA_NN</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 987.88
MAE: 775.17
RRMSE: 0.15
R-squared (R^2): 0.80
NSE (Nash-Sutcliffe Efficiency): 0.80
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Nueva carpeta"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">aapineda</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#river-flow-forecasting-a-hybrid-approach-integrating-machine-learning-and-linear-time-series-models">River Flow Forecasting: A Hybrid Approach Integrating Machine Learning and Linear Time Series Models</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resumen"><strong>Resumen</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metodologia"><strong>Metodolog√≠a</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#librerias-necesarias">Librerias Necesarias</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset">Dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#relacion-entre-enso-y-caudal">Relacion entre ENSO y Caudal</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#lag-a-los-datos">Lag a los datos</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#auto-correlation-function-acf-and-partial-autocorrelation-funcion-pacf">Auto Correlation function (ACF) and Partial Autocorrelation Funcion(PACF).</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#datos-de-entrenamiento-y-prueba">Datos de Entrenamiento y Prueba</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metricas">Metricas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#arima">ARIMA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#funcion-arima">Funcion ARIMA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-lineales">Modelos lineales</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ar">AR</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arma">ARMA</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ridge">Ridge</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lasso">Lasso</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest">Random Forest</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Metricas</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#k-nn-regresor">k-NN regresor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#svr">SVR</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#redes-neuronales">Redes Neuronales</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-hibrido">Modelo Hibrido</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest-con-modelos-lineales">Random Forest con modelos lineales</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ar-rf">AR-RF</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arma-rf">ARMA-RF</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ar-ann">AR-ANN</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arma-ann">ARMA-ANN</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Angel Andres Pineda Lopez
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      ¬© Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>