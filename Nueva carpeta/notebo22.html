

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>aapineda &#8212; River Flow Forecasting = A Hybrid Approach Integrating Machine Learning and Linear Time Series Models</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Nueva carpeta/notebo22';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.jpg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.jpg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Bienvenidos
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Texto.html">River Flow Forecasting: A Hybrid Approach Integrating Machine Learning and ARIMA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebo23.html">Aplicación</a></li>

</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FNueva carpeta/notebo22.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Nueva carpeta/notebo22.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>aapineda</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">aapineda</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#river-flow-forecasting-a-hybrid-approach-integrating-machine-learning-and-linear-time-series-models">River Flow Forecasting: A Hybrid Approach Integrating Machine Learning and Linear Time Series Models</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resumen"><strong>Resumen</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metodologia"><strong>Metodología</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#librerias-necesarias">Librerias Necesarias</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset">Dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#relacion-entre-enso-y-caudal">Relacion entre ENSO y Caudal</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#lag-a-los-datos">Lag a los datos</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#auto-correlation-function-acf-and-partial-autocorrelation-funcion-pacf">Auto Correlation function (ACF) and Partial Autocorrelation Funcion(PACF).</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#datos-de-entrenamiento-y-prueba">Datos de Entrenamiento y Prueba</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metricas">Metricas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#arima">ARIMA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#funcion-arima">Funcion ARIMA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-lineales">Modelos lineales</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ar">AR</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arma">ARMA</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ridge">Ridge</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lasso">Lasso</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest">Random Forest</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Metricas</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#k-nn-regresor">k-NN regresor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#svr">SVR</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#redes-neuronales">Redes Neuronales</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-hibrido">Modelo Hibrido</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest-con-modelos-lineales">Random Forest con modelos lineales</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ar-rf">AR-RF</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arma-rf">ARMA-RF</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ar-ann">AR-ANN</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arma-ann">ARMA-ANN</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="aapineda">
<h1>aapineda<a class="headerlink" href="#aapineda" title="Permalink to this heading">#</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="river-flow-forecasting-a-hybrid-approach-integrating-machine-learning-and-linear-time-series-models">
<h1>River Flow Forecasting: A Hybrid Approach Integrating Machine Learning and Linear Time Series Models<a class="headerlink" href="#river-flow-forecasting-a-hybrid-approach-integrating-machine-learning-and-linear-time-series-models" title="Permalink to this heading">#</a></h1>
<p><img alt="Alt text" src="Nueva carpeta/1024px-Rio_Magdalena_Delta_landsat.jpg" /></p>
<section id="resumen">
<h2><strong>Resumen</strong><a class="headerlink" href="#resumen" title="Permalink to this heading">#</a></h2>
<p>La precisa estimación del caudal del río Magdalena en la estación de Calamar, Bolívar, es esencial para la gestión de recursos hídricos y la reducción de riesgos de inundaciones en esta región. En este estudio, se emplearon tres enfoques de modelado para estimar el caudal del río a largo plazo (mensuales).
Los datos necesarios para este análisis fueron recopilados específicamente en la estación de monitoreo de Calamar, Bolívar, a lo largo del río Magdalena. Se examinaron tres enfoques de modelado: modelos autoregresivos (AR), modelos de promedio móvil (MA) y modelos autoregresivos de promedio móvil (ARMA). Los resultados revelaron que los modelos MA superaron consistentemente en rendimiento a los modelos AR y ARMA.
Además, para mejorar la precisión en la estimación del caudal del río Magdalena, se exploraron modelos de aprendizaje automático. Específicamente, se utilizaron Bosques Aleatorios (RF) y Splines de Regresión Adaptativos Multivariados (MARS) para estimar los valores mensuales de un factor crítico, el caudal del Rio, basándose en datos del Caudal del periodo anterior. Los resultados revelaron que RF y MARS produjeron estimaciones comparables, con RF mostrando una ligera ventaja en el rendimiento.
Posteriormente, se implementaron modelos híbridos que combinaron enfoques de series temporales y aprendizaje automático, como RF-AR, RF-MA, RF-ARMA, MARS-AR, MARS-MA y MARS-ARMA, con el objetivo de mejorar la precisión en la estimación del Caudal. Entre estos modelos híbridos, RF-AR y MARS-AR demostraron consistentemente un rendimiento sobresaliente.
Los resultados de este estudio sugieren que la combinación de enfoques híbridos, que integran modelos de series temporales y aprendizaje automático, ofrece un enfoque prometedor para estimar el Caudal en la estación de Calamar, Bolívar, a lo largo del río Magdalena. Estas estimaciones precisas del Caudal tienen aplicaciones significativas en proyectos relacionados con el analisis de Riesgo, planificacion de dragados y Energia hidroelectrica.</p>
<ul class="simple">
<li><p>Palabras clave: Río Magdalena · Estimación · Modelos de Series Temporales · Modelos de Aprendizaje Automático · Modelos Independientes y Híbridos · Caudales.</p></li>
</ul>
</section>
<section id="metodologia">
<h2><strong>Metodología</strong><a class="headerlink" href="#metodologia" title="Permalink to this heading">#</a></h2>
<p><strong>Población y Muestra:</strong></p>
<ul class="simple">
<li><p>Población: La población de interés consistió en todos los datos históricos de caudales disponibles para la estación de Calamar, Bolívar, a lo largo del río Magdalena. (1984-2020)</p></li>
<li><p>Muestra: La muestra se seleccionó considerando el tiempo y el espacio, incluyendo datos diarios recopilados a lo largo de varios años específicos. La muestra se limitó a la estación de Calamar, Bolívar.</p></li>
</ul>
<p><strong>Variables:</strong>
Se definió un diccionario de características que incluyó las siguientes variables:</p>
<ul class="simple">
<li><p>Caudal del río Magdalena (variable objetivo).</p></li>
<li><p>Variables meteorológicas adicionales (si es necesario).</p></li>
<li><p>Fechas y marcas temporales para el análisis de series temporales.</p></li>
</ul>
<p><strong>Técnicas:</strong>
Se emplearon diversas técnicas para la estimación del caudal del río Magdalena, que se dividieron en dos categorías principales:</p>
<p><strong>a. Modelos de Series Temporales:</strong></p>
<ul class="simple">
<li><p>Modelos AR (Autoregresivos).</p></li>
<li><p>Modelos MA (Promedio Móvil).</p></li>
<li><p>Modelos ARMA (Autoregresivos de Promedio Móvil).</p></li>
</ul>
<p><strong>b. Modelos de Aprendizaje Automático:</strong></p>
<ul class="simple">
<li><p>Bosques Aleatorios (RF).</p></li>
<li><p>Splines de Regresión Adaptativos Multivariados (MARS).
Además, se aplicaron modelos híbridos que combinaron enfoques de series temporales y aprendizaje automático, como RF-AR y MARS-AR.</p></li>
</ul>
<p><strong>Diseño General:</strong>
El estudio siguió un diseño de investigación observacional retrospectiva. Se recopilaron datos históricos de caudales del río Magdalena en la estación de Calamar, Bolívar, así como datos de velocidad del viento y, en su caso, datos meteorológicos adicionales. Estos datos retrospectivos se analizaron para desarrollar modelos de estimación del caudal del río.</p>
<p><strong>Validez:</strong>
La validez del estudio se abordó de la siguiente manera:</p>
<ul class="simple">
<li><p>Grupos de Datos Coherentes: Se utilizaron datos coherentes y homogéneos recopilados de manera consistente a lo largo del tiempo.</p></li>
<li><p>Automatizado: La obtención de datos se automatizó mediante la extracción de datos desde fuentes como archivos CSV y, en su caso, API o consultas SQL.</p></li>
<li><p>Técnicas Estadísticas: Se aplicaron pruebas estadísticas como Chi cuadrado, T-Students, Prueba Fisher y análisis de autocorrelación para evaluar la validez y la robustez de los modelos propuestos y los resultados del estudio.</p></li>
</ul>
<p>Este enfoque metodológico riguroso garantiza la calidad y la confiabilidad de los resultados del estudio de estimación del caudal del río Magdalena en la estación de Calamar, Bolívar, y sienta las bases para la mejora de la gestión de recursos hídricos en esta región.</p>
</section>
<section id="librerias-necesarias">
<h2>Librerias Necesarias<a class="headerlink" href="#librerias-necesarias" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span><span class="n">plot_pacf</span> 
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools.sm_exceptions</span> <span class="kn">import</span> <span class="n">ConvergenceWarning</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">ConvergenceWarning</span><span class="p">)</span>

<span class="c1">## Errores</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="dataset">
<h2>Dataset<a class="headerlink" href="#dataset" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># URL del archivo CSV en GitHub</span>
<span class="c1">#url = &#39;https://raw.githubusercontent.com/aapineda/data/main/Q_Station_25017010.csv&#39;</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/aapineda/data/main/Q_Station_29037020.csv&#39;</span> <span class="c1">##CALMAR</span>
<span class="c1">#url = &#39;https://raw.githubusercontent.com/aapineda/data/main/Q_Station_21237020.csv&#39;</span>
<span class="c1">#url = &#39;https://raw.githubusercontent.com/aapineda/data/main/Q_Station_25027020.csv&#39;</span>



<span class="c1"># Leer el archivo CSV desde la URL</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 13515 entries, 0 to 13514
Data columns (total 3 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   Date    13515 non-null  object 
 1   Flow    13515 non-null  float64
 2   ENSO    13515 non-null  float64
dtypes: float64(2), object(1)
memory usage: 316.9+ KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Flow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Flow</th>
      <th>ENSO</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1-01-1984</td>
      <td>7803.0</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2-01-1984</td>
      <td>7718.0</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3-01-1984</td>
      <td>7634.0</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4-01-1984</td>
      <td>7554.0</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5-01-1984</td>
      <td>7498.0</td>
      <td>-0.6</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Flow</th>
      <th>ENSO</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>13515.000000</td>
      <td>13515.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>7239.553703</td>
      <td>-0.003492</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2708.667922</td>
      <td>0.850624</td>
    </tr>
    <tr>
      <th>min</th>
      <td>2011.900000</td>
      <td>-1.800000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>5177.200000</td>
      <td>-0.600000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>6987.000000</td>
      <td>-0.100000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>9157.050000</td>
      <td>0.500000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>14909.000000</td>
      <td>2.600000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Date    0
Flow    0
ENSO    0
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)))</span><span class="o">*</span><span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Date    0.0
Flow    0.0
ENSO    0.0
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Asegúrate de que la columna &#39;fecha&#39; sea de tipo datetime</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">-%m-%Y&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>


<span class="c1"># Agrupa los datos por mes y calcula el promedio</span>
<span class="n">serie</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="c1">#serie = df</span>

<span class="n">serie</span> <span class="o">=</span> <span class="n">serie</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># La variable promedio_por_mes ahora contiene el promedio de &#39;valor&#39; por mes</span>
<span class="nb">print</span><span class="p">(</span><span class="n">serie</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>             Flow  ENSO
0     7046.387097  -0.6
1     5769.344828  -0.4
2     5016.483871  -0.3
3     4613.266667  -0.4
4     6783.838710  -0.5
..            ...   ...
439   7277.535484  -0.6
440   8679.066667  -0.9
441   9349.567742  -1.2
442   9804.350000  -1.3
443  10353.732258  -1.2

[444 rows x 2 columns]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Flow</th>
      <th>ENSO</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7046.387097</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5769.344828</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5016.483871</td>
      <td>-0.3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4613.266667</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6783.838710</td>
      <td>-0.5</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>439</th>
      <td>7277.535484</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>440</th>
      <td>8679.066667</td>
      <td>-0.9</td>
    </tr>
    <tr>
      <th>441</th>
      <td>9349.567742</td>
      <td>-1.2</td>
    </tr>
    <tr>
      <th>442</th>
      <td>9804.350000</td>
      <td>-1.3</td>
    </tr>
    <tr>
      <th>443</th>
      <td>10353.732258</td>
      <td>-1.2</td>
    </tr>
  </tbody>
</table>
<p>444 rows × 2 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie</span><span class="p">[</span><span class="s1">&#39;Mes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">serie</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">#PREDECIR CON MESES</span>
<span class="c1">#serie = serie.drop(columns=&#39;Date&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Flow</th>
      <th>ENSO</th>
      <th>Mes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7046.387097</td>
      <td>-0.6</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5769.344828</td>
      <td>-0.4</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5016.483871</td>
      <td>-0.3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4613.266667</td>
      <td>-0.4</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6783.838710</td>
      <td>-0.5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>439</th>
      <td>7277.535484</td>
      <td>-0.6</td>
      <td>440</td>
    </tr>
    <tr>
      <th>440</th>
      <td>8679.066667</td>
      <td>-0.9</td>
      <td>441</td>
    </tr>
    <tr>
      <th>441</th>
      <td>9349.567742</td>
      <td>-1.2</td>
      <td>442</td>
    </tr>
    <tr>
      <th>442</th>
      <td>9804.350000</td>
      <td>-1.3</td>
      <td>443</td>
    </tr>
    <tr>
      <th>443</th>
      <td>10353.732258</td>
      <td>-1.2</td>
      <td>444</td>
    </tr>
  </tbody>
</table>
<p>444 rows × 3 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr</span> <span class="o">=</span> <span class="n">serie</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

<span class="n">f</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">annot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">1.5</span> <span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;.2f&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/83fea1324cf93f977fcb12b05b451a86fe4eacf3ca7ff98fe6b5ae287c26d272.png" src="../_images/83fea1324cf93f977fcb12b05b451a86fe4eacf3ca7ff98fe6b5ae287c26d272.png" />
</div>
</div>
<section id="relacion-entre-enso-y-caudal">
<h3>Relacion entre ENSO y Caudal<a class="headerlink" href="#relacion-entre-enso-y-caudal" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>  <span class="c1"># Importa StandardScaler desde sklearn.preprocessing si no está ya importado</span>

<span class="c1"># Escala las series &#39;Flow&#39; y &#39;ENSO&#39; usando StandardScaler</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">scaled_flow</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">serie</span><span class="p">[[</span><span class="s1">&#39;Flow&#39;</span><span class="p">]])</span>
<span class="n">scaled_enso</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">serie</span><span class="p">[[</span><span class="s1">&#39;ENSO&#39;</span><span class="p">]])</span>

<span class="c1"># Crea una figura y traza las series</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie</span><span class="p">[</span><span class="s1">&#39;Mes&#39;</span><span class="p">],</span> <span class="n">scaled_flow</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Flow&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie</span><span class="p">[</span><span class="s1">&#39;Mes&#39;</span><span class="p">],</span> <span class="n">scaled_enso</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ENSO&#39;</span><span class="p">)</span>  <span class="c1"># Usamos un color diferente (azul) para ENSO</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Tiempo (Mes)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Caudal (escala estándar)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;River Flow and ENSO&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Rotate x-axis labels for readability</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f5726da8c12a98845c35b5f101a4ea2e6f126ea1f2e89c1d0594a8f9ac69bc01.png" src="../_images/f5726da8c12a98845c35b5f101a4ea2e6f126ea1f2e89c1d0594a8f9ac69bc01.png" />
</div>
</div>
<section id="lag-a-los-datos">
<h4>Lag a los datos<a class="headerlink" href="#lag-a-los-datos" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie</span><span class="p">[</span><span class="s1">&#39;Flow_lag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">serie</span><span class="p">[</span><span class="s1">&#39;Flow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">serie</span><span class="p">[</span><span class="s1">&#39;ENSO_lag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">serie</span><span class="p">[</span><span class="s1">&#39;ENSO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Flow</th>
      <th>ENSO</th>
      <th>Mes</th>
      <th>Flow_lag</th>
      <th>ENSO_lag</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7046.387097</td>
      <td>-0.6</td>
      <td>1</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5769.344828</td>
      <td>-0.4</td>
      <td>2</td>
      <td>7046.387097</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5016.483871</td>
      <td>-0.3</td>
      <td>3</td>
      <td>5769.344828</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4613.266667</td>
      <td>-0.4</td>
      <td>4</td>
      <td>5016.483871</td>
      <td>-0.3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6783.838710</td>
      <td>-0.5</td>
      <td>5</td>
      <td>4613.266667</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>439</th>
      <td>7277.535484</td>
      <td>-0.6</td>
      <td>440</td>
      <td>6987.390323</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>440</th>
      <td>8679.066667</td>
      <td>-0.9</td>
      <td>441</td>
      <td>7277.535484</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>441</th>
      <td>9349.567742</td>
      <td>-1.2</td>
      <td>442</td>
      <td>8679.066667</td>
      <td>-0.9</td>
    </tr>
    <tr>
      <th>442</th>
      <td>9804.350000</td>
      <td>-1.3</td>
      <td>443</td>
      <td>9349.567742</td>
      <td>-1.2</td>
    </tr>
    <tr>
      <th>443</th>
      <td>10353.732258</td>
      <td>-1.2</td>
      <td>444</td>
      <td>9804.350000</td>
      <td>-1.3</td>
    </tr>
  </tbody>
</table>
<p>444 rows × 5 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Flow_lag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">7490.387</span>
<span class="c1">#serie.at[0, &#39;ENSO_lag&#39;] = -0.8</span>
<span class="c1">#serie.at[1, &#39;ENSO_lag&#39;] = -1</span>
<span class="n">serie</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;ENSO_lag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.9</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Flow</th>
      <th>ENSO</th>
      <th>Mes</th>
      <th>Flow_lag</th>
      <th>ENSO_lag</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7046.387097</td>
      <td>-0.6</td>
      <td>1</td>
      <td>7490.387000</td>
      <td>-0.9</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5769.344828</td>
      <td>-0.4</td>
      <td>2</td>
      <td>7046.387097</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5016.483871</td>
      <td>-0.3</td>
      <td>3</td>
      <td>5769.344828</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4613.266667</td>
      <td>-0.4</td>
      <td>4</td>
      <td>5016.483871</td>
      <td>-0.3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6783.838710</td>
      <td>-0.5</td>
      <td>5</td>
      <td>4613.266667</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>439</th>
      <td>7277.535484</td>
      <td>-0.6</td>
      <td>440</td>
      <td>6987.390323</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>440</th>
      <td>8679.066667</td>
      <td>-0.9</td>
      <td>441</td>
      <td>7277.535484</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>441</th>
      <td>9349.567742</td>
      <td>-1.2</td>
      <td>442</td>
      <td>8679.066667</td>
      <td>-0.9</td>
    </tr>
    <tr>
      <th>442</th>
      <td>9804.350000</td>
      <td>-1.3</td>
      <td>443</td>
      <td>9349.567742</td>
      <td>-1.2</td>
    </tr>
    <tr>
      <th>443</th>
      <td>10353.732258</td>
      <td>-1.2</td>
      <td>444</td>
      <td>9804.350000</td>
      <td>-1.3</td>
    </tr>
  </tbody>
</table>
<p>444 rows × 5 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr</span> <span class="o">=</span> <span class="n">serie</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

<span class="n">f</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">annot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">1.5</span> <span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;.2f&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/87a00c04697c24393db9c3a1aba1481ff0436c6d9be219068c78d6f05ebebf2f.png" src="../_images/87a00c04697c24393db9c3a1aba1481ff0436c6d9be219068c78d6f05ebebf2f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie_ARIMA</span><span class="o">=</span> <span class="n">serie</span><span class="p">[[</span><span class="s1">&#39;Flow&#39;</span><span class="p">,</span> <span class="s1">&#39;Mes&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie_ARIMA</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Flow</th>
      <th>Mes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7046.387097</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5769.344828</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5016.483871</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4613.266667</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6783.838710</td>
      <td>5</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>439</th>
      <td>7277.535484</td>
      <td>440</td>
    </tr>
    <tr>
      <th>440</th>
      <td>8679.066667</td>
      <td>441</td>
    </tr>
    <tr>
      <th>441</th>
      <td>9349.567742</td>
      <td>442</td>
    </tr>
    <tr>
      <th>442</th>
      <td>9804.350000</td>
      <td>443</td>
    </tr>
    <tr>
      <th>443</th>
      <td>10353.732258</td>
      <td>444</td>
    </tr>
  </tbody>
</table>
<p>444 rows × 2 columns</p>
</div></div></div>
</div>
</section>
</section>
<section id="auto-correlation-function-acf-and-partial-autocorrelation-funcion-pacf">
<h3>Auto Correlation function (ACF) and Partial Autocorrelation Funcion(PACF).<a class="headerlink" href="#auto-correlation-function-acf-and-partial-autocorrelation-funcion-pacf" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_pacf</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">[</span><span class="s1">&#39;Flow&#39;</span><span class="p">])</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">[</span><span class="s1">&#39;Flow&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/dfa50777e42c2b59a57662f80d37deb4245e4933e3db71d0c77dff09ee964525.png" src="../_images/dfa50777e42c2b59a57662f80d37deb4245e4933e3db71d0c77dff09ee964525.png" />
<img alt="../_images/82646700d8f6b7bfc1f228c440956e787018690fc456e43a57a54ad8bf48783e.png" src="../_images/82646700d8f6b7bfc1f228c440956e787018690fc456e43a57a54ad8bf48783e.png" />
<img alt="../_images/dfa50777e42c2b59a57662f80d37deb4245e4933e3db71d0c77dff09ee964525.png" src="../_images/dfa50777e42c2b59a57662f80d37deb4245e4933e3db71d0c77dff09ee964525.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Function to know stacionality</span>

<span class="k">def</span> <span class="nf">Prueba_Dickey_Fuller</span><span class="p">(</span><span class="n">series</span> <span class="p">,</span> <span class="n">column_name</span><span class="p">):</span>
    <span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Resultados de la prueba de Dickey-Fuller para columna: </span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">dftest</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">autolag</span><span class="o">=</span><span class="s1">&#39;AIC&#39;</span><span class="p">)</span>
    <span class="n">dfoutput</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dftest</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Test Statistic&#39;</span><span class="p">,</span><span class="s1">&#39;p-value&#39;</span><span class="p">,</span><span class="s1">&#39;No Lags Used&#39;</span><span class="p">,</span><span class="s1">&#39;Número de observaciones utilizadas&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">dftest</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
       <span class="n">dfoutput</span><span class="p">[</span><span class="s1">&#39;Critical Value (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="k">key</span>] = value
    <span class="nb">print</span> <span class="p">(</span><span class="n">dfoutput</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dftest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.05</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Conclusion:====&gt;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rechazar la hipótesis nula&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los datos son estacionarios (Stationary)&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Conclusion:====&gt;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No se puede rechazar la hipótesis nula&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los datos son no estacionarios (Non Stationary)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Prueba_Dickey_Fuller</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">[</span><span class="s1">&#39;Flow&#39;</span><span class="p">],</span><span class="s2">&quot;Flow&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Resultados de la prueba de Dickey-Fuller para columna: Flow
Test Statistic                         -5.555584
p-value                                 0.000002
No Lags Used                           13.000000
Número de observaciones utilizadas    430.000000
Critical Value (1%)                    -3.445649
Critical Value (5%)                    -2.868285
Critical Value (10%)                   -2.570363
dtype: float64
Conclusion:====&gt;
Rechazar la hipótesis nula
Los datos son estacionarios (Stationary)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convertir &#39;Flow&#39; y &#39;Mes&#39; en arreglos NumPy y luego aplicar reshape</span>
<span class="sd">&quot;&quot;&quot;target = serie[&#39;Flow&#39;].values.reshape(-1, 1)</span>
<span class="sd">data = serie[&#39;Mes&#39;].values.reshape(-1, 1)&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&quot;target = serie[&#39;Flow&#39;].values.reshape(-1, 1)\ndata = serie[&#39;Mes&#39;].values.reshape(-1, 1)&quot;
</pre></div>
</div>
</div>
</div>
</section>
<section id="datos-de-entrenamiento-y-prueba">
<h3>Datos de Entrenamiento y Prueba<a class="headerlink" href="#datos-de-entrenamiento-y-prueba" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">serie</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_train</span> <span class="o">=</span> <span class="n">serie</span><span class="p">[</span><span class="n">serie</span><span class="o">.</span><span class="n">Mes</span> <span class="o">&lt;=</span> <span class="n">size</span><span class="p">]</span>
<span class="n">data_test</span>  <span class="o">=</span> <span class="n">serie</span><span class="p">[</span><span class="n">serie</span><span class="o">.</span><span class="n">Mes</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#X_train = np.array(data_train.Mes)[:, None] # vector-columna</span>

<span class="c1">#X_train = np.array(data_train[[&#39;Mes&#39;, &#39;ENSO&#39;]])</span>
<span class="c1">#X_train = np.array(data_train[[&#39;Flow_lag&#39;]])</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_train</span><span class="p">[[</span><span class="s1">&#39;Flow_lag&#39;</span><span class="p">,</span> <span class="s1">&#39;ENSO_lag&#39;</span><span class="p">]])</span>

<span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_train</span><span class="o">.</span><span class="n">Flow</span><span class="p">)</span>

<span class="c1">#X_test = np.array(data_test.Mes)[:, None] # vector-columna</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_test</span><span class="p">[[</span><span class="s1">&#39;Flow_lag&#39;</span><span class="p">,</span> <span class="s1">&#39;ENSO_lag&#39;</span><span class="p">]])</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_test</span><span class="o">.</span><span class="n">Flow</span><span class="p">)</span>

<span class="n">X_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">serie</span><span class="p">[[</span><span class="s1">&#39;Flow_lag&#39;</span><span class="p">,</span> <span class="s1">&#39;ENSO_lag&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>89
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="metricas">
<h2>Metricas<a class="headerlink" href="#metricas" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculo de Metricas</span>
<span class="k">def</span> <span class="nf">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred</span><span class="p">):</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMSE: </span><span class="si">{</span><span class="n">rmse</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAE: </span><span class="si">{</span><span class="n">mae</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Calcular el RRMSE directamente</span>
    <span class="n">rrmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RRMSE: </span><span class="si">{</span><span class="n">rrmse</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Calcular R-squared</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R-squared (R^2): </span><span class="si">{</span><span class="n">r2</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Calcular el NSE (coeficiente de eficiencia Nash-Sutcliffe)</span>
    <span class="n">nse</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_test</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NSE (Nash-Sutcliffe Efficiency): </span><span class="si">{</span><span class="n">nse</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="arima">
<h2>ARIMA<a class="headerlink" href="#arima" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>

<span class="c1"># Load dataset</span>

<span class="c1"># Split into train and test sets</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">serie_ARIMA</span><span class="p">[</span><span class="s1">&#39;Flow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">size</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">size</span><span class="p">:]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pmdarima</span> <span class="k">as</span> <span class="nn">pm</span>

<span class="n">model_1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">auto_arima</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">start_p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">start_q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">test</span><span class="o">=</span><span class="s1">&#39;adf&#39;</span><span class="p">,</span>
                      <span class="n">max_p</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">d</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">seasonal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">start_P</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">D</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">trace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">error_action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span>
                      <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">stepwise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">model_1</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Performing stepwise search to minimize aic
 ARIMA(1,0,0)(0,0,0)[0]             : AIC=7865.329, Time=0.02 sec
 ARIMA(0,0,0)(0,0,0)[0]             : AIC=9208.012, Time=0.01 sec
 ARIMA(2,0,0)(0,0,0)[0]             : AIC=7777.791, Time=0.03 sec
 ARIMA(3,0,0)(0,0,0)[0]             : AIC=7662.598, Time=0.07 sec
 ARIMA(4,0,0)(0,0,0)[0]             : AIC=7641.101, Time=0.09 sec
 ARIMA(5,0,0)(0,0,0)[0]             : AIC=7639.764, Time=0.11 sec
 ARIMA(5,0,0)(0,0,0)[0] intercept   : AIC=7603.639, Time=0.12 sec
 ARIMA(4,0,0)(0,0,0)[0] intercept   : AIC=7601.648, Time=0.09 sec
 ARIMA(3,0,0)(0,0,0)[0] intercept   : AIC=7606.573, Time=0.07 sec

Best model:  ARIMA(4,0,0)(0,0,0)[0] intercept
Total fit time: 0.607 seconds
                               SARIMAX Results                                
==============================================================================
Dep. Variable:                      y   No. Observations:                  444
Model:               SARIMAX(4, 0, 0)   Log Likelihood               -3794.824
Date:                Wed, 04 Oct 2023   AIC                           7601.648
Time:                        10:10:47   BIC                           7626.223
Sample:                             0   HQIC                          7611.340
                                - 444                                         
Covariance Type:                  opg                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
intercept   1414.4895    230.488      6.137      0.000     962.742    1866.237
ar.L1          1.3864      0.050     27.656      0.000       1.288       1.485
ar.L2         -0.8359      0.083    -10.109      0.000      -0.998      -0.674
ar.L3          0.1300      0.085      1.529      0.126      -0.037       0.297
ar.L4          0.1242      0.049      2.547      0.011       0.029       0.220
sigma2      1.555e+06      0.009   1.64e+08      0.000    1.56e+06    1.56e+06
===================================================================================
Ljung-Box (L1) (Q):                   0.00   Jarque-Bera (JB):                 9.27
Prob(Q):                              0.96   Prob(JB):                         0.01
Heteroskedasticity (H):               1.16   Skew:                            -0.35
Prob(H) (two-sided):                  0.36   Kurtosis:                         2.91
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
[2] Covariance matrix is singular or near-singular, with condition number 7.88e+25. Standard errors may be unstable.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">orden_ar</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fit model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">orden_ar</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="c1"># summary of fit model</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
<span class="c1"># line plot of residuals</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">model_fit</span><span class="o">.</span><span class="n">resid</span><span class="p">)</span>
<span class="n">residuals</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># density plot of residuals</span>
<span class="n">residuals</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># summary stats of residuals</span>
<span class="nb">print</span><span class="p">(</span><span class="n">residuals</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                               SARIMAX Results                                
==============================================================================
Dep. Variable:                      y   No. Observations:                  355
Model:                 ARIMA(5, 0, 0)   Log Likelihood               -3036.744
Date:                Wed, 04 Oct 2023   AIC                           6087.488
Time:                        10:10:47   BIC                           6114.593
Sample:                             0   HQIC                          6098.271
                                - 355                                         
Covariance Type:                  opg                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const       7413.0301    367.764     20.157      0.000    6692.227    8133.834
ar.L1          1.4205      0.057     24.728      0.000       1.308       1.533
ar.L2         -0.8886      0.095     -9.400      0.000      -1.074      -0.703
ar.L3          0.1636      0.107      1.530      0.126      -0.046       0.373
ar.L4          0.1146      0.104      1.099      0.272      -0.090       0.319
ar.L5         -0.0103      0.065     -0.158      0.875      -0.138       0.117
sigma2      1.576e+06   1.33e+05     11.854      0.000    1.32e+06    1.84e+06
===================================================================================
Ljung-Box (L1) (Q):                   0.00   Jarque-Bera (JB):                 6.01
Prob(Q):                              0.98   Prob(JB):                         0.05
Heteroskedasticity (H):               1.31   Skew:                            -0.31
Prob(H) (two-sided):                  0.14   Kurtosis:                         2.87
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
</pre></div>
</div>
<img alt="../_images/cf40e5c061452b1eeb7b104b2f5aa00e315f9ce809dafa55d18ce3275642360e.png" src="../_images/cf40e5c061452b1eeb7b104b2f5aa00e315f9ce809dafa55d18ce3275642360e.png" />
<img alt="../_images/d7c2763d1dcde8eef74f91e82d59ae9291ecc4e4ba67a911af368ffbf0961f31.png" src="../_images/d7c2763d1dcde8eef74f91e82d59ae9291ecc4e4ba67a911af368ffbf0961f31.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                 0
count   355.000000
mean     -5.996724
std    1254.328712
min   -3866.216294
25%    -843.690612
50%      66.530667
75%     869.953976
max    3390.829384
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="funcion-arima">
<h2>Funcion ARIMA<a class="headerlink" href="#funcion-arima" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ARIMA_estimador</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">,</span> <span class="n">orden</span><span class="p">):</span>
    <span class="c1"># Split into train and test sets</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">residuales</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">serie_ARIMA</span><span class="p">[</span><span class="s1">&#39;Flow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">size</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">size</span><span class="p">:]</span>

    <span class="n">history</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">train</span><span class="p">]</span>
    
    <span class="c1"># Walk-forward validation</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">orden</span><span class="p">)</span>
        <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">()</span>
        <span class="n">yhat</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yhat</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="c1">#print(&#39;Month=%s, Predicted=%f, Expected=%f&#39; % (serie_ARIMA[&#39;Mes&#39;].iloc[size + t], yhat, obs))</span>

    <span class="n">history</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">train</span><span class="p">]</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">orden</span><span class="p">)</span>
        <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">()</span>
        <span class="n">yhat</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yhat</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="n">residuales</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="o">-</span><span class="n">yhat</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">[</span><span class="s1">&#39;Mes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">size</span><span class="p">:],</span> <span class="n">test</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">[</span><span class="s1">&#39;Mes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">size</span><span class="p">:],</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicted&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Tiempo (Mes)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Caudal (m3/s)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;River Flow Forecast&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


    <span class="c1"># Evaluate forecasts</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test RMSE: </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">rmse</span><span class="p">)</span>

    <span class="c1"># Plot forecasts against actual outcomes</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">[</span><span class="s1">&#39;Mes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">size</span><span class="p">:],</span> <span class="n">residuales</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Residuales&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Tiempo (Mes)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Caudal (m3/s)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Residuales obtenidos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Rotate x-axis labels for readability</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    
    <span class="k">return</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">residuales</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="modelos-lineales">
<h2>Modelos lineales<a class="headerlink" href="#modelos-lineales" title="Permalink to this heading">#</a></h2>
<p>Entre los modelos lineales se encuentran: autoregressive (AR), moving average (MA), and autoregressive moving average (ARMA)</p>
<section id="ar">
<h3>AR<a class="headerlink" href="#ar" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pmdarima</span> <span class="k">as</span> <span class="nn">pm</span>

<span class="n">model_1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">auto_arima</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">start_p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">start_q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">test</span><span class="o">=</span><span class="s1">&#39;adf&#39;</span><span class="p">,</span>
                      <span class="n">max_p</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">d</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">seasonal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">start_P</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">D</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">trace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">error_action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span>
                      <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">stepwise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">model_1</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Performing stepwise search to minimize aic
 ARIMA(1,0,0)(0,0,0)[0]             : AIC=7865.329, Time=0.02 sec
 ARIMA(0,0,0)(0,0,0)[0]             : AIC=9208.012, Time=0.01 sec
 ARIMA(2,0,0)(0,0,0)[0]             : AIC=7777.791, Time=0.04 sec
 ARIMA(3,0,0)(0,0,0)[0]             : AIC=7662.598, Time=0.06 sec
 ARIMA(4,0,0)(0,0,0)[0]             : AIC=7641.101, Time=0.09 sec
 ARIMA(5,0,0)(0,0,0)[0]             : AIC=7639.764, Time=0.11 sec
 ARIMA(5,0,0)(0,0,0)[0] intercept   : AIC=7603.639, Time=0.11 sec
 ARIMA(4,0,0)(0,0,0)[0] intercept   : AIC=7601.648, Time=0.09 sec
 ARIMA(3,0,0)(0,0,0)[0] intercept   : AIC=7606.573, Time=0.07 sec

Best model:  ARIMA(4,0,0)(0,0,0)[0] intercept
Total fit time: 0.594 seconds
                               SARIMAX Results                                
==============================================================================
Dep. Variable:                      y   No. Observations:                  444
Model:               SARIMAX(4, 0, 0)   Log Likelihood               -3794.824
Date:                Wed, 04 Oct 2023   AIC                           7601.648
Time:                        10:10:48   BIC                           7626.223
Sample:                             0   HQIC                          7611.340
                                - 444                                         
Covariance Type:                  opg                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
intercept   1414.4895    230.488      6.137      0.000     962.742    1866.237
ar.L1          1.3864      0.050     27.656      0.000       1.288       1.485
ar.L2         -0.8359      0.083    -10.109      0.000      -0.998      -0.674
ar.L3          0.1300      0.085      1.529      0.126      -0.037       0.297
ar.L4          0.1242      0.049      2.547      0.011       0.029       0.220
sigma2      1.555e+06      0.009   1.64e+08      0.000    1.56e+06    1.56e+06
===================================================================================
Ljung-Box (L1) (Q):                   0.00   Jarque-Bera (JB):                 9.27
Prob(Q):                              0.96   Prob(JB):                         0.01
Heteroskedasticity (H):               1.16   Skew:                            -0.35
Prob(H) (two-sided):                  0.36   Kurtosis:                         2.91
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
[2] Covariance matrix is singular or near-singular, with condition number 7.88e+25. Standard errors may be unstable.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">orden_ar</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fit model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">orden_ar</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="c1"># summary of fit model</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
<span class="c1"># line plot of residuals</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">model_fit</span><span class="o">.</span><span class="n">resid</span><span class="p">)</span>
<span class="n">residuals</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># density plot of residuals</span>
<span class="n">residuals</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># summary stats of residuals</span>
<span class="nb">print</span><span class="p">(</span><span class="n">residuals</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                               SARIMAX Results                                
==============================================================================
Dep. Variable:                      y   No. Observations:                  355
Model:                 ARIMA(5, 0, 0)   Log Likelihood               -3036.744
Date:                Wed, 04 Oct 2023   AIC                           6087.488
Time:                        10:10:48   BIC                           6114.593
Sample:                             0   HQIC                          6098.271
                                - 355                                         
Covariance Type:                  opg                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const       7413.0301    367.764     20.157      0.000    6692.227    8133.834
ar.L1          1.4205      0.057     24.728      0.000       1.308       1.533
ar.L2         -0.8886      0.095     -9.400      0.000      -1.074      -0.703
ar.L3          0.1636      0.107      1.530      0.126      -0.046       0.373
ar.L4          0.1146      0.104      1.099      0.272      -0.090       0.319
ar.L5         -0.0103      0.065     -0.158      0.875      -0.138       0.117
sigma2      1.576e+06   1.33e+05     11.854      0.000    1.32e+06    1.84e+06
===================================================================================
Ljung-Box (L1) (Q):                   0.00   Jarque-Bera (JB):                 6.01
Prob(Q):                              0.98   Prob(JB):                         0.05
Heteroskedasticity (H):               1.31   Skew:                            -0.31
Prob(H) (two-sided):                  0.14   Kurtosis:                         2.87
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
</pre></div>
</div>
<img alt="../_images/cf40e5c061452b1eeb7b104b2f5aa00e315f9ce809dafa55d18ce3275642360e.png" src="../_images/cf40e5c061452b1eeb7b104b2f5aa00e315f9ce809dafa55d18ce3275642360e.png" />
<img alt="../_images/d7c2763d1dcde8eef74f91e82d59ae9291ecc4e4ba67a911af368ffbf0961f31.png" src="../_images/d7c2763d1dcde8eef74f91e82d59ae9291ecc4e4ba67a911af368ffbf0961f31.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                 0
count   355.000000
mean     -5.996724
std    1254.328712
min   -3866.216294
25%    -843.690612
50%      66.530667
75%     869.953976
max    3390.829384
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">residuales</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">orden_ar</span><span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="n">predictions_AR</span><span class="p">,</span> <span class="n">residuales_AR</span> <span class="o">=</span> <span class="n">ARIMA_estimador</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">,</span> <span class="n">orden_ar</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/560ffb1c1765269a5671b1bfc254d30961bdce391af3f17bb96486d4fee87b31.png" src="../_images/560ffb1c1765269a5671b1bfc254d30961bdce391af3f17bb96486d4fee87b31.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test RMSE: 1216.840
</pre></div>
</div>
<img alt="../_images/afb722f2ca7e75edbebc5b1d0c77fc713467364e26a837b034d6b6c45da49b0d.png" src="../_images/afb722f2ca7e75edbebc5b1d0c77fc713467364e26a837b034d6b6c45da49b0d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions_AR</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1216.84
MAE: 968.17
RRMSE: 0.19
R-squared (R^2): 0.70
NSE (Nash-Sutcliffe Efficiency): 0.70
</pre></div>
</div>
</div>
</div>
</section>
<section id="arma">
<h3>ARMA<a class="headerlink" href="#arma" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pmdarima</span> <span class="k">as</span> <span class="nn">pm</span>

<span class="n">model_1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">auto_arima</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">start_p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">start_q</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">test</span><span class="o">=</span><span class="s1">&#39;adf&#39;</span><span class="p">,</span>
                      <span class="n">max_p</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_q</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                      <span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">d</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">seasonal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">start_P</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">D</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">trace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">error_action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span>
                      <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">stepwise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">model_1</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Performing stepwise search to minimize aic
 ARIMA(1,0,1)(0,0,0)[0]             : AIC=7727.800, Time=0.05 sec
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> ARIMA(0,0,0)(0,0,0)[0]             : AIC=9208.012, Time=0.01 sec
 ARIMA(1,0,0)(0,0,0)[0]             : AIC=7865.329, Time=0.02 sec
 ARIMA(0,0,1)(0,0,0)[0]             : AIC=inf, Time=0.08 sec
 ARIMA(2,0,1)(0,0,0)[0]             : AIC=7724.921, Time=0.15 sec
 ARIMA(2,0,0)(0,0,0)[0]             : AIC=7777.791, Time=0.03 sec
 ARIMA(3,0,1)(0,0,0)[0]             : AIC=7640.387, Time=0.24 sec
 ARIMA(3,0,0)(0,0,0)[0]             : AIC=7662.598, Time=0.06 sec
 ARIMA(4,0,1)(0,0,0)[0]             : AIC=7641.410, Time=0.17 sec
 ARIMA(3,0,2)(0,0,0)[0]             : AIC=7604.934, Time=0.48 sec
 ARIMA(2,0,2)(0,0,0)[0]             : AIC=inf, Time=0.39 sec
 ARIMA(4,0,2)(0,0,0)[0]             : AIC=inf, Time=0.63 sec
 ARIMA(3,0,3)(0,0,0)[0]             : AIC=7555.354, Time=0.54 sec
 ARIMA(2,0,3)(0,0,0)[0]             : AIC=inf, Time=0.42 sec
 ARIMA(4,0,3)(0,0,0)[0]             : AIC=7557.681, Time=0.55 sec
 ARIMA(3,0,4)(0,0,0)[0]             : AIC=7560.305, Time=0.66 sec
 ARIMA(2,0,4)(0,0,0)[0]             : AIC=inf, Time=0.43 sec
 ARIMA(4,0,4)(0,0,0)[0]             : AIC=7526.204, Time=0.76 sec
 ARIMA(5,0,4)(0,0,0)[0]             : AIC=inf, Time=0.84 sec
 ARIMA(4,0,5)(0,0,0)[0]             : AIC=7516.154, Time=0.84 sec
 ARIMA(3,0,5)(0,0,0)[0]             : AIC=7556.109, Time=0.77 sec
 ARIMA(5,0,5)(0,0,0)[0]             : AIC=inf, Time=0.85 sec
 ARIMA(4,0,5)(0,0,0)[0] intercept   : AIC=7476.958, Time=0.97 sec
 ARIMA(3,0,5)(0,0,0)[0] intercept   : AIC=7519.091, Time=0.89 sec
 ARIMA(4,0,4)(0,0,0)[0] intercept   : AIC=7513.379, Time=0.78 sec
 ARIMA(5,0,5)(0,0,0)[0] intercept   : AIC=7490.555, Time=1.00 sec
 ARIMA(3,0,4)(0,0,0)[0] intercept   : AIC=7503.175, Time=0.71 sec
 ARIMA(5,0,4)(0,0,0)[0] intercept   : AIC=7500.473, Time=0.85 sec

Best model:  ARIMA(4,0,5)(0,0,0)[0] intercept
Total fit time: 14.193 seconds
                               SARIMAX Results                                
==============================================================================
Dep. Variable:                      y   No. Observations:                  444
Model:               SARIMAX(4, 0, 5)   Log Likelihood               -3727.479
Date:                Wed, 04 Oct 2023   AIC                           7476.958
Time:                        10:11:19   BIC                           7522.012
Sample:                             0   HQIC                          7494.726
                                - 444                                         
Covariance Type:                  opg                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
intercept   1859.5711    237.672      7.824      0.000    1393.742    2325.400
ar.L1          2.4839      0.076     32.829      0.000       2.336       2.632
ar.L2         -3.2187      0.133    -24.248      0.000      -3.479      -2.959
ar.L3          2.2184      0.133     16.723      0.000       1.958       2.478
ar.L4         -0.7365      0.059    -12.439      0.000      -0.853      -0.620
ma.L1         -1.3457      0.089    -15.198      0.000      -1.519      -1.172
ma.L2          1.2681      0.100     12.668      0.000       1.072       1.464
ma.L3          0.0281      0.126      0.224      0.823      -0.218       0.274
ma.L4         -0.3528      0.086     -4.116      0.000      -0.521      -0.185
ma.L5          0.3390      0.063      5.376      0.000       0.215       0.463
sigma2      1.163e+06      0.067   1.73e+07      0.000    1.16e+06    1.16e+06
===================================================================================
Ljung-Box (L1) (Q):                   2.18   Jarque-Bera (JB):                 1.48
Prob(Q):                              0.14   Prob(JB):                         0.48
Heteroskedasticity (H):               1.37   Skew:                            -0.10
Prob(H) (two-sided):                  0.05   Kurtosis:                         3.19
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
[2] Covariance matrix is singular or near-singular, with condition number 1.52e+23. Standard errors may be unstable.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">orden_arma</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fit model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">orden_arma</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="c1"># summary of fit model</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
<span class="c1"># line plot of residuals</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">model_fit</span><span class="o">.</span><span class="n">resid</span><span class="p">)</span>
<span class="n">residuals</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># density plot of residuals</span>
<span class="n">residuals</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># summary stats of residuals</span>
<span class="nb">print</span><span class="p">(</span><span class="n">residuals</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                               SARIMAX Results                                
==============================================================================
Dep. Variable:                      y   No. Observations:                  355
Model:                 ARIMA(3, 0, 3)   Log Likelihood               -2997.923
Date:                Wed, 04 Oct 2023   AIC                           6011.846
Time:                        10:11:20   BIC                           6042.823
Sample:                             0   HQIC                          6024.169
                                - 355                                         
Covariance Type:                  opg                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const       7413.0298    502.706     14.746      0.000    6427.744    8398.316
ar.L1          1.7701      0.048     36.754      0.000       1.676       1.864
ar.L2         -1.7616      0.050    -35.102      0.000      -1.860      -1.663
ar.L3          0.7713      0.047     16.477      0.000       0.680       0.863
ma.L1         -0.4861      0.064     -7.602      0.000      -0.611      -0.361
ma.L2          0.5243      0.059      8.883      0.000       0.409       0.640
ma.L3          0.4209      0.063      6.685      0.000       0.297       0.544
sigma2      1.406e+06      0.263   5.35e+06      0.000    1.41e+06    1.41e+06
===================================================================================
Ljung-Box (L1) (Q):                   0.63   Jarque-Bera (JB):                 9.29
Prob(Q):                              0.43   Prob(JB):                         0.01
Heteroskedasticity (H):               1.17   Skew:                            -0.35
Prob(H) (two-sided):                  0.39   Kurtosis:                         3.37
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
[2] Covariance matrix is singular or near-singular, with condition number 1.72e+22. Standard errors may be unstable.
</pre></div>
</div>
<img alt="../_images/8a20c0d5751f5689a7ae20c67d696cd87168420d24470435f9f86f764c29780d.png" src="../_images/8a20c0d5751f5689a7ae20c67d696cd87168420d24470435f9f86f764c29780d.png" />
<img alt="../_images/406dae4701bfbf3c1f533f21ccefdd407a7969703e3af28a841d1b4d94977ede.png" src="../_images/406dae4701bfbf3c1f533f21ccefdd407a7969703e3af28a841d1b4d94977ede.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                 0
count   355.000000
mean     -4.073299
std    1120.852946
min   -3569.044814
25%    -725.947060
50%     125.712727
75%     716.186546
max    2872.423936
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie_ARIMA</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Flow</th>
      <th>Mes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7046.387097</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5769.344828</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5016.483871</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4613.266667</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6783.838710</td>
      <td>5</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>439</th>
      <td>7277.535484</td>
      <td>440</td>
    </tr>
    <tr>
      <th>440</th>
      <td>8679.066667</td>
      <td>441</td>
    </tr>
    <tr>
      <th>441</th>
      <td>9349.567742</td>
      <td>442</td>
    </tr>
    <tr>
      <th>442</th>
      <td>9804.350000</td>
      <td>443</td>
    </tr>
    <tr>
      <th>443</th>
      <td>10353.732258</td>
      <td>444</td>
    </tr>
  </tbody>
</table>
<p>444 rows × 2 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictions_ARMA</span><span class="p">,</span> <span class="n">residuales_ARMA</span> <span class="o">=</span> <span class="n">ARIMA_estimador</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">,</span> <span class="n">orden_arma</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/e1434c32d5eef2848b18d4c91fff409a4d748dff9e4c3e2758faa648a4c355e6.png" src="../_images/e1434c32d5eef2848b18d4c91fff409a4d748dff9e4c3e2758faa648a4c355e6.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test RMSE: 1105.741
</pre></div>
</div>
<img alt="../_images/147c47b0ff0ae4aad43c1c42090d0c355645c62e046c81694ae22b05bc73c99b.png" src="../_images/147c47b0ff0ae4aad43c1c42090d0c355645c62e046c81694ae22b05bc73c99b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions_ARMA</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1105.74
MAE: 857.58
RRMSE: 0.17
R-squared (R^2): 0.75
NSE (Nash-Sutcliffe Efficiency): 0.75
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="ridge">
<h2>Ridge<a class="headerlink" href="#ridge" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>

<span class="n">alpha_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>  <span class="c1"># Generates values from 1e-6 to 1e6 with 13 points</span>

<span class="c1"># Definir el conjunto de hiperparámetros para la búsqueda en cuadrícula</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ridge__alpha&#39;</span><span class="p">:</span> <span class="n">alpha_values</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Crear el pipeline con MinMaxScaler y Ridge</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">(),</span> <span class="n">Ridge</span><span class="p">())</span>

<span class="c1"># Realizar la búsqueda en cuadrícula</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#39;minmaxscaler&#39;, MinMaxScaler()),
                                       (&#39;ridge&#39;, Ridge())]),
             n_jobs=-1,
             param_grid={&#39;ridge__alpha&#39;: array([ 0.1       ,  0.10476158,  0.10974988,  0.1149757 ,  0.12045035,
        0.12618569,  0.13219411,  0.13848864,  0.14508288,  0.15199111,
        0.15922828,  0.16681005,  0.17475284,  0.18307383,  0.19179103,
        0.2009233 ,  0.21049041,  0.22051307,  0.23101297,  0.24201283...
        2.05651231,  2.15443469,  2.25701972,  2.36448941,  2.47707636,
        2.59502421,  2.71858824,  2.84803587,  2.98364724,  3.12571585,
        3.27454916,  3.43046929,  3.59381366,  3.76493581,  3.94420606,
        4.1320124 ,  4.32876128,  4.53487851,  4.75081016,  4.97702356,
        5.21400829,  5.46227722,  5.72236766,  5.9948425 ,  6.28029144,
        6.57933225,  6.8926121 ,  7.22080902,  7.56463328,  7.92482898,
        8.30217568,  8.69749003,  9.11162756,  9.54548457, 10.        ])},
             scoring=&#39;r2&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;minmaxscaler&#39;, MinMaxScaler()),
                (&#39;ridge&#39;, Ridge(alpha=0.30538555088334157))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>

<span class="c1"># Calculo de Metricas</span>

<span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training-set score: 0.64
Test-set score: 0.59
RMSE: 1422.57
MAE: 1131.05
RRMSE: 0.22
R-squared (R^2): 0.59
NSE (Nash-Sutcliffe Efficiency): 0.59
</pre></div>
</div>
</div>
</div>
</section>
<section id="lasso">
<h2>Lasso<a class="headerlink" href="#lasso" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Lasso</span>


<span class="c1"># Definir el conjunto de hiperparámetros para la búsqueda en cuadrícula</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;lasso__alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span>
<span class="p">}</span>

<span class="c1"># Crear el pipeline con MinMaxScaler y Lasso</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">(),</span> <span class="n">Lasso</span><span class="p">())</span>

<span class="c1"># Realizar la búsqueda en cuadrícula</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#39;minmaxscaler&#39;, MinMaxScaler()),
                                       (&#39;lasso&#39;, Lasso())]),
             n_jobs=-1, param_grid={&#39;lasso__alpha&#39;: [0.1, 1.0, 10.0]},
             scoring=&#39;r2&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;minmaxscaler&#39;, MinMaxScaler()), (&#39;lasso&#39;, Lasso(alpha=0.1))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>

<span class="c1"># Calculo de Metricas</span>

<span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training-set score: 0.64
Test-set score: 0.59
RMSE: 1424.01
MAE: 1130.71
RRMSE: 0.22
R-squared (R^2): 0.59
NSE (Nash-Sutcliffe Efficiency): 0.59
</pre></div>
</div>
</div>
</div>
</section>
<section id="random-forest">
<h2>Random Forest<a class="headerlink" href="#random-forest" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">RandomForestRegressor</span><span class="p">())</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;randomforestregressor__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">400</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__max_leaf_nodes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__min_samples_split&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">]}</span>

<span class="n">RF</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">RF</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                                       (&#39;randomforestregressor&#39;,
                                        RandomForestRegressor())]),
             n_jobs=-1,
             param_grid={&#39;randomforestregressor__max_depth&#39;: [2, 3, 4],
                         &#39;randomforestregressor__max_leaf_nodes&#39;: [2, 4, 6, 8],
                         &#39;randomforestregressor__min_samples_split&#39;: [2, 5, 10,
                                                                      15],
                         &#39;randomforestregressor__n_estimators&#39;: [400]},
             scoring=&#39;r2&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                (&#39;randomforestregressor&#39;,
                 RandomForestRegressor(max_depth=3, max_leaf_nodes=8,
                                       min_samples_split=10,
                                       n_estimators=400))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training-set score: 0.68
Test-set score: 0.53
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_RF_train</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">-</span><span class="n">RF</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">RF</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">res_RF_test</span><span class="o">=</span> <span class="n">y_test</span><span class="o">-</span><span class="n">y_pred</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_tree</span> <span class="o">=</span> <span class="n">RF</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_all</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">data_train</span><span class="o">.</span><span class="n">Mes</span><span class="p">,</span> <span class="n">data_train</span><span class="o">.</span><span class="n">Flow</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Training data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">data_test</span><span class="o">.</span><span class="n">Mes</span><span class="p">,</span> <span class="n">data_test</span><span class="o">.</span><span class="n">Flow</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">serie</span><span class="o">.</span><span class="n">Mes</span><span class="p">,</span> <span class="n">y_tree</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Tree prediction&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/08d40a29f90b386930e84328ec10768aee6ae124b5dded6288b419ae8ca0bbd6.png" src="../_images/08d40a29f90b386930e84328ec10768aee6ae124b5dded6288b419ae8ca0bbd6.png" />
</div>
</div>
<section id="id1">
<h3>Metricas<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculo de Metricas</span>

<span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1517.53
MAE: 1175.72
RRMSE: 0.23
R-squared (R^2): 0.53
NSE (Nash-Sutcliffe Efficiency): 0.53
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_test</span><span class="o">.</span><span class="n">Mes</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_test</span><span class="o">.</span><span class="n">Mes</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;RF&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">data_test</span><span class="o">.</span><span class="n">Mes</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">data_test</span><span class="o">.</span><span class="n">Mes</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4339c0df00ab547ab3a99ddb964fbaea332f045958f6e74a25b8d266e60e7e20.png" src="../_images/4339c0df00ab547ab3a99ddb964fbaea332f045958f6e74a25b8d266e60e7e20.png" />
</div>
</div>
</section>
</section>
<section id="k-nn-regresor">
<h2>k-NN regresor<a class="headerlink" href="#k-nn-regresor" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>  
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">neighbors</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_log_error</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">explained_variance_score</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">KNeighborsRegressor</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;kneighborsregressor__n_neighbors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">]}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                                       (&#39;kneighborsregressor&#39;,
                                        KNeighborsRegressor())]),
             param_grid={&#39;kneighborsregressor__n_neighbors&#39;: [1, 2, 4, 6, 8, 10,
                                                              15, 20, 30, 40]},
             scoring=&#39;r2&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                (&#39;kneighborsregressor&#39;, KNeighborsRegressor(n_neighbors=15))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training-set score: 0.66
Test-set score: 0.53
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculo de Metricas</span>

<span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1514.89
MAE: 1174.65
RRMSE: 0.23
R-squared (R^2): 0.53
NSE (Nash-Sutcliffe Efficiency): 0.53
</pre></div>
</div>
</div>
</div>
</section>
<section id="svr">
<h2>SVR<a class="headerlink" href="#svr" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;svr__kernel&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;rbf&#39;</span><span class="p">],</span>
    <span class="s1">&#39;svr__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
    <span class="s1">&#39;svr__epsilon&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">(),</span> <span class="n">SVR</span><span class="p">())</span>

<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#39;minmaxscaler&#39;, MinMaxScaler()),
                                       (&#39;svr&#39;, SVR())]),
             n_jobs=-1,
             param_grid={&#39;svr__C&#39;: [0.001, 0.01, 0.1, 1, 10, 100],
                         &#39;svr__epsilon&#39;: [0.001, 0.01, 0.1, 0.2, 0.5, 1],
                         &#39;svr__kernel&#39;: [&#39;linear&#39;, &#39;rbf&#39;]},
             scoring=&#39;r2&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;minmaxscaler&#39;, MinMaxScaler()),
                (&#39;svr&#39;, SVR(C=100, epsilon=0.001))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculo de Metricas</span>

<span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1624.98
MAE: 1303.93
RRMSE: 0.25
R-squared (R^2): 0.46
NSE (Nash-Sutcliffe Efficiency): 0.46
</pre></div>
</div>
</div>
</div>
</section>
<section id="redes-neuronales">
<h2>Redes Neuronales<a class="headerlink" href="#redes-neuronales" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">TransformedTargetRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.optimizers</span> <span class="kn">import</span> <span class="n">Adam</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>
<span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">load_model</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define el callback EarlyStopping</span>
<span class="n">early_stopping</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define el modelo de red neuronal</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Compila el modelo</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">)</span>

<span class="n">indice</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.8</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">))</span>

<span class="n">X_trainval</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[:</span><span class="n">indice</span><span class="p">]</span>
<span class="n">y_trainval</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[:</span><span class="n">indice</span><span class="p">]</span>
<span class="n">X_val</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">indice</span><span class="p">:]</span>
<span class="n">y_val</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="n">indice</span><span class="p">:]</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>


<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainval</span><span class="p">,</span> <span class="n">y_trainval</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                        <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">),</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">early_stopping</span><span class="p">])</span>

<span class="c1"># Define el pipeline con transformador de escala y modelo</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
<span class="p">])</span>


<span class="c1"># Evalúa el modelo en datos de prueba</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>


<span class="c1"># Grafica los resultados</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos reales&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicciones&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/200
3/3 [==============================] - 1s 66ms/step - loss: 48913872.0000 - val_loss: 58421796.0000
Epoch 2/200
3/3 [==============================] - 0s 14ms/step - loss: 38823312.0000 - val_loss: 44610068.0000
Epoch 3/200
3/3 [==============================] - 0s 17ms/step - loss: 29216994.0000 - val_loss: 31271680.0000
Epoch 4/200
3/3 [==============================] - 0s 14ms/step - loss: 20246678.0000 - val_loss: 19174994.0000
Epoch 5/200
3/3 [==============================] - 0s 16ms/step - loss: 12159398.0000 - val_loss: 9666562.0000
Epoch 6/200
3/3 [==============================] - 0s 14ms/step - loss: 6172211.0000 - val_loss: 4302165.5000
Epoch 7/200
3/3 [==============================] - 0s 14ms/step - loss: 3232517.2500 - val_loss: 3782894.7500
Epoch 8/200
3/3 [==============================] - 0s 15ms/step - loss: 3253041.7500 - val_loss: 5827627.0000
Epoch 9/200
3/3 [==============================] - 0s 12ms/step - loss: 4685014.5000 - val_loss: 6890366.0000
Epoch 10/200
3/3 [==============================] - 0s 13ms/step - loss: 5080949.0000 - val_loss: 5864102.5000
Epoch 11/200
1/3 [=========&gt;....................] - ETA: 0s - loss: 3889228.5000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3/3 [==============================] - 0s 14ms/step - loss: 4173153.7500 - val_loss: 4272778.0000
Epoch 12/200
3/3 [==============================] - 0s 15ms/step - loss: 3184655.5000 - val_loss: 3510447.2500
Epoch 13/200
3/3 [==============================] - 0s 14ms/step - loss: 2847797.7500 - val_loss: 3606377.5000
Epoch 14/200
3/3 [==============================] - 0s 14ms/step - loss: 2982999.5000 - val_loss: 3941065.0000
Epoch 15/200
3/3 [==============================] - 0s 25ms/step - loss: 3189583.0000 - val_loss: 4047552.0000
Epoch 16/200
3/3 [==============================] - 0s 19ms/step - loss: 3210101.2500 - val_loss: 3864025.2500
Epoch 17/200
3/3 [==============================] - 0s 12ms/step - loss: 3067441.0000 - val_loss: 3595466.0000
Epoch 18/200
3/3 [==============================] - 0s 12ms/step - loss: 2887278.7500 - val_loss: 3477968.7500
Epoch 19/200
3/3 [==============================] - 0s 12ms/step - loss: 2832053.5000 - val_loss: 3500604.7500
Epoch 20/200
3/3 [==============================] - 0s 13ms/step - loss: 2846294.7500 - val_loss: 3556143.5000
Epoch 21/200
3/3 [==============================] - 0s 13ms/step - loss: 2882282.2500 - val_loss: 3554018.2500
Epoch 22/200
3/3 [==============================] - 0s 14ms/step - loss: 2866209.7500 - val_loss: 3496163.5000
Epoch 23/200
3/3 [==============================] - 0s 16ms/step - loss: 2835516.5000 - val_loss: 3473385.7500
Epoch 24/200
3/3 [==============================] - 0s 13ms/step - loss: 2837047.0000 - val_loss: 3491290.0000
Epoch 25/200
3/3 [==============================] - 0s 13ms/step - loss: 2837543.0000 - val_loss: 3509393.7500
Epoch 26/200
3/3 [==============================] - 0s 13ms/step - loss: 2856990.0000 - val_loss: 3507917.5000
Epoch 27/200
3/3 [==============================] - 0s 13ms/step - loss: 2844321.0000 - val_loss: 3481724.5000
Epoch 28/200
3/3 [==============================] - 0s 17ms/step - loss: 2832011.0000 - val_loss: 3474127.2500
Epoch 29/200
3/3 [==============================] - 0s 15ms/step - loss: 2827495.0000 - val_loss: 3489321.7500
Epoch 30/200
3/3 [==============================] - 0s 13ms/step - loss: 2834416.7500 - val_loss: 3502157.7500
Epoch 31/200
3/3 [==============================] - 0s 14ms/step - loss: 2843869.2500 - val_loss: 3492199.2500
Epoch 32/200
3/3 [==============================] - 0s 13ms/step - loss: 2835568.0000 - val_loss: 3473521.7500
Epoch 33/200
3/3 [==============================] - 0s 13ms/step - loss: 2826364.7500 - val_loss: 3477221.2500
3/3 [==============================] - 0s 1ms/step
</pre></div>
</div>
<img alt="../_images/f49e2ef40e49edc2470f3a12f36efe948696a3cd577f8ae46584cf70b66f2bc1.png" src="../_images/f49e2ef40e49edc2470f3a12f36efe948696a3cd577f8ae46584cf70b66f2bc1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 6474.7046],
       [ 5418.282 ],
       [ 7175.731 ],
       [ 7644.2515],
       [ 8310.623 ],
       [ 8186.2217],
       [ 5644.778 ],
       [ 3672.1523],
       [ 4431.8745],
       [ 3968.4912],
       [ 6305.4146],
       [ 6473.0645],
       [ 4619.563 ],
       [ 4087.2664],
       [ 5350.793 ],
       [ 6854.216 ],
       [ 8102.642 ],
       [ 8253.836 ],
       [ 4461.773 ],
       [ 3885.069 ],
       [ 3309.9644],
       [ 4749.325 ],
       [ 4963.4556],
       [ 5749.248 ],
       [ 4227.2603],
       [ 4018.7798],
       [ 4279.035 ],
       [ 4229.514 ],
       [ 5650.164 ],
       [ 4327.8794],
       [ 2618.9004],
       [ 2413.7605],
       [ 2606.897 ],
       [ 3281.2634],
       [ 5241.5615],
       [ 5774.298 ],
       [ 5183.414 ],
       [ 5306.5923],
       [ 5968.573 ],
       [ 7064.945 ],
       [ 8864.442 ],
       [ 9902.019 ],
       [ 8460.561 ],
       [ 4945.1587],
       [ 4623.4624],
       [ 6620.6724],
       [ 8188.8223],
       [10152.13  ],
       [10467.647 ],
       [ 8869.452 ],
       [ 8517.142 ],
       [ 8825.258 ],
       [ 8965.366 ],
       [ 9412.199 ],
       [ 8013.069 ],
       [ 4775.291 ],
       [ 3799.3843],
       [ 5918.522 ],
       [ 7696.7456],
       [ 9539.483 ],
       [ 8409.817 ],
       [ 6656.1934],
       [ 6492.314 ],
       [ 8331.983 ],
       [ 9877.489 ],
       [ 9266.953 ],
       [ 4194.789 ],
       [ 3205.6497],
       [ 3851.0586],
       [ 5689.375 ],
       [ 6748.169 ],
       [ 8782.264 ],
       [ 7641.8115],
       [ 5797.2114],
       [ 5086.096 ],
       [ 7279.2197],
       [ 9029.681 ],
       [ 8313.006 ],
       [ 5083.318 ],
       [ 3148.1768],
       [ 3219.9312],
       [ 3551.2874],
       [ 4011.5005],
       [ 5464.59  ],
       [ 6803.9395],
       [ 7086.4585],
       [ 8451.124 ],
       [ 9103.995 ],
       [ 9546.814 ]], dtype=float32)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1543.38
MAE: 1244.66
RRMSE: 0.47
R-squared (R^2): 0.51
NSE (Nash-Sutcliffe Efficiency): -170.24
</pre></div>
</div>
</div>
</div>
</section>
<section id="modelo-hibrido">
<h2>Modelo Hibrido<a class="headerlink" href="#modelo-hibrido" title="Permalink to this heading">#</a></h2>
<section id="random-forest-con-modelos-lineales">
<h3>Random Forest con modelos lineales<a class="headerlink" href="#random-forest-con-modelos-lineales" title="Permalink to this heading">#</a></h3>
<p>Entre los modelos lineales se encuentran: autoregressive (AR), moving average (MA), and autoregressive moving average (ARMA)</p>
<p>Para medir el rendimiento de todos los modelos desarrollados de manera cualitativa, los valores de RRMSE (Error Cuadrático Medio Raíz Relativo) se categorizaron de la siguiente manera:</p>
<ul class="simple">
<li><p>Excelente: 0% &lt; RRMSE &lt; 10%</p></li>
<li><p>Bueno: 10% &lt; RRMSE &lt; 20%</p></li>
<li><p>Regular: 20% &lt; RRMSE &lt; 30%</p></li>
<li><p>Malo: RRMSE &gt; 30%</p></li>
</ul>
</section>
<section id="ar-rf">
<h3>AR-RF<a class="headerlink" href="#ar-rf" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">residuales_test_lag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#residuales_test_extra = np.column_stack((residuales_test_lag, X_test[:, 1]))</span>
<span class="n">residuales_test_extra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="n">residuales_test_lag</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="c1">#plt.plot(data_test.Mes, y_pred, label=&quot;RF&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Caudal (m3/s)&#39;)
</pre></div>
</div>
<img alt="../_images/2c647242ef19397c30621fbeda30722e7be13b6d28c54f06c0be42c10d4b22b9.png" src="../_images/2c647242ef19397c30621fbeda30722e7be13b6d28c54f06c0be42c10d4b22b9.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_order</span> <span class="o">=</span> <span class="n">orden_ar</span>
<span class="n">history</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">train</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">residuals_train</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">resid</span>

<span class="n">residuales_train_lag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#residuales_train_extra = residuales_train_lag</span>
<span class="n">residuales_train_extra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">residuales_train_lag</span><span class="p">,</span> <span class="n">X_train</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 7.49038700e+03, -9.00000000e-01],
       [ 7.04638710e+03, -6.00000000e-01],
       [ 5.76934483e+03, -4.00000000e-01],
       [ 5.01648387e+03, -3.00000000e-01],
       [ 4.61326667e+03, -4.00000000e-01],
       [ 6.78383871e+03, -5.00000000e-01],
       [ 9.16430000e+03, -4.00000000e-01],
       [ 1.04028065e+04, -3.00000000e-01],
       [ 1.04148065e+04, -2.00000000e-01],
       [ 1.01124667e+04, -2.00000000e-01],
       [ 1.12975484e+04, -6.00000000e-01],
       [ 1.27622333e+04, -9.00000000e-01],
       [ 1.25075484e+04, -1.10000000e+00],
       [ 7.95409677e+03, -1.00000000e+00],
       [ 3.91685714e+03, -8.00000000e-01],
       [ 3.00100000e+03, -8.00000000e-01],
       [ 3.97440000e+03, -8.00000000e-01],
       [ 5.52129032e+03, -8.00000000e-01],
       [ 6.20606667e+03, -6.00000000e-01],
       [ 4.73029032e+03, -5.00000000e-01],
       [ 6.05835484e+03, -5.00000000e-01],
       [ 7.84180000e+03, -4.00000000e-01],
       [ 9.08690323e+03, -3.00000000e-01],
       [ 9.90666667e+03, -3.00000000e-01],
       [ 9.75325806e+03, -4.00000000e-01],
       [ 6.52548387e+03, -5.00000000e-01],
       [ 5.09717857e+03, -5.00000000e-01],
       [ 5.66748387e+03, -3.00000000e-01],
       [ 6.55200000e+03, -2.00000000e-01],
       [ 8.34709677e+03, -1.00000000e-01],
       [ 9.22853333e+03,  0.00000000e+00],
       [ 8.71706452e+03,  2.00000000e-01],
       [ 6.20522581e+03,  4.00000000e-01],
       [ 6.18996667e+03,  7.00000000e-01],
       [ 8.39074194e+03,  9.00000000e-01],
       [ 1.06275333e+04,  1.10000000e+00],
       [ 9.59354839e+03,  1.20000000e+00],
       [ 5.07500000e+03,  1.20000000e+00],
       [ 4.22164286e+03,  1.20000000e+00],
       [ 4.11390323e+03,  1.10000000e+00],
       [ 4.45050000e+03,  9.00000000e-01],
       [ 6.14919355e+03,  1.00000000e+00],
       [ 6.98206667e+03,  1.20000000e+00],
       [ 5.94500000e+03,  1.50000000e+00],
       [ 7.56383871e+03,  1.70000000e+00],
       [ 7.65320000e+03,  1.60000000e+00],
       [ 8.92225806e+03,  1.50000000e+00],
       [ 1.10862000e+04,  1.30000000e+00],
       [ 1.11318710e+04,  1.10000000e+00],
       [ 6.51670968e+03,  8.00000000e-01],
       [ 4.39441379e+03,  5.00000000e-01],
       [ 4.15222581e+03,  1.00000000e-01],
       [ 4.69490000e+03, -3.00000000e-01],
       [ 5.72529032e+03, -9.00000000e-01],
       [ 6.41570000e+03, -1.30000000e+00],
       [ 8.63629032e+03, -1.30000000e+00],
       [ 9.66929032e+03, -1.10000000e+00],
       [ 1.15193000e+04, -1.20000000e+00],
       [ 1.28927097e+04, -1.50000000e+00],
       [ 1.31599667e+04, -1.80000000e+00],
       [ 1.35308387e+04, -1.80000000e+00],
       [ 1.15635161e+04, -1.70000000e+00],
       [ 7.22439286e+03, -1.40000000e+00],
       [ 6.12045161e+03, -1.10000000e+00],
       [ 5.86236667e+03, -8.00000000e-01],
       [ 6.46380645e+03, -6.00000000e-01],
       [ 7.54586667e+03, -4.00000000e-01],
       [ 7.21819355e+03, -3.00000000e-01],
       [ 6.88880645e+03, -3.00000000e-01],
       [ 8.29833333e+03, -2.00000000e-01],
       [ 1.05308065e+04, -2.00000000e-01],
       [ 1.20455000e+04, -2.00000000e-01],
       [ 1.07093871e+04, -1.00000000e-01],
       [ 6.67322581e+03,  1.00000000e-01],
       [ 5.05682143e+03,  2.00000000e-01],
       [ 4.68441935e+03,  3.00000000e-01],
       [ 5.27616667e+03,  3.00000000e-01],
       [ 7.40058065e+03,  3.00000000e-01],
       [ 7.70736667e+03,  3.00000000e-01],
       [ 7.09032258e+03,  3.00000000e-01],
       [ 6.33496774e+03,  4.00000000e-01],
       [ 6.60586667e+03,  4.00000000e-01],
       [ 7.99829032e+03,  3.00000000e-01],
       [ 9.89116667e+03,  4.00000000e-01],
       [ 1.01937742e+04,  4.00000000e-01],
       [ 7.04987097e+03,  4.00000000e-01],
       [ 3.69596429e+03,  3.00000000e-01],
       [ 4.15470968e+03,  2.00000000e-01],
       [ 4.84343333e+03,  3.00000000e-01],
       [ 6.41819355e+03,  5.00000000e-01],
       [ 7.13026667e+03,  6.00000000e-01],
       [ 6.73990323e+03,  7.00000000e-01],
       [ 6.34674194e+03,  6.00000000e-01],
       [ 5.39646667e+03,  6.00000000e-01],
       [ 7.76845161e+03,  8.00000000e-01],
       [ 8.24023333e+03,  1.20000000e+00],
       [ 8.43783871e+03,  1.50000000e+00],
       [ 4.55206452e+03,  1.70000000e+00],
       [ 3.06772414e+03,  1.60000000e+00],
       [ 2.88403226e+03,  1.50000000e+00],
       [ 2.84413333e+03,  1.30000000e+00],
       [ 4.61690323e+03,  1.10000000e+00],
       [ 5.50690000e+03,  7.00000000e-01],
       [ 4.89880645e+03,  4.00000000e-01],
       [ 5.71783871e+03,  1.00000000e-01],
       [ 6.07516667e+03, -1.00000000e-01],
       [ 6.90800000e+03, -2.00000000e-01],
       [ 6.91370000e+03, -3.00000000e-01],
       [ 7.09638710e+03, -1.00000000e-01],
       [ 5.11138710e+03,  1.00000000e-01],
       [ 3.85028571e+03,  3.00000000e-01],
       [ 3.58738710e+03,  5.00000000e-01],
       [ 5.26603333e+03,  7.00000000e-01],
       [ 7.41777419e+03,  7.00000000e-01],
       [ 8.56700000e+03,  6.00000000e-01],
       [ 7.77048387e+03,  3.00000000e-01],
       [ 6.27522581e+03,  3.00000000e-01],
       [ 7.23683333e+03,  2.00000000e-01],
       [ 8.26770968e+03,  1.00000000e-01],
       [ 8.98203333e+03,  0.00000000e+00],
       [ 1.00119032e+04,  1.00000000e-01],
       [ 8.04461290e+03,  1.00000000e-01],
       [ 5.15410714e+03,  1.00000000e-01],
       [ 5.14622581e+03,  2.00000000e-01],
       [ 6.45143333e+03,  3.00000000e-01],
       [ 8.07354839e+03,  4.00000000e-01],
       [ 9.08156667e+03,  4.00000000e-01],
       [ 8.37629032e+03,  4.00000000e-01],
       [ 6.86635484e+03,  4.00000000e-01],
       [ 6.57506667e+03,  6.00000000e-01],
       [ 7.92058065e+03,  7.00000000e-01],
       [ 9.54086667e+03,  1.00000000e+00],
       [ 9.94609677e+03,  1.10000000e+00],
       [ 5.24693548e+03,  1.00000000e+00],
       [ 2.53400000e+03,  7.00000000e-01],
       [ 2.62264516e+03,  5.00000000e-01],
       [ 3.68930000e+03,  3.00000000e-01],
       [ 5.82183871e+03,  1.00000000e-01],
       [ 7.23370000e+03,  0.00000000e+00],
       [ 7.74154839e+03, -2.00000000e-01],
       [ 8.85032258e+03, -5.00000000e-01],
       [ 9.49323333e+03, -8.00000000e-01],
       [ 9.16258065e+03, -1.00000000e+00],
       [ 1.05438733e+04, -1.00000000e+00],
       [ 9.34874194e+03, -1.00000000e+00],
       [ 6.82161290e+03, -9.00000000e-01],
       [ 4.98224138e+03, -8.00000000e-01],
       [ 5.88254839e+03, -6.00000000e-01],
       [ 6.62680000e+03, -4.00000000e-01],
       [ 7.20877419e+03, -3.00000000e-01],
       [ 9.22450000e+03, -3.00000000e-01],
       [ 1.10290645e+04, -3.00000000e-01],
       [ 1.11215806e+04, -3.00000000e-01],
       [ 1.02336000e+04, -4.00000000e-01],
       [ 9.89625806e+03, -4.00000000e-01],
       [ 1.05106333e+04, -4.00000000e-01],
       [ 9.40222581e+03, -5.00000000e-01],
       [ 5.69187097e+03, -5.00000000e-01],
       [ 4.93360714e+03, -4.00000000e-01],
       [ 3.68938710e+03, -1.00000000e-01],
       [ 3.70373333e+03,  3.00000000e-01],
       [ 4.58241935e+03,  8.00000000e-01],
       [ 5.43830000e+03,  1.20000000e+00],
       [ 5.06632258e+03,  1.60000000e+00],
       [ 3.72848387e+03,  1.90000000e+00],
       [ 3.66056667e+03,  2.10000000e+00],
       [ 5.03935484e+03,  2.30000000e+00],
       [ 5.66160000e+03,  2.40000000e+00],
       [ 4.81900000e+03,  2.40000000e+00],
       [ 2.62587097e+03,  2.20000000e+00],
       [ 2.74557143e+03,  1.90000000e+00],
       [ 2.53348387e+03,  1.40000000e+00],
       [ 4.12746667e+03,  1.00000000e+00],
       [ 6.51380645e+03,  5.00000000e-01],
       [ 8.00793333e+03, -1.00000000e-01],
       [ 8.63419355e+03, -8.00000000e-01],
       [ 8.30719355e+03, -1.10000000e+00],
       [ 8.48100000e+03, -1.30000000e+00],
       [ 9.30712903e+03, -1.40000000e+00],
       [ 9.98053333e+03, -1.50000000e+00],
       [ 1.10197419e+04, -1.60000000e+00],
       [ 9.84880645e+03, -1.50000000e+00],
       [ 7.31500000e+03, -1.30000000e+00],
       [ 8.07658065e+03, -1.10000000e+00],
       [ 8.43106667e+03, -1.00000000e+00],
       [ 9.33390323e+03, -1.00000000e+00],
       [ 1.03279000e+04, -1.00000000e+00],
       [ 1.09857742e+04, -1.10000000e+00],
       [ 9.73258065e+03, -1.10000000e+00],
       [ 9.59440000e+03, -1.20000000e+00],
       [ 1.14342258e+04, -1.30000000e+00],
       [ 1.33782333e+04, -1.50000000e+00],
       [ 1.30227742e+04, -1.70000000e+00],
       [ 1.08118387e+04, -1.70000000e+00],
       [ 6.09337931e+03, -1.40000000e+00],
       [ 5.97648387e+03, -1.10000000e+00],
       [ 5.62980000e+03, -8.00000000e-01],
       [ 6.92251613e+03, -7.00000000e-01],
       [ 8.97120000e+03, -6.00000000e-01],
       [ 9.57287097e+03, -6.00000000e-01],
       [ 8.56200000e+03, -5.00000000e-01],
       [ 8.57196667e+03, -5.00000000e-01],
       [ 1.02342903e+04, -6.00000000e-01],
       [ 1.05701333e+04, -7.00000000e-01],
       [ 9.16245161e+03, -7.00000000e-01],
       [ 5.23922581e+03, -7.00000000e-01],
       [ 2.96032143e+03, -5.00000000e-01],
       [ 3.28812903e+03, -4.00000000e-01],
       [ 3.76126667e+03, -3.00000000e-01],
       [ 4.55577419e+03, -3.00000000e-01],
       [ 5.87240000e+03, -1.00000000e-01],
       [ 4.88964516e+03, -1.00000000e-01],
       [ 4.29306452e+03, -1.00000000e-01],
       [ 4.58910000e+03, -2.00000000e-01],
       [ 6.22883871e+03, -3.00000000e-01],
       [ 7.73403333e+03, -3.00000000e-01],
       [ 8.53735484e+03, -3.00000000e-01],
       [ 6.71738710e+03, -1.00000000e-01],
       [ 3.32614286e+03,  0.00000000e+00],
       [ 2.89341935e+03,  1.00000000e-01],
       [ 4.51806667e+03,  2.00000000e-01],
       [ 5.95490323e+03,  4.00000000e-01],
       [ 7.58330000e+03,  7.00000000e-01],
       [ 6.75061290e+03,  8.00000000e-01],
       [ 4.44029032e+03,  9.00000000e-01],
       [ 4.58456667e+03,  1.00000000e+00],
       [ 5.09380645e+03,  1.20000000e+00],
       [ 7.59186667e+03,  1.30000000e+00],
       [ 6.22529032e+03,  1.10000000e+00],
       [ 3.52700000e+03,  9.00000000e-01],
       [ 2.51669286e+03,  6.00000000e-01],
       [ 2.68403226e+03,  4.00000000e-01],
       [ 3.81450000e+03,  0.00000000e+00],
       [ 5.95896774e+03, -3.00000000e-01],
       [ 7.15183333e+03, -2.00000000e-01],
       [ 7.71235484e+03,  1.00000000e-01],
       [ 6.91016129e+03,  2.00000000e-01],
       [ 6.13983333e+03,  3.00000000e-01],
       [ 7.89738710e+03,  3.00000000e-01],
       [ 1.00157333e+04,  4.00000000e-01],
       [ 1.11461613e+04,  4.00000000e-01],
       [ 8.35522581e+03,  4.00000000e-01],
       [ 3.72365517e+03,  3.00000000e-01],
       [ 2.91551613e+03,  2.00000000e-01],
       [ 3.60866667e+03,  2.00000000e-01],
       [ 6.01135484e+03,  2.00000000e-01],
       [ 7.55763333e+03,  3.00000000e-01],
       [ 6.19545161e+03,  5.00000000e-01],
       [ 5.94148387e+03,  6.00000000e-01],
       [ 6.27126667e+03,  7.00000000e-01],
       [ 8.04712903e+03,  7.00000000e-01],
       [ 1.01606333e+04,  7.00000000e-01],
       [ 1.11060968e+04,  7.00000000e-01],
       [ 7.07870968e+03,  6.00000000e-01],
       [ 4.56842857e+03,  6.00000000e-01],
       [ 3.83841935e+03,  4.00000000e-01],
       [ 4.44826667e+03,  4.00000000e-01],
       [ 6.62954839e+03,  3.00000000e-01],
       [ 8.43363333e+03,  1.00000000e-01],
       [ 8.27274194e+03, -1.00000000e-01],
       [ 6.66387097e+03, -1.00000000e-01],
       [ 6.31793333e+03, -1.00000000e-01],
       [ 7.51048387e+03, -3.00000000e-01],
       [ 1.00604667e+04, -6.00000000e-01],
       [ 1.26999032e+04, -8.00000000e-01],
       [ 9.20445161e+03, -9.00000000e-01],
       [ 5.53164286e+03, -8.00000000e-01],
       [ 4.32906452e+03, -6.00000000e-01],
       [ 6.29180000e+03, -4.00000000e-01],
       [ 8.75725806e+03, -1.00000000e-01],
       [ 1.10471000e+04,  0.00000000e+00],
       [ 1.01592903e+04,  1.00000000e-01],
       [ 6.98380645e+03,  3.00000000e-01],
       [ 7.05766667e+03,  5.00000000e-01],
       [ 7.21825806e+03,  8.00000000e-01],
       [ 9.11436667e+03,  9.00000000e-01],
       [ 1.05754194e+04,  9.00000000e-01],
       [ 7.90932258e+03,  7.00000000e-01],
       [ 3.75367857e+03,  2.00000000e-01],
       [ 2.91609677e+03, -1.00000000e-01],
       [ 5.65806667e+03, -3.00000000e-01],
       [ 8.44187097e+03, -4.00000000e-01],
       [ 1.12632667e+04, -5.00000000e-01],
       [ 1.10995806e+04, -6.00000000e-01],
       [ 9.30432258e+03, -8.00000000e-01],
       [ 1.04192000e+04, -1.10000000e+00],
       [ 1.04443871e+04, -1.30000000e+00],
       [ 1.31311000e+04, -1.50000000e+00],
       [ 1.25108387e+04, -1.60000000e+00],
       [ 8.93561290e+03, -1.60000000e+00],
       [ 5.44206897e+03, -1.50000000e+00],
       [ 5.42022581e+03, -1.30000000e+00],
       [ 5.67336667e+03, -1.00000000e+00],
       [ 7.71080645e+03, -8.00000000e-01],
       [ 9.97433333e+03, -6.00000000e-01],
       [ 1.15245484e+04, -4.00000000e-01],
       [ 1.19362258e+04, -2.00000000e-01],
       [ 1.21245667e+04, -2.00000000e-01],
       [ 1.20382581e+04, -4.00000000e-01],
       [ 1.33234667e+04, -6.00000000e-01],
       [ 1.44381935e+04, -7.00000000e-01],
       [ 1.02574839e+04, -8.00000000e-01],
       [ 6.77750000e+03, -8.00000000e-01],
       [ 5.64258065e+03, -6.00000000e-01],
       [ 6.94770000e+03, -3.00000000e-01],
       [ 7.84980645e+03,  0.00000000e+00],
       [ 7.78746667e+03,  3.00000000e-01],
       [ 7.40141935e+03,  5.00000000e-01],
       [ 6.03451613e+03,  6.00000000e-01],
       [ 6.08250000e+03,  7.00000000e-01],
       [ 5.28929032e+03,  1.00000000e+00],
       [ 7.12320000e+03,  1.40000000e+00],
       [ 6.16322581e+03,  1.60000000e+00],
       [ 3.44706452e+03,  1.50000000e+00],
       [ 2.57892857e+03,  1.20000000e+00],
       [ 3.22200000e+03,  8.00000000e-01],
       [ 4.54460000e+03,  4.00000000e-01],
       [ 7.18206452e+03, -2.00000000e-01],
       [ 9.27516667e+03, -7.00000000e-01],
       [ 1.09722581e+04, -1.00000000e+00],
       [ 1.27412581e+04, -1.30000000e+00],
       [ 1.28392667e+04, -1.60000000e+00],
       [ 1.36845484e+04, -1.60000000e+00],
       [ 1.37174333e+04, -1.60000000e+00],
       [ 1.39420323e+04, -1.60000000e+00],
       [ 1.14301290e+04, -1.40000000e+00],
       [ 6.72085714e+03, -1.20000000e+00],
       [ 6.59529032e+03, -9.00000000e-01],
       [ 8.27376667e+03, -7.00000000e-01],
       [ 1.19960000e+04, -6.00000000e-01],
       [ 1.28272667e+04, -4.00000000e-01],
       [ 1.12263548e+04, -5.00000000e-01],
       [ 1.01257742e+04, -6.00000000e-01],
       [ 9.12993333e+03, -8.00000000e-01],
       [ 9.56509677e+03, -1.00000000e+00],
       [ 1.14015333e+04, -1.10000000e+00],
       [ 1.33945806e+04, -1.00000000e+00],
       [ 1.13356129e+04, -9.00000000e-01],
       [ 6.96813793e+03, -7.00000000e-01],
       [ 4.54058065e+03, -6.00000000e-01],
       [ 6.58516667e+03, -5.00000000e-01],
       [ 9.66800000e+03, -3.00000000e-01],
       [ 9.00076667e+03,  0.00000000e+00],
       [ 6.41796774e+03,  2.00000000e-01],
       [ 6.19329032e+03,  4.00000000e-01],
       [ 6.50166667e+03,  4.00000000e-01],
       [ 6.41374194e+03,  3.00000000e-01],
       [ 7.85830000e+03,  1.00000000e-01],
       [ 6.85496774e+03, -2.00000000e-01],
       [ 3.66877419e+03, -4.00000000e-01],
       [ 3.20507143e+03, -4.00000000e-01],
       [ 3.79174194e+03, -3.00000000e-01],
       [ 4.22893333e+03, -3.00000000e-01],
       [ 6.25893548e+03, -4.00000000e-01],
       [ 8.22893333e+03, -4.00000000e-01]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">residuales_train_extra</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-2.05548235e+03, -9.00000000e-01],
       [-3.66642956e+02, -6.00000000e-01],
       [-1.35158224e+03, -4.00000000e-01],
       [-5.33305150e+02, -3.00000000e-01],
       [-8.31250276e+02, -4.00000000e-01],
       [ 1.53187660e+03, -5.00000000e-01],
       [ 7.33944478e+02, -4.00000000e-01],
       [ 6.58861933e+02, -3.00000000e-01],
       [ 7.10107490e+02, -2.00000000e-01],
       [ 8.48887464e+02, -2.00000000e-01],
       [ 2.02095423e+03, -6.00000000e-01],
       [ 1.41410648e+03, -9.00000000e-01],
       [ 1.92658996e+02, -1.10000000e+00],
       [-2.85666871e+03, -1.00000000e+00],
       [-1.03056696e+03, -8.00000000e-01],
       [-3.71602339e+02, -8.00000000e-01],
       [-8.95370105e+02, -8.00000000e-01],
       [-3.65287927e+02, -8.00000000e-01],
       [-4.47168264e+02, -6.00000000e-01],
       [-1.61686439e+03, -5.00000000e-01],
       [ 2.04199009e+03, -5.00000000e-01],
       [ 3.48265058e+02, -4.00000000e-01],
       [ 4.18930741e+02, -3.00000000e-01],
       [ 1.01356452e+03, -3.00000000e-01],
       [ 3.42932030e+02, -4.00000000e-01],
       [-2.33296529e+03, -5.00000000e-01],
       [ 4.28964552e+02, -5.00000000e-01],
       [ 1.03997334e+02, -3.00000000e-01],
       [-5.36645099e+02, -2.00000000e-01],
       [ 1.11072952e+03, -1.00000000e-01],
       [ 2.65435169e+02,  0.00000000e+00],
       [-1.27755927e+02,  2.00000000e-01],
       [-1.51904963e+03,  4.00000000e-01],
       [ 1.23844685e+03,  7.00000000e-01],
       [ 1.23003458e+03,  9.00000000e-01],
       [ 8.05694308e+02,  1.10000000e+00],
       [-1.16503949e+03,  1.20000000e+00],
       [-2.61135182e+03,  1.20000000e+00],
       [ 1.41681401e+03,  1.20000000e+00],
       [-1.55835061e+03,  1.10000000e+00],
       [-9.46235725e+02,  9.00000000e-01],
       [ 8.25360260e+02,  1.00000000e+00],
       [-3.86593772e+02,  1.20000000e+00],
       [-1.14882091e+03,  1.50000000e+00],
       [ 2.36562793e+03,  1.70000000e+00],
       [-1.09355493e+03,  1.60000000e+00],
       [ 1.57869649e+03,  1.50000000e+00],
       [ 1.88183211e+03,  1.30000000e+00],
       [-2.29474626e+02,  1.10000000e+00],
       [-3.18797398e+03,  8.00000000e-01],
       [ 7.87598871e+02,  5.00000000e-01],
       [-7.83191622e+02,  1.00000000e-01],
       [-1.01021149e+03, -3.00000000e-01],
       [-8.93534449e+01, -9.00000000e-01],
       [-1.44922154e+02, -1.30000000e+00],
       [ 1.92771605e+03, -1.30000000e+00],
       [ 1.86582215e+02, -1.10000000e+00],
       [ 2.31690678e+03, -1.20000000e+00],
       [ 1.54838707e+03, -1.50000000e+00],
       [ 1.09220004e+03, -1.80000000e+00],
       [ 1.90551107e+03, -1.80000000e+00],
       [-7.77266895e+02, -1.70000000e+00],
       [-2.17438451e+03, -1.40000000e+00],
       [ 1.06007372e+03, -1.10000000e+00],
       [-1.20335494e+03, -8.00000000e-01],
       [-2.77038467e+02, -6.00000000e-01],
       [ 3.78993581e+02, -4.00000000e-01],
       [-8.27091948e+02, -3.00000000e-01],
       [ 1.90318478e+02, -3.00000000e-01],
       [ 1.52796857e+03, -2.00000000e-01],
       [ 1.40131464e+03, -2.00000000e-01],
       [ 1.09977866e+03, -2.00000000e-01],
       [-6.00488264e+02, -1.00000000e-01],
       [-1.92294422e+03,  1.00000000e-01],
       [ 5.17605767e+02,  2.00000000e-01],
       [-1.07717309e+03,  3.00000000e-01],
       [-5.63693131e+02,  3.00000000e-01],
       [ 1.10248942e+03,  3.00000000e-01],
       [-8.77886056e+02,  3.00000000e-01],
       [-1.13743381e+02,  3.00000000e-01],
       [-1.39206412e+02,  4.00000000e-01],
       [ 3.68835439e+02,  4.00000000e-01],
       [ 7.92847457e+02,  3.00000000e-01],
       [ 1.14593645e+03,  4.00000000e-01],
       [ 3.28794077e+01,  4.00000000e-01],
       [-2.12553176e+03,  4.00000000e-01],
       [-1.21111098e+03,  3.00000000e-01],
       [ 9.66146635e+02,  2.00000000e-01],
       [-1.47783163e+03,  3.00000000e-01],
       [ 4.38337781e+02,  5.00000000e-01],
       [-1.97553648e+02,  6.00000000e-01],
       [-3.99767526e+02,  7.00000000e-01],
       [ 6.24360147e+01,  6.00000000e-01],
       [-9.66109651e+02,  6.00000000e-01],
       [ 2.40481762e+03,  8.00000000e-01],
       [-1.22084489e+03,  1.20000000e+00],
       [ 6.10814255e+02,  1.50000000e+00],
       [-3.41970136e+03,  1.70000000e+00],
       [ 4.32575525e+02,  1.60000000e+00],
       [-1.15748106e+03,  1.50000000e+00],
       [-1.63739873e+03,  1.30000000e+00],
       [ 7.18962982e+02,  1.10000000e+00],
       [-7.84423111e+02,  7.00000000e-01],
       [-1.06916239e+03,  4.00000000e-01],
       [ 1.11712151e+03,  1.00000000e-01],
       [-5.78486648e+02, -1.00000000e-01],
       [ 4.90228547e+02, -2.00000000e-01],
       [-4.24811336e+02, -3.00000000e-01],
       [ 3.31265888e+02, -1.00000000e-01],
       [-2.07699333e+03,  1.00000000e-01],
       [-4.48761606e+02,  3.00000000e-01],
       [-7.06089961e+02,  5.00000000e-01],
       [ 5.29337084e+02,  7.00000000e-01],
       [ 4.98614081e+02,  7.00000000e-01],
       [ 2.50053503e+02,  6.00000000e-01],
       [-5.24427798e+02,  3.00000000e-01],
       [-4.14170301e+02,  3.00000000e-01],
       [ 1.54631110e+03,  2.00000000e-01],
       [-9.67210140e+01,  1.00000000e-01],
       [ 3.55407663e+02,  0.00000000e+00],
       [ 1.29241336e+03,  1.00000000e-01],
       [-1.79726849e+03,  1.00000000e-01],
       [-1.20325541e+03,  1.00000000e-01],
       [ 9.06960635e+02,  2.00000000e-01],
       [-1.33857502e+02,  3.00000000e-01],
       [ 3.36130593e+02,  4.00000000e-01],
       [ 5.12025544e+02,  4.00000000e-01],
       [-4.26066162e+02,  4.00000000e-01],
       [-4.53503186e+02,  4.00000000e-01],
       [ 4.35967111e+02,  6.00000000e-01],
       [ 8.70094046e+02,  7.00000000e-01],
       [ 6.58448150e+02,  1.00000000e+00],
       [ 1.71089942e+02,  1.10000000e+00],
       [-3.86621629e+03,  1.00000000e+00],
       [ 3.38257860e+01,  7.00000000e-01],
       [-4.37520984e+02,  5.00000000e-01],
       [-1.16836655e+03,  3.00000000e-01],
       [ 5.14247181e+02,  1.00000000e-01],
       [ 9.28050682e+01,  0.00000000e+00],
       [ 2.77520632e+02, -2.00000000e-01],
       [ 1.44919748e+03, -5.00000000e-01],
       [ 5.03924634e+02, -8.00000000e-01],
       [ 2.22389703e+01, -1.00000000e+00],
       [ 2.21936416e+03, -1.00000000e+00],
       [-1.45874194e+03, -1.00000000e+00],
       [-1.06899619e+03, -9.00000000e-01],
       [-5.62068965e+02, -8.00000000e-01],
       [ 7.39414572e+02, -6.00000000e-01],
       [-8.65045086e+02, -4.00000000e-01],
       [ 3.79820422e+01, -3.00000000e-01],
       [ 1.92587482e+03, -3.00000000e-01],
       [ 1.14042784e+03, -3.00000000e-01],
       [ 2.89407017e+02, -3.00000000e-01],
       [ 4.84627260e+02, -4.00000000e-01],
       [ 9.70604849e+02, -4.00000000e-01],
       [ 1.07389495e+03, -4.00000000e-01],
       [-1.05379389e+03, -5.00000000e-01],
       [-2.48584100e+03, -5.00000000e-01],
       [ 9.70586364e+02, -4.00000000e-01],
       [-2.38594289e+03, -1.00000000e-01],
       [-5.37552053e+02,  3.00000000e-01],
       [-2.46981639e+02,  8.00000000e-01],
       [-3.74104802e+02,  1.20000000e+00],
       [-1.04864034e+03,  1.60000000e+00],
       [-1.25574257e+03,  1.90000000e+00],
       [ 5.63820276e+00,  2.10000000e+00],
       [ 2.63936063e+02,  2.30000000e+00],
       [-8.62443790e+02,  2.40000000e+00],
       [-1.20319570e+03,  2.40000000e+00],
       [-1.87803193e+03,  2.20000000e+00],
       [ 3.47807136e+02,  1.90000000e+00],
       [-1.90236990e+03,  1.40000000e+00],
       [ 5.61019021e+02,  1.00000000e+00],
       [ 7.17714870e+02,  5.00000000e-01],
       [ 2.36913427e+02, -1.00000000e-01],
       [ 6.25921988e+02, -8.00000000e-01],
       [ 1.61685958e+02, -1.10000000e+00],
       [ 8.54913529e+02, -1.30000000e+00],
       [ 8.94381116e+02, -1.40000000e+00],
       [ 5.45771488e+02, -1.50000000e+00],
       [ 1.37793583e+03, -1.60000000e+00],
       [-8.29269430e+02, -1.50000000e+00],
       [-9.79404895e+02, -1.30000000e+00],
       [ 2.10226340e+03, -1.10000000e+00],
       [-7.97136377e+02, -1.00000000e+00],
       [ 8.38284693e+02, -1.00000000e+00],
       [ 1.01849979e+03, -1.00000000e+00],
       [ 8.95392571e+02, -1.10000000e+00],
       [-5.89606215e+02, -1.10000000e+00],
       [ 1.37449455e+03, -1.20000000e+00],
       [ 2.08476816e+03, -1.30000000e+00],
       [ 1.43237400e+03, -1.50000000e+00],
       [ 1.23218512e+02, -1.70000000e+00],
       [-1.53440988e+02, -1.70000000e+00],
       [-2.57742349e+03, -1.40000000e+00],
       [ 1.89796007e+03, -1.10000000e+00],
       [-2.05296143e+03, -8.00000000e-01],
       [ 6.50086009e+02, -7.00000000e-01],
       [ 1.09151929e+03, -6.00000000e-01],
       [-4.65537064e+01, -6.00000000e-01],
       [-2.64681905e+02, -5.00000000e-01],
       [ 1.22897253e+03, -5.00000000e-01],
       [ 1.65896685e+03, -6.00000000e-01],
       [-2.40205437e+02, -7.00000000e-01],
       [-5.27486975e+02, -7.00000000e-01],
       [-2.43617405e+03, -7.00000000e-01],
       [-6.38277305e+02, -5.00000000e-01],
       [-3.50470951e+02, -4.00000000e-01],
       [-1.56129680e+03, -3.00000000e-01],
       [-3.39620419e+02, -3.00000000e-01],
       [ 4.36085559e+02, -1.00000000e-01],
       [-1.84930263e+03, -1.00000000e-01],
       [-6.08069954e+01, -1.00000000e-01],
       [-9.21939294e+01, -2.00000000e-01],
       [ 6.15002725e+02, -3.00000000e-01],
       [ 2.77712552e+02, -3.00000000e-01],
       [ 4.09775556e+02, -3.00000000e-01],
       [-1.52216911e+03, -1.00000000e-01],
       [-2.04546528e+03,  0.00000000e+00],
       [ 4.34807397e+02,  1.00000000e-01],
       [-1.18063407e+02,  2.00000000e-01],
       [-6.01894701e+02,  4.00000000e-01],
       [ 8.69813907e+02,  7.00000000e-01],
       [-1.25029415e+03,  8.00000000e-01],
       [-1.35652003e+03,  9.00000000e-01],
       [ 9.15250184e+02,  1.00000000e+00],
       [-8.68959194e+02,  1.20000000e+00],
       [ 1.52405225e+03,  1.30000000e+00],
       [-2.70595036e+03,  1.10000000e+00],
       [-1.36684107e+03,  9.00000000e-01],
       [-2.24133710e+02,  6.00000000e-01],
       [-1.07669485e+03,  4.00000000e-01],
       [-4.57968805e+02,  0.00000000e+00],
       [ 6.89834279e+02, -3.00000000e-01],
       [-9.82994396e+01, -2.00000000e-01],
       [ 4.58771587e+02,  1.00000000e-01],
       [-5.58392740e+02,  2.00000000e-01],
       [-1.20444246e+02,  3.00000000e-01],
       [ 1.81214453e+03,  3.00000000e-01],
       [ 8.28646309e+02,  4.00000000e-01],
       [ 7.35382910e+02,  4.00000000e-01],
       [-1.98655242e+03,  4.00000000e-01],
       [-2.20501137e+03,  3.00000000e-01],
       [ 6.76384821e+02,  2.00000000e-01],
       [-1.24914949e+03,  2.00000000e-01],
       [ 5.40034973e+02,  2.00000000e-01],
       [-7.64842201e+01,  3.00000000e-01],
       [-1.56849238e+03,  5.00000000e-01],
       [ 1.00566638e+03,  6.00000000e-01],
       [-3.53955044e+01,  7.00000000e-01],
       [ 1.11668089e+03,  7.00000000e-01],
       [ 1.21409443e+03,  7.00000000e-01],
       [ 6.96480170e+02,  7.00000000e-01],
       [-3.12689488e+03,  6.00000000e-01],
       [ 3.77937901e+02,  6.00000000e-01],
       [-7.43508631e+02,  4.00000000e-01],
       [-7.54948588e+02,  4.00000000e-01],
       [ 7.93274973e+02,  3.00000000e-01],
       [ 4.06526032e+02,  1.00000000e-01],
       [-4.20716095e+02, -1.00000000e-01],
       [-6.32243723e+02, -1.00000000e-01],
       [ 6.25387950e+02, -1.00000000e-01],
       [ 7.21713564e+02, -3.00000000e-01],
       [ 1.57046225e+03, -6.00000000e-01],
       [ 1.88661318e+03, -8.00000000e-01],
       [-3.26429946e+03, -9.00000000e-01],
       [-1.83895707e+02, -8.00000000e-01],
       [ 1.29624378e+01, -6.00000000e-01],
       [ 7.16041775e+02, -4.00000000e-01],
       [ 3.53379170e+02, -1.00000000e-01],
       [ 1.46683920e+03,  0.00000000e+00],
       [-7.03962269e+02,  1.00000000e-01],
       [-1.22424136e+03,  3.00000000e-01],
       [ 1.93447357e+03,  5.00000000e-01],
       [-9.23343595e+02,  8.00000000e-01],
       [ 1.45505990e+03,  9.00000000e-01],
       [ 7.08049050e+02,  9.00000000e-01],
       [-2.41593906e+03,  7.00000000e-01],
       [-1.81401780e+03,  2.00000000e-01],
       [ 4.27802609e+02, -1.00000000e-01],
       [ 9.55219137e+02, -3.00000000e-01],
       [ 1.00216145e+02, -4.00000000e-01],
       [ 1.98953270e+03, -5.00000000e-01],
       [-1.03617190e+02, -6.00000000e-01],
       [ 6.24020818e+01, -8.00000000e-01],
       [ 2.82949568e+03, -1.10000000e+00],
       [-5.92185070e+02, -1.30000000e+00],
       [ 3.39082938e+03, -1.50000000e+00],
       [-1.00192777e+03, -1.60000000e+00],
       [-1.45899605e+03, -1.60000000e+00],
       [-8.56130949e+02, -1.50000000e+00],
       [ 7.01654944e+02, -1.30000000e+00],
       [-1.43484901e+03, -1.00000000e+00],
       [ 1.19851546e+03, -8.00000000e-01],
       [ 1.16000457e+03, -6.00000000e-01],
       [ 1.23055626e+03, -4.00000000e-01],
       [ 1.08886225e+03, -2.00000000e-01],
       [ 1.46867361e+03, -2.00000000e-01],
       [ 9.88511290e+02, -4.00000000e-01],
       [ 2.34189668e+03, -6.00000000e-01],
       [ 1.49219488e+03, -7.00000000e-01],
       [-3.13322084e+03, -8.00000000e-01],
       [ 1.17557682e+02, -8.00000000e-01],
       [-1.19451102e+02, -6.00000000e-01],
       [ 2.75103120e+02, -3.00000000e-01],
       [-6.25309398e+02,  0.00000000e+00],
       [-2.67817219e+02,  3.00000000e-01],
       [ 1.17094823e+02,  5.00000000e-01],
       [-1.06560535e+03,  6.00000000e-01],
       [ 5.01252443e+02,  7.00000000e-01],
       [-1.49515710e+03,  1.00000000e+00],
       [ 1.77539804e+03,  1.40000000e+00],
       [-2.34966362e+03,  1.60000000e+00],
       [-1.96233684e+03,  1.50000000e+00],
       [-3.38551230e+01,  1.20000000e+00],
       [-6.32301437e+02,  8.00000000e-01],
       [-4.21366990e+02,  4.00000000e-01],
       [ 1.35218628e+03, -2.00000000e-01],
       [ 8.40395582e+02, -7.00000000e-01],
       [ 1.60882226e+03, -1.00000000e+00],
       [ 2.25047556e+03, -1.30000000e+00],
       [ 7.12481996e+02, -1.60000000e+00],
       [ 2.49995822e+03, -1.60000000e+00],
       [ 9.56760542e+02, -1.60000000e+00],
       [ 1.68440980e+03, -1.60000000e+00],
       [-1.24871624e+03, -1.40000000e+00],
       [-2.29147860e+03, -1.20000000e+00],
       [ 2.00862412e+03, -9.00000000e-01],
       [ 6.65306674e+01, -7.00000000e-01],
       [ 2.35357291e+03, -6.00000000e-01],
       [-7.67600712e+01, -4.00000000e-01],
       [ 1.40464892e+02, -5.00000000e-01],
       [ 1.24997550e+03, -6.00000000e-01],
       [-1.50325924e+02, -8.00000000e-01],
       [ 9.26343269e+02, -1.00000000e+00],
       [ 1.63178796e+03, -1.10000000e+00],
       [ 1.67548221e+03, -1.00000000e+00],
       [-1.55118373e+03, -9.00000000e-01],
       [-1.58346968e+03, -7.00000000e-01],
       [-1.68631963e+02, -6.00000000e-01],
       [ 1.57082927e+03, -5.00000000e-01],
       [ 5.63226410e+02, -3.00000000e-01],
       [-1.78988346e+03,  0.00000000e+00],
       [-7.86708037e+02,  2.00000000e-01],
       [ 1.30101797e+03,  4.00000000e-01],
       [-5.89564542e+02,  4.00000000e-01],
       [-7.84517055e+02,  3.00000000e-01],
       [ 1.38481907e+03,  1.00000000e-01],
       [-1.79983439e+03, -2.00000000e-01],
       [-2.30044387e+03, -4.00000000e-01],
       [ 6.47189543e+02, -4.00000000e-01],
       [-9.40877160e+02, -3.00000000e-01],
       [-1.09798020e+03, -3.00000000e-01],
       [ 1.26295867e+03, -4.00000000e-01],
       [ 6.62281918e+02, -4.00000000e-01]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="c1">#plt.plot(data_test.Mes, y_pred, label=&quot;RF&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Caudal (m3/s)&#39;)
</pre></div>
</div>
<img alt="../_images/5e2d97f9e1ea61533982ef07dad93c4b12d153fcabf86728277f25f2c88b8469.png" src="../_images/5e2d97f9e1ea61533982ef07dad93c4b12d153fcabf86728277f25f2c88b8469.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">RandomForestRegressor</span><span class="p">())</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;randomforestregressor__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">400</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__max_leaf_nodes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__min_samples_split&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">]}</span>

<span class="n">RF_e</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">RF_e</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">residuales_train_extra</span><span class="p">,</span> <span class="n">residuals_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                                       (&#39;randomforestregressor&#39;,
                                        RandomForestRegressor())]),
             n_jobs=-1,
             param_grid={&#39;randomforestregressor__max_depth&#39;: [2, 3, 4],
                         &#39;randomforestregressor__max_leaf_nodes&#39;: [2, 4, 6, 8],
                         &#39;randomforestregressor__min_samples_split&#39;: [2, 5, 10,
                                                                      15],
                         &#39;randomforestregressor__n_estimators&#39;: [400]},
             scoring=&#39;r2&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF_e</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                (&#39;randomforestregressor&#39;,
                 RandomForestRegressor(max_depth=2, max_leaf_nodes=4,
                                       min_samples_split=10,
                                       n_estimators=400))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">RF_e</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;plt.figure(figsize=(14,6))</span>
<span class="sd">plt.plot(residuals_train, label=&quot;Training data&quot;)</span>
<span class="sd">#plt.plot(residuales_AR, label=&quot;Test data&quot;)</span>
<span class="sd">plt.plot(y_tree, label=&quot;Tree prediction&quot;)</span>
<span class="sd">plt.legend();</span>

<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;plt.figure(figsize=(14,6))\nplt.plot(residuals_train, label=&quot;Training data&quot;)\n#plt.plot(residuales_AR, label=&quot;Test data&quot;)\nplt.plot(y_tree, label=&quot;Tree prediction&quot;)\nplt.legend();\n\n&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Tree prediction&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/390fd02f5ca2269dc028b14c45bdf452380b9aafe5ce15de0366c93f787db3c2.png" src="../_images/390fd02f5ca2269dc028b14c45bdf452380b9aafe5ce15de0366c93f787db3c2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1156.25
MAE: 905.34
RRMSE: -9.62
R-squared (R^2): 0.09
NSE (Nash-Sutcliffe Efficiency): 0.09
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF_e</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">residuales_train_extra</span><span class="p">,</span> <span class="n">residuals_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF_e</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">,</span> <span class="n">residuales_AR</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training-set score: 0.11
Test-set score: 0.09
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_residual</span> <span class="o">=</span> <span class="n">RF_e</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">)</span>

<span class="n">y_AR_RF</span> <span class="o">=</span> <span class="n">predictions_AR</span> <span class="o">+</span> <span class="n">y_residual</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_residual</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">y_residual</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 204.87690686  157.46849406   88.55189808   75.96798872  199.45515548
  157.57243349   64.09413357   94.32346196  157.46849406   27.65768434
 -100.06963795   28.19259421   23.34020573  -63.22500076  -66.263562
 -116.50823544 -126.84920244 -183.77578446   14.89923952 -100.44047899
   -4.70642642 -191.34306829  -15.67448948 -946.86845608 -196.6750682
 -943.84197509 -692.83681656 -440.24735749 -968.13364435 -225.91333405
 -394.5719107  -784.15464689 -370.41728731 -125.77228365  -83.39627061
   28.90147522   97.39659945  166.94458271  166.0004807   168.66401136
  209.38949964  189.10213103   81.8578675    67.6375051   -34.46968299
  -76.33872799  -42.97128686 -113.20029835  -63.22500076    8.06204146
  205.37610143  168.66401136  168.7679508   245.52643235   77.72695074
   80.21057046  168.7679508   212.9818702   113.54368716   21.75313028
   33.16008109  -44.40866726 -124.21969567 -170.6603832  -223.20629298
 -107.23718967    8.65951089 -189.97990542  -16.66793127 -162.28256194
  -93.00507378 -172.99016344   31.80566268  -13.77925983  -57.80931792
 -108.26609641 -120.39011512    5.65509078   -4.70642642  -57.38886059
  -30.82121393   30.13380943   24.30022906  179.62604238  158.83961936
  161.72980417   87.64558263  365.41106606  402.48323065]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">y_AR_RF</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1156.25
MAE: 905.34
RRMSE: 0.18
R-squared (R^2): 0.73
NSE (Nash-Sutcliffe Efficiency): 0.73
</pre></div>
</div>
</div>
</div>
</section>
<section id="arma-rf">
<h3>ARMA-RF<a class="headerlink" href="#arma-rf" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">residuales_test_lag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">residuales_ARMA</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">residuales_test_extra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">residuales_test_lag</span><span class="p">,</span> <span class="n">X_test</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_ARMA</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="c1">#plt.plot(data_test.Mes, y_pred, label=&quot;RF&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Caudal (m3/s)&#39;)
</pre></div>
</div>
<img alt="../_images/c717374804f9c509f95765ebb4ea8f3b8e06bf245d7ac294b903bd39917811a7.png" src="../_images/c717374804f9c509f95765ebb4ea8f3b8e06bf245d7ac294b903bd39917811a7.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_order</span> <span class="o">=</span> <span class="n">orden_arma</span>
<span class="n">history</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">train</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">residuals_train</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">resid</span>

<span class="n">residuales_train_lag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#residuales_train_extra = residuales_train_lag</span>
<span class="n">residuales_train_extra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">residuales_train_lag</span><span class="p">,</span> <span class="n">X_train</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">residuales_train_extra</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-9.95316452e+02, -9.00000000e-01],
       [-3.66642685e+02, -6.00000000e-01],
       [-1.33301501e+03, -4.00000000e-01],
       [-5.35182063e+02, -3.00000000e-01],
       [-7.43209384e+02, -4.00000000e-01],
       [ 1.65822042e+03, -5.00000000e-01],
       [ 1.03503090e+03, -4.00000000e-01],
       [ 9.19765051e+02, -3.00000000e-01],
       [ 5.88513585e+02, -2.00000000e-01],
       [ 7.49303034e+02, -2.00000000e-01],
       [ 1.79242984e+03, -6.00000000e-01],
       [ 1.14860395e+03, -9.00000000e-01],
       [-2.32944715e+02, -1.10000000e+00],
       [-3.42084525e+03, -1.00000000e+00],
       [-1.54023016e+03, -8.00000000e-01],
       [-1.55261066e+02, -8.00000000e-01],
       [-1.46731871e+02, -8.00000000e-01],
       [-2.51598233e+02, -8.00000000e-01],
       [-4.95658197e+02, -6.00000000e-01],
       [-1.27402632e+03, -5.00000000e-01],
       [ 2.47469354e+03, -5.00000000e-01],
       [ 1.04391403e+03, -4.00000000e-01],
       [ 3.62001390e+02, -3.00000000e-01],
       [-3.80035330e+01, -3.00000000e-01],
       [-8.48324210e+01, -4.00000000e-01],
       [-2.09799281e+03, -5.00000000e-01],
       [ 5.10897485e+02, -5.00000000e-01],
       [ 3.33775065e+02, -3.00000000e-01],
       [-4.02240371e+02, -2.00000000e-01],
       [ 5.94687537e+02, -1.00000000e-01],
       [ 3.44787899e+02,  0.00000000e+00],
       [ 4.26300318e+02,  2.00000000e-01],
       [-1.25738564e+03,  4.00000000e-01],
       [ 8.45294325e+02,  7.00000000e-01],
       [ 8.86784313e+02,  9.00000000e-01],
       [ 7.74982187e+02,  1.10000000e+00],
       [-1.28041023e+03,  1.20000000e+00],
       [-2.67610135e+03,  1.20000000e+00],
       [ 1.35740211e+03,  1.20000000e+00],
       [-8.76449432e+02,  1.10000000e+00],
       [-9.51257692e+02,  9.00000000e-01],
       [ 5.82299633e+01,  1.00000000e+00],
       [ 1.99372833e+01,  1.20000000e+00],
       [-2.69521399e+02,  1.50000000e+00],
       [ 2.79997011e+03,  1.70000000e+00],
       [-7.95339950e+02,  1.60000000e+00],
       [ 7.53376185e+02,  1.50000000e+00],
       [ 9.14952015e+02,  1.30000000e+00],
       [ 7.36828180e+01,  1.10000000e+00],
       [-2.92901518e+03,  8.00000000e-01],
       [ 4.45615001e+02,  5.00000000e-01],
       [-6.52973640e+02,  1.00000000e-01],
       [-8.93264371e+02, -3.00000000e-01],
       [-5.71432940e+02, -9.00000000e-01],
       [ 1.80165642e+02, -1.30000000e+00],
       [ 2.87242394e+03, -1.30000000e+00],
       [ 1.17421993e+03, -1.10000000e+00],
       [ 2.02997963e+03, -1.20000000e+00],
       [ 4.07719746e+02, -1.50000000e+00],
       [ 1.85099447e+02, -1.80000000e+00],
       [ 1.45541593e+03, -1.80000000e+00],
       [-3.43233811e+02, -1.70000000e+00],
       [-2.19607772e+03, -1.40000000e+00],
       [ 1.36694844e+02, -1.10000000e+00],
       [-1.43740237e+03, -8.00000000e-01],
       [-1.82465238e+02, -6.00000000e-01],
       [ 6.84414082e+02, -4.00000000e-01],
       [ 1.25712727e+02, -3.00000000e-01],
       [ 5.66417689e+02, -3.00000000e-01],
       [ 1.28906082e+03, -2.00000000e-01],
       [ 1.05416412e+03, -2.00000000e-01],
       [ 6.76711627e+02, -2.00000000e-01],
       [-8.59270482e+02, -1.00000000e-01],
       [-2.03368654e+03,  1.00000000e-01],
       [ 3.64722208e+02,  2.00000000e-01],
       [-8.00383038e+02,  3.00000000e-01],
       [-6.11629259e+02,  3.00000000e-01],
       [ 7.49382723e+02,  3.00000000e-01],
       [-3.22320122e+02,  3.00000000e-01],
       [ 4.90751494e+02,  3.00000000e-01],
       [ 1.13312024e+02,  4.00000000e-01],
       [ 2.39113257e+02,  4.00000000e-01],
       [ 2.14194686e+02,  3.00000000e-01],
       [ 7.82957079e+02,  4.00000000e-01],
       [ 2.15415015e+02,  4.00000000e-01],
       [-1.76689539e+03,  4.00000000e-01],
       [-1.38786352e+03,  3.00000000e-01],
       [ 6.97439958e+02,  2.00000000e-01],
       [-1.26051195e+03,  3.00000000e-01],
       [ 2.86722329e+02,  5.00000000e-01],
       [-2.87263300e+01,  6.00000000e-01],
       [ 4.23021177e+02,  7.00000000e-01],
       [ 4.94406089e+02,  6.00000000e-01],
       [-1.06618441e+03,  6.00000000e-01],
       [ 1.61050369e+03,  8.00000000e-01],
       [-1.39843139e+03,  1.20000000e+00],
       [ 6.67075199e+02,  1.50000000e+00],
       [-3.11244299e+03,  1.70000000e+00],
       [ 6.12307585e+02,  1.60000000e+00],
       [-1.01953607e+03,  1.50000000e+00],
       [-1.50686152e+03,  1.30000000e+00],
       [ 2.09004325e+02,  1.10000000e+00],
       [-1.91491557e+02,  7.00000000e-01],
       [-1.10258413e+02,  4.00000000e-01],
       [ 1.51292211e+03,  1.00000000e-01],
       [-4.22346472e+02, -1.00000000e-01],
       [-1.35801557e+02, -2.00000000e-01],
       [-1.13589702e+03, -3.00000000e-01],
       [ 4.06335797e+02, -1.00000000e-01],
       [-1.38113108e+03,  1.00000000e-01],
       [-6.75593224e+01,  3.00000000e-01],
       [-8.09446546e+02,  5.00000000e-01],
       [ 3.47137491e+02,  7.00000000e-01],
       [ 4.35411644e+02,  7.00000000e-01],
       [ 6.84568585e+02,  6.00000000e-01],
       [-6.23898345e+01,  3.00000000e-01],
       [-3.13816667e+02,  3.00000000e-01],
       [ 1.16947082e+03,  2.00000000e-01],
       [-3.54301597e+02,  1.00000000e-01],
       [-2.98572859e+01,  0.00000000e+00],
       [ 1.14216685e+03,  1.00000000e-01],
       [-1.14398933e+03,  1.00000000e-01],
       [-1.15121390e+03,  1.00000000e-01],
       [ 3.99165948e+02,  2.00000000e-01],
       [-1.36601377e+02,  3.00000000e-01],
       [ 3.20645250e+02,  4.00000000e-01],
       [ 6.13350073e+02,  4.00000000e-01],
       [ 1.02606686e+02,  4.00000000e-01],
       [-2.28559949e+02,  4.00000000e-01],
       [ 1.16540941e+02,  6.00000000e-01],
       [ 4.18091844e+02,  7.00000000e-01],
       [ 4.13264122e+02,  1.00000000e+00],
       [ 2.39702028e+02,  1.10000000e+00],
       [-3.56904481e+03,  1.00000000e+00],
       [-2.58316623e+02,  7.00000000e-01],
       [-2.78962384e+02,  5.00000000e-01],
       [-6.66497474e+02,  3.00000000e-01],
       [ 2.55732249e+02,  1.00000000e-01],
       [ 3.63618062e+02,  0.00000000e+00],
       [ 1.03831693e+03, -2.00000000e-01],
       [ 1.97363540e+03, -5.00000000e-01],
       [ 5.15029194e+02, -8.00000000e-01],
       [-8.75482789e+02, -1.00000000e+00],
       [ 1.06359832e+03, -1.00000000e+00],
       [-1.36940663e+03, -1.00000000e+00],
       [-7.06779455e+02, -9.00000000e-01],
       [-4.62128064e+02, -8.00000000e-01],
       [ 9.59594237e+02, -6.00000000e-01],
       [-8.96841187e+02, -4.00000000e-01],
       [-3.78266051e+02, -3.00000000e-01],
       [ 1.85097313e+03, -3.00000000e-01],
       [ 2.13173274e+03, -3.00000000e-01],
       [ 8.81439699e+02, -3.00000000e-01],
       [-2.39384473e+02, -4.00000000e-01],
       [-2.41313289e+02, -4.00000000e-01],
       [ 4.47512033e+02, -4.00000000e-01],
       [-8.50143122e+02, -5.00000000e-01],
       [-2.24715604e+03, -5.00000000e-01],
       [ 8.47131414e+02, -4.00000000e-01],
       [-1.95339550e+03, -1.00000000e-01],
       [-6.06176310e+02,  3.00000000e-01],
       [-5.38990230e+02,  8.00000000e-01],
       [ 2.51541629e+02,  1.20000000e+00],
       [-3.16584035e+02,  1.60000000e+00],
       [-8.84949976e+02,  1.90000000e+00],
       [-2.11355740e+02,  2.10000000e+00],
       [ 8.23776655e+01,  2.30000000e+00],
       [-7.94838809e+02,  2.40000000e+00],
       [-1.12152259e+03,  2.40000000e+00],
       [-1.61303344e+03,  2.20000000e+00],
       [ 7.25979829e+02,  1.90000000e+00],
       [-1.37931821e+03,  1.40000000e+00],
       [ 4.49727556e+02,  1.00000000e+00],
       [ 5.57073669e+02,  5.00000000e-01],
       [ 7.78033865e+02, -1.00000000e-01],
       [ 1.01514397e+03, -8.00000000e-01],
       [ 3.25229921e+02, -1.10000000e+00],
       [ 4.75930930e+02, -1.30000000e+00],
       [ 2.70498723e+02, -1.40000000e+00],
       [ 1.51501554e+02, -1.50000000e+00],
       [ 1.30641427e+03, -1.60000000e+00],
       [-4.44714924e+02, -1.50000000e+00],
       [-1.00126588e+03, -1.30000000e+00],
       [ 1.54257200e+03, -1.10000000e+00],
       [-7.46007129e+02, -1.00000000e+00],
       [ 6.13410754e+02, -1.00000000e+00],
       [ 8.36378990e+02, -1.00000000e+00],
       [ 1.41067930e+03, -1.10000000e+00],
       [-3.62283612e+02, -1.10000000e+00],
       [ 8.53231927e+02, -1.20000000e+00],
       [ 1.50129481e+03, -1.30000000e+00],
       [ 1.33580759e+03, -1.50000000e+00],
       [-4.49117146e+01, -1.70000000e+00],
       [-4.78355841e+02, -1.70000000e+00],
       [-2.82604631e+03, -1.40000000e+00],
       [ 1.45572188e+03, -1.10000000e+00],
       [-1.79606158e+03, -8.00000000e-01],
       [ 7.06393263e+02, -7.00000000e-01],
       [ 1.06549463e+03, -6.00000000e-01],
       [ 8.16628744e+02, -6.00000000e-01],
       [-9.92028797e+00, -5.00000000e-01],
       [ 8.46625718e+02, -5.00000000e-01],
       [ 1.20094206e+03, -6.00000000e-01],
       [-5.37364230e+02, -7.00000000e-01],
       [-1.01010550e+03, -7.00000000e-01],
       [-2.59971422e+03, -7.00000000e-01],
       [-4.66194348e+02, -5.00000000e-01],
       [ 1.39587849e+02, -4.00000000e-01],
       [-1.11103867e+03, -3.00000000e-01],
       [-6.42279258e+02, -3.00000000e-01],
       [ 4.77239251e+02, -1.00000000e-01],
       [-9.76607371e+02, -1.00000000e-01],
       [ 3.81935986e+02, -1.00000000e-01],
       [-6.13697043e+01, -2.00000000e-01],
       [ 4.45590242e+02, -3.00000000e-01],
       [-6.29708624e+01, -3.00000000e-01],
       [ 4.09832482e+02, -3.00000000e-01],
       [-1.16222241e+03, -1.00000000e-01],
       [-1.87585141e+03,  0.00000000e+00],
       [ 1.46880103e+02,  1.00000000e-01],
       [-1.36791089e+01,  2.00000000e-01],
       [-4.37333646e+02,  4.00000000e-01],
       [ 8.70393318e+02,  7.00000000e-01],
       [-6.41328315e+02,  8.00000000e-01],
       [-9.59592490e+02,  9.00000000e-01],
       [ 6.38741171e+02,  1.00000000e+00],
       [-9.54911806e+02,  1.20000000e+00],
       [ 1.19921693e+03,  1.30000000e+00],
       [-2.59340320e+03,  1.10000000e+00],
       [-1.16716989e+03,  9.00000000e-01],
       [ 3.96428164e+01,  6.00000000e-01],
       [-2.68803022e+02,  4.00000000e-01],
       [-5.15986651e+02,  0.00000000e+00],
       [ 2.35161513e+02, -3.00000000e-01],
       [ 1.19050257e+02, -2.00000000e-01],
       [ 1.12759131e+03,  1.00000000e-01],
       [ 1.54453266e+01,  2.00000000e-01],
       [-2.88131290e+02,  3.00000000e-01],
       [ 9.98535130e+02,  3.00000000e-01],
       [ 5.20314642e+02,  4.00000000e-01],
       [ 8.12087119e+02,  4.00000000e-01],
       [-1.75276529e+03,  4.00000000e-01],
       [-2.28518076e+03,  3.00000000e-01],
       [ 2.79663363e+02,  2.00000000e-01],
       [-9.97534330e+02,  2.00000000e-01],
       [ 5.85568588e+02,  2.00000000e-01],
       [ 8.29374781e+01,  3.00000000e-01],
       [-8.55154765e+02,  5.00000000e-01],
       [ 1.31392399e+03,  6.00000000e-01],
       [ 2.58702850e+02,  7.00000000e-01],
       [ 7.98768291e+02,  7.00000000e-01],
       [ 4.48526634e+02,  7.00000000e-01],
       [ 5.17631195e+02,  7.00000000e-01],
       [-2.84001933e+03,  6.00000000e-01],
       [ 2.92888024e+02,  6.00000000e-01],
       [-5.63402441e+02,  4.00000000e-01],
       [-6.22671964e+02,  4.00000000e-01],
       [ 2.30940016e+02,  3.00000000e-01],
       [ 6.17777983e+02,  1.00000000e-01],
       [ 4.01081809e+02, -1.00000000e-01],
       [-9.48540251e+01, -1.00000000e-01],
       [ 4.41797820e+02, -1.00000000e-01],
       [ 1.48693736e+02, -3.00000000e-01],
       [ 1.00422938e+03, -6.00000000e-01],
       [ 1.84128845e+03, -8.00000000e-01],
       [-2.67230337e+03, -9.00000000e-01],
       [-4.68096976e+02, -8.00000000e-01],
       [-2.77328444e+02, -6.00000000e-01],
       [ 8.76985816e+02, -4.00000000e-01],
       [ 1.16075011e+02, -1.00000000e-01],
       [ 1.37161799e+03,  0.00000000e+00],
       [-2.16757579e+02,  1.00000000e-01],
       [-7.98770306e+02,  3.00000000e-01],
       [ 1.58720435e+03,  5.00000000e-01],
       [-1.15859342e+03,  8.00000000e-01],
       [ 6.92002150e+02,  9.00000000e-01],
       [ 3.57676087e+02,  9.00000000e-01],
       [-1.65540027e+03,  7.00000000e-01],
       [-1.56272226e+03,  2.00000000e-01],
       [ 3.73212061e+02, -1.00000000e-01],
       [ 1.07336429e+03, -3.00000000e-01],
       [ 1.98544314e+01, -4.00000000e-01],
       [ 1.69598355e+03, -5.00000000e-01],
       [ 3.99597320e+02, -6.00000000e-01],
       [ 6.51454252e+02, -8.00000000e-01],
       [ 2.57616401e+03, -1.10000000e+00],
       [-1.05917313e+03, -1.30000000e+00],
       [ 2.04943213e+03, -1.50000000e+00],
       [-1.53509855e+03, -1.60000000e+00],
       [-1.14110559e+03, -1.60000000e+00],
       [-7.08684737e+02, -1.50000000e+00],
       [ 1.14596045e+03, -1.30000000e+00],
       [-1.44980930e+03, -1.00000000e+00],
       [ 3.79575951e+02, -8.00000000e-01],
       [ 9.69072082e+02, -6.00000000e-01],
       [ 2.32647700e+03, -4.00000000e-01],
       [ 1.99078963e+03, -2.00000000e-01],
       [ 1.31236770e+03, -2.00000000e-01],
       [-3.02921746e+02, -4.00000000e-01],
       [ 8.61131429e+02, -6.00000000e-01],
       [ 1.10190903e+03, -7.00000000e-01],
       [-2.53478811e+03, -8.00000000e-01],
       [-2.61343957e+01, -8.00000000e-01],
       [-2.00923972e+02, -6.00000000e-01],
       [ 3.37856360e+02, -3.00000000e-01],
       [-1.08759238e+03,  0.00000000e+00],
       [-4.74047264e+02,  3.00000000e-01],
       [ 6.51562904e+02,  5.00000000e-01],
       [-1.22342817e+01,  6.00000000e-01],
       [ 6.52232351e+02,  7.00000000e-01],
       [-2.13881218e+03,  1.00000000e+00],
       [ 8.12325009e+02,  1.40000000e+00],
       [-2.20993554e+03,  1.60000000e+00],
       [-1.22608594e+03,  1.50000000e+00],
       [ 4.28680018e+02,  1.20000000e+00],
       [ 1.24656407e+02,  8.00000000e-01],
       [-5.54765672e+02,  4.00000000e-01],
       [ 6.76714433e+02, -2.00000000e-01],
       [ 1.01795752e+03, -7.00000000e-01],
       [ 2.44223848e+03, -1.00000000e+00],
       [ 2.85517874e+03, -1.30000000e+00],
       [ 5.07368273e+02, -1.60000000e+00],
       [ 1.02920575e+03, -1.60000000e+00],
       [-3.15117605e+02, -1.60000000e+00],
       [ 1.32584027e+03, -1.60000000e+00],
       [-8.94835880e+02, -1.40000000e+00],
       [-2.16154568e+03, -1.20000000e+00],
       [ 1.30839684e+03, -9.00000000e-01],
       [ 1.36305045e+02, -7.00000000e-01],
       [ 2.44279618e+03, -6.00000000e-01],
       [ 1.42820255e+01, -4.00000000e-01],
       [ 3.07923273e+02, -5.00000000e-01],
       [ 1.07961058e+03, -6.00000000e-01],
       [-1.86167573e+02, -8.00000000e-01],
       [ 1.64296584e+02, -1.00000000e+00],
       [ 8.34320554e+02, -1.10000000e+00],
       [ 1.78612864e+03, -1.00000000e+00],
       [-9.37435552e+02, -9.00000000e-01],
       [-1.67086247e+03, -7.00000000e-01],
       [-8.61137151e+02, -6.00000000e-01],
       [ 1.29929849e+03, -5.00000000e-01],
       [ 7.89742013e+02, -3.00000000e-01],
       [-1.58139865e+03,  0.00000000e+00],
       [-9.24204490e+02,  2.00000000e-01],
       [ 1.64672934e+03,  4.00000000e-01],
       [ 2.20720217e+02,  4.00000000e-01],
       [-1.13439030e+03,  3.00000000e-01],
       [ 1.89225496e+02,  1.00000000e-01],
       [-1.80975055e+03, -2.00000000e-01],
       [-1.70272026e+03, -4.00000000e-01],
       [ 1.13469829e+03, -4.00000000e-01],
       [-1.32268529e+02, -3.00000000e-01],
       [-1.24136791e+03, -3.00000000e-01],
       [ 3.36837234e+02, -4.00000000e-01],
       [ 9.13120832e+02, -4.00000000e-01]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="c1">#plt.plot(data_test.Mes, y_pred, label=&quot;RF&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Caudal (m3/s)&#39;)
</pre></div>
</div>
<img alt="../_images/e489b64b76d9fc8e9d47b29b625ef69a074fbeb204eed27550ae074b376368ad.png" src="../_images/e489b64b76d9fc8e9d47b29b625ef69a074fbeb204eed27550ae074b376368ad.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">RandomForestRegressor</span><span class="p">())</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;randomforestregressor__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">400</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__max_leaf_nodes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__min_samples_split&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">]}</span>

<span class="n">RF_e</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">RF_e</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">residuales_train_extra</span><span class="p">,</span> <span class="n">residuals_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                                       (&#39;randomforestregressor&#39;,
                                        RandomForestRegressor())]),
             n_jobs=-1,
             param_grid={&#39;randomforestregressor__max_depth&#39;: [2, 3, 4],
                         &#39;randomforestregressor__max_leaf_nodes&#39;: [2, 4, 6, 8],
                         &#39;randomforestregressor__min_samples_split&#39;: [2, 5, 10,
                                                                      15],
                         &#39;randomforestregressor__n_estimators&#39;: [400]},
             scoring=&#39;r2&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF_e</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                (&#39;randomforestregressor&#39;,
                 RandomForestRegressor(max_depth=2, max_leaf_nodes=6,
                                       min_samples_split=15,
                                       n_estimators=400))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">RF_e</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;plt.figure(figsize=(14,6))</span>
<span class="sd">plt.plot(residuals_train, label=&quot;Training data&quot;)</span>
<span class="sd">#plt.plot(residuales_AR, label=&quot;Test data&quot;)</span>
<span class="sd">plt.plot(y_tree, label=&quot;Tree prediction&quot;)</span>
<span class="sd">plt.legend();</span>

<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;plt.figure(figsize=(14,6))\nplt.plot(residuals_train, label=&quot;Training data&quot;)\n#plt.plot(residuales_AR, label=&quot;Test data&quot;)\nplt.plot(y_tree, label=&quot;Tree prediction&quot;)\nplt.legend();\n\n&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Tree prediction&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a87d131c337e8b8c0ff3ef3567f5031ce1fce7317bd3c27a897fc96993cdc0e9.png" src="../_images/a87d131c337e8b8c0ff3ef3567f5031ce1fce7317bd3c27a897fc96993cdc0e9.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1178.08
MAE: 925.66
RRMSE: -9.81
R-squared (R^2): 0.05
NSE (Nash-Sutcliffe Efficiency): 0.05
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF_e</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">residuales_train_extra</span><span class="p">,</span> <span class="n">residuals_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF_e</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">,</span> <span class="n">residuales_AR</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training-set score: 0.09
Test-set score: 0.05
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_residual</span> <span class="o">=</span> <span class="n">RF_e</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">)</span>

<span class="n">y_ARMA_RF</span> <span class="o">=</span> <span class="n">predictions_ARMA</span> <span class="o">+</span> <span class="n">y_residual</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">y_residual</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 1.43506090e+02  1.39949826e+02  1.39053744e+02  1.60085529e+01
  5.97779545e+01  6.35085775e+01  1.90238501e+01  7.93863660e+01
  1.34173046e+02 -6.15101174e+00 -1.88420896e+01  3.38977522e-01
  1.83358667e+01  2.17240719e+01  1.77995213e+01  1.46759489e+01
  4.04342984e+00 -5.11031951e+01 -1.02876168e+01 -2.43596408e+01
 -2.52176451e+01 -6.36249443e+01 -4.97423261e+01 -7.82509497e+02
 -2.82854295e+02 -8.62908656e+02 -3.19420207e+02 -2.31111268e+02
 -6.47951096e+02 -2.33650056e+02 -3.44265617e+02 -6.86637471e+02
 -2.90357756e+02 -4.79298263e+01  1.53742797e+00  5.78685642e+01
  1.22185675e+02  1.61193038e+02  8.31597946e+01  6.91906282e+01
  1.59783823e+02  1.71032624e+02  5.91718151e+01  1.17958255e+01
  1.96680514e+01  2.15994288e+01  2.28929588e+01  1.83338146e+02
  2.87284803e+01  3.66817425e+01  1.25941391e+02  7.23887998e+01
  4.96910205e+01  1.54125870e+02  4.87798444e+01  2.02973232e+01
  6.91906282e+01  1.73729307e+02  5.97779545e+01  5.68401862e+01
  8.89752484e+00  1.77658515e+01  5.36699693e-01 -1.72142036e+02
 -1.16657566e+02 -4.55168892e+01 -4.23073063e+01 -1.94053927e+02
 -3.38640830e+01 -7.43061965e+01  5.70057474e+00  1.49386772e+02
  1.53443131e+01  2.41097964e+01  1.53443131e+01 -1.50588868e+01
  1.20405410e+01  5.70057474e+00 -2.52176451e+01  5.30136862e+00
  1.78110218e+01 -5.42125072e+00  1.45362007e+00  1.49809767e+02
  1.41536590e+02  1.67282877e+02  1.13821690e+02  7.99839316e+01
  1.02563189e+02]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">y_ARMA_RF</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1072.73
MAE: 827.04
RRMSE: 0.17
R-squared (R^2): 0.76
NSE (Nash-Sutcliffe Efficiency): 0.76
</pre></div>
</div>
</div>
</div>
</section>
<section id="ar-ann">
<h3>AR-ANN<a class="headerlink" href="#ar-ann" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="c1">#plt.plot(data_test.Mes, y_pred, label=&quot;RF&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Caudal (m3/s)&#39;)
</pre></div>
</div>
<img alt="../_images/2c647242ef19397c30621fbeda30722e7be13b6d28c54f06c0be42c10d4b22b9.png" src="../_images/2c647242ef19397c30621fbeda30722e7be13b6d28c54f06c0be42c10d4b22b9.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_order</span> <span class="o">=</span> <span class="n">orden_ar</span>
<span class="n">history</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">train</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">residuals_train</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">resid</span>

<span class="n">residuales_train_lag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">residuales_train_extra</span> <span class="o">=</span> <span class="n">residuales_train_lag</span>
<span class="c1">#residuales_train_extra = np.column_stack((residuales_train_lag, X_train[:, 1]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">residuals_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ -366.64295624, -1351.58223592,  -533.30514997,  -831.25027626,
        1531.87660435,   733.94447797,   658.86193283,   710.10749014,
         848.88746436,  2020.95423151,  1414.10647682,   192.65899641,
       -2856.66871192, -1030.56695727,  -371.6023392 ,  -895.37010523,
        -365.28792655,  -447.16826419, -1616.86438941,  2041.99008813,
         348.26505768,   418.93074112,  1013.56452335,   342.93202992,
       -2332.9652862 ,   428.96455198,   103.99733384,  -536.64509875,
        1110.72951906,   265.43516947,  -127.75592678, -1519.04962938,
        1238.4468516 ,  1230.03457623,   805.69430814, -1165.03948861,
       -2611.35181747,  1416.8140149 , -1558.35060857,  -946.23572464,
         825.36025969,  -386.59377153, -1148.82090796,  2365.62792604,
       -1093.55493402,  1578.69648541,  1881.83211238,  -229.47462645,
       -3187.97397641,   787.59887145,  -783.19162225, -1010.21148911,
         -89.3534449 ,  -144.92215417,  1927.71605278,   186.58221539,
        2316.90677986,  1548.38706906,  1092.20004407,  1905.51106997,
        -777.26689543, -2174.38451165,  1060.0737208 , -1203.35494235,
        -277.03846748,   378.99358127,  -827.09194846,   190.31847758,
        1527.96856662,  1401.31463857,  1099.77865548,  -600.48826354,
       -1922.94421865,   517.60576706, -1077.17308778,  -563.69313052,
        1102.48941522,  -877.88605644,  -113.74338123,  -139.20641245,
         368.83543938,   792.8474569 ,  1145.93645473,    32.87940767,
       -2125.53176096, -1211.11098383,   966.14663497, -1477.83162635,
         438.33778118,  -197.55364801,  -399.7675264 ,    62.43601469,
        -966.10965078,  2404.81761995, -1220.84489209,   610.8142551 ,
       -3419.70135867,   432.57552494, -1157.48106418, -1637.39873181,
         718.96298229,  -784.42311106, -1069.16239332,  1117.1215091 ,
        -578.4866483 ,   490.22854673,  -424.81133628,   331.26588804,
       -2076.99332647,  -448.76160643,  -706.08996132,   529.33708426,
         498.61408073,   250.05350298,  -524.42779843,  -414.17030082,
        1546.31109752,   -96.72101403,   355.40766316,  1292.41336399,
       -1797.26848913, -1203.25541408,   906.96063482,  -133.85750223,
         336.13059323,   512.02554394,  -426.06616218,  -453.50318595,
         435.96711108,   870.09404586,   658.44814974,   171.08994185,
       -3866.21629428,    33.82578599,  -437.5209837 , -1168.36655233,
         514.24718123,    92.80506816,   277.52063222,  1449.19747506,
         503.92463377,    22.23897035,  2219.36415832, -1458.7419385 ,
       -1068.99619415,  -562.06896466,   739.41457248,  -865.04508554,
          37.98204217,  1925.87481503,  1140.42783694,   289.40701693,
         484.62725997,   970.60484917,  1073.89495258, -1053.79389449,
       -2485.84100183,   970.58636407, -2385.94288794,  -537.55205303,
        -246.98163871,  -374.10480215, -1048.64034418, -1255.74256831,
           5.63820276,   263.93606321,  -862.44379004, -1203.1957044 ,
       -1878.0319277 ,   347.80713597, -1902.36989656,   561.01902071,
         717.71487002,   236.91342688,   625.92198761,   161.68595841,
         854.91352927,   894.38111646,   545.77148812,  1377.93582659,
        -829.26943022,  -979.4048946 ,  2102.26340468,  -797.13637715,
         838.28469333,  1018.49979451,   895.39257097,  -589.60621452,
        1374.49454612,  2084.76816394,  1432.37400476,   123.2185123 ,
        -153.44098786, -2577.42349354,  1897.9600703 , -2052.96143234,
         650.0860085 ,  1091.51929154,   -46.5537064 ,  -264.68190535,
        1228.97252546,  1658.96685359,  -240.20543697,  -527.48697494,
       -2436.17405469,  -638.27730483,  -350.47095067, -1561.29679533,
        -339.62041944,   436.08555884, -1849.30262866,   -60.8069954 ,
         -92.1939294 ,   615.00272537,   277.71255238,   409.77555556,
       -1522.16911387, -2045.46527591,   434.80739729,  -118.06340735,
        -601.89470063,   869.8139069 , -1250.29414568, -1356.52002845,
         915.25018373,  -868.95919407,  1524.05225437, -2705.95036399,
       -1366.84107074,  -224.13370961, -1076.69484692,  -457.96880511,
         689.83427942,   -98.29943957,   458.77158681,  -558.39273958,
        -120.44424581,  1812.14453444,   828.64630895,   735.3829095 ,
       -1986.55241526, -2205.01136969,   676.38482091, -1249.14949345,
         540.03497256,   -76.48422013, -1568.49238185,  1005.66637548,
         -35.39550441,  1116.68089191,  1214.09443407,   696.48017015,
       -3126.89487821,   377.93790068,  -743.50863064,  -754.94858834,
         793.27497318,   406.52603167,  -420.71609462,  -632.24372314,
         625.38795049,   721.71356398,  1570.46224716,  1886.61317874,
       -3264.29946051,  -183.89570718,    12.96243777,   716.04177506,
         353.37917037,  1466.83920059,  -703.96226851, -1224.24136365,
        1934.47357251,  -923.34359453,  1455.05990451,   708.04905019,
       -2415.93905504, -1814.0178007 ,   427.8026091 ,   955.21913733,
         100.21614547,  1989.53269858,  -103.61718998,    62.40208184,
        2829.49568039,  -592.18506975,  3390.8293839 , -1001.92777132,
       -1458.99604545,  -856.13094862,   701.6549445 , -1434.84900694,
        1198.5154581 ,  1160.00456638,  1230.5562573 ,  1088.86225395,
        1468.67360703,   988.51129033,  2341.89668242,  1492.19488496,
       -3133.22084361,   117.55768206,  -119.45110179,   275.10311957,
        -625.30939807,  -267.81721871,   117.09482275, -1065.60534855,
         501.2524435 , -1495.1571017 ,  1775.39803949, -2349.66361582,
       -1962.33684472,   -33.85512302,  -632.30143713,  -421.3669904 ,
        1352.18627778,   840.39558187,  1608.82225624,  2250.47556191,
         712.48199616,  2499.95821501,   956.76054172,  1684.40980381,
       -1248.71624212, -2291.47860063,  2008.6241213 ,    66.53066743,
        2353.5729145 ,   -76.76007117,   140.46489196,  1249.97550016,
        -150.32592424,   926.3432692 ,  1631.78796012,  1675.48220967,
       -1551.18373351, -1583.46968166,  -168.63196321,  1570.829266  ,
         563.22640957, -1789.88346424,  -786.70803691,  1301.01796788,
        -589.56454218,  -784.5170546 ,  1384.81906944, -1799.83438703,
       -2300.44386738,   647.18954316,  -940.87716016, -1097.98020442,
        1262.9586726 ,   662.28191782, -2055.48235269])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">residuales_train_extra</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-2055.48235269,  -366.64295624, -1351.58223592,  -533.30514997,
        -831.25027626,  1531.87660435,   733.94447797,   658.86193283,
         710.10749014,   848.88746436,  2020.95423151,  1414.10647682,
         192.65899641, -2856.66871192, -1030.56695727,  -371.6023392 ,
        -895.37010523,  -365.28792655,  -447.16826419, -1616.86438941,
        2041.99008813,   348.26505768,   418.93074112,  1013.56452335,
         342.93202992, -2332.9652862 ,   428.96455198,   103.99733384,
        -536.64509875,  1110.72951906,   265.43516947,  -127.75592678,
       -1519.04962938,  1238.4468516 ,  1230.03457623,   805.69430814,
       -1165.03948861, -2611.35181747,  1416.8140149 , -1558.35060857,
        -946.23572464,   825.36025969,  -386.59377153, -1148.82090796,
        2365.62792604, -1093.55493402,  1578.69648541,  1881.83211238,
        -229.47462645, -3187.97397641,   787.59887145,  -783.19162225,
       -1010.21148911,   -89.3534449 ,  -144.92215417,  1927.71605278,
         186.58221539,  2316.90677986,  1548.38706906,  1092.20004407,
        1905.51106997,  -777.26689543, -2174.38451165,  1060.0737208 ,
       -1203.35494235,  -277.03846748,   378.99358127,  -827.09194846,
         190.31847758,  1527.96856662,  1401.31463857,  1099.77865548,
        -600.48826354, -1922.94421865,   517.60576706, -1077.17308778,
        -563.69313052,  1102.48941522,  -877.88605644,  -113.74338123,
        -139.20641245,   368.83543938,   792.8474569 ,  1145.93645473,
          32.87940767, -2125.53176096, -1211.11098383,   966.14663497,
       -1477.83162635,   438.33778118,  -197.55364801,  -399.7675264 ,
          62.43601469,  -966.10965078,  2404.81761995, -1220.84489209,
         610.8142551 , -3419.70135867,   432.57552494, -1157.48106418,
       -1637.39873181,   718.96298229,  -784.42311106, -1069.16239332,
        1117.1215091 ,  -578.4866483 ,   490.22854673,  -424.81133628,
         331.26588804, -2076.99332647,  -448.76160643,  -706.08996132,
         529.33708426,   498.61408073,   250.05350298,  -524.42779843,
        -414.17030082,  1546.31109752,   -96.72101403,   355.40766316,
        1292.41336399, -1797.26848913, -1203.25541408,   906.96063482,
        -133.85750223,   336.13059323,   512.02554394,  -426.06616218,
        -453.50318595,   435.96711108,   870.09404586,   658.44814974,
         171.08994185, -3866.21629428,    33.82578599,  -437.5209837 ,
       -1168.36655233,   514.24718123,    92.80506816,   277.52063222,
        1449.19747506,   503.92463377,    22.23897035,  2219.36415832,
       -1458.7419385 , -1068.99619415,  -562.06896466,   739.41457248,
        -865.04508554,    37.98204217,  1925.87481503,  1140.42783694,
         289.40701693,   484.62725997,   970.60484917,  1073.89495258,
       -1053.79389449, -2485.84100183,   970.58636407, -2385.94288794,
        -537.55205303,  -246.98163871,  -374.10480215, -1048.64034418,
       -1255.74256831,     5.63820276,   263.93606321,  -862.44379004,
       -1203.1957044 , -1878.0319277 ,   347.80713597, -1902.36989656,
         561.01902071,   717.71487002,   236.91342688,   625.92198761,
         161.68595841,   854.91352927,   894.38111646,   545.77148812,
        1377.93582659,  -829.26943022,  -979.4048946 ,  2102.26340468,
        -797.13637715,   838.28469333,  1018.49979451,   895.39257097,
        -589.60621452,  1374.49454612,  2084.76816394,  1432.37400476,
         123.2185123 ,  -153.44098786, -2577.42349354,  1897.9600703 ,
       -2052.96143234,   650.0860085 ,  1091.51929154,   -46.5537064 ,
        -264.68190535,  1228.97252546,  1658.96685359,  -240.20543697,
        -527.48697494, -2436.17405469,  -638.27730483,  -350.47095067,
       -1561.29679533,  -339.62041944,   436.08555884, -1849.30262866,
         -60.8069954 ,   -92.1939294 ,   615.00272537,   277.71255238,
         409.77555556, -1522.16911387, -2045.46527591,   434.80739729,
        -118.06340735,  -601.89470063,   869.8139069 , -1250.29414568,
       -1356.52002845,   915.25018373,  -868.95919407,  1524.05225437,
       -2705.95036399, -1366.84107074,  -224.13370961, -1076.69484692,
        -457.96880511,   689.83427942,   -98.29943957,   458.77158681,
        -558.39273958,  -120.44424581,  1812.14453444,   828.64630895,
         735.3829095 , -1986.55241526, -2205.01136969,   676.38482091,
       -1249.14949345,   540.03497256,   -76.48422013, -1568.49238185,
        1005.66637548,   -35.39550441,  1116.68089191,  1214.09443407,
         696.48017015, -3126.89487821,   377.93790068,  -743.50863064,
        -754.94858834,   793.27497318,   406.52603167,  -420.71609462,
        -632.24372314,   625.38795049,   721.71356398,  1570.46224716,
        1886.61317874, -3264.29946051,  -183.89570718,    12.96243777,
         716.04177506,   353.37917037,  1466.83920059,  -703.96226851,
       -1224.24136365,  1934.47357251,  -923.34359453,  1455.05990451,
         708.04905019, -2415.93905504, -1814.0178007 ,   427.8026091 ,
         955.21913733,   100.21614547,  1989.53269858,  -103.61718998,
          62.40208184,  2829.49568039,  -592.18506975,  3390.8293839 ,
       -1001.92777132, -1458.99604545,  -856.13094862,   701.6549445 ,
       -1434.84900694,  1198.5154581 ,  1160.00456638,  1230.5562573 ,
        1088.86225395,  1468.67360703,   988.51129033,  2341.89668242,
        1492.19488496, -3133.22084361,   117.55768206,  -119.45110179,
         275.10311957,  -625.30939807,  -267.81721871,   117.09482275,
       -1065.60534855,   501.2524435 , -1495.1571017 ,  1775.39803949,
       -2349.66361582, -1962.33684472,   -33.85512302,  -632.30143713,
        -421.3669904 ,  1352.18627778,   840.39558187,  1608.82225624,
        2250.47556191,   712.48199616,  2499.95821501,   956.76054172,
        1684.40980381, -1248.71624212, -2291.47860063,  2008.6241213 ,
          66.53066743,  2353.5729145 ,   -76.76007117,   140.46489196,
        1249.97550016,  -150.32592424,   926.3432692 ,  1631.78796012,
        1675.48220967, -1551.18373351, -1583.46968166,  -168.63196321,
        1570.829266  ,   563.22640957, -1789.88346424,  -786.70803691,
        1301.01796788,  -589.56454218,  -784.5170546 ,  1384.81906944,
       -1799.83438703, -2300.44386738,   647.18954316,  -940.87716016,
       -1097.98020442,  1262.9586726 ,   662.28191782])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Train data&quot;</span><span class="p">)</span>
<span class="c1">#plt.plot(data_test.Mes, y_pred, label=&quot;RF&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Caudal (m3/s)&#39;)
</pre></div>
</div>
<img alt="../_images/2ccce75afd1cfeefb7a626e82df05bee3da7544a5f7f38c3cbe75c00e628aec5.png" src="../_images/2ccce75afd1cfeefb7a626e82df05bee3da7544a5f7f38c3cbe75c00e628aec5.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>

<span class="c1"># Define a range of alpha values you want to test</span>
<span class="n">alpha_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>  <span class="c1"># Adjust as needed</span>

<span class="c1"># Create a pipeline with StandardScaler and Ridge regression</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">(),</span> <span class="n">Ridge</span><span class="p">())</span>

<span class="c1"># Define the parameter grid for the Ridge regression</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ridge__alpha&#39;</span><span class="p">:</span> <span class="n">alpha_values</span><span class="p">}</span>

<span class="c1"># Create the GridSearchCV object</span>
<span class="n">ridge_grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Fit the model to your training data</span>
<span class="n">ridge_grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">residuales_train_extra</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">residuals_train</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>


<span class="c1"># Evalúa el modelo en datos de prueba escalados</span>
<span class="n">y_pred_ridge</span> <span class="o">=</span> <span class="n">ridge_grid</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># Grafica los resultados</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos reales&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred_ridge</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicciones&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6280cb070b0fd241e58dadf93ee4b527e9c7820385635650b1c25dc4831af077.png" src="../_images/6280cb070b0fd241e58dadf93ee4b527e9c7820385635650b1c25dc4831af077.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">residuales_ARMA</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[726.3356016732514,
 1722.2530595960197,
 -1294.0712019808116,
 -224.48035002755023,
 -310.0528757577649,
 -1195.7873769506177,
 -142.03970455537365,
 599.5973285526161,
 -2437.0382638724373,
 1624.401823077069,
 -1175.7709761162268,
 -563.9001284287551,
 442.43326798858834,
 724.5377220258806,
 -314.94343632170694,
 -145.921283917427,
 65.79009948489329,
 -2720.9902182846854,
 1656.7387717125348,
 -1733.9508562007222,
 145.14616020887934,
 -1951.8053686200446,
 834.4540740069333,
 -1076.9274183967163,
 1071.2632864050447,
 -696.6248975198614,
 -1604.7622517233513,
 176.12839061694558,
 -1810.2077951211431,
 -423.38952479648515,
 279.55782531938667,
 -917.8662781032408,
 -1235.586594745631,
 593.4975058645596,
 -16.539100752452214,
 266.29331527663544,
 802.8744075748682,
 -108.46329638599855,
 -220.72322461851672,
 884.0614849630292,
 1029.507290617992,
 -232.67177752556745,
 -2100.5998513837912,
 269.54490840351264,
 458.10750552315494,
 125.14379098957215,
 1953.6410724482157,
 1004.1911549193828,
 -263.78722406475754,
 515.5369654733768,
 -270.19767860362845,
 -515.1707249228566,
 714.421236477072,
 -665.9847263251522,
 -2123.71866041466,
 -228.58814431867222,
 1015.8798881889543,
 -143.19433616564947,
 1703.4580918114152,
 -940.9857285379694,
 -435.35101941447283,
 318.22631880042354,
 764.0864061743232,
 275.2804700239176,
 -643.4260946004579,
 -3681.0153365709184,
 1461.1504177793627,
 -516.3315681357703,
 294.2251759957717,
 -697.4897103419426,
 1967.6986662446898,
 -642.0786037656926,
 -104.86864458012224,
 -477.20009245698293,
 1092.4227708983826,
 -50.39969894466776,
 -690.3479385281335,
 -1733.001982574243,
 -128.0558710880382,
 -310.62676533989406,
 -1527.5109438514587,
 -996.2819922590234,
 955.597913966496,
 1656.109744049195,
 930.4745737463318,
 1464.9126924153024,
 -441.714883049066,
 -83.15520046231723,
 773.7533497437398]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred_ridge</span>  <span class="o">=</span> <span class="n">y_pred_ridge</span> <span class="o">-</span> <span class="mi">1000</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">residuales_ARMA</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[726.3356016732514,
 1722.2530595960197,
 -1294.0712019808116,
 -224.48035002755023,
 -310.0528757577649,
 -1195.7873769506177,
 -142.03970455537365,
 599.5973285526161,
 -2437.0382638724373,
 1624.401823077069,
 -1175.7709761162268,
 -563.9001284287551,
 442.43326798858834,
 724.5377220258806,
 -314.94343632170694,
 -145.921283917427,
 65.79009948489329,
 -2720.9902182846854,
 1656.7387717125348,
 -1733.9508562007222,
 145.14616020887934,
 -1951.8053686200446,
 834.4540740069333,
 -1076.9274183967163,
 1071.2632864050447,
 -696.6248975198614,
 -1604.7622517233513,
 176.12839061694558,
 -1810.2077951211431,
 -423.38952479648515,
 279.55782531938667,
 -917.8662781032408,
 -1235.586594745631,
 593.4975058645596,
 -16.539100752452214,
 266.29331527663544,
 802.8744075748682,
 -108.46329638599855,
 -220.72322461851672,
 884.0614849630292,
 1029.507290617992,
 -232.67177752556745,
 -2100.5998513837912,
 269.54490840351264,
 458.10750552315494,
 125.14379098957215,
 1953.6410724482157,
 1004.1911549193828,
 -263.78722406475754,
 515.5369654733768,
 -270.19767860362845,
 -515.1707249228566,
 714.421236477072,
 -665.9847263251522,
 -2123.71866041466,
 -228.58814431867222,
 1015.8798881889543,
 -143.19433616564947,
 1703.4580918114152,
 -940.9857285379694,
 -435.35101941447283,
 318.22631880042354,
 764.0864061743232,
 275.2804700239176,
 -643.4260946004579,
 -3681.0153365709184,
 1461.1504177793627,
 -516.3315681357703,
 294.2251759957717,
 -697.4897103419426,
 1967.6986662446898,
 -642.0786037656926,
 -104.86864458012224,
 -477.20009245698293,
 1092.4227708983826,
 -50.39969894466776,
 -690.3479385281335,
 -1733.001982574243,
 -128.0558710880382,
 -310.62676533989406,
 -1527.5109438514587,
 -996.2819922590234,
 955.597913966496,
 1656.109744049195,
 930.4745737463318,
 1464.9126924153024,
 -441.714883049066,
 -83.15520046231723,
 773.7533497437398]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define el modelo de red neuronal</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">residuales_train_extra</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Compila el modelo</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">)</span>


<span class="c1"># Escala los datos</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>


<span class="c1"># Define el callback EarlyStopping</span>
<span class="n">early_stopping</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Entrena el modelo con los datos escalados</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">residuales_train_extra</span><span class="p">,</span> <span class="n">residuals_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                        <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">early_stopping</span><span class="p">])</span>


<span class="c1"># Evalúa el modelo en datos de prueba escalados</span>
<span class="n">y_pred_NN</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">)</span>

<span class="c1"># Grafica los resultados</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos reales&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred_NN</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicciones&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/1000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3/3 [==============================] - 1s 62ms/step - loss: 1443993.1250 - val_loss: 2094019.8750
Epoch 2/1000
3/3 [==============================] - 0s 15ms/step - loss: 1438488.7500 - val_loss: 2097637.0000
Epoch 3/1000
3/3 [==============================] - 0s 16ms/step - loss: 1441351.2500 - val_loss: 2093572.5000
Epoch 4/1000
3/3 [==============================] - 0s 15ms/step - loss: 1441707.2500 - val_loss: 2092826.3750
Epoch 5/1000
3/3 [==============================] - 0s 13ms/step - loss: 1444787.3750 - val_loss: 2090272.5000
Epoch 6/1000
3/3 [==============================] - 0s 14ms/step - loss: 1443848.7500 - val_loss: 2087766.5000
Epoch 7/1000
3/3 [==============================] - 0s 13ms/step - loss: 1440923.1250 - val_loss: 2088534.5000
Epoch 8/1000
3/3 [==============================] - 0s 13ms/step - loss: 1439355.3750 - val_loss: 2093504.0000
Epoch 9/1000
3/3 [==============================] - 0s 13ms/step - loss: 1438272.6250 - val_loss: 2100410.7500
Epoch 10/1000
3/3 [==============================] - 0s 11ms/step - loss: 1440351.7500 - val_loss: 2108517.0000
Epoch 11/1000
3/3 [==============================] - 0s 12ms/step - loss: 1442387.8750 - val_loss: 2113245.2500
Epoch 12/1000
3/3 [==============================] - 0s 12ms/step - loss: 1442584.6250 - val_loss: 2116217.7500
Epoch 13/1000
3/3 [==============================] - 0s 12ms/step - loss: 1442013.0000 - val_loss: 2108750.7500
Epoch 14/1000
3/3 [==============================] - 0s 13ms/step - loss: 1440992.6250 - val_loss: 2098767.7500
Epoch 15/1000
3/3 [==============================] - 0s 12ms/step - loss: 1438947.7500 - val_loss: 2094583.2500
Epoch 16/1000
3/3 [==============================] - 0s 12ms/step - loss: 1439065.2500 - val_loss: 2090972.1250
Epoch 17/1000
3/3 [==============================] - 0s 13ms/step - loss: 1439400.5000 - val_loss: 2089194.1250
Epoch 18/1000
3/3 [==============================] - 0s 13ms/step - loss: 1440109.2500 - val_loss: 2087057.7500
Epoch 19/1000
3/3 [==============================] - 0s 13ms/step - loss: 1440686.6250 - val_loss: 2084952.1250
Epoch 20/1000
3/3 [==============================] - 0s 12ms/step - loss: 1440366.6250 - val_loss: 2084816.8750
Epoch 21/1000
3/3 [==============================] - 0s 12ms/step - loss: 1440915.7500 - val_loss: 2087942.1250
Epoch 22/1000
3/3 [==============================] - 0s 12ms/step - loss: 1439614.1250 - val_loss: 2090000.8750
Epoch 23/1000
3/3 [==============================] - 0s 12ms/step - loss: 1439920.7500 - val_loss: 2094805.3750
Epoch 24/1000
3/3 [==============================] - 0s 13ms/step - loss: 1439566.8750 - val_loss: 2095796.7500
Epoch 25/1000
3/3 [==============================] - 0s 12ms/step - loss: 1440478.2500 - val_loss: 2094580.2500
Epoch 26/1000
3/3 [==============================] - 0s 13ms/step - loss: 1439159.0000 - val_loss: 2095527.2500
Epoch 27/1000
3/3 [==============================] - 0s 12ms/step - loss: 1439221.8750 - val_loss: 2093897.7500
Epoch 28/1000
3/3 [==============================] - 0s 12ms/step - loss: 1439406.6250 - val_loss: 2090069.8750
Epoch 29/1000
3/3 [==============================] - 0s 12ms/step - loss: 1439126.3750 - val_loss: 2087979.5000
Epoch 30/1000
3/3 [==============================] - 0s 13ms/step - loss: 1439532.0000 - val_loss: 2086509.5000
Epoch 31/1000
3/3 [==============================] - 0s 12ms/step - loss: 1439711.1250 - val_loss: 2085697.3750
Epoch 32/1000
3/3 [==============================] - 0s 13ms/step - loss: 1439705.7500 - val_loss: 2086285.2500
Epoch 33/1000
3/3 [==============================] - 0s 12ms/step - loss: 1440009.0000 - val_loss: 2087977.5000
Epoch 34/1000
3/3 [==============================] - 0s 12ms/step - loss: 1440481.8750 - val_loss: 2090130.0000
Epoch 35/1000
3/3 [==============================] - 0s 12ms/step - loss: 1438989.7500 - val_loss: 2092359.8750
Epoch 36/1000
3/3 [==============================] - 0s 12ms/step - loss: 1438715.0000 - val_loss: 2097346.0000
Epoch 37/1000
3/3 [==============================] - 0s 12ms/step - loss: 1438965.1250 - val_loss: 2101167.2500
Epoch 38/1000
3/3 [==============================] - 0s 13ms/step - loss: 1439488.1250 - val_loss: 2102114.5000
Epoch 39/1000
3/3 [==============================] - 0s 13ms/step - loss: 1439887.0000 - val_loss: 2101805.2500
Epoch 40/1000
3/3 [==============================] - 0s 12ms/step - loss: 1439800.1250 - val_loss: 2100144.2500
Epoch 41/1000
3/3 [==============================] - 0s 12ms/step - loss: 1439376.6250 - val_loss: 2099229.2500
Epoch 42/1000
3/3 [==============================] - 0s 13ms/step - loss: 1439300.0000 - val_loss: 2098393.2500
Epoch 43/1000
3/3 [==============================] - 0s 12ms/step - loss: 1438923.0000 - val_loss: 2099762.0000
Epoch 44/1000
3/3 [==============================] - 0s 12ms/step - loss: 1439778.5000 - val_loss: 2102072.7500
Epoch 45/1000
3/3 [==============================] - 0s 12ms/step - loss: 1439846.8750 - val_loss: 2099785.7500
Epoch 46/1000
3/3 [==============================] - 0s 12ms/step - loss: 1439164.1250 - val_loss: 2094711.8750
Epoch 47/1000
3/3 [==============================] - 0s 13ms/step - loss: 1439340.6250 - val_loss: 2092032.5000
Epoch 48/1000
3/3 [==============================] - 0s 12ms/step - loss: 1438903.5000 - val_loss: 2090571.2500
Epoch 49/1000
3/3 [==============================] - 0s 12ms/step - loss: 1439139.5000 - val_loss: 2090106.6250
Epoch 50/1000
3/3 [==============================] - 0s 13ms/step - loss: 1439068.5000 - val_loss: 2087928.3750
3/3 [==============================] - 0s 1ms/step
</pre></div>
</div>
<img alt="../_images/c01cd7f15f9399216305ff4f91ea5f08c692829ef40d2704f682a66f04cab2cc.png" src="../_images/c01cd7f15f9399216305ff4f91ea5f08c692829ef40d2704f682a66f04cab2cc.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred_ridge</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Tree prediction&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7269e79ebdb134f7e6039b55d0d5d76e55d2d61efa2d2e29bc6b5237c8ce8c28.png" src="../_images/7269e79ebdb134f7e6039b55d0d5d76e55d2d61efa2d2e29bc6b5237c8ce8c28.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">y_pred_ridge</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1610.74
MAE: 1285.67
RRMSE: -13.41
R-squared (R^2): -0.77
NSE (Nash-Sutcliffe Efficiency): -0.77
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred_NN</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">y_pred_NN</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_AR_NN</span> <span class="o">=</span> <span class="n">predictions_AR</span> <span class="o">+</span> <span class="n">y_pred_NN</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">y_AR_NN</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>178
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">y_AR_NN</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="o">~</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Temp</span>\<span class="n">ipykernel_14148</span>\<span class="mf">3148504773.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">metricas</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">y_AR_NN</span><span class="p">)</span>

<span class="nn">~\AppData\Local\Temp\ipykernel_14148\1041418915.py</span> in <span class="ni">metricas</span><span class="nt">(y_test, y_pred)</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Calculo de Metricas</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="k">def</span> <span class="nf">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred</span><span class="p">):</span>
<span class="ne">----&gt; </span><span class="mi">3</span>     <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>

<span class="nn">c:\ProgramData\Anaconda3\lib\site-packages\sklearn\metrics\_regression.py</span> in <span class="ni">mean_absolute_error</span><span class="nt">(y_true, y_pred, sample_weight, multioutput)</span>
<span class="g g-Whitespace">    </span><span class="mi">189</span>     <span class="mf">0.85</span><span class="o">...</span>
<span class="g g-Whitespace">    </span><span class="mi">190</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">191</span><span class="sd">     y_type, y_true, y_pred, multioutput = _check_reg_targets(</span>
<span class="g g-Whitespace">    </span><span class="mi">192</span><span class="sd">         y_true, y_pred, multioutput</span>
<span class="g g-Whitespace">    </span><span class="mi">193</span><span class="sd">     )</span>

<span class="nn">c:\ProgramData\Anaconda3\lib\site-packages\sklearn\metrics\_regression.py</span> in <span class="ni">_check_reg_targets</span><span class="nt">(y_true, y_pred, multioutput, dtype)</span>
<span class="g g-Whitespace">     </span><span class="mi">92</span><span class="sd">         the dtype argument passed to check_array.</span>
<span class="g g-Whitespace">     </span><span class="mi">93</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">---&gt; </span><span class="mi">94</span>     <span class="n">check_consistent_length</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">95</span>     <span class="n">y_true</span> <span class="o">=</span> <span class="n">check_array</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">ensure_2d</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">96</span>     <span class="n">y_pred</span> <span class="o">=</span> <span class="n">check_array</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">ensure_2d</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>

<span class="nn">c:\ProgramData\Anaconda3\lib\site-packages\sklearn\utils\validation.py</span> in <span class="ni">check_consistent_length</span><span class="nt">(*arrays)</span>
<span class="g g-Whitespace">    </span><span class="mi">330</span>     <span class="n">uniques</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">331</span>     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">uniques</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">332</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">333</span>             <span class="s2">&quot;Found input variables with inconsistent numbers of samples: </span><span class="si">%r</span><span class="s2">&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">334</span>             <span class="o">%</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lengths</span><span class="p">]</span>

<span class="ne">ValueError</span>: Found input variables with inconsistent numbers of samples: [89, 178]
</pre></div>
</div>
</div>
</div>
</section>
<section id="arma-ann">
<h3>ARMA-ANN<a class="headerlink" href="#arma-ann" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_ARMA</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="c1">#plt.plot(data_test.Mes, y_pred, label=&quot;RF&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Caudal (m3/s)&#39;)
</pre></div>
</div>
<img alt="../_images/c717374804f9c509f95765ebb4ea8f3b8e06bf245d7ac294b903bd39917811a7.png" src="../_images/c717374804f9c509f95765ebb4ea8f3b8e06bf245d7ac294b903bd39917811a7.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_order</span> <span class="o">=</span> <span class="n">orden_arma</span>
<span class="n">history</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">train</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">residuals_train</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">resid</span>

<span class="n">residuales_train_lag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#residuales_train_extra = residuales_train_lag</span>
<span class="n">residuales_train_extra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">residuales_train_lag</span><span class="p">,</span> <span class="n">X_train</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">residuales_train_extra</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-9.95316452e+02, -9.00000000e-01],
       [-3.66642685e+02, -6.00000000e-01],
       [-1.33301501e+03, -4.00000000e-01],
       [-5.35182063e+02, -3.00000000e-01],
       [-7.43209384e+02, -4.00000000e-01],
       [ 1.65822042e+03, -5.00000000e-01],
       [ 1.03503090e+03, -4.00000000e-01],
       [ 9.19765051e+02, -3.00000000e-01],
       [ 5.88513585e+02, -2.00000000e-01],
       [ 7.49303034e+02, -2.00000000e-01],
       [ 1.79242984e+03, -6.00000000e-01],
       [ 1.14860395e+03, -9.00000000e-01],
       [-2.32944715e+02, -1.10000000e+00],
       [-3.42084525e+03, -1.00000000e+00],
       [-1.54023016e+03, -8.00000000e-01],
       [-1.55261066e+02, -8.00000000e-01],
       [-1.46731871e+02, -8.00000000e-01],
       [-2.51598233e+02, -8.00000000e-01],
       [-4.95658197e+02, -6.00000000e-01],
       [-1.27402632e+03, -5.00000000e-01],
       [ 2.47469354e+03, -5.00000000e-01],
       [ 1.04391403e+03, -4.00000000e-01],
       [ 3.62001390e+02, -3.00000000e-01],
       [-3.80035330e+01, -3.00000000e-01],
       [-8.48324210e+01, -4.00000000e-01],
       [-2.09799281e+03, -5.00000000e-01],
       [ 5.10897485e+02, -5.00000000e-01],
       [ 3.33775065e+02, -3.00000000e-01],
       [-4.02240371e+02, -2.00000000e-01],
       [ 5.94687537e+02, -1.00000000e-01],
       [ 3.44787899e+02,  0.00000000e+00],
       [ 4.26300318e+02,  2.00000000e-01],
       [-1.25738564e+03,  4.00000000e-01],
       [ 8.45294325e+02,  7.00000000e-01],
       [ 8.86784313e+02,  9.00000000e-01],
       [ 7.74982187e+02,  1.10000000e+00],
       [-1.28041023e+03,  1.20000000e+00],
       [-2.67610135e+03,  1.20000000e+00],
       [ 1.35740211e+03,  1.20000000e+00],
       [-8.76449432e+02,  1.10000000e+00],
       [-9.51257692e+02,  9.00000000e-01],
       [ 5.82299633e+01,  1.00000000e+00],
       [ 1.99372833e+01,  1.20000000e+00],
       [-2.69521399e+02,  1.50000000e+00],
       [ 2.79997011e+03,  1.70000000e+00],
       [-7.95339950e+02,  1.60000000e+00],
       [ 7.53376185e+02,  1.50000000e+00],
       [ 9.14952015e+02,  1.30000000e+00],
       [ 7.36828180e+01,  1.10000000e+00],
       [-2.92901518e+03,  8.00000000e-01],
       [ 4.45615001e+02,  5.00000000e-01],
       [-6.52973640e+02,  1.00000000e-01],
       [-8.93264371e+02, -3.00000000e-01],
       [-5.71432940e+02, -9.00000000e-01],
       [ 1.80165642e+02, -1.30000000e+00],
       [ 2.87242394e+03, -1.30000000e+00],
       [ 1.17421993e+03, -1.10000000e+00],
       [ 2.02997963e+03, -1.20000000e+00],
       [ 4.07719746e+02, -1.50000000e+00],
       [ 1.85099447e+02, -1.80000000e+00],
       [ 1.45541593e+03, -1.80000000e+00],
       [-3.43233811e+02, -1.70000000e+00],
       [-2.19607772e+03, -1.40000000e+00],
       [ 1.36694844e+02, -1.10000000e+00],
       [-1.43740237e+03, -8.00000000e-01],
       [-1.82465238e+02, -6.00000000e-01],
       [ 6.84414082e+02, -4.00000000e-01],
       [ 1.25712727e+02, -3.00000000e-01],
       [ 5.66417689e+02, -3.00000000e-01],
       [ 1.28906082e+03, -2.00000000e-01],
       [ 1.05416412e+03, -2.00000000e-01],
       [ 6.76711627e+02, -2.00000000e-01],
       [-8.59270482e+02, -1.00000000e-01],
       [-2.03368654e+03,  1.00000000e-01],
       [ 3.64722208e+02,  2.00000000e-01],
       [-8.00383038e+02,  3.00000000e-01],
       [-6.11629259e+02,  3.00000000e-01],
       [ 7.49382723e+02,  3.00000000e-01],
       [-3.22320122e+02,  3.00000000e-01],
       [ 4.90751494e+02,  3.00000000e-01],
       [ 1.13312024e+02,  4.00000000e-01],
       [ 2.39113257e+02,  4.00000000e-01],
       [ 2.14194686e+02,  3.00000000e-01],
       [ 7.82957079e+02,  4.00000000e-01],
       [ 2.15415015e+02,  4.00000000e-01],
       [-1.76689539e+03,  4.00000000e-01],
       [-1.38786352e+03,  3.00000000e-01],
       [ 6.97439958e+02,  2.00000000e-01],
       [-1.26051195e+03,  3.00000000e-01],
       [ 2.86722329e+02,  5.00000000e-01],
       [-2.87263300e+01,  6.00000000e-01],
       [ 4.23021177e+02,  7.00000000e-01],
       [ 4.94406089e+02,  6.00000000e-01],
       [-1.06618441e+03,  6.00000000e-01],
       [ 1.61050369e+03,  8.00000000e-01],
       [-1.39843139e+03,  1.20000000e+00],
       [ 6.67075199e+02,  1.50000000e+00],
       [-3.11244299e+03,  1.70000000e+00],
       [ 6.12307585e+02,  1.60000000e+00],
       [-1.01953607e+03,  1.50000000e+00],
       [-1.50686152e+03,  1.30000000e+00],
       [ 2.09004325e+02,  1.10000000e+00],
       [-1.91491557e+02,  7.00000000e-01],
       [-1.10258413e+02,  4.00000000e-01],
       [ 1.51292211e+03,  1.00000000e-01],
       [-4.22346472e+02, -1.00000000e-01],
       [-1.35801557e+02, -2.00000000e-01],
       [-1.13589702e+03, -3.00000000e-01],
       [ 4.06335797e+02, -1.00000000e-01],
       [-1.38113108e+03,  1.00000000e-01],
       [-6.75593224e+01,  3.00000000e-01],
       [-8.09446546e+02,  5.00000000e-01],
       [ 3.47137491e+02,  7.00000000e-01],
       [ 4.35411644e+02,  7.00000000e-01],
       [ 6.84568585e+02,  6.00000000e-01],
       [-6.23898345e+01,  3.00000000e-01],
       [-3.13816667e+02,  3.00000000e-01],
       [ 1.16947082e+03,  2.00000000e-01],
       [-3.54301597e+02,  1.00000000e-01],
       [-2.98572859e+01,  0.00000000e+00],
       [ 1.14216685e+03,  1.00000000e-01],
       [-1.14398933e+03,  1.00000000e-01],
       [-1.15121390e+03,  1.00000000e-01],
       [ 3.99165948e+02,  2.00000000e-01],
       [-1.36601377e+02,  3.00000000e-01],
       [ 3.20645250e+02,  4.00000000e-01],
       [ 6.13350073e+02,  4.00000000e-01],
       [ 1.02606686e+02,  4.00000000e-01],
       [-2.28559949e+02,  4.00000000e-01],
       [ 1.16540941e+02,  6.00000000e-01],
       [ 4.18091844e+02,  7.00000000e-01],
       [ 4.13264122e+02,  1.00000000e+00],
       [ 2.39702028e+02,  1.10000000e+00],
       [-3.56904481e+03,  1.00000000e+00],
       [-2.58316623e+02,  7.00000000e-01],
       [-2.78962384e+02,  5.00000000e-01],
       [-6.66497474e+02,  3.00000000e-01],
       [ 2.55732249e+02,  1.00000000e-01],
       [ 3.63618062e+02,  0.00000000e+00],
       [ 1.03831693e+03, -2.00000000e-01],
       [ 1.97363540e+03, -5.00000000e-01],
       [ 5.15029194e+02, -8.00000000e-01],
       [-8.75482789e+02, -1.00000000e+00],
       [ 1.06359832e+03, -1.00000000e+00],
       [-1.36940663e+03, -1.00000000e+00],
       [-7.06779455e+02, -9.00000000e-01],
       [-4.62128064e+02, -8.00000000e-01],
       [ 9.59594237e+02, -6.00000000e-01],
       [-8.96841187e+02, -4.00000000e-01],
       [-3.78266051e+02, -3.00000000e-01],
       [ 1.85097313e+03, -3.00000000e-01],
       [ 2.13173274e+03, -3.00000000e-01],
       [ 8.81439699e+02, -3.00000000e-01],
       [-2.39384473e+02, -4.00000000e-01],
       [-2.41313289e+02, -4.00000000e-01],
       [ 4.47512033e+02, -4.00000000e-01],
       [-8.50143122e+02, -5.00000000e-01],
       [-2.24715604e+03, -5.00000000e-01],
       [ 8.47131414e+02, -4.00000000e-01],
       [-1.95339550e+03, -1.00000000e-01],
       [-6.06176310e+02,  3.00000000e-01],
       [-5.38990230e+02,  8.00000000e-01],
       [ 2.51541629e+02,  1.20000000e+00],
       [-3.16584035e+02,  1.60000000e+00],
       [-8.84949976e+02,  1.90000000e+00],
       [-2.11355740e+02,  2.10000000e+00],
       [ 8.23776655e+01,  2.30000000e+00],
       [-7.94838809e+02,  2.40000000e+00],
       [-1.12152259e+03,  2.40000000e+00],
       [-1.61303344e+03,  2.20000000e+00],
       [ 7.25979829e+02,  1.90000000e+00],
       [-1.37931821e+03,  1.40000000e+00],
       [ 4.49727556e+02,  1.00000000e+00],
       [ 5.57073669e+02,  5.00000000e-01],
       [ 7.78033865e+02, -1.00000000e-01],
       [ 1.01514397e+03, -8.00000000e-01],
       [ 3.25229921e+02, -1.10000000e+00],
       [ 4.75930930e+02, -1.30000000e+00],
       [ 2.70498723e+02, -1.40000000e+00],
       [ 1.51501554e+02, -1.50000000e+00],
       [ 1.30641427e+03, -1.60000000e+00],
       [-4.44714924e+02, -1.50000000e+00],
       [-1.00126588e+03, -1.30000000e+00],
       [ 1.54257200e+03, -1.10000000e+00],
       [-7.46007129e+02, -1.00000000e+00],
       [ 6.13410754e+02, -1.00000000e+00],
       [ 8.36378990e+02, -1.00000000e+00],
       [ 1.41067930e+03, -1.10000000e+00],
       [-3.62283612e+02, -1.10000000e+00],
       [ 8.53231927e+02, -1.20000000e+00],
       [ 1.50129481e+03, -1.30000000e+00],
       [ 1.33580759e+03, -1.50000000e+00],
       [-4.49117146e+01, -1.70000000e+00],
       [-4.78355841e+02, -1.70000000e+00],
       [-2.82604631e+03, -1.40000000e+00],
       [ 1.45572188e+03, -1.10000000e+00],
       [-1.79606158e+03, -8.00000000e-01],
       [ 7.06393263e+02, -7.00000000e-01],
       [ 1.06549463e+03, -6.00000000e-01],
       [ 8.16628744e+02, -6.00000000e-01],
       [-9.92028797e+00, -5.00000000e-01],
       [ 8.46625718e+02, -5.00000000e-01],
       [ 1.20094206e+03, -6.00000000e-01],
       [-5.37364230e+02, -7.00000000e-01],
       [-1.01010550e+03, -7.00000000e-01],
       [-2.59971422e+03, -7.00000000e-01],
       [-4.66194348e+02, -5.00000000e-01],
       [ 1.39587849e+02, -4.00000000e-01],
       [-1.11103867e+03, -3.00000000e-01],
       [-6.42279258e+02, -3.00000000e-01],
       [ 4.77239251e+02, -1.00000000e-01],
       [-9.76607371e+02, -1.00000000e-01],
       [ 3.81935986e+02, -1.00000000e-01],
       [-6.13697043e+01, -2.00000000e-01],
       [ 4.45590242e+02, -3.00000000e-01],
       [-6.29708624e+01, -3.00000000e-01],
       [ 4.09832482e+02, -3.00000000e-01],
       [-1.16222241e+03, -1.00000000e-01],
       [-1.87585141e+03,  0.00000000e+00],
       [ 1.46880103e+02,  1.00000000e-01],
       [-1.36791089e+01,  2.00000000e-01],
       [-4.37333646e+02,  4.00000000e-01],
       [ 8.70393318e+02,  7.00000000e-01],
       [-6.41328315e+02,  8.00000000e-01],
       [-9.59592490e+02,  9.00000000e-01],
       [ 6.38741171e+02,  1.00000000e+00],
       [-9.54911806e+02,  1.20000000e+00],
       [ 1.19921693e+03,  1.30000000e+00],
       [-2.59340320e+03,  1.10000000e+00],
       [-1.16716989e+03,  9.00000000e-01],
       [ 3.96428164e+01,  6.00000000e-01],
       [-2.68803022e+02,  4.00000000e-01],
       [-5.15986651e+02,  0.00000000e+00],
       [ 2.35161513e+02, -3.00000000e-01],
       [ 1.19050257e+02, -2.00000000e-01],
       [ 1.12759131e+03,  1.00000000e-01],
       [ 1.54453266e+01,  2.00000000e-01],
       [-2.88131290e+02,  3.00000000e-01],
       [ 9.98535130e+02,  3.00000000e-01],
       [ 5.20314642e+02,  4.00000000e-01],
       [ 8.12087119e+02,  4.00000000e-01],
       [-1.75276529e+03,  4.00000000e-01],
       [-2.28518076e+03,  3.00000000e-01],
       [ 2.79663363e+02,  2.00000000e-01],
       [-9.97534330e+02,  2.00000000e-01],
       [ 5.85568588e+02,  2.00000000e-01],
       [ 8.29374781e+01,  3.00000000e-01],
       [-8.55154765e+02,  5.00000000e-01],
       [ 1.31392399e+03,  6.00000000e-01],
       [ 2.58702850e+02,  7.00000000e-01],
       [ 7.98768291e+02,  7.00000000e-01],
       [ 4.48526634e+02,  7.00000000e-01],
       [ 5.17631195e+02,  7.00000000e-01],
       [-2.84001933e+03,  6.00000000e-01],
       [ 2.92888024e+02,  6.00000000e-01],
       [-5.63402441e+02,  4.00000000e-01],
       [-6.22671964e+02,  4.00000000e-01],
       [ 2.30940016e+02,  3.00000000e-01],
       [ 6.17777983e+02,  1.00000000e-01],
       [ 4.01081809e+02, -1.00000000e-01],
       [-9.48540251e+01, -1.00000000e-01],
       [ 4.41797820e+02, -1.00000000e-01],
       [ 1.48693736e+02, -3.00000000e-01],
       [ 1.00422938e+03, -6.00000000e-01],
       [ 1.84128845e+03, -8.00000000e-01],
       [-2.67230337e+03, -9.00000000e-01],
       [-4.68096976e+02, -8.00000000e-01],
       [-2.77328444e+02, -6.00000000e-01],
       [ 8.76985816e+02, -4.00000000e-01],
       [ 1.16075011e+02, -1.00000000e-01],
       [ 1.37161799e+03,  0.00000000e+00],
       [-2.16757579e+02,  1.00000000e-01],
       [-7.98770306e+02,  3.00000000e-01],
       [ 1.58720435e+03,  5.00000000e-01],
       [-1.15859342e+03,  8.00000000e-01],
       [ 6.92002150e+02,  9.00000000e-01],
       [ 3.57676087e+02,  9.00000000e-01],
       [-1.65540027e+03,  7.00000000e-01],
       [-1.56272226e+03,  2.00000000e-01],
       [ 3.73212061e+02, -1.00000000e-01],
       [ 1.07336429e+03, -3.00000000e-01],
       [ 1.98544314e+01, -4.00000000e-01],
       [ 1.69598355e+03, -5.00000000e-01],
       [ 3.99597320e+02, -6.00000000e-01],
       [ 6.51454252e+02, -8.00000000e-01],
       [ 2.57616401e+03, -1.10000000e+00],
       [-1.05917313e+03, -1.30000000e+00],
       [ 2.04943213e+03, -1.50000000e+00],
       [-1.53509855e+03, -1.60000000e+00],
       [-1.14110559e+03, -1.60000000e+00],
       [-7.08684737e+02, -1.50000000e+00],
       [ 1.14596045e+03, -1.30000000e+00],
       [-1.44980930e+03, -1.00000000e+00],
       [ 3.79575951e+02, -8.00000000e-01],
       [ 9.69072082e+02, -6.00000000e-01],
       [ 2.32647700e+03, -4.00000000e-01],
       [ 1.99078963e+03, -2.00000000e-01],
       [ 1.31236770e+03, -2.00000000e-01],
       [-3.02921746e+02, -4.00000000e-01],
       [ 8.61131429e+02, -6.00000000e-01],
       [ 1.10190903e+03, -7.00000000e-01],
       [-2.53478811e+03, -8.00000000e-01],
       [-2.61343957e+01, -8.00000000e-01],
       [-2.00923972e+02, -6.00000000e-01],
       [ 3.37856360e+02, -3.00000000e-01],
       [-1.08759238e+03,  0.00000000e+00],
       [-4.74047264e+02,  3.00000000e-01],
       [ 6.51562904e+02,  5.00000000e-01],
       [-1.22342817e+01,  6.00000000e-01],
       [ 6.52232351e+02,  7.00000000e-01],
       [-2.13881218e+03,  1.00000000e+00],
       [ 8.12325009e+02,  1.40000000e+00],
       [-2.20993554e+03,  1.60000000e+00],
       [-1.22608594e+03,  1.50000000e+00],
       [ 4.28680018e+02,  1.20000000e+00],
       [ 1.24656407e+02,  8.00000000e-01],
       [-5.54765672e+02,  4.00000000e-01],
       [ 6.76714433e+02, -2.00000000e-01],
       [ 1.01795752e+03, -7.00000000e-01],
       [ 2.44223848e+03, -1.00000000e+00],
       [ 2.85517874e+03, -1.30000000e+00],
       [ 5.07368273e+02, -1.60000000e+00],
       [ 1.02920575e+03, -1.60000000e+00],
       [-3.15117605e+02, -1.60000000e+00],
       [ 1.32584027e+03, -1.60000000e+00],
       [-8.94835880e+02, -1.40000000e+00],
       [-2.16154568e+03, -1.20000000e+00],
       [ 1.30839684e+03, -9.00000000e-01],
       [ 1.36305045e+02, -7.00000000e-01],
       [ 2.44279618e+03, -6.00000000e-01],
       [ 1.42820255e+01, -4.00000000e-01],
       [ 3.07923273e+02, -5.00000000e-01],
       [ 1.07961058e+03, -6.00000000e-01],
       [-1.86167573e+02, -8.00000000e-01],
       [ 1.64296584e+02, -1.00000000e+00],
       [ 8.34320554e+02, -1.10000000e+00],
       [ 1.78612864e+03, -1.00000000e+00],
       [-9.37435552e+02, -9.00000000e-01],
       [-1.67086247e+03, -7.00000000e-01],
       [-8.61137151e+02, -6.00000000e-01],
       [ 1.29929849e+03, -5.00000000e-01],
       [ 7.89742013e+02, -3.00000000e-01],
       [-1.58139865e+03,  0.00000000e+00],
       [-9.24204490e+02,  2.00000000e-01],
       [ 1.64672934e+03,  4.00000000e-01],
       [ 2.20720217e+02,  4.00000000e-01],
       [-1.13439030e+03,  3.00000000e-01],
       [ 1.89225496e+02,  1.00000000e-01],
       [-1.80975055e+03, -2.00000000e-01],
       [-1.70272026e+03, -4.00000000e-01],
       [ 1.13469829e+03, -4.00000000e-01],
       [-1.32268529e+02, -3.00000000e-01],
       [-1.24136791e+03, -3.00000000e-01],
       [ 3.36837234e+02, -4.00000000e-01],
       [ 9.13120832e+02, -4.00000000e-01]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="c1">#plt.plot(data_test.Mes, y_pred, label=&quot;RF&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Caudal (m3/s)&#39;)
</pre></div>
</div>
<img alt="../_images/e489b64b76d9fc8e9d47b29b625ef69a074fbeb204eed27550ae074b376368ad.png" src="../_images/e489b64b76d9fc8e9d47b29b625ef69a074fbeb204eed27550ae074b376368ad.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">residuales_test_extra</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.optimizers</span> <span class="kn">import</span> <span class="n">Adam</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>

<span class="c1"># Define el modelo de red neuronal</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">residuales_train_extra</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],)),</span>  <span class="c1"># Corregir la forma de entrada</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Compila el modelo</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">Adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">)</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>

<span class="c1"># Escala los datos de entrenamiento y validación</span>
<span class="n">X_trainval_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_trainval</span><span class="p">)</span>
<span class="n">X_val_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>

<span class="c1"># Define el callback EarlyStopping</span>
<span class="n">early_stopping</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Entrena el modelo</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">residuales_train_extra</span><span class="p">,</span> <span class="n">residuals_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
          <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">early_stopping</span><span class="p">])</span>

<span class="c1"># Escala los datos de prueba</span>
<span class="n">residuales_test_extra_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">)</span>

<span class="c1"># Define el pipeline con transformador de escala y modelo</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">scaler</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Evalúa el modelo en datos de prueba usando el pipeline</span>
<span class="n">y_pred_NN</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">)</span>

<span class="c1"># Grafica los resultados</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_ARMA</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos reales&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred_NN</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicciones&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/1000
3/3 [==============================] - 1s 79ms/step - loss: 1161137.2500 - val_loss: 1669781.1250
Epoch 2/1000
3/3 [==============================] - 0s 18ms/step - loss: 1184145.3750 - val_loss: 1649140.0000
Epoch 3/1000
3/3 [==============================] - 0s 16ms/step - loss: 1154741.6250 - val_loss: 1648667.8750
Epoch 4/1000
3/3 [==============================] - 0s 15ms/step - loss: 1153844.8750 - val_loss: 1650352.5000
Epoch 5/1000
3/3 [==============================] - 0s 18ms/step - loss: 1153958.0000 - val_loss: 1652373.0000
Epoch 6/1000
3/3 [==============================] - 0s 15ms/step - loss: 1154473.8750 - val_loss: 1653185.3750
Epoch 7/1000
3/3 [==============================] - 0s 15ms/step - loss: 1154040.2500 - val_loss: 1650733.1250
Epoch 8/1000
3/3 [==============================] - 0s 15ms/step - loss: 1154088.0000 - val_loss: 1648974.3750
Epoch 9/1000
3/3 [==============================] - 0s 15ms/step - loss: 1153859.5000 - val_loss: 1648813.1250
Epoch 10/1000
3/3 [==============================] - 0s 15ms/step - loss: 1153777.7500 - val_loss: 1649033.0000
Epoch 11/1000
3/3 [==============================] - 0s 15ms/step - loss: 1153596.0000 - val_loss: 1649591.5000
Epoch 12/1000
3/3 [==============================] - 0s 16ms/step - loss: 1153288.1250 - val_loss: 1651197.6250
Epoch 13/1000
3/3 [==============================] - 0s 18ms/step - loss: 1153745.5000 - val_loss: 1652979.6250
Epoch 14/1000
3/3 [==============================] - 0s 16ms/step - loss: 1154916.0000 - val_loss: 1651988.5000
Epoch 15/1000
3/3 [==============================] - 0s 18ms/step - loss: 1154923.1250 - val_loss: 1649779.8750
Epoch 16/1000
3/3 [==============================] - 0s 16ms/step - loss: 1153124.5000 - val_loss: 1649504.6250
Epoch 17/1000
3/3 [==============================] - 0s 15ms/step - loss: 1152945.7500 - val_loss: 1650596.1250
Epoch 18/1000
3/3 [==============================] - 0s 15ms/step - loss: 1155662.3750 - val_loss: 1651080.5000
Epoch 19/1000
3/3 [==============================] - 0s 15ms/step - loss: 1153344.6250 - val_loss: 1648596.1250
Epoch 20/1000
3/3 [==============================] - 0s 18ms/step - loss: 1153122.8750 - val_loss: 1648348.7500
Epoch 21/1000
3/3 [==============================] - 0s 20ms/step - loss: 1153365.7500 - val_loss: 1648268.0000
Epoch 22/1000
3/3 [==============================] - 0s 16ms/step - loss: 1153396.5000 - val_loss: 1648240.6250
Epoch 23/1000
3/3 [==============================] - 0s 14ms/step - loss: 1153399.0000 - val_loss: 1648288.5000
Epoch 24/1000
3/3 [==============================] - 0s 16ms/step - loss: 1153205.1250 - val_loss: 1648450.1250
Epoch 25/1000
3/3 [==============================] - 0s 16ms/step - loss: 1153235.3750 - val_loss: 1648764.8750
Epoch 26/1000
3/3 [==============================] - 0s 14ms/step - loss: 1153102.6250 - val_loss: 1649504.3750
Epoch 27/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153736.0000 - val_loss: 1650714.8750
Epoch 28/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153590.8750 - val_loss: 1651324.0000
Epoch 29/1000
3/3 [==============================] - 0s 12ms/step - loss: 1153530.5000 - val_loss: 1651854.2500
Epoch 30/1000
3/3 [==============================] - 0s 13ms/step - loss: 1154099.0000 - val_loss: 1651105.3750
Epoch 31/1000
3/3 [==============================] - 0s 14ms/step - loss: 1152700.8750 - val_loss: 1649246.3750
Epoch 32/1000
3/3 [==============================] - 0s 14ms/step - loss: 1153653.6250 - val_loss: 1648609.7500
Epoch 33/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153799.7500 - val_loss: 1648487.0000
Epoch 34/1000
3/3 [==============================] - 0s 14ms/step - loss: 1153803.8750 - val_loss: 1648433.1250
Epoch 35/1000
3/3 [==============================] - 0s 12ms/step - loss: 1153669.7500 - val_loss: 1648467.0000
Epoch 36/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153684.8750 - val_loss: 1648487.0000
Epoch 37/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153682.6250 - val_loss: 1648526.6250
Epoch 38/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153661.6250 - val_loss: 1648486.7500
Epoch 39/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153599.6250 - val_loss: 1648425.5000
Epoch 40/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153613.7500 - val_loss: 1648370.3750
Epoch 41/1000
3/3 [==============================] - 0s 14ms/step - loss: 1153626.8750 - val_loss: 1648361.1250
Epoch 42/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153602.7500 - val_loss: 1648364.6250
Epoch 43/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153564.0000 - val_loss: 1648376.5000
Epoch 44/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153537.3750 - val_loss: 1648405.0000
Epoch 45/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153399.3750 - val_loss: 1648450.3750
Epoch 46/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153381.5000 - val_loss: 1648512.2500
Epoch 47/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153272.2500 - val_loss: 1648492.2500
Epoch 48/1000
3/3 [==============================] - 0s 12ms/step - loss: 1153277.1250 - val_loss: 1648479.1250
Epoch 49/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153298.3750 - val_loss: 1648465.2500
Epoch 50/1000
3/3 [==============================] - 0s 18ms/step - loss: 1153382.3750 - val_loss: 1648455.0000
Epoch 51/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153377.3750 - val_loss: 1648509.1250
Epoch 52/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153237.6250 - val_loss: 1648546.5000
Epoch 53/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153228.3750 - val_loss: 1648594.6250
Epoch 54/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153166.7500 - val_loss: 1648643.7500
Epoch 55/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153557.5000 - val_loss: 1648592.7500
Epoch 56/1000
3/3 [==============================] - 0s 13ms/step - loss: 1152968.8750 - val_loss: 1649062.1250
Epoch 57/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153011.1250 - val_loss: 1649807.3750
Epoch 58/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153008.2500 - val_loss: 1649967.1250
Epoch 59/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153033.0000 - val_loss: 1648735.8750
Epoch 60/1000
3/3 [==============================] - 0s 14ms/step - loss: 1152977.7500 - val_loss: 1647029.6250
Epoch 61/1000
3/3 [==============================] - 0s 14ms/step - loss: 1152738.5000 - val_loss: 1645358.8750
Epoch 62/1000
3/3 [==============================] - 0s 12ms/step - loss: 1153514.7500 - val_loss: 1645580.8750
Epoch 63/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153780.2500 - val_loss: 1642350.7500
Epoch 64/1000
3/3 [==============================] - 0s 14ms/step - loss: 1153244.8750 - val_loss: 1641279.6250
Epoch 65/1000
3/3 [==============================] - 0s 14ms/step - loss: 1153680.6250 - val_loss: 1638351.3750
Epoch 66/1000
3/3 [==============================] - 0s 14ms/step - loss: 1153411.2500 - val_loss: 1640638.1250
Epoch 67/1000
3/3 [==============================] - 0s 14ms/step - loss: 1153739.7500 - val_loss: 1641496.1250
Epoch 68/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153152.2500 - val_loss: 1639079.1250
Epoch 69/1000
3/3 [==============================] - 0s 14ms/step - loss: 1153917.3750 - val_loss: 1639845.6250
Epoch 70/1000
3/3 [==============================] - 0s 14ms/step - loss: 1153668.0000 - val_loss: 1645552.2500
Epoch 71/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153097.7500 - val_loss: 1647372.0000
Epoch 72/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153442.0000 - val_loss: 1647947.8750
Epoch 73/1000
3/3 [==============================] - 0s 14ms/step - loss: 1153555.7500 - val_loss: 1648191.0000
Epoch 74/1000
3/3 [==============================] - 0s 14ms/step - loss: 1153740.5000 - val_loss: 1648311.2500
Epoch 75/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153622.3750 - val_loss: 1648466.7500
Epoch 76/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153604.2500 - val_loss: 1648533.5000
Epoch 77/1000
3/3 [==============================] - 0s 18ms/step - loss: 1153539.6250 - val_loss: 1648529.1250
Epoch 78/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153285.6250 - val_loss: 1648684.6250
Epoch 79/1000
3/3 [==============================] - 0s 14ms/step - loss: 1153836.7500 - val_loss: 1648955.6250
Epoch 80/1000
3/3 [==============================] - 0s 14ms/step - loss: 1152793.2500 - val_loss: 1648649.5000
Epoch 81/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153125.8750 - val_loss: 1648550.6250
Epoch 82/1000
3/3 [==============================] - 0s 14ms/step - loss: 1153372.8750 - val_loss: 1648514.7500
Epoch 83/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153477.7500 - val_loss: 1648497.5000
Epoch 84/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153625.7500 - val_loss: 1648477.5000
Epoch 85/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153621.0000 - val_loss: 1648510.2500
Epoch 86/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153670.0000 - val_loss: 1648660.2500
Epoch 87/1000
3/3 [==============================] - 0s 14ms/step - loss: 1153699.8750 - val_loss: 1648633.8750
Epoch 88/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153711.8750 - val_loss: 1648825.7500
Epoch 89/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153756.0000 - val_loss: 1649813.1250
Epoch 90/1000
3/3 [==============================] - 0s 12ms/step - loss: 1153992.0000 - val_loss: 1649816.6250
Epoch 91/1000
3/3 [==============================] - 0s 12ms/step - loss: 1153819.6250 - val_loss: 1648541.1250
Epoch 92/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153647.3750 - val_loss: 1648436.8750
Epoch 93/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153621.5000 - val_loss: 1648413.1250
Epoch 94/1000
3/3 [==============================] - 0s 12ms/step - loss: 1153588.6250 - val_loss: 1648368.5000
Epoch 95/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153528.3750 - val_loss: 1648358.8750
Epoch 96/1000
3/3 [==============================] - 0s 12ms/step - loss: 1153536.2500 - val_loss: 1648438.7500
Epoch 97/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153430.2500 - val_loss: 1649303.7500
Epoch 98/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153677.1250 - val_loss: 1648359.2500
Epoch 99/1000
3/3 [==============================] - 0s 12ms/step - loss: 1153417.8750 - val_loss: 1648231.5000
Epoch 100/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153474.0000 - val_loss: 1648251.7500
Epoch 101/1000
3/3 [==============================] - 0s 15ms/step - loss: 1153467.1250 - val_loss: 1648054.2500
Epoch 102/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153357.1250 - val_loss: 1647214.1250
Epoch 103/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153124.8750 - val_loss: 1643280.0000
Epoch 104/1000
3/3 [==============================] - 0s 13ms/step - loss: 1154150.5000 - val_loss: 1638811.2500
Epoch 105/1000
3/3 [==============================] - 0s 16ms/step - loss: 1153246.8750 - val_loss: 1643036.1250
Epoch 106/1000
3/3 [==============================] - 0s 13ms/step - loss: 1152712.1250 - val_loss: 1647495.1250
Epoch 107/1000
3/3 [==============================] - 0s 12ms/step - loss: 1153194.8750 - val_loss: 1648048.2500
Epoch 108/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153287.7500 - val_loss: 1648018.5000
Epoch 109/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153208.6250 - val_loss: 1647780.5000
Epoch 110/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153177.7500 - val_loss: 1647404.3750
Epoch 111/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153312.3750 - val_loss: 1647421.7500
Epoch 112/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153368.6250 - val_loss: 1648239.5000
Epoch 113/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153298.5000 - val_loss: 1648421.8750
Epoch 114/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153359.6250 - val_loss: 1648560.7500
Epoch 115/1000
3/3 [==============================] - 0s 14ms/step - loss: 1153325.2500 - val_loss: 1648639.8750
Epoch 116/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153471.6250 - val_loss: 1648680.3750
Epoch 117/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153399.7500 - val_loss: 1648588.1250
Epoch 118/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153321.1250 - val_loss: 1648580.5000
Epoch 119/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153273.5000 - val_loss: 1648646.3750
Epoch 120/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153178.1250 - val_loss: 1654863.5000
Epoch 121/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153772.2500 - val_loss: 1648712.5000
Epoch 122/1000
3/3 [==============================] - 0s 12ms/step - loss: 1153074.3750 - val_loss: 1648817.5000
Epoch 123/1000
3/3 [==============================] - 0s 13ms/step - loss: 1152828.7500 - val_loss: 1649270.1250
Epoch 124/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153758.7500 - val_loss: 1650567.7500
Epoch 125/1000
3/3 [==============================] - 0s 13ms/step - loss: 1152641.5000 - val_loss: 1649760.2500
Epoch 126/1000
3/3 [==============================] - 0s 13ms/step - loss: 1152002.8750 - val_loss: 1649485.1250
Epoch 127/1000
3/3 [==============================] - 0s 12ms/step - loss: 1152798.3750 - val_loss: 1649596.8750
Epoch 128/1000
3/3 [==============================] - 0s 15ms/step - loss: 1152664.2500 - val_loss: 1650334.3750
Epoch 129/1000
3/3 [==============================] - 0s 15ms/step - loss: 1152661.1250 - val_loss: 1651405.6250
Epoch 130/1000
3/3 [==============================] - 0s 13ms/step - loss: 1146996.8750 - val_loss: 1662469.1250
Epoch 131/1000
3/3 [==============================] - 0s 13ms/step - loss: 1158820.3750 - val_loss: 1653628.2500
Epoch 132/1000
3/3 [==============================] - 0s 13ms/step - loss: 1150688.7500 - val_loss: 1649004.6250
Epoch 133/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153742.2500 - val_loss: 1646860.0000
Epoch 134/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153746.2500 - val_loss: 1645578.6250
Epoch 135/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153048.7500 - val_loss: 1641688.6250
Epoch 136/1000
3/3 [==============================] - 0s 13ms/step - loss: 1155315.1250 - val_loss: 1639679.3750
Epoch 137/1000
3/3 [==============================] - 0s 14ms/step - loss: 1153222.8750 - val_loss: 1647419.0000
Epoch 138/1000
3/3 [==============================] - 0s 13ms/step - loss: 1173490.1250 - val_loss: 1647112.3750
Epoch 139/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153648.1250 - val_loss: 1646366.5000
Epoch 140/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153846.3750 - val_loss: 1645248.5000
Epoch 141/1000
3/3 [==============================] - 0s 12ms/step - loss: 1156786.0000 - val_loss: 1643726.7500
Epoch 142/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153276.8750 - val_loss: 1647464.6250
Epoch 143/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153928.5000 - val_loss: 1647601.3750
Epoch 144/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153887.7500 - val_loss: 1648864.3750
Epoch 145/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153945.6250 - val_loss: 1650806.1250
Epoch 146/1000
3/3 [==============================] - 0s 12ms/step - loss: 1154210.8750 - val_loss: 1650212.8750
Epoch 147/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153986.3750 - val_loss: 1650101.0000
Epoch 148/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153899.0000 - val_loss: 1650559.5000
Epoch 149/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153795.2500 - val_loss: 1651724.1250
Epoch 150/1000
3/3 [==============================] - 0s 14ms/step - loss: 1153948.5000 - val_loss: 1653152.5000
Epoch 151/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153717.6250 - val_loss: 1652842.8750
Epoch 152/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153771.3750 - val_loss: 1652233.5000
Epoch 153/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153568.6250 - val_loss: 1650583.8750
Epoch 154/1000
3/3 [==============================] - 0s 18ms/step - loss: 1153723.0000 - val_loss: 1649530.3750
Epoch 155/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153631.1250 - val_loss: 1650427.7500
Epoch 156/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153737.5000 - val_loss: 1651733.8750
Epoch 157/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153753.3750 - val_loss: 1651691.5000
Epoch 158/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153609.0000 - val_loss: 1651949.6250
Epoch 159/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153634.1250 - val_loss: 1652104.3750
Epoch 160/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153625.6250 - val_loss: 1652154.2500
Epoch 161/1000
3/3 [==============================] - 0s 14ms/step - loss: 1153615.0000 - val_loss: 1652415.0000
Epoch 162/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153685.6250 - val_loss: 1652494.2500
Epoch 163/1000
3/3 [==============================] - 0s 13ms/step - loss: 1153663.0000 - val_loss: 1652816.5000
Epoch 164/1000
3/3 [==============================] - 0s 14ms/step - loss: 1153682.2500 - val_loss: 1652719.3750
Epoch 165/1000
3/3 [==============================] - 0s 15ms/step - loss: 1153646.0000 - val_loss: 1652281.1250
3/3 [==============================] - 0s 1ms/step
</pre></div>
</div>
<img alt="../_images/c9b903ee96f5a51dc242ed400a8787b140878b9e143830ddcd6dfa482326f791.png" src="../_images/c9b903ee96f5a51dc242ed400a8787b140878b9e143830ddcd6dfa482326f791.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_ARMA</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred_NN</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Tree prediction&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7a7f9c958dba1525b28751f2921a539116580afb58fe89da4fdf0421d747414a.png" src="../_images/7a7f9c958dba1525b28751f2921a539116580afb58fe89da4fdf0421d747414a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">residuales_ARMA</span><span class="p">,</span> <span class="n">y_pred_NN</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1098.26
MAE: 845.78
RRMSE: -11.01
R-squared (R^2): 0.00
NSE (Nash-Sutcliffe Efficiency): -102.87
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_ARMA_NN</span> <span class="o">=</span> <span class="n">predictions_ARMA</span> <span class="o">+</span> <span class="n">y_pred_NN</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">y_residual</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 1.43506090e+02  1.39949826e+02  1.39053744e+02  1.60085529e+01
  5.97779545e+01  6.35085775e+01  1.90238501e+01  7.93863660e+01
  1.34173046e+02 -6.15101174e+00 -1.88420896e+01  3.38977522e-01
  1.83358667e+01  2.17240719e+01  1.77995213e+01  1.46759489e+01
  4.04342984e+00 -5.11031951e+01 -1.02876168e+01 -2.43596408e+01
 -2.52176451e+01 -6.36249443e+01 -4.97423261e+01 -7.82509497e+02
 -2.82854295e+02 -8.62908656e+02 -3.19420207e+02 -2.31111268e+02
 -6.47951096e+02 -2.33650056e+02 -3.44265617e+02 -6.86637471e+02
 -2.90357756e+02 -4.79298263e+01  1.53742797e+00  5.78685642e+01
  1.22185675e+02  1.61193038e+02  8.31597946e+01  6.91906282e+01
  1.59783823e+02  1.71032624e+02  5.91718151e+01  1.17958255e+01
  1.96680514e+01  2.15994288e+01  2.28929588e+01  1.83338146e+02
  2.87284803e+01  3.66817425e+01  1.25941391e+02  7.23887998e+01
  4.96910205e+01  1.54125870e+02  4.87798444e+01  2.02973232e+01
  6.91906282e+01  1.73729307e+02  5.97779545e+01  5.68401862e+01
  8.89752484e+00  1.77658515e+01  5.36699693e-01 -1.72142036e+02
 -1.16657566e+02 -4.55168892e+01 -4.23073063e+01 -1.94053927e+02
 -3.38640830e+01 -7.43061965e+01  5.70057474e+00  1.49386772e+02
  1.53443131e+01  2.41097964e+01  1.53443131e+01 -1.50588868e+01
  1.20405410e+01  5.70057474e+00 -2.52176451e+01  5.30136862e+00
  1.78110218e+01 -5.42125072e+00  1.45362007e+00  1.49809767e+02
  1.41536590e+02  1.67282877e+02  1.13821690e+02  7.99839316e+01
  1.02563189e+02]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">y_ARMA_NN</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="o">~</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Temp</span>\<span class="n">ipykernel_14148</span>\<span class="mf">2753252320.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">metricas</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">y_ARMA_NN</span><span class="p">)</span>

<span class="nn">~\AppData\Local\Temp\ipykernel_14148\1041418915.py</span> in <span class="ni">metricas</span><span class="nt">(y_test, y_pred)</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Calculo de Metricas</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="k">def</span> <span class="nf">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred</span><span class="p">):</span>
<span class="ne">----&gt; </span><span class="mi">3</span>     <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>

<span class="nn">c:\ProgramData\Anaconda3\lib\site-packages\sklearn\metrics\_regression.py</span> in <span class="ni">mean_absolute_error</span><span class="nt">(y_true, y_pred, sample_weight, multioutput)</span>
<span class="g g-Whitespace">    </span><span class="mi">189</span>     <span class="mf">0.85</span><span class="o">...</span>
<span class="g g-Whitespace">    </span><span class="mi">190</span>     <span class="s2">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">191</span><span class="s2">     y_type, y_true, y_pred, multioutput = _check_reg_targets(</span>
<span class="g g-Whitespace">    </span><span class="mi">192</span><span class="s2">         y_true, y_pred, multioutput</span>
<span class="g g-Whitespace">    </span><span class="mi">193</span><span class="s2">     )</span>

<span class="nn">c:\ProgramData\Anaconda3\lib\site-packages\sklearn\metrics\_regression.py</span> in <span class="ni">_check_reg_targets</span><span class="nt">(y_true, y_pred, multioutput, dtype)</span>
<span class="g g-Whitespace">    </span><span class="mi">103</span><span class="s2"> </span>
<span class="g g-Whitespace">    </span><span class="mi">104</span><span class="s2">     if y_true.shape[1] != y_pred.shape[1]:</span>
<span class="ne">--&gt; </span><span class="mi">105</span><span class="s2">         raise ValueError(</span>
<span class="g g-Whitespace">    </span><span class="mi">106</span><span class="s2">             &quot;y_true and y_pred have different number of output (</span><span class="si">{0}</span><span class="s2">!=</span><span class="si">{1}</span><span class="s2">)&quot;.format(</span>
<span class="g g-Whitespace">    </span><span class="mi">107</span><span class="s2">                 y_true.shape[1], y_pred.shape[1]</span>

<span class="ne">ValueError</span>: y_true and y_pred have different number of output (1!=89)
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Nueva carpeta"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">aapineda</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#river-flow-forecasting-a-hybrid-approach-integrating-machine-learning-and-linear-time-series-models">River Flow Forecasting: A Hybrid Approach Integrating Machine Learning and Linear Time Series Models</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resumen"><strong>Resumen</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metodologia"><strong>Metodología</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#librerias-necesarias">Librerias Necesarias</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset">Dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#relacion-entre-enso-y-caudal">Relacion entre ENSO y Caudal</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#lag-a-los-datos">Lag a los datos</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#auto-correlation-function-acf-and-partial-autocorrelation-funcion-pacf">Auto Correlation function (ACF) and Partial Autocorrelation Funcion(PACF).</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#datos-de-entrenamiento-y-prueba">Datos de Entrenamiento y Prueba</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metricas">Metricas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#arima">ARIMA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#funcion-arima">Funcion ARIMA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-lineales">Modelos lineales</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ar">AR</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arma">ARMA</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ridge">Ridge</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lasso">Lasso</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest">Random Forest</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Metricas</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#k-nn-regresor">k-NN regresor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#svr">SVR</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#redes-neuronales">Redes Neuronales</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-hibrido">Modelo Hibrido</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest-con-modelos-lineales">Random Forest con modelos lineales</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ar-rf">AR-RF</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arma-rf">ARMA-RF</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ar-ann">AR-ANN</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arma-ann">ARMA-ANN</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Angel Andres Pineda Lopez
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>