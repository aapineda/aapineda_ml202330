

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>aapineda &#8212; River Flow Forecasting = A Hybrid Approach Integrating Machine Learning and Linear Time Series Models</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'intentos/notebo22';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.jpg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.jpg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Bienvenidos
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Texto.html">River Flow Forecasting: A Hybrid Approach Integrating Machine Learning and ARIMA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notebo23.html">Aplicación</a></li>

</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fintentos/notebo22.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/intentos/notebo22.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>aapineda</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">aapineda</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#river-flow-forecasting-a-hybrid-approach-integrating-machine-learning-and-linear-time-series-models">River Flow Forecasting: A Hybrid Approach Integrating Machine Learning and Linear Time Series Models</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resumen"><strong>Resumen</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metodologia"><strong>Metodología</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#librerias-necesarias">Librerias Necesarias</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset">Dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#relacion-entre-enso-y-caudal">Relacion entre ENSO y Caudal</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#lag-a-los-datos">Lag a los datos</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#auto-correlation-function-acf-and-partial-autocorrelation-funcion-pacf">Auto Correlation function (ACF) and Partial Autocorrelation Funcion(PACF).</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#datos-de-entrenamiento-y-prueba">Datos de Entrenamiento y Prueba</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metricas">Metricas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#arima">ARIMA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#funcion-arima">Funcion ARIMA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-lineales">Modelos lineales</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ar">AR</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arma">ARMA</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ridge">Ridge</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lasso">Lasso</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest">Random Forest</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Metricas</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#k-nn-regresor">k-NN regresor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#svr">SVR</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#redes-neuronales">Redes Neuronales</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-hibrido">Modelo Hibrido</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest-con-modelos-lineales">Random Forest con modelos lineales</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ar-rf">AR-RF</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arma-rf">ARMA-RF</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ar-model">AR-MODEL</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arma-model">ARMA-MODEL</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="aapineda">
<h1>aapineda<a class="headerlink" href="#aapineda" title="Permalink to this heading">#</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="river-flow-forecasting-a-hybrid-approach-integrating-machine-learning-and-linear-time-series-models">
<h1>River Flow Forecasting: A Hybrid Approach Integrating Machine Learning and Linear Time Series Models<a class="headerlink" href="#river-flow-forecasting-a-hybrid-approach-integrating-machine-learning-and-linear-time-series-models" title="Permalink to this heading">#</a></h1>
<p><img alt="Alt text" src="intentos/1024px-Rio_Magdalena_Delta_landsat.jpg" /></p>
<section id="resumen">
<h2><strong>Resumen</strong><a class="headerlink" href="#resumen" title="Permalink to this heading">#</a></h2>
<p>La precisa estimación del caudal del río Magdalena en la estación de Calamar, Bolívar, es esencial para la gestión de recursos hídricos y la reducción de riesgos de inundaciones en esta región. En este estudio, se emplearon tres enfoques de modelado para estimar el caudal del río a largo plazo (mensuales).
Los datos necesarios para este análisis fueron recopilados específicamente en la estación de monitoreo de Calamar, Bolívar, a lo largo del río Magdalena. Se examinaron tres enfoques de modelado: modelos autoregresivos (AR), modelos de promedio móvil (MA) y modelos autoregresivos de promedio móvil (ARMA). Los resultados revelaron que los modelos MA superaron consistentemente en rendimiento a los modelos AR y ARMA.
Además, para mejorar la precisión en la estimación del caudal del río Magdalena, se exploraron modelos de aprendizaje automático. Específicamente, se utilizaron Bosques Aleatorios (RF) y Splines de Regresión Adaptativos Multivariados (MARS) para estimar los valores mensuales de un factor crítico, el caudal del Rio, basándose en datos del Caudal del periodo anterior. Los resultados revelaron que RF y MARS produjeron estimaciones comparables, con RF mostrando una ligera ventaja en el rendimiento.
Posteriormente, se implementaron modelos híbridos que combinaron enfoques de series temporales y aprendizaje automático, como RF-AR, RF-MA, RF-ARMA, MARS-AR, MARS-MA y MARS-ARMA, con el objetivo de mejorar la precisión en la estimación del Caudal. Entre estos modelos híbridos, RF-AR y MARS-AR demostraron consistentemente un rendimiento sobresaliente.
Los resultados de este estudio sugieren que la combinación de enfoques híbridos, que integran modelos de series temporales y aprendizaje automático, ofrece un enfoque prometedor para estimar el Caudal en la estación de Calamar, Bolívar, a lo largo del río Magdalena. Estas estimaciones precisas del Caudal tienen aplicaciones significativas en proyectos relacionados con el analisis de Riesgo, planificacion de dragados y Energia hidroelectrica.</p>
<ul class="simple">
<li><p>Palabras clave: Río Magdalena · Estimación · Modelos de Series Temporales · Modelos de Aprendizaje Automático · Modelos Independientes y Híbridos · Caudales.</p></li>
</ul>
</section>
<section id="metodologia">
<h2><strong>Metodología</strong><a class="headerlink" href="#metodologia" title="Permalink to this heading">#</a></h2>
<p><strong>Población y Muestra:</strong></p>
<ul class="simple">
<li><p>Población: La población de interés consistió en todos los datos históricos de caudales disponibles para la estación de Calamar, Bolívar, a lo largo del río Magdalena. (1984-2020)</p></li>
<li><p>Muestra: La muestra se seleccionó considerando el tiempo y el espacio, incluyendo datos diarios recopilados a lo largo de varios años específicos. La muestra se limitó a la estación de Calamar, Bolívar.</p></li>
</ul>
<p><strong>Variables:</strong>
Se definió un diccionario de características que incluyó las siguientes variables:</p>
<ul class="simple">
<li><p>Caudal del río Magdalena (variable objetivo).</p></li>
<li><p>Variables meteorológicas adicionales (si es necesario).</p></li>
<li><p>Fechas y marcas temporales para el análisis de series temporales.</p></li>
</ul>
<p><strong>Técnicas:</strong>
Se emplearon diversas técnicas para la estimación del caudal del río Magdalena, que se dividieron en dos categorías principales:</p>
<p><strong>a. Modelos de Series Temporales:</strong></p>
<ul class="simple">
<li><p>Modelos AR (Autoregresivos).</p></li>
<li><p>Modelos MA (Promedio Móvil).</p></li>
<li><p>Modelos ARMA (Autoregresivos de Promedio Móvil).</p></li>
</ul>
<p><strong>b. Modelos de Aprendizaje Automático:</strong></p>
<ul class="simple">
<li><p>Bosques Aleatorios (RF).</p></li>
<li><p>Splines de Regresión Adaptativos Multivariados (MARS).
Además, se aplicaron modelos híbridos que combinaron enfoques de series temporales y aprendizaje automático, como RF-AR y MARS-AR.</p></li>
</ul>
<p><strong>Diseño General:</strong>
El estudio siguió un diseño de investigación observacional retrospectiva. Se recopilaron datos históricos de caudales del río Magdalena en la estación de Calamar, Bolívar, así como datos de velocidad del viento y, en su caso, datos meteorológicos adicionales. Estos datos retrospectivos se analizaron para desarrollar modelos de estimación del caudal del río.</p>
<p><strong>Validez:</strong>
La validez del estudio se abordó de la siguiente manera:</p>
<ul class="simple">
<li><p>Grupos de Datos Coherentes: Se utilizaron datos coherentes y homogéneos recopilados de manera consistente a lo largo del tiempo.</p></li>
<li><p>Automatizado: La obtención de datos se automatizó mediante la extracción de datos desde fuentes como archivos CSV y, en su caso, API o consultas SQL.</p></li>
<li><p>Técnicas Estadísticas: Se aplicaron pruebas estadísticas como Chi cuadrado, T-Students, Prueba Fisher y análisis de autocorrelación para evaluar la validez y la robustez de los modelos propuestos y los resultados del estudio.</p></li>
</ul>
<p>Este enfoque metodológico riguroso garantiza la calidad y la confiabilidad de los resultados del estudio de estimación del caudal del río Magdalena en la estación de Calamar, Bolívar, y sienta las bases para la mejora de la gestión de recursos hídricos en esta región.</p>
<p><img alt="Alt text" src="intentos/image-1.png" />
Fuente: Wikipedia</p>
</section>
<section id="librerias-necesarias">
<h2>Librerias Necesarias<a class="headerlink" href="#librerias-necesarias" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span><span class="n">plot_pacf</span> 
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools.sm_exceptions</span> <span class="kn">import</span> <span class="n">ConvergenceWarning</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">ConvergenceWarning</span><span class="p">)</span>

<span class="c1">## Errores</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="dataset">
<h2>Dataset<a class="headerlink" href="#dataset" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># URL del archivo CSV en GitHub</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/aapineda/data/main/Q_Station_29037020.csv&#39;</span> <span class="c1">##CALAMAR</span>
<span class="c1">#url = &#39;https://raw.githubusercontent.com/aapineda/data/main/Q_Station_21237020.csv&#39;</span>
<span class="c1">#url = &#39;https://raw.githubusercontent.com/aapineda/data/main/Q_Station_25027020.csv&#39;</span>



<span class="c1"># Leer el archivo CSV desde la URL</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 13515 entries, 0 to 13514
Data columns (total 3 columns):
 #   Column  Non-Null Count  Dtype  
---  ------  --------------  -----  
 0   Date    13515 non-null  object 
 1   Flow    13515 non-null  float64
 2   ENSO    13515 non-null  float64
dtypes: float64(2), object(1)
memory usage: 316.9+ KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Flow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>Flow</th>
      <th>ENSO</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1-01-1984</td>
      <td>7803.0</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2-01-1984</td>
      <td>7718.0</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3-01-1984</td>
      <td>7634.0</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4-01-1984</td>
      <td>7554.0</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5-01-1984</td>
      <td>7498.0</td>
      <td>-0.6</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Flow</th>
      <th>ENSO</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>13515.000000</td>
      <td>13515.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>7239.553703</td>
      <td>-0.003492</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2708.667922</td>
      <td>0.850624</td>
    </tr>
    <tr>
      <th>min</th>
      <td>2011.900000</td>
      <td>-1.800000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>5177.200000</td>
      <td>-0.600000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>6987.000000</td>
      <td>-0.100000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>9157.050000</td>
      <td>0.500000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>14909.000000</td>
      <td>2.600000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Date    0
Flow    0
ENSO    0
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)))</span><span class="o">*</span><span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Date    0.0
Flow    0.0
ENSO    0.0
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Asegúrate de que la columna &#39;fecha&#39; sea de tipo datetime</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">-%m-%Y&#39;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>


<span class="c1"># Agrupa los datos por mes y calcula el promedio</span>
<span class="n">serie</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="c1">#serie = df</span>

<span class="n">serie</span> <span class="o">=</span> <span class="n">serie</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># La variable promedio_por_mes ahora contiene el promedio de &#39;valor&#39; por mes</span>
<span class="nb">print</span><span class="p">(</span><span class="n">serie</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>             Flow  ENSO
0     7046.387097  -0.6
1     5769.344828  -0.4
2     5016.483871  -0.3
3     4613.266667  -0.4
4     6783.838710  -0.5
..            ...   ...
439   7277.535484  -0.6
440   8679.066667  -0.9
441   9349.567742  -1.2
442   9804.350000  -1.3
443  10353.732258  -1.2

[444 rows x 2 columns]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Flow</th>
      <th>ENSO</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7046.387097</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5769.344828</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5016.483871</td>
      <td>-0.3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4613.266667</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6783.838710</td>
      <td>-0.5</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>439</th>
      <td>7277.535484</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>440</th>
      <td>8679.066667</td>
      <td>-0.9</td>
    </tr>
    <tr>
      <th>441</th>
      <td>9349.567742</td>
      <td>-1.2</td>
    </tr>
    <tr>
      <th>442</th>
      <td>9804.350000</td>
      <td>-1.3</td>
    </tr>
    <tr>
      <th>443</th>
      <td>10353.732258</td>
      <td>-1.2</td>
    </tr>
  </tbody>
</table>
<p>444 rows × 2 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie</span><span class="p">[</span><span class="s1">&#39;Mes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">serie</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">#PREDECIR CON MESES</span>
<span class="c1">#serie = serie.drop(columns=&#39;Date&#39;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Flow</th>
      <th>ENSO</th>
      <th>Mes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7046.387097</td>
      <td>-0.6</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5769.344828</td>
      <td>-0.4</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5016.483871</td>
      <td>-0.3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4613.266667</td>
      <td>-0.4</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6783.838710</td>
      <td>-0.5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>439</th>
      <td>7277.535484</td>
      <td>-0.6</td>
      <td>440</td>
    </tr>
    <tr>
      <th>440</th>
      <td>8679.066667</td>
      <td>-0.9</td>
      <td>441</td>
    </tr>
    <tr>
      <th>441</th>
      <td>9349.567742</td>
      <td>-1.2</td>
      <td>442</td>
    </tr>
    <tr>
      <th>442</th>
      <td>9804.350000</td>
      <td>-1.3</td>
      <td>443</td>
    </tr>
    <tr>
      <th>443</th>
      <td>10353.732258</td>
      <td>-1.2</td>
      <td>444</td>
    </tr>
  </tbody>
</table>
<p>444 rows × 3 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr</span> <span class="o">=</span> <span class="n">serie</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

<span class="n">f</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">annot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">1.5</span> <span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;.2f&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/83fea1324cf93f977fcb12b05b451a86fe4eacf3ca7ff98fe6b5ae287c26d272.png" src="../_images/83fea1324cf93f977fcb12b05b451a86fe4eacf3ca7ff98fe6b5ae287c26d272.png" />
</div>
</div>
<section id="relacion-entre-enso-y-caudal">
<h3>Relacion entre ENSO y Caudal<a class="headerlink" href="#relacion-entre-enso-y-caudal" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>  <span class="c1"># Importa StandardScaler desde sklearn.preprocessing si no está ya importado</span>

<span class="c1"># Escala las series &#39;Flow&#39; y &#39;ENSO&#39; usando StandardScaler</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">scaled_flow</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">serie</span><span class="p">[[</span><span class="s1">&#39;Flow&#39;</span><span class="p">]])</span>
<span class="n">scaled_enso</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">serie</span><span class="p">[[</span><span class="s1">&#39;ENSO&#39;</span><span class="p">]])</span>

<span class="c1"># Crea una figura y traza las series</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie</span><span class="p">[</span><span class="s1">&#39;Mes&#39;</span><span class="p">],</span> <span class="n">scaled_flow</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Flow&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie</span><span class="p">[</span><span class="s1">&#39;Mes&#39;</span><span class="p">],</span> <span class="n">scaled_enso</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ENSO&#39;</span><span class="p">)</span>  <span class="c1"># Usamos un color diferente (azul) para ENSO</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Tiempo (Mes)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Caudal (escala estándar)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;River Flow and ENSO&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Rotate x-axis labels for readability</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f5726da8c12a98845c35b5f101a4ea2e6f126ea1f2e89c1d0594a8f9ac69bc01.png" src="../_images/f5726da8c12a98845c35b5f101a4ea2e6f126ea1f2e89c1d0594a8f9ac69bc01.png" />
</div>
</div>
<section id="lag-a-los-datos">
<h4>Lag a los datos<a class="headerlink" href="#lag-a-los-datos" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie</span><span class="p">[</span><span class="s1">&#39;Flow_lag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">serie</span><span class="p">[</span><span class="s1">&#39;Flow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">serie</span><span class="p">[</span><span class="s1">&#39;ENSO_lag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">serie</span><span class="p">[</span><span class="s1">&#39;ENSO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Flow</th>
      <th>ENSO</th>
      <th>Mes</th>
      <th>Flow_lag</th>
      <th>ENSO_lag</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7046.387097</td>
      <td>-0.6</td>
      <td>1</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5769.344828</td>
      <td>-0.4</td>
      <td>2</td>
      <td>7046.387097</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5016.483871</td>
      <td>-0.3</td>
      <td>3</td>
      <td>5769.344828</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4613.266667</td>
      <td>-0.4</td>
      <td>4</td>
      <td>5016.483871</td>
      <td>-0.3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6783.838710</td>
      <td>-0.5</td>
      <td>5</td>
      <td>4613.266667</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>439</th>
      <td>7277.535484</td>
      <td>-0.6</td>
      <td>440</td>
      <td>6987.390323</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>440</th>
      <td>8679.066667</td>
      <td>-0.9</td>
      <td>441</td>
      <td>7277.535484</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>441</th>
      <td>9349.567742</td>
      <td>-1.2</td>
      <td>442</td>
      <td>8679.066667</td>
      <td>-0.9</td>
    </tr>
    <tr>
      <th>442</th>
      <td>9804.350000</td>
      <td>-1.3</td>
      <td>443</td>
      <td>9349.567742</td>
      <td>-1.2</td>
    </tr>
    <tr>
      <th>443</th>
      <td>10353.732258</td>
      <td>-1.2</td>
      <td>444</td>
      <td>9804.350000</td>
      <td>-1.3</td>
    </tr>
  </tbody>
</table>
<p>444 rows × 5 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Flow_lag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">7490.387</span>
<span class="c1">#serie.at[0, &#39;ENSO_lag&#39;] = -0.8</span>
<span class="c1">#serie.at[1, &#39;ENSO_lag&#39;] = -1</span>
<span class="n">serie</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;ENSO_lag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.9</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Flow</th>
      <th>ENSO</th>
      <th>Mes</th>
      <th>Flow_lag</th>
      <th>ENSO_lag</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7046.387097</td>
      <td>-0.6</td>
      <td>1</td>
      <td>7490.387000</td>
      <td>-0.9</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5769.344828</td>
      <td>-0.4</td>
      <td>2</td>
      <td>7046.387097</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5016.483871</td>
      <td>-0.3</td>
      <td>3</td>
      <td>5769.344828</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4613.266667</td>
      <td>-0.4</td>
      <td>4</td>
      <td>5016.483871</td>
      <td>-0.3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6783.838710</td>
      <td>-0.5</td>
      <td>5</td>
      <td>4613.266667</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>439</th>
      <td>7277.535484</td>
      <td>-0.6</td>
      <td>440</td>
      <td>6987.390323</td>
      <td>-0.4</td>
    </tr>
    <tr>
      <th>440</th>
      <td>8679.066667</td>
      <td>-0.9</td>
      <td>441</td>
      <td>7277.535484</td>
      <td>-0.6</td>
    </tr>
    <tr>
      <th>441</th>
      <td>9349.567742</td>
      <td>-1.2</td>
      <td>442</td>
      <td>8679.066667</td>
      <td>-0.9</td>
    </tr>
    <tr>
      <th>442</th>
      <td>9804.350000</td>
      <td>-1.3</td>
      <td>443</td>
      <td>9349.567742</td>
      <td>-1.2</td>
    </tr>
    <tr>
      <th>443</th>
      <td>10353.732258</td>
      <td>-1.2</td>
      <td>444</td>
      <td>9804.350000</td>
      <td>-1.3</td>
    </tr>
  </tbody>
</table>
<p>444 rows × 5 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr</span> <span class="o">=</span> <span class="n">serie</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

<span class="n">f</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">annot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">1.5</span> <span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;.2f&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/87a00c04697c24393db9c3a1aba1481ff0436c6d9be219068c78d6f05ebebf2f.png" src="../_images/87a00c04697c24393db9c3a1aba1481ff0436c6d9be219068c78d6f05ebebf2f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie_ARIMA</span><span class="o">=</span> <span class="n">serie</span><span class="p">[[</span><span class="s1">&#39;Flow&#39;</span><span class="p">,</span> <span class="s1">&#39;Mes&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie_ARIMA</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Flow</th>
      <th>Mes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7046.387097</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5769.344828</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5016.483871</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4613.266667</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6783.838710</td>
      <td>5</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>439</th>
      <td>7277.535484</td>
      <td>440</td>
    </tr>
    <tr>
      <th>440</th>
      <td>8679.066667</td>
      <td>441</td>
    </tr>
    <tr>
      <th>441</th>
      <td>9349.567742</td>
      <td>442</td>
    </tr>
    <tr>
      <th>442</th>
      <td>9804.350000</td>
      <td>443</td>
    </tr>
    <tr>
      <th>443</th>
      <td>10353.732258</td>
      <td>444</td>
    </tr>
  </tbody>
</table>
<p>444 rows × 2 columns</p>
</div></div></div>
</div>
</section>
</section>
<section id="auto-correlation-function-acf-and-partial-autocorrelation-funcion-pacf">
<h3>Auto Correlation function (ACF) and Partial Autocorrelation Funcion(PACF).<a class="headerlink" href="#auto-correlation-function-acf-and-partial-autocorrelation-funcion-pacf" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_pacf</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">[</span><span class="s1">&#39;Flow&#39;</span><span class="p">])</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">[</span><span class="s1">&#39;Flow&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/dfa50777e42c2b59a57662f80d37deb4245e4933e3db71d0c77dff09ee964525.png" src="../_images/dfa50777e42c2b59a57662f80d37deb4245e4933e3db71d0c77dff09ee964525.png" />
<img alt="../_images/82646700d8f6b7bfc1f228c440956e787018690fc456e43a57a54ad8bf48783e.png" src="../_images/82646700d8f6b7bfc1f228c440956e787018690fc456e43a57a54ad8bf48783e.png" />
<img alt="../_images/dfa50777e42c2b59a57662f80d37deb4245e4933e3db71d0c77dff09ee964525.png" src="../_images/dfa50777e42c2b59a57662f80d37deb4245e4933e3db71d0c77dff09ee964525.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Function to know stacionality</span>

<span class="k">def</span> <span class="nf">Prueba_Dickey_Fuller</span><span class="p">(</span><span class="n">series</span> <span class="p">,</span> <span class="n">column_name</span><span class="p">):</span>
    <span class="nb">print</span> <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Resultados de la prueba de Dickey-Fuller para columna: </span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">dftest</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">autolag</span><span class="o">=</span><span class="s1">&#39;AIC&#39;</span><span class="p">)</span>
    <span class="n">dfoutput</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dftest</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Test Statistic&#39;</span><span class="p">,</span><span class="s1">&#39;p-value&#39;</span><span class="p">,</span><span class="s1">&#39;No Lags Used&#39;</span><span class="p">,</span><span class="s1">&#39;Número de observaciones utilizadas&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">dftest</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
       <span class="n">dfoutput</span><span class="p">[</span><span class="s1">&#39;Critical Value (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="k">key</span>] = value
    <span class="nb">print</span> <span class="p">(</span><span class="n">dfoutput</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dftest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.05</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Conclusion:====&gt;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rechazar la hipótesis nula&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los datos son estacionarios (Stationary)&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Conclusion:====&gt;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No se puede rechazar la hipótesis nula&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los datos son no estacionarios (Non Stationary)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Prueba_Dickey_Fuller</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">[</span><span class="s1">&#39;Flow&#39;</span><span class="p">],</span><span class="s2">&quot;Flow&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Resultados de la prueba de Dickey-Fuller para columna: Flow
Test Statistic                         -5.555584
p-value                                 0.000002
No Lags Used                           13.000000
Número de observaciones utilizadas    430.000000
Critical Value (1%)                    -3.445649
Critical Value (5%)                    -2.868285
Critical Value (10%)                   -2.570363
dtype: float64
Conclusion:====&gt;
Rechazar la hipótesis nula
Los datos son estacionarios (Stationary)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convertir &#39;Flow&#39; y &#39;Mes&#39; en arreglos NumPy y luego aplicar reshape</span>
<span class="sd">&quot;&quot;&quot;target = serie[&#39;Flow&#39;].values.reshape(-1, 1)</span>
<span class="sd">data = serie[&#39;Mes&#39;].values.reshape(-1, 1)&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&quot;target = serie[&#39;Flow&#39;].values.reshape(-1, 1)\ndata = serie[&#39;Mes&#39;].values.reshape(-1, 1)&quot;
</pre></div>
</div>
</div>
</div>
</section>
<section id="datos-de-entrenamiento-y-prueba">
<h3>Datos de Entrenamiento y Prueba<a class="headerlink" href="#datos-de-entrenamiento-y-prueba" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">serie</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_train</span> <span class="o">=</span> <span class="n">serie</span><span class="p">[</span><span class="n">serie</span><span class="o">.</span><span class="n">Mes</span> <span class="o">&lt;=</span> <span class="n">size</span><span class="p">]</span>
<span class="n">data_test</span>  <span class="o">=</span> <span class="n">serie</span><span class="p">[</span><span class="n">serie</span><span class="o">.</span><span class="n">Mes</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#X_train = np.array(data_train.Mes)[:, None] # vector-columna</span>

<span class="c1">#X_train = np.array(data_train[[&#39;Mes&#39;, &#39;ENSO&#39;]])</span>
<span class="c1">#X_train = np.array(data_train[[&#39;Flow_lag&#39;]])</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_train</span><span class="p">[[</span><span class="s1">&#39;Flow_lag&#39;</span><span class="p">,</span> <span class="s1">&#39;ENSO_lag&#39;</span><span class="p">]])</span>

<span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_train</span><span class="o">.</span><span class="n">Flow</span><span class="p">)</span>

<span class="c1">#X_test = np.array(data_test.Mes)[:, None] # vector-columna</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_test</span><span class="p">[[</span><span class="s1">&#39;Flow_lag&#39;</span><span class="p">,</span> <span class="s1">&#39;ENSO_lag&#39;</span><span class="p">]])</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_test</span><span class="o">.</span><span class="n">Flow</span><span class="p">)</span>

<span class="n">X_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">serie</span><span class="p">[[</span><span class="s1">&#39;Flow_lag&#39;</span><span class="p">,</span> <span class="s1">&#39;ENSO_lag&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>89
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="metricas">
<h2>Metricas<a class="headerlink" href="#metricas" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculo de Metricas</span>
<span class="k">def</span> <span class="nf">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_pred</span><span class="p">):</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMSE: </span><span class="si">{</span><span class="n">rmse</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAE: </span><span class="si">{</span><span class="n">mae</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Calcular el RRMSE directamente</span>
    <span class="n">rrmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RRMSE: </span><span class="si">{</span><span class="n">rrmse</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Calcular R-squared</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R-squared (R^2): </span><span class="si">{</span><span class="n">r2</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Calcular el NSE (coeficiente de eficiencia Nash-Sutcliffe)</span>
    <span class="n">nse</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_test</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NSE (Nash-Sutcliffe Efficiency): </span><span class="si">{</span><span class="n">nse</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="arima">
<h2>ARIMA<a class="headerlink" href="#arima" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima.model</span> <span class="kn">import</span> <span class="n">ARIMA</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>

<span class="c1"># Load dataset</span>

<span class="c1"># Split into train and test sets</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">serie_ARIMA</span><span class="p">[</span><span class="s1">&#39;Flow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">size</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">size</span><span class="p">:]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="funcion-arima">
<h2>Funcion ARIMA<a class="headerlink" href="#funcion-arima" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ARIMA_estimador</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">,</span> <span class="n">orden</span><span class="p">):</span>
    <span class="c1"># Split into train and test sets</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">residuales</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">serie_ARIMA</span><span class="p">[</span><span class="s1">&#39;Flow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span>
    <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">size</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">size</span><span class="p">:]</span>

    <span class="n">history</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">train</span><span class="p">]</span>
    
    <span class="c1"># Walk-forward validation</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">orden</span><span class="p">)</span>
        <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">()</span>
        <span class="n">yhat</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yhat</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="c1">#print(&#39;Month=%s, Predicted=%f, Expected=%f&#39; % (serie_ARIMA[&#39;Mes&#39;].iloc[size + t], yhat, obs))</span>

    <span class="n">history</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">train</span><span class="p">]</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">orden</span><span class="p">)</span>
        <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">()</span>
        <span class="n">yhat</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yhat</span><span class="p">)</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">test</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
        <span class="n">history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
        <span class="n">residuales</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs</span><span class="o">-</span><span class="n">yhat</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">[</span><span class="s1">&#39;Mes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">size</span><span class="p">:],</span> <span class="n">test</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">[</span><span class="s1">&#39;Mes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">size</span><span class="p">:],</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicted&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Tiempo (Mes)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Caudal (m3/s)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;River Flow Forecast&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


    <span class="c1"># Evaluate forecasts</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test RMSE: </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">rmse</span><span class="p">)</span>

    <span class="c1"># Plot forecasts against actual outcomes</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">[</span><span class="s1">&#39;Mes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">size</span><span class="p">:],</span> <span class="n">residuales</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Residuales&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Tiempo (Mes)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Caudal (m3/s)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Residuales obtenidos&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Rotate x-axis labels for readability</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    
    <span class="k">return</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">residuales</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="modelos-lineales">
<h2>Modelos lineales<a class="headerlink" href="#modelos-lineales" title="Permalink to this heading">#</a></h2>
<p>Entre los modelos lineales se encuentran: autoregressive (AR), moving average (MA), and autoregressive moving average (ARMA)</p>
<section id="ar">
<h3>AR<a class="headerlink" href="#ar" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pmdarima</span> <span class="k">as</span> <span class="nn">pm</span>

<span class="n">model_1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">auto_arima</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">start_p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">start_q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">test</span><span class="o">=</span><span class="s1">&#39;adf&#39;</span><span class="p">,</span>
                      <span class="n">max_p</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_q</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">d</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">seasonal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">start_P</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">D</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">trace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">error_action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span>
                      <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">stepwise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">model_1</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Performing stepwise search to minimize aic
 ARIMA(1,0,0)(0,0,0)[0]             : AIC=7865.329, Time=0.01 sec
 ARIMA(0,0,0)(0,0,0)[0]             : AIC=9208.012, Time=0.00 sec
 ARIMA(2,0,0)(0,0,0)[0]             : AIC=7777.791, Time=0.03 sec
 ARIMA(3,0,0)(0,0,0)[0]             : AIC=7662.598, Time=0.05 sec
 ARIMA(4,0,0)(0,0,0)[0]             : AIC=7641.101, Time=0.08 sec
 ARIMA(5,0,0)(0,0,0)[0]             : AIC=7639.764, Time=0.09 sec
 ARIMA(5,0,0)(0,0,0)[0] intercept   : AIC=7603.639, Time=0.07 sec
 ARIMA(4,0,0)(0,0,0)[0] intercept   : AIC=7601.648, Time=0.06 sec
 ARIMA(3,0,0)(0,0,0)[0] intercept   : AIC=7606.573, Time=0.04 sec

Best model:  ARIMA(4,0,0)(0,0,0)[0] intercept
Total fit time: 0.438 seconds
                               SARIMAX Results                                
==============================================================================
Dep. Variable:                      y   No. Observations:                  444
Model:               SARIMAX(4, 0, 0)   Log Likelihood               -3794.824
Date:                Wed, 04 Oct 2023   AIC                           7601.648
Time:                        18:37:25   BIC                           7626.223
Sample:                             0   HQIC                          7611.340
                                - 444                                         
Covariance Type:                  opg                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
intercept   1414.4895    230.488      6.137      0.000     962.742    1866.237
ar.L1          1.3864      0.050     27.656      0.000       1.288       1.485
ar.L2         -0.8359      0.083    -10.109      0.000      -0.998      -0.674
ar.L3          0.1300      0.085      1.529      0.126      -0.037       0.297
ar.L4          0.1242      0.049      2.547      0.011       0.029       0.220
sigma2      1.555e+06      0.009   1.64e+08      0.000    1.56e+06    1.56e+06
===================================================================================
Ljung-Box (L1) (Q):                   0.00   Jarque-Bera (JB):                 9.27
Prob(Q):                              0.96   Prob(JB):                         0.01
Heteroskedasticity (H):               1.16   Skew:                            -0.35
Prob(H) (two-sided):                  0.36   Kurtosis:                         2.91
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
[2] Covariance matrix is singular or near-singular, with condition number 7.88e+25. Standard errors may be unstable.
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Se ajusta el orden de AR.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">orden_ar</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fit model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">orden_ar</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="c1"># summary of fit model</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
<span class="c1"># line plot of residuals</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">model_fit</span><span class="o">.</span><span class="n">resid</span><span class="p">)</span>
<span class="n">residuals</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># density plot of residuals</span>
<span class="n">residuals</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># summary stats of residuals</span>
<span class="nb">print</span><span class="p">(</span><span class="n">residuals</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                               SARIMAX Results                                
==============================================================================
Dep. Variable:                      y   No. Observations:                  355
Model:                 ARIMA(5, 0, 0)   Log Likelihood               -3036.744
Date:                Wed, 04 Oct 2023   AIC                           6087.488
Time:                        18:37:26   BIC                           6114.593
Sample:                             0   HQIC                          6098.271
                                - 355                                         
Covariance Type:                  opg                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const       7413.0301    367.764     20.157      0.000    6692.227    8133.834
ar.L1          1.4205      0.057     24.728      0.000       1.308       1.533
ar.L2         -0.8886      0.095     -9.400      0.000      -1.074      -0.703
ar.L3          0.1636      0.107      1.530      0.126      -0.046       0.373
ar.L4          0.1146      0.104      1.099      0.272      -0.090       0.319
ar.L5         -0.0103      0.065     -0.158      0.875      -0.138       0.117
sigma2      1.576e+06   1.33e+05     11.854      0.000    1.32e+06    1.84e+06
===================================================================================
Ljung-Box (L1) (Q):                   0.00   Jarque-Bera (JB):                 6.01
Prob(Q):                              0.98   Prob(JB):                         0.05
Heteroskedasticity (H):               1.31   Skew:                            -0.31
Prob(H) (two-sided):                  0.14   Kurtosis:                         2.87
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
</pre></div>
</div>
<img alt="../_images/cf40e5c061452b1eeb7b104b2f5aa00e315f9ce809dafa55d18ce3275642360e.png" src="../_images/cf40e5c061452b1eeb7b104b2f5aa00e315f9ce809dafa55d18ce3275642360e.png" />
<img alt="../_images/d7c2763d1dcde8eef74f91e82d59ae9291ecc4e4ba67a911af368ffbf0961f31.png" src="../_images/d7c2763d1dcde8eef74f91e82d59ae9291ecc4e4ba67a911af368ffbf0961f31.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                 0
count   355.000000
mean     -5.996724
std    1254.328712
min   -3866.216294
25%    -843.690612
50%      66.530667
75%     869.953976
max    3390.829384
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">residuales</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">predictions_AR</span><span class="p">,</span> <span class="n">residuales_AR</span> <span class="o">=</span> <span class="n">ARIMA_estimador</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">,</span> <span class="n">orden_ar</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/560ffb1c1765269a5671b1bfc254d30961bdce391af3f17bb96486d4fee87b31.png" src="../_images/560ffb1c1765269a5671b1bfc254d30961bdce391af3f17bb96486d4fee87b31.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test RMSE: 1216.840
</pre></div>
</div>
<img alt="../_images/afb722f2ca7e75edbebc5b1d0c77fc713467364e26a837b034d6b6c45da49b0d.png" src="../_images/afb722f2ca7e75edbebc5b1d0c77fc713467364e26a837b034d6b6c45da49b0d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions_AR</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1216.84
MAE: 968.17
RRMSE: 0.19
R-squared (R^2): 0.70
NSE (Nash-Sutcliffe Efficiency): 0.70
</pre></div>
</div>
</div>
</div>
</section>
<section id="arma">
<h3>ARMA<a class="headerlink" href="#arma" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pmdarima</span> <span class="k">as</span> <span class="nn">pm</span>

<span class="n">model_1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">auto_arima</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">start_p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">start_q</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">test</span><span class="o">=</span><span class="s1">&#39;adf&#39;</span><span class="p">,</span>
                      <span class="n">max_p</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_q</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                      <span class="n">m</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">d</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">seasonal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="n">start_P</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">D</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                      <span class="n">trace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">error_action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span>
                      <span class="n">suppress_warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">stepwise</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">model_1</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Performing stepwise search to minimize aic
 ARIMA(1,0,1)(0,0,0)[0]             : AIC=7727.800, Time=0.04 sec
 ARIMA(0,0,0)(0,0,0)[0]             : AIC=9208.012, Time=0.00 sec
 ARIMA(1,0,0)(0,0,0)[0]             : AIC=7865.329, Time=0.01 sec
 ARIMA(0,0,1)(0,0,0)[0]             : AIC=inf, Time=0.06 sec
 ARIMA(2,0,1)(0,0,0)[0]             : AIC=7724.921, Time=0.10 sec
 ARIMA(2,0,0)(0,0,0)[0]             : AIC=7777.791, Time=0.03 sec
 ARIMA(3,0,1)(0,0,0)[0]             : AIC=7640.387, Time=0.20 sec
 ARIMA(3,0,0)(0,0,0)[0]             : AIC=7662.598, Time=0.05 sec
 ARIMA(4,0,1)(0,0,0)[0]             : AIC=7641.410, Time=0.15 sec
 ARIMA(3,0,2)(0,0,0)[0]             : AIC=7604.934, Time=0.37 sec
 ARIMA(2,0,2)(0,0,0)[0]             : AIC=inf, Time=0.30 sec
 ARIMA(4,0,2)(0,0,0)[0]             : AIC=inf, Time=0.51 sec
 ARIMA(3,0,3)(0,0,0)[0]             : AIC=7555.354, Time=0.44 sec
 ARIMA(2,0,3)(0,0,0)[0]             : AIC=inf, Time=0.34 sec
 ARIMA(4,0,3)(0,0,0)[0]             : AIC=7557.681, Time=0.44 sec
 ARIMA(3,0,4)(0,0,0)[0]             : AIC=7560.305, Time=0.56 sec
 ARIMA(2,0,4)(0,0,0)[0]             : AIC=inf, Time=0.36 sec
 ARIMA(4,0,4)(0,0,0)[0]             : AIC=7526.204, Time=0.64 sec
 ARIMA(5,0,4)(0,0,0)[0]             : AIC=inf, Time=0.74 sec
 ARIMA(4,0,5)(0,0,0)[0]             : AIC=7516.154, Time=0.81 sec
 ARIMA(3,0,5)(0,0,0)[0]             : AIC=7556.109, Time=0.75 sec
 ARIMA(5,0,5)(0,0,0)[0]             : AIC=inf, Time=0.75 sec
 ARIMA(4,0,5)(0,0,0)[0] intercept   : AIC=7476.958, Time=0.81 sec
 ARIMA(3,0,5)(0,0,0)[0] intercept   : AIC=7519.091, Time=0.73 sec
 ARIMA(4,0,4)(0,0,0)[0] intercept   : AIC=7513.379, Time=0.63 sec
 ARIMA(5,0,5)(0,0,0)[0] intercept   : AIC=7490.555, Time=0.84 sec
 ARIMA(3,0,4)(0,0,0)[0] intercept   : AIC=7503.175, Time=0.55 sec
 ARIMA(5,0,4)(0,0,0)[0] intercept   : AIC=7500.473, Time=0.66 sec

Best model:  ARIMA(4,0,5)(0,0,0)[0] intercept
Total fit time: 11.858 seconds
                               SARIMAX Results                                
==============================================================================
Dep. Variable:                      y   No. Observations:                  444
Model:               SARIMAX(4, 0, 5)   Log Likelihood               -3727.479
Date:                Wed, 04 Oct 2023   AIC                           7476.958
Time:                        18:37:51   BIC                           7522.012
Sample:                             0   HQIC                          7494.726
                                - 444                                         
Covariance Type:                  opg                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
intercept   1859.5711    237.672      7.824      0.000    1393.742    2325.400
ar.L1          2.4839      0.076     32.829      0.000       2.336       2.632
ar.L2         -3.2187      0.133    -24.248      0.000      -3.479      -2.959
ar.L3          2.2184      0.133     16.723      0.000       1.958       2.478
ar.L4         -0.7365      0.059    -12.439      0.000      -0.853      -0.620
ma.L1         -1.3457      0.089    -15.198      0.000      -1.519      -1.172
ma.L2          1.2681      0.100     12.668      0.000       1.072       1.464
ma.L3          0.0281      0.126      0.224      0.823      -0.218       0.274
ma.L4         -0.3528      0.086     -4.116      0.000      -0.521      -0.185
ma.L5          0.3390      0.063      5.376      0.000       0.215       0.463
sigma2      1.163e+06      0.067   1.73e+07      0.000    1.16e+06    1.16e+06
===================================================================================
Ljung-Box (L1) (Q):                   2.18   Jarque-Bera (JB):                 1.48
Prob(Q):                              0.14   Prob(JB):                         0.48
Heteroskedasticity (H):               1.37   Skew:                            -0.10
Prob(H) (two-sided):                  0.05   Kurtosis:                         3.19
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
[2] Covariance matrix is singular or near-singular, with condition number 1.52e+23. Standard errors may be unstable.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">orden_arma</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fit model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">orden_arma</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="c1"># summary of fit model</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model_fit</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
<span class="c1"># line plot of residuals</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">model_fit</span><span class="o">.</span><span class="n">resid</span><span class="p">)</span>
<span class="n">residuals</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># density plot of residuals</span>
<span class="n">residuals</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="c1"># summary stats of residuals</span>
<span class="nb">print</span><span class="p">(</span><span class="n">residuals</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                               SARIMAX Results                                
==============================================================================
Dep. Variable:                      y   No. Observations:                  355
Model:                 ARIMA(4, 0, 5)   Log Likelihood               -2995.301
Date:                Wed, 04 Oct 2023   AIC                           6012.602
Time:                        18:37:52   BIC                           6055.196
Sample:                             0   HQIC                          6029.547
                                - 355                                         
Covariance Type:                  opg                                         
==============================================================================
                 coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------
const       7413.0299    355.870     20.831      0.000    6715.537    8110.523
ar.L1          0.7218      0.092      7.853      0.000       0.542       0.902
ar.L2         -0.0133      0.130     -0.102      0.919      -0.267       0.241
ar.L3         -0.9841      0.129     -7.599      0.000      -1.238      -0.730
ar.L4          0.7031      0.071      9.971      0.000       0.565       0.841
ma.L1          0.5741      0.100      5.730      0.000       0.378       0.771
ma.L2          0.1720      0.065      2.659      0.008       0.045       0.299
ma.L3          0.9547      0.054     17.779      0.000       0.849       1.060
ma.L4          0.5865      0.068      8.668      0.000       0.454       0.719
ma.L5          0.2072      0.068      3.061      0.002       0.075       0.340
sigma2      1.099e+06      0.173   6.35e+06      0.000     1.1e+06     1.1e+06
===================================================================================
Ljung-Box (L1) (Q):                   0.01   Jarque-Bera (JB):                 2.57
Prob(Q):                              0.91   Prob(JB):                         0.28
Heteroskedasticity (H):               1.26   Skew:                            -0.21
Prob(H) (two-sided):                  0.22   Kurtosis:                         3.00
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
[2] Covariance matrix is singular or near-singular, with condition number 3.19e+22. Standard errors may be unstable.
</pre></div>
</div>
<img alt="../_images/d111e8b6a39d2d8f7e51b1a039988a387bb200d2fb759f39e880269efa2888b6.png" src="../_images/d111e8b6a39d2d8f7e51b1a039988a387bb200d2fb759f39e880269efa2888b6.png" />
<img alt="../_images/a9580a27bacc587e93f0cbb604bb5ace0a18c3d263d0008f7d3b651b4bc085f5.png" src="../_images/a9580a27bacc587e93f0cbb604bb5ace0a18c3d263d0008f7d3b651b4bc085f5.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                 0
count   355.000000
mean     -4.507657
std    1113.250244
min   -3301.730544
25%    -712.586706
50%      88.607167
75%     726.392783
max    3012.873611
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">serie_ARIMA</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Flow</th>
      <th>Mes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>7046.387097</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>5769.344828</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5016.483871</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4613.266667</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6783.838710</td>
      <td>5</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>439</th>
      <td>7277.535484</td>
      <td>440</td>
    </tr>
    <tr>
      <th>440</th>
      <td>8679.066667</td>
      <td>441</td>
    </tr>
    <tr>
      <th>441</th>
      <td>9349.567742</td>
      <td>442</td>
    </tr>
    <tr>
      <th>442</th>
      <td>9804.350000</td>
      <td>443</td>
    </tr>
    <tr>
      <th>443</th>
      <td>10353.732258</td>
      <td>444</td>
    </tr>
  </tbody>
</table>
<p>444 rows × 2 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predictions_ARMA</span><span class="p">,</span> <span class="n">residuales_ARMA</span> <span class="o">=</span> <span class="n">ARIMA_estimador</span><span class="p">(</span><span class="n">serie_ARIMA</span><span class="p">,</span> <span class="n">orden_arma</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7ac28b32ae1128bb4c5759a7054bdce94f5a3f7a8abf1ef1f02a8045c904a1cd.png" src="../_images/7ac28b32ae1128bb4c5759a7054bdce94f5a3f7a8abf1ef1f02a8045c904a1cd.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test RMSE: 1090.089
</pre></div>
</div>
<img alt="../_images/740079320f50341c4ad4b99df5ae86c6b758922da4d2704763e3a627ad91f6b3.png" src="../_images/740079320f50341c4ad4b99df5ae86c6b758922da4d2704763e3a627ad91f6b3.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions_ARMA</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1090.09
MAE: 857.68
RRMSE: 0.17
R-squared (R^2): 0.76
NSE (Nash-Sutcliffe Efficiency): 0.76
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="ridge">
<h2>Ridge<a class="headerlink" href="#ridge" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>

<span class="n">alpha_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>  <span class="c1"># Generates values from 1e-6 to 1e6 with 13 points</span>

<span class="c1"># Definir el conjunto de hiperparámetros para la búsqueda en cuadrícula</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;ridge__alpha&#39;</span><span class="p">:</span> <span class="n">alpha_values</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Crear el pipeline con MinMaxScaler y Ridge</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">(),</span> <span class="n">Ridge</span><span class="p">())</span>

<span class="c1"># Realizar la búsqueda en cuadrícula</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#39;minmaxscaler&#39;, MinMaxScaler()),
                                       (&#39;ridge&#39;, Ridge())]),
             n_jobs=-1,
             param_grid={&#39;ridge__alpha&#39;: array([ 0.1       ,  0.10476158,  0.10974988,  0.1149757 ,  0.12045035,
        0.12618569,  0.13219411,  0.13848864,  0.14508288,  0.15199111,
        0.15922828,  0.16681005,  0.17475284,  0.18307383,  0.19179103,
        0.2009233 ,  0.21049041,  0.22051307,  0.23101297,  0.24201283...
        2.05651231,  2.15443469,  2.25701972,  2.36448941,  2.47707636,
        2.59502421,  2.71858824,  2.84803587,  2.98364724,  3.12571585,
        3.27454916,  3.43046929,  3.59381366,  3.76493581,  3.94420606,
        4.1320124 ,  4.32876128,  4.53487851,  4.75081016,  4.97702356,
        5.21400829,  5.46227722,  5.72236766,  5.9948425 ,  6.28029144,
        6.57933225,  6.8926121 ,  7.22080902,  7.56463328,  7.92482898,
        8.30217568,  8.69749003,  9.11162756,  9.54548457, 10.        ])},
             scoring=&#39;r2&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;minmaxscaler&#39;, MinMaxScaler()),
                (&#39;ridge&#39;, Ridge(alpha=0.30538555088334157))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>

<span class="c1"># Calculo de Metricas</span>

<span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training-set score: 0.64
Test-set score: 0.59
RMSE: 1422.57
MAE: 1131.05
RRMSE: 0.22
R-squared (R^2): 0.59
NSE (Nash-Sutcliffe Efficiency): 0.59
</pre></div>
</div>
</div>
</div>
</section>
<section id="lasso">
<h2>Lasso<a class="headerlink" href="#lasso" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Lasso</span>

<span class="n">alpha_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>  <span class="c1"># Generates values from 1e-6 to 1e6 with 13 points</span>

<span class="c1"># Definir el conjunto de hiperparámetros para la búsqueda en cuadrícula</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;lasso__alpha&#39;</span><span class="p">:</span> <span class="n">alpha_values</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Crear el pipeline con MinMaxScaler y Lasso</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">(),</span> <span class="n">Lasso</span><span class="p">())</span>

<span class="c1"># Realizar la búsqueda en cuadrícula</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#39;minmaxscaler&#39;, MinMaxScaler()),
                                       (&#39;lasso&#39;, Lasso())]),
             n_jobs=-1,
             param_grid={&#39;lasso__alpha&#39;: array([ 0.1       ,  0.10476158,  0.10974988,  0.1149757 ,  0.12045035,
        0.12618569,  0.13219411,  0.13848864,  0.14508288,  0.15199111,
        0.15922828,  0.16681005,  0.17475284,  0.18307383,  0.19179103,
        0.2009233 ,  0.21049041,  0.22051307,  0.23101297,  0.24201283...
        2.05651231,  2.15443469,  2.25701972,  2.36448941,  2.47707636,
        2.59502421,  2.71858824,  2.84803587,  2.98364724,  3.12571585,
        3.27454916,  3.43046929,  3.59381366,  3.76493581,  3.94420606,
        4.1320124 ,  4.32876128,  4.53487851,  4.75081016,  4.97702356,
        5.21400829,  5.46227722,  5.72236766,  5.9948425 ,  6.28029144,
        6.57933225,  6.8926121 ,  7.22080902,  7.56463328,  7.92482898,
        8.30217568,  8.69749003,  9.11162756,  9.54548457, 10.        ])},
             scoring=&#39;r2&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;minmaxscaler&#39;, MinMaxScaler()),
                (&#39;lasso&#39;, Lasso(alpha=0.11497569953977356))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>

<span class="c1"># Calculo de Metricas</span>

<span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training-set score: 0.64
Test-set score: 0.59
RMSE: 1424.01
MAE: 1130.72
RRMSE: 0.22
R-squared (R^2): 0.59
NSE (Nash-Sutcliffe Efficiency): 0.59
</pre></div>
</div>
</div>
</div>
</section>
<section id="random-forest">
<h2>Random Forest<a class="headerlink" href="#random-forest" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">RandomForestRegressor</span><span class="p">())</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;randomforestregressor__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">400</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__max_leaf_nodes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__min_samples_split&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">]}</span>

<span class="n">RF</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">RF</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                                       (&#39;randomforestregressor&#39;,
                                        RandomForestRegressor())]),
             n_jobs=-1,
             param_grid={&#39;randomforestregressor__max_depth&#39;: [2, 3, 4],
                         &#39;randomforestregressor__max_leaf_nodes&#39;: [2, 4, 6, 8],
                         &#39;randomforestregressor__min_samples_split&#39;: [2, 5, 10,
                                                                      15],
                         &#39;randomforestregressor__n_estimators&#39;: [400]},
             scoring=&#39;r2&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                (&#39;randomforestregressor&#39;,
                 RandomForestRegressor(max_depth=3, max_leaf_nodes=8,
                                       min_samples_split=10,
                                       n_estimators=400))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training-set score: 0.68
Test-set score: 0.54
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res_RF_train</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">-</span><span class="n">RF</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">RF</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">res_RF_test</span><span class="o">=</span> <span class="n">y_test</span><span class="o">-</span><span class="n">y_pred</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_tree</span> <span class="o">=</span> <span class="n">RF</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_all</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h3>Metricas<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculo de Metricas</span>

<span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1506.74
MAE: 1166.69
RRMSE: 0.23
R-squared (R^2): 0.54
NSE (Nash-Sutcliffe Efficiency): 0.54
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_test</span><span class="o">.</span><span class="n">Mes</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_test</span><span class="o">.</span><span class="n">Mes</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;RF&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">data_test</span><span class="o">.</span><span class="n">Mes</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">data_test</span><span class="o">.</span><span class="n">Mes</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/849cdf57b3be2797ed494b05e9bf782c7c837ad359fbfb764e45aa6442e13b8c.png" src="../_images/849cdf57b3be2797ed494b05e9bf782c7c837ad359fbfb764e45aa6442e13b8c.png" />
</div>
</div>
</section>
</section>
<section id="k-nn-regresor">
<h2>k-NN regresor<a class="headerlink" href="#k-nn-regresor" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>  
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">neighbors</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_log_error</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">explained_variance_score</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">KNeighborsRegressor</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;kneighborsregressor__n_neighbors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">]}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                                       (&#39;kneighborsregressor&#39;,
                                        KNeighborsRegressor())]),
             param_grid={&#39;kneighborsregressor__n_neighbors&#39;: [1, 2, 4, 6, 8, 10,
                                                              15, 20, 30, 40]},
             scoring=&#39;r2&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                (&#39;kneighborsregressor&#39;, KNeighborsRegressor(n_neighbors=15))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training-set score: 0.66
Test-set score: 0.53
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculo de Metricas</span>

<span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1514.89
MAE: 1174.65
RRMSE: 0.23
R-squared (R^2): 0.53
NSE (Nash-Sutcliffe Efficiency): 0.53
</pre></div>
</div>
</div>
</div>
</section>
<section id="svr">
<h2>SVR<a class="headerlink" href="#svr" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;svr__kernel&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;rbf&#39;</span><span class="p">],</span>
    <span class="s1">&#39;svr__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
    <span class="s1">&#39;svr__epsilon&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">(),</span> <span class="n">SVR</span><span class="p">())</span>

<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#39;minmaxscaler&#39;, MinMaxScaler()),
                                       (&#39;svr&#39;, SVR())]),
             n_jobs=-1,
             param_grid={&#39;svr__C&#39;: [0.001, 0.01, 0.1, 1, 10, 100],
                         &#39;svr__epsilon&#39;: [0.001, 0.01, 0.1, 0.2, 0.5, 1],
                         &#39;svr__kernel&#39;: [&#39;linear&#39;, &#39;rbf&#39;]},
             scoring=&#39;r2&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;minmaxscaler&#39;, MinMaxScaler()),
                (&#39;svr&#39;, SVR(C=100, epsilon=0.001))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculo de Metricas</span>

<span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1624.98
MAE: 1303.93
RRMSE: 0.25
R-squared (R^2): 0.46
NSE (Nash-Sutcliffe Efficiency): 0.46
</pre></div>
</div>
</div>
</div>
</section>
<section id="redes-neuronales">
<h2>Redes Neuronales<a class="headerlink" href="#redes-neuronales" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">tensorflow</span> <span class="kn">import</span> <span class="n">keras</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">TransformedTargetRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.optimizers</span> <span class="kn">import</span> <span class="n">Adam</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>
<span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">load_model</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define el callback EarlyStopping</span>
<span class="n">early_stopping</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define el modelo de red neuronal</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
    <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Compila el modelo</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">)</span>

<span class="n">indice</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.8</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">))</span>

<span class="n">X_trainval</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[:</span><span class="n">indice</span><span class="p">]</span>
<span class="n">y_trainval</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[:</span><span class="n">indice</span><span class="p">]</span>
<span class="n">X_val</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">indice</span><span class="p">:]</span>
<span class="n">y_val</span> <span class="o">=</span> <span class="n">y_train</span><span class="p">[</span><span class="n">indice</span><span class="p">:]</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>


<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_trainval</span><span class="p">,</span> <span class="n">y_trainval</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                        <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">),</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">early_stopping</span><span class="p">])</span>


<span class="c1"># Evalúa el modelo en datos de prueba</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>



<span class="c1"># Grafica los resultados</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos reales&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicciones&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/200
3/3 [==============================] - 0s 36ms/step - loss: 42844240.0000 - val_loss: 47382072.0000
Epoch 2/200
3/3 [==============================] - 0s 10ms/step - loss: 30742990.0000 - val_loss: 31396980.0000
Epoch 3/200
3/3 [==============================] - 0s 10ms/step - loss: 20069602.0000 - val_loss: 18424000.0000
Epoch 4/200
3/3 [==============================] - 0s 10ms/step - loss: 11606135.0000 - val_loss: 9000642.0000
Epoch 5/200
3/3 [==============================] - 0s 9ms/step - loss: 5741597.0000 - val_loss: 4130624.5000
Epoch 6/200
3/3 [==============================] - 0s 9ms/step - loss: 3036724.5000 - val_loss: 3858846.2500
Epoch 7/200
3/3 [==============================] - 0s 9ms/step - loss: 3421605.7500 - val_loss: 5919814.0000
Epoch 8/200
3/3 [==============================] - 0s 9ms/step - loss: 4682536.5000 - val_loss: 6519600.0000
Epoch 9/200
3/3 [==============================] - 0s 10ms/step - loss: 4779051.5000 - val_loss: 5353511.0000
Epoch 10/200
3/3 [==============================] - 0s 9ms/step - loss: 3900821.7500 - val_loss: 3971691.7500
Epoch 11/200
3/3 [==============================] - 0s 10ms/step - loss: 3105566.7500 - val_loss: 3477356.0000
Epoch 12/200
3/3 [==============================] - 0s 10ms/step - loss: 2872937.5000 - val_loss: 3614912.5000
Epoch 13/200
3/3 [==============================] - 0s 9ms/step - loss: 2962462.2500 - val_loss: 3772758.2500
Epoch 14/200
3/3 [==============================] - 0s 9ms/step - loss: 3036336.2500 - val_loss: 3719651.5000
Epoch 15/200
3/3 [==============================] - 0s 9ms/step - loss: 2980723.5000 - val_loss: 3577754.2500
Epoch 16/200
3/3 [==============================] - 0s 10ms/step - loss: 2870840.7500 - val_loss: 3481371.0000
Epoch 17/200
3/3 [==============================] - 0s 9ms/step - loss: 2829176.0000 - val_loss: 3496514.0000
Epoch 18/200
3/3 [==============================] - 0s 9ms/step - loss: 2841994.2500 - val_loss: 3560003.7500
Epoch 19/200
3/3 [==============================] - 0s 9ms/step - loss: 2891840.2500 - val_loss: 3566108.7500
Epoch 20/200
3/3 [==============================] - 0s 10ms/step - loss: 2883154.2500 - val_loss: 3505244.2500
Epoch 21/200
3/3 [==============================] - 0s 10ms/step - loss: 2840445.5000 - val_loss: 3478744.2500
3/3 [==============================] - 0s 1ms/step
</pre></div>
</div>
<img alt="../_images/8401f7b167bd2904731f5725d28c45a156306713c5434b2b46fe2601989fbdac.png" src="../_images/8401f7b167bd2904731f5725d28c45a156306713c5434b2b46fe2601989fbdac.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1542.46
MAE: 1236.63
RRMSE: 0.24
R-squared (R^2): 0.51
NSE (Nash-Sutcliffe Efficiency): 0.51
</pre></div>
</div>
</div>
</div>
</section>
<section id="modelo-hibrido">
<h2>Modelo Hibrido<a class="headerlink" href="#modelo-hibrido" title="Permalink to this heading">#</a></h2>
<section id="random-forest-con-modelos-lineales">
<h3>Random Forest con modelos lineales<a class="headerlink" href="#random-forest-con-modelos-lineales" title="Permalink to this heading">#</a></h3>
<p>Entre los modelos lineales se encuentran: autoregressive (AR), moving average (MA), and autoregressive moving average (ARMA)</p>
<p>Para medir el rendimiento de todos los modelos desarrollados de manera cualitativa, los valores de RRMSE (Error Cuadrático Medio Raíz Relativo) se categorizaron de la siguiente manera:</p>
<ul class="simple">
<li><p>Excelente: 0% &lt; RRMSE &lt; 10%</p></li>
<li><p>Bueno: 10% &lt; RRMSE &lt; 20%</p></li>
<li><p>Regular: 20% &lt; RRMSE &lt; 30%</p></li>
<li><p>Malo: RRMSE &gt; 30%</p></li>
</ul>
</section>
<section id="ar-rf">
<h3>AR-RF<a class="headerlink" href="#ar-rf" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">residuales_test_lag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">residuales_test_extra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">residuales_test_lag</span><span class="p">,</span> <span class="n">X_test</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span>
<span class="c1">#residuales_test_extra = residuales_test_lag</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="c1">#plt.plot(data_test.Mes, y_pred, label=&quot;RF&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Caudal (m3/s)&#39;)
</pre></div>
</div>
<img alt="../_images/2c647242ef19397c30621fbeda30722e7be13b6d28c54f06c0be42c10d4b22b9.png" src="../_images/2c647242ef19397c30621fbeda30722e7be13b6d28c54f06c0be42c10d4b22b9.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_order</span> <span class="o">=</span> <span class="n">orden_ar</span>
<span class="n">history</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">train</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">residuals_train</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">resid</span>

<span class="n">residuales_train_lag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#residuales_train_extra = residuales_train_lag</span>
<span class="n">residuales_train_extra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">residuales_train_lag</span><span class="p">,</span> <span class="n">X_train</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="c1">#plt.plot(data_test.Mes, y_pred, label=&quot;RF&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Caudal (m3/s)&#39;)
</pre></div>
</div>
<img alt="../_images/5e2d97f9e1ea61533982ef07dad93c4b12d153fcabf86728277f25f2c88b8469.png" src="../_images/5e2d97f9e1ea61533982ef07dad93c4b12d153fcabf86728277f25f2c88b8469.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">RandomForestRegressor</span><span class="p">())</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;randomforestregressor__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">400</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__max_leaf_nodes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__min_samples_split&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">]}</span>

<span class="n">RF_e</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">RF_e</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">residuales_train_extra</span><span class="p">,</span> <span class="n">residuals_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                                       (&#39;randomforestregressor&#39;,
                                        RandomForestRegressor())]),
             n_jobs=-1,
             param_grid={&#39;randomforestregressor__max_depth&#39;: [2, 3, 4],
                         &#39;randomforestregressor__max_leaf_nodes&#39;: [2, 4, 6, 8],
                         &#39;randomforestregressor__min_samples_split&#39;: [2, 5, 10,
                                                                      15],
                         &#39;randomforestregressor__n_estimators&#39;: [400]},
             scoring=&#39;r2&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF_e</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                (&#39;randomforestregressor&#39;,
                 RandomForestRegressor(max_depth=2, max_leaf_nodes=6,
                                       min_samples_split=15,
                                       n_estimators=400))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">RF_e</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;plt.figure(figsize=(14,6))</span>
<span class="sd">plt.plot(residuals_train, label=&quot;Training data&quot;)</span>
<span class="sd">#plt.plot(residuales_AR, label=&quot;Test data&quot;)</span>
<span class="sd">plt.plot(y_tree, label=&quot;Tree prediction&quot;)</span>
<span class="sd">plt.legend();</span>

<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;plt.figure(figsize=(14,6))\nplt.plot(residuals_train, label=&quot;Training data&quot;)\n#plt.plot(residuales_AR, label=&quot;Test data&quot;)\nplt.plot(y_tree, label=&quot;Tree prediction&quot;)\nplt.legend();\n\n&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Tree prediction&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f36a47835376bb0e0bd40cf05977df73763c4a221b6b6448ef1a2767848a2411.png" src="../_images/f36a47835376bb0e0bd40cf05977df73763c4a221b6b6448ef1a2767848a2411.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1158.28
MAE: 906.35
RRMSE: -9.64
R-squared (R^2): 0.09
NSE (Nash-Sutcliffe Efficiency): 0.09
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF_e</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">residuales_train_extra</span><span class="p">,</span> <span class="n">residuals_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF_e</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">,</span> <span class="n">residuales_AR</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training-set score: 0.10
Test-set score: 0.09
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_residual</span> <span class="o">=</span> <span class="n">RF_e</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">)</span>

<span class="n">y_AR_RF</span> <span class="o">=</span> <span class="n">predictions_AR</span> <span class="o">+</span> <span class="n">y_residual</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_residual</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 207.66449928,  154.74417354,  105.93012027,   78.24147499,
        202.58557068,  154.53576782,   54.30979501,   94.2412036 ,
        156.74150847,   13.97192703, -110.86823938,   18.79306462,
         13.58991164,  -74.02883468,  -76.45100778, -127.12222416,
       -142.14515643, -176.17904596,    8.69899165, -118.29946188,
          6.10081348, -192.38536351,   -8.0279788 , -906.85689561,
       -174.09794452, -926.38949013, -729.08745279, -412.45411356,
       -939.01804426, -210.86498739, -349.18899433, -812.42418   ,
       -323.12891872, -112.35440771,  -91.65754597,    8.33845477,
         87.85320727,  170.06381002,  171.78488045,  162.89875591,
        208.27785877,  201.15447968,   79.87231996,   55.71137369,
        -40.08290257,  -78.67004461,  -60.82342836, -120.09534901,
        -75.58363917,  -14.91214384,  204.01577936,  162.89875591,
        170.31486946,  252.37075848,   75.51585182,   61.63751996,
        169.4423814 ,  217.77406245,  106.86752704,  -12.39780268,
         33.00145951,  -57.29885857, -122.95887425, -166.34721169,
       -209.74149727, -100.38983305,   -4.7313682 , -168.48274657,
         -7.92152862, -160.52259211, -110.4375309 , -170.8320711 ,
         20.38704286,  -31.95083747,  -68.35237414, -115.29147162,
       -129.19168861,   17.96383013,    6.10081348,  -75.73904509,
        -47.38359016,   20.41146559,    3.21444536,  185.49312485,
        156.20206181,  167.94426128,  115.36509631,  355.2217087 ,
        392.34103339])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">y_residual</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[ 207.66449928  154.74417354  105.93012027   78.24147499  202.58557068
  154.53576782   54.30979501   94.2412036   156.74150847   13.97192703
 -110.86823938   18.79306462   13.58991164  -74.02883468  -76.45100778
 -127.12222416 -142.14515643 -176.17904596    8.69899165 -118.29946188
    6.10081348 -192.38536351   -8.0279788  -906.85689561 -174.09794452
 -926.38949013 -729.08745279 -412.45411356 -939.01804426 -210.86498739
 -349.18899433 -812.42418    -323.12891872 -112.35440771  -91.65754597
    8.33845477   87.85320727  170.06381002  171.78488045  162.89875591
  208.27785877  201.15447968   79.87231996   55.71137369  -40.08290257
  -78.67004461  -60.82342836 -120.09534901  -75.58363917  -14.91214384
  204.01577936  162.89875591  170.31486946  252.37075848   75.51585182
   61.63751996  169.4423814   217.77406245  106.86752704  -12.39780268
   33.00145951  -57.29885857 -122.95887425 -166.34721169 -209.74149727
 -100.38983305   -4.7313682  -168.48274657   -7.92152862 -160.52259211
 -110.4375309  -170.8320711    20.38704286  -31.95083747  -68.35237414
 -115.29147162 -129.19168861   17.96383013    6.10081348  -75.73904509
  -47.38359016   20.41146559    3.21444536  185.49312485  156.20206181
  167.94426128  115.36509631  355.2217087   392.34103339]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">y_AR_RF</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1158.28
MAE: 906.35
RRMSE: 0.18
R-squared (R^2): 0.73
NSE (Nash-Sutcliffe Efficiency): 0.73
</pre></div>
</div>
</div>
</div>
</section>
<section id="arma-rf">
<h3>ARMA-RF<a class="headerlink" href="#arma-rf" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">residuales_test_lag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">residuales_ARMA</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">residuales_test_extra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">residuales_test_lag</span><span class="p">,</span> <span class="n">X_test</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_ARMA</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="c1">#plt.plot(data_test.Mes, y_pred, label=&quot;RF&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Caudal (m3/s)&#39;)
</pre></div>
</div>
<img alt="../_images/81dc4aca142a5250be789719ee86c33abd5de4c63aa4d0766a758072381d1d5e.png" src="../_images/81dc4aca142a5250be789719ee86c33abd5de4c63aa4d0766a758072381d1d5e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_order</span> <span class="o">=</span> <span class="n">orden_arma</span>
<span class="n">history</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">train</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">residuals_train</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">resid</span>

<span class="n">residuales_train_lag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#residuales_train_extra = residuales_train_lag</span>
<span class="n">residuales_train_extra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">residuales_train_lag</span><span class="p">,</span> <span class="n">X_train</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="c1">#plt.plot(data_test.Mes, y_pred, label=&quot;RF&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Caudal (m3/s)&#39;)
</pre></div>
</div>
<img alt="../_images/c6fbe50a8519dc62ba1489379fe5fd9a312e3b7e11a99227045f9f465d0196a2.png" src="../_images/c6fbe50a8519dc62ba1489379fe5fd9a312e3b7e11a99227045f9f465d0196a2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">RandomForestRegressor</span><span class="p">())</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;randomforestregressor__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">400</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__max_leaf_nodes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
              <span class="s1">&#39;randomforestregressor__min_samples_split&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">]}</span>

<span class="n">RF_e</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">RF_e</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">residuales_train_extra</span><span class="p">,</span> <span class="n">residuals_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=5,
             estimator=Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                                       (&#39;randomforestregressor&#39;,
                                        RandomForestRegressor())]),
             n_jobs=-1,
             param_grid={&#39;randomforestregressor__max_depth&#39;: [2, 3, 4],
                         &#39;randomforestregressor__max_leaf_nodes&#39;: [2, 4, 6, 8],
                         &#39;randomforestregressor__min_samples_split&#39;: [2, 5, 10,
                                                                      15],
                         &#39;randomforestregressor__n_estimators&#39;: [400]},
             scoring=&#39;r2&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best estimator:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF_e</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best estimator:
Pipeline(steps=[(&#39;standardscaler&#39;, StandardScaler()),
                (&#39;randomforestregressor&#39;,
                 RandomForestRegressor(max_depth=2, max_leaf_nodes=6,
                                       n_estimators=400))])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">RF_e</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Tree prediction&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ae8e1ff9efdc71c405b34c6ed98fbad4039b29474fb4021e97a177824e849e2f.png" src="../_images/ae8e1ff9efdc71c405b34c6ed98fbad4039b29474fb4021e97a177824e849e2f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1168.76
MAE: 919.88
RRMSE: -9.73
R-squared (R^2): 0.07
NSE (Nash-Sutcliffe Efficiency): 0.07
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF_e</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">residuales_train_extra</span><span class="p">,</span> <span class="n">residuals_train</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test-set score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RF_e</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">,</span> <span class="n">residuales_AR</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training-set score: 0.09
Test-set score: 0.07
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_residual</span> <span class="o">=</span> <span class="n">RF_e</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">)</span>

<span class="n">y_ARMA_RF</span> <span class="o">=</span> <span class="n">predictions_ARMA</span> <span class="o">+</span> <span class="n">y_residual</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">y_ARMA_RF</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1051.89
MAE: 831.62
RRMSE: 0.16
R-squared (R^2): 0.77
NSE (Nash-Sutcliffe Efficiency): 0.77
</pre></div>
</div>
</div>
</div>
</section>
<section id="ar-model">
<h3>AR-MODEL<a class="headerlink" href="#ar-model" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="c1">#plt.plot(data_test.Mes, y_pred, label=&quot;RF&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Caudal (m3/s)&#39;)
</pre></div>
</div>
<img alt="../_images/2c647242ef19397c30621fbeda30722e7be13b6d28c54f06c0be42c10d4b22b9.png" src="../_images/2c647242ef19397c30621fbeda30722e7be13b6d28c54f06c0be42c10d4b22b9.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_order</span> <span class="o">=</span> <span class="n">orden_ar</span>
<span class="n">history</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">train</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">residuals_train</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">resid</span>

<span class="n">residuales_train_lag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#residuales_train_extra = residuales_train_lag</span>
<span class="n">residuales_train_extra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">residuales_train_lag</span><span class="p">,</span> <span class="n">X_train</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Train data&quot;</span><span class="p">)</span>
<span class="c1">#plt.plot(data_test.Mes, y_pred, label=&quot;RF&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Caudal (m3/s)&#39;)
</pre></div>
</div>
<img alt="../_images/2ccce75afd1cfeefb7a626e82df05bee3da7544a5f7f38c3cbe75c00e628aec5.png" src="../_images/2ccce75afd1cfeefb7a626e82df05bee3da7544a5f7f38c3cbe75c00e628aec5.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>

<span class="c1"># Define a range of alpha values you want to test</span>
<span class="n">alpha_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>  <span class="c1"># Adjust as needed</span>

<span class="c1"># Create a pipeline with StandardScaler and Ridge regression</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">(),</span> <span class="n">Ridge</span><span class="p">())</span>

<span class="c1"># Define the parameter grid for the Ridge regression</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ridge__alpha&#39;</span><span class="p">:</span> <span class="n">alpha_values</span><span class="p">}</span>

<span class="c1"># Create the GridSearchCV object</span>
<span class="n">ridge_grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Fit the model to your training data</span>
<span class="n">ridge_grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">residuales_train_extra</span><span class="p">,</span> <span class="n">residuals_train</span><span class="p">)</span>


<span class="c1"># Evalúa el modelo en datos de prueba escalados</span>
<span class="n">y_pred_ridge</span> <span class="o">=</span> <span class="n">ridge_grid</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">)</span>

<span class="c1"># Grafica los resultados</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos reales&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred_ridge</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicciones&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ba999132e433797e72f79009880125aa650ac004586cf6e803882e95555f4da5.png" src="../_images/ba999132e433797e72f79009880125aa650ac004586cf6e803882e95555f4da5.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">residuales_AR</span><span class="p">,</span> <span class="n">y_pred_ridge</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1169.28
MAE: 919.99
RRMSE: -9.73
R-squared (R^2): 0.07
NSE (Nash-Sutcliffe Efficiency): 0.07
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_AR_Ridge</span> <span class="o">=</span> <span class="n">predictions_AR</span> <span class="o">+</span> <span class="n">y_pred_ridge</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_AR_Ridge</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1169.28
MAE: 919.99
RRMSE: 0.18
R-squared (R^2): 0.72
NSE (Nash-Sutcliffe Efficiency): 0.72
</pre></div>
</div>
</div>
</div>
</section>
<section id="arma-model">
<h3>ARMA-MODEL<a class="headerlink" href="#arma-model" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_ARMA</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Test data&quot;</span><span class="p">)</span>
<span class="c1">#plt.plot(data_test.Mes, y_pred, label=&quot;RF&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Agregamos nombres a los ejes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo (Mes)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje x</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Caudal (m3/s)&quot;</span><span class="p">)</span>  <span class="c1"># Nombre del eje y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Caudal (m3/s)&#39;)
</pre></div>
</div>
<img alt="../_images/81dc4aca142a5250be789719ee86c33abd5de4c63aa4d0766a758072381d1d5e.png" src="../_images/81dc4aca142a5250be789719ee86c33abd5de4c63aa4d0766a758072381d1d5e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">best_order</span> <span class="o">=</span> <span class="n">orden_arma</span>
<span class="n">history</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">train</span><span class="p">]</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">best_order</span><span class="p">)</span>
<span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">residuals_train</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">resid</span>

<span class="n">residuales_train_lag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#residuales_train_extra = residuales_train_lag</span>
<span class="n">residuales_train_extra</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">residuales_train_lag</span><span class="p">,</span> <span class="n">X_train</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>

<span class="c1"># Define a range of alpha values you want to test</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;svr__kernel&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;rbf&#39;</span><span class="p">],</span>
    <span class="s1">&#39;svr__C&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>
    <span class="s1">&#39;svr__epsilon&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="p">}</span>
<span class="c1"># Create a pipeline with StandardScaler and Ridge regression</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">(),</span> <span class="n">SVR</span><span class="p">())</span>


<span class="c1"># Create the GridSearchCV object</span>
<span class="n">ridge_grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Fit the model to your training data</span>
<span class="n">ridge_grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">residuales_train_extra</span><span class="p">,</span> <span class="n">residuals_train</span><span class="p">)</span>


<span class="c1"># Evalúa el modelo en datos de prueba escalados</span>
<span class="n">y_pred_ridge</span> <span class="o">=</span> <span class="n">ridge_grid</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">)</span>

<span class="c1"># Grafica los resultados</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_ARMA</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos reales&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred_ridge</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicciones&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/da0ebf277fb13890027f2e3a918afc0a389a7820a95a68c413c330ad482795f3.png" src="../_images/da0ebf277fb13890027f2e3a918afc0a389a7820a95a68c413c330ad482795f3.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>

<span class="c1"># Define a range of alpha values you want to test</span>
<span class="n">alpha_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>  <span class="c1"># Adjust as needed</span>

<span class="c1"># Create a pipeline with StandardScaler and Ridge regression</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">MinMaxScaler</span><span class="p">(),</span> <span class="n">Ridge</span><span class="p">())</span>

<span class="c1"># Define the parameter grid for the Ridge regression</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ridge__alpha&#39;</span><span class="p">:</span> <span class="n">alpha_values</span><span class="p">}</span>

<span class="c1"># Create the GridSearchCV object</span>
<span class="n">ridge_grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipe</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Fit the model to your training data</span>
<span class="n">ridge_grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">residuales_train_extra</span><span class="p">,</span> <span class="n">residuals_train</span><span class="p">)</span>


<span class="c1"># Evalúa el modelo en datos de prueba escalados</span>
<span class="n">y_pred_ridge</span> <span class="o">=</span> <span class="n">ridge_grid</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">residuales_test_extra</span><span class="p">)</span>

<span class="c1"># Grafica los resultados</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residuales_ARMA</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos reales&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_pred_ridge</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicciones&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2751f03c12f08483d2f4591f7dae8ce96848263ee9d8142e597db35a0cc49608.png" src="../_images/2751f03c12f08483d2f4591f7dae8ce96848263ee9d8142e597db35a0cc49608.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;import numpy as np</span>
<span class="sd">from xgboost import XGBRegressor</span>
<span class="sd">from sklearn.model_selection import GridSearchCV</span>
<span class="sd">from sklearn.preprocessing import MinMaxScaler</span>
<span class="sd">import matplotlib.pyplot as plt</span>


<span class="sd"># Define el modelo XGBoost Regressor</span>
<span class="sd">xgb_model = XGBRegressor()</span>



<span class="sd"># Define los hiperparámetros que deseas buscar utilizando GridSearchCV</span>
<span class="sd">param_grid = {</span>
<span class="sd">    &#39;max_depth&#39;: range (2, 10, 1),</span>
<span class="sd">    &#39;n_estimators&#39;: range(60, 220, 40),</span>
<span class="sd">    &#39;learning_rate&#39;: [0.1, 0.01, 0.05]</span>
<span class="sd">}</span>

<span class="sd"># Create the GridSearchCV object</span>
<span class="sd">xgb_grid = GridSearchCV(xgb_model, param_grid, scoring=&#39;r2&#39;, cv=5, n_jobs=-1)</span>

<span class="sd"># Fit the model to your training data</span>
<span class="sd">xgb_grid.fit(residuales_train_extra, residuals_train)</span>

<span class="sd"># Evaluate the model on scaled test data</span>
<span class="sd">y_pred_xgb = xgb_grid.predict(residuales_test_extra)</span>

<span class="sd"># Plot the results</span>
<span class="sd">plt.figure(figsize=(10, 6))</span>
<span class="sd">plt.plot(residuales_ARMA, label=&#39;Datos reales&#39;, marker=&#39;o&#39;, linestyle=&#39;&#39; )</span>
<span class="sd">plt.plot(y_pred_xgb, label=&#39;Predicciones&#39;)</span>
<span class="sd">plt.legend()</span>
<span class="sd">plt.show()</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&quot;import numpy as np\nfrom xgboost import XGBRegressor\nfrom sklearn.model_selection import GridSearchCV\nfrom sklearn.preprocessing import MinMaxScaler\nimport matplotlib.pyplot as plt\n\n\n# Define el modelo XGBoost Regressor\nxgb_model = XGBRegressor()\n\n\n\n# Define los hiperparámetros que deseas buscar utilizando GridSearchCV\nparam_grid = {\n    &#39;max_depth&#39;: range (2, 10, 1),\n    &#39;n_estimators&#39;: range(60, 220, 40),\n    &#39;learning_rate&#39;: [0.1, 0.01, 0.05]\n}\n\n# Create the GridSearchCV object\nxgb_grid = GridSearchCV(xgb_model, param_grid, scoring=&#39;r2&#39;, cv=5, n_jobs=-1)\n\n# Fit the model to your training data\nxgb_grid.fit(residuales_train_extra, residuals_train)\n\n# Evaluate the model on scaled test data\ny_pred_xgb = xgb_grid.predict(residuales_test_extra)\n\n# Plot the results\nplt.figure(figsize=(10, 6))\nplt.plot(residuales_ARMA, label=&#39;Datos reales&#39;, marker=&#39;o&#39;, linestyle=&#39;&#39; )\nplt.plot(y_pred_xgb, label=&#39;Predicciones&#39;)\nplt.legend()\nplt.show()\n&quot;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">residuales_ARMA</span><span class="p">,</span> <span class="n">y_pred_ridge</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1060.48
MAE: 835.47
RRMSE: -11.17
R-squared (R^2): 0.05
NSE (Nash-Sutcliffe Efficiency): 0.05
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_ARMA_NN</span> <span class="o">=</span> <span class="n">predictions_ARMA</span> <span class="o">+</span> <span class="n">y_pred_ridge</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metricas</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">y_ARMA_NN</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE: 1060.48
MAE: 835.47
RRMSE: 0.16
R-squared (R^2): 0.77
NSE (Nash-Sutcliffe Efficiency): 0.77
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./intentos"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">aapineda</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#river-flow-forecasting-a-hybrid-approach-integrating-machine-learning-and-linear-time-series-models">River Flow Forecasting: A Hybrid Approach Integrating Machine Learning and Linear Time Series Models</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resumen"><strong>Resumen</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metodologia"><strong>Metodología</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#librerias-necesarias">Librerias Necesarias</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset">Dataset</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#relacion-entre-enso-y-caudal">Relacion entre ENSO y Caudal</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#lag-a-los-datos">Lag a los datos</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#auto-correlation-function-acf-and-partial-autocorrelation-funcion-pacf">Auto Correlation function (ACF) and Partial Autocorrelation Funcion(PACF).</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#datos-de-entrenamiento-y-prueba">Datos de Entrenamiento y Prueba</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metricas">Metricas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#arima">ARIMA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#funcion-arima">Funcion ARIMA</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-lineales">Modelos lineales</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ar">AR</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arma">ARMA</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ridge">Ridge</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lasso">Lasso</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest">Random Forest</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Metricas</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#k-nn-regresor">k-NN regresor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#svr">SVR</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#redes-neuronales">Redes Neuronales</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-hibrido">Modelo Hibrido</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#random-forest-con-modelos-lineales">Random Forest con modelos lineales</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ar-rf">AR-RF</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arma-rf">ARMA-RF</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ar-model">AR-MODEL</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#arma-model">ARMA-MODEL</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Angel Andres Pineda Lopez
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>